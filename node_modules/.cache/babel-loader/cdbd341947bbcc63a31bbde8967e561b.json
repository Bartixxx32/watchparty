{"ast":null,"code":"\"use strict\";\n\nvar _createForOfIteratorHelper = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function get() {\n        return m[k];\n      }\n    };\n  }\n\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.mangleRtpParameters = exports.getCapabilities = void 0;\n\nvar utils = __importStar(require(\"../../utils\"));\n/**\n * Normalize ORTC based Edge's RTCRtpReceiver.getCapabilities() to produce a full\n * compliant ORTC RTCRtpCapabilities.\n */\n\n\nfunction getCapabilities() {\n  var nativeCaps = RTCRtpReceiver.getCapabilities();\n  var caps = utils.clone(nativeCaps, {});\n\n  var _iterator = _createForOfIteratorHelper(caps.codecs),\n      _step;\n\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var codec = _step.value;\n      // Rename numChannels to channels.\n      codec.channels = codec.numChannels;\n      delete codec.numChannels; // Add mimeType.\n\n      codec.mimeType = codec.mimeType || \"\".concat(codec.kind, \"/\").concat(codec.name); // NOTE: Edge sets some numeric parameters as string rather than number. Fix them.\n\n      if (codec.parameters) {\n        var parameters = codec.parameters;\n\n        if (parameters.apt) {\n          parameters.apt = Number(parameters.apt);\n        }\n\n        if (parameters['packetization-mode']) {\n          parameters['packetization-mode'] = Number(parameters['packetization-mode']);\n        }\n      } // Delete emty parameter String in rtcpFeedback.\n\n\n      var _iterator2 = _createForOfIteratorHelper(codec.rtcpFeedback || []),\n          _step2;\n\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var feedback = _step2.value;\n\n          if (!feedback.parameter) {\n            feedback.parameter = '';\n          }\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n\n  return caps;\n}\n\nexports.getCapabilities = getCapabilities;\n/**\n * Generate RTCRtpParameters as ORTC based Edge likes.\n */\n\nfunction mangleRtpParameters(rtpParameters) {\n  var params = utils.clone(rtpParameters, {}); // Rename mid to muxId.\n\n  if (params.mid) {\n    params.muxId = params.mid;\n    delete params.mid;\n  }\n\n  var _iterator3 = _createForOfIteratorHelper(params.codecs),\n      _step3;\n\n  try {\n    for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n      var codec = _step3.value;\n\n      // Rename channels to numChannels.\n      if (codec.channels) {\n        codec.numChannels = codec.channels;\n        delete codec.channels;\n      } // Add codec.name (requried by Edge).\n\n\n      if (codec.mimeType && !codec.name) {\n        codec.name = codec.mimeType.split('/')[1];\n      } // Remove mimeType.\n\n\n      delete codec.mimeType;\n    }\n  } catch (err) {\n    _iterator3.e(err);\n  } finally {\n    _iterator3.f();\n  }\n\n  return params;\n}\n\nexports.mangleRtpParameters = mangleRtpParameters;","map":{"version":3,"names":["__createBinding","Object","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","prototype","hasOwnProperty","call","exports","mangleRtpParameters","getCapabilities","utils","require","nativeCaps","RTCRtpReceiver","caps","clone","codecs","codec","channels","numChannels","mimeType","kind","name","parameters","apt","Number","rtcpFeedback","feedback","parameter","rtpParameters","params","mid","muxId","split"],"sources":["/home/runner/work/watchparty/watchparty/node_modules/mediasoup-client/lib/handlers/ortc/edgeUtils.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.mangleRtpParameters = exports.getCapabilities = void 0;\nconst utils = __importStar(require(\"../../utils\"));\n/**\n * Normalize ORTC based Edge's RTCRtpReceiver.getCapabilities() to produce a full\n * compliant ORTC RTCRtpCapabilities.\n */\nfunction getCapabilities() {\n    const nativeCaps = RTCRtpReceiver.getCapabilities();\n    const caps = utils.clone(nativeCaps, {});\n    for (const codec of caps.codecs) {\n        // Rename numChannels to channels.\n        codec.channels = codec.numChannels;\n        delete codec.numChannels;\n        // Add mimeType.\n        codec.mimeType = codec.mimeType || `${codec.kind}/${codec.name}`;\n        // NOTE: Edge sets some numeric parameters as string rather than number. Fix them.\n        if (codec.parameters) {\n            const parameters = codec.parameters;\n            if (parameters.apt) {\n                parameters.apt = Number(parameters.apt);\n            }\n            if (parameters['packetization-mode']) {\n                parameters['packetization-mode'] = Number(parameters['packetization-mode']);\n            }\n        }\n        // Delete emty parameter String in rtcpFeedback.\n        for (const feedback of codec.rtcpFeedback || []) {\n            if (!feedback.parameter) {\n                feedback.parameter = '';\n            }\n        }\n    }\n    return caps;\n}\nexports.getCapabilities = getCapabilities;\n/**\n * Generate RTCRtpParameters as ORTC based Edge likes.\n */\nfunction mangleRtpParameters(rtpParameters) {\n    const params = utils.clone(rtpParameters, {});\n    // Rename mid to muxId.\n    if (params.mid) {\n        params.muxId = params.mid;\n        delete params.mid;\n    }\n    for (const codec of params.codecs) {\n        // Rename channels to numChannels.\n        if (codec.channels) {\n            codec.numChannels = codec.channels;\n            delete codec.channels;\n        }\n        // Add codec.name (requried by Edge).\n        if (codec.mimeType && !codec.name) {\n            codec.name = codec.mimeType.split('/')[1];\n        }\n        // Remove mimeType.\n        delete codec.mimeType;\n    }\n    return params;\n}\nexports.mangleRtpParameters = mangleRtpParameters;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}