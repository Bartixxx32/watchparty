{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import{Button,Comment,Form,Icon,Input,Popup}from'semantic-ui-react';// import data from '@emoji-mart/data';\nimport Picker from'@emoji-mart/react';import{init}from'emoji-mart';// import onClickOutside from 'react-onclickoutside';\n//@ts-ignore\nimport Linkify from'react-linkify';import{SecureLink}from'react-secure-link';import styles from'./Chat.module.css';import{formatTimestamp,formatUnixTime,getColorForStringHex,getDefaultPicture,isEmojiString}from'../../utils';import{Separator}from'../App/App';import{UserMenu}from'../UserMenu/UserMenu';import classes from'./Chat.module.css';import{CSSTransition,SwitchTransition,TransitionGroup}from'react-transition-group';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var Chat=/*#__PURE__*/function(_React$Component){_inherits(Chat,_React$Component);var _super=_createSuper(Chat);function Chat(){var _this;_classCallCheck(this,Chat);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={chatMsg:'',isNearBottom:true,isPickerOpen:false,reactionMenu:{isOpen:false,selectedMsgId:'',selectedMsgTimestamp:'',yPosition:0,xPosition:0}};_this.messagesRef=/*#__PURE__*/React.createRef();_this.setReactionMenu=function(isOpen,selectedMsgId,selectedMsgTimestamp,yPosition,xPosition){_this.setState({reactionMenu:{isOpen:isOpen,selectedMsgId:selectedMsgId,selectedMsgTimestamp:selectedMsgTimestamp,yPosition:yPosition,xPosition:xPosition}});};_this.handleReactionClick=function(value,id,timestamp){var _msg$reactions;var msg=_this.props.chat.find(function(m){return m.id===id&&m.timestamp===timestamp;});var data={value:value,msgId:id||_this.state.reactionMenu.selectedMsgId,msgTimestamp:timestamp||_this.state.reactionMenu.selectedMsgTimestamp};if(msg!==null&&msg!==void 0&&(_msg$reactions=msg.reactions)!==null&&_msg$reactions!==void 0&&_msg$reactions[value].includes(_this.props.socket.id)){_this.props.socket.emit('CMD:removeReaction',data);}else{_this.props.socket.emit('CMD:addReaction',data);}};_this.updateChatMsg=function(_e,data){// console.log(e.target.selectionStart);\n_this.setState({chatMsg:data.value});};_this.sendChatMsg=function(){if(!_this.state.chatMsg){return;}if(_this.chatTooLong()){return;}_this.setState({chatMsg:''});_this.props.socket.emit('CMD:chat',_this.state.chatMsg);};_this.chatTooLong=function(){var _this$state$chatMsg;return Boolean(((_this$state$chatMsg=_this.state.chatMsg)===null||_this$state$chatMsg===void 0?void 0:_this$state$chatMsg.length)>10000);};_this.onScroll=function(){_this.setState({isNearBottom:_this.isChatNearBottom()});};_this.isChatNearBottom=function(){return _this.messagesRef.current&&_this.messagesRef.current.scrollHeight-_this.messagesRef.current.scrollTop-_this.messagesRef.current.offsetHeight<100;};_this.scrollToBottom=function(){if(_this.messagesRef.current){_this.messagesRef.current.scrollTop=_this.messagesRef.current.scrollHeight;}};_this.formatMessage=function(cmd,msg){if(cmd==='host'){return/*#__PURE__*/_jsxs(React.Fragment,{children:[\"changed the video to \",/*#__PURE__*/_jsx(\"span\",{style:{textTransform:'initial'},children:_this.props.getMediaDisplayName(msg)})]});}else if(cmd==='playlistAdd'){return/*#__PURE__*/_jsxs(React.Fragment,{children:[\"added to the playlist: \",/*#__PURE__*/_jsx(\"span\",{style:{textTransform:'initial'},children:_this.props.getMediaDisplayName(msg)})]});}else if(cmd==='seek'){return\"jumped to \".concat(_this.props.isLiveHls?formatUnixTime(msg):formatTimestamp(msg));}else if(cmd==='play'){return\"started the video at \".concat(formatTimestamp(msg));}else if(cmd==='pause'){return\"paused the video at \".concat(formatTimestamp(msg));}else if(cmd==='playbackRate'){return\"set the playback rate to \".concat(msg==='0'?'auto':\"\".concat(msg,\"x\"));}else if(cmd==='lock'){return\"locked the room\";}else if(cmd==='unlock'){return'unlocked the room';}else if(cmd==='vBrowserTimeout'){return/*#__PURE__*/_jsxs(React.Fragment,{children:[\"The VBrowser shut down automatically.\",/*#__PURE__*/_jsx(\"br\",{}),\"Subscribe for longer sessions.\"]});}else if(cmd==='vBrowserAlmostTimeout'){return/*#__PURE__*/_jsxs(React.Fragment,{children:[\"The VBrowser will shut down soon.\",/*#__PURE__*/_jsx(\"br\",{}),\"Subscribe for longer sessions.\"]});}return cmd;};_this.addEmoji=function(emoji){_this.setState({chatMsg:_this.state.chatMsg+emoji.native});};return _this;}_createClass(Chat,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _this$messagesRef$cur;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:this.scrollToBottom();(_this$messagesRef$cur=this.messagesRef.current)===null||_this$messagesRef$cur===void 0?void 0:_this$messagesRef$cur.addEventListener('scroll',this.onScroll);init({});case 3:case\"end\":return _context.stop();}}},_callee,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(this.props.scrollTimestamp!==prevProps.scrollTimestamp){if(prevProps.scrollTimestamp===0||this.state.isNearBottom){this.scrollToBottom();}}if(this.props.hide!==prevProps.hide){this.scrollToBottom();}}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsxs(\"div\",{className:this.props.className,style:{display:this.props.hide?'none':'flex',flexDirection:'column',flexGrow:1,minHeight:0,marginTop:0,marginBottom:0,padding:'8px'},children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.chatContainer,ref:this.messagesRef,style:{position:'relative',paddingTop:13},children:[/*#__PURE__*/_jsx(Comment.Group,{children:this.props.chat.map(function(msg){return/*#__PURE__*/_jsx(ChatMessage,{className:msg.id===_this2.state.reactionMenu.selectedMsgId&&msg.timestamp===_this2.state.reactionMenu.selectedMsgTimestamp?classes.selected:'',message:msg,pictureMap:_this2.props.pictureMap,nameMap:_this2.props.nameMap,formatMessage:_this2.formatMessage,owner:_this2.props.owner,user:_this2.props.user,socket:_this2.props.socket,isChatDisabled:_this2.props.isChatDisabled,setReactionMenu:_this2.setReactionMenu,handleReactionClick:_this2.handleReactionClick},msg.timestamp+msg.id);})}),!this.state.isNearBottom&&/*#__PURE__*/_jsx(Button,{size:\"tiny\",onClick:this.scrollToBottom,style:{position:'sticky',bottom:0,display:'block',margin:'0 auto'},children:\"Jump to bottom\"})]}),/*#__PURE__*/_jsx(Separator,{}),this.state.isPickerOpen&&/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',bottom:'60px'},children:/*#__PURE__*/_jsx(Picker,{theme:\"dark\",previewPosition:\"none\",maxFrequentRows:1,onEmojiSelect:this.addEmoji,onClickOutside:function onClickOutside(){return _this2.setState({isPickerOpen:false});}})}),/*#__PURE__*/_jsx(CSSTransition,{in:this.state.reactionMenu.isOpen,timeout:300,classNames:{enter:classes['reactionMenu-enter'],enterActive:classes['reactionMenu-enter-active'],exit:classes['reactionMenu-exit'],exitActive:classes['reactionMenu-exit-active']},unmountOnExit:true,children:/*#__PURE__*/_jsx(\"div\",{style:{position:'fixed',top:Math.min(this.state.reactionMenu.yPosition-150,window.innerHeight-450),left:this.state.reactionMenu.xPosition-240},children:/*#__PURE__*/_jsx(Picker,{theme:\"dark\",previewPosition:\"none\",maxFrequentRows:1,perLine:6,onClickOutside:function onClickOutside(){return _this2.setReactionMenu(false);},onEmojiSelect:function onEmojiSelect(emoji){_this2.handleReactionClick(emoji.native);_this2.setReactionMenu(false);}})})}),/*#__PURE__*/_jsx(Form,{autoComplete:\"off\",children:/*#__PURE__*/_jsxs(Input,{inverted:true,fluid:true,onKeyPress:function onKeyPress(e){return e.key==='Enter'&&_this2.sendChatMsg();},onChange:this.updateChatMsg,value:this.state.chatMsg,error:this.chatTooLong(),icon:true,disabled:this.props.isChatDisabled,placeholder:this.props.isChatDisabled?'The chat was disabled by the room owner.':'Enter a message...',children:[/*#__PURE__*/_jsx(\"input\",{}),/*#__PURE__*/_jsx(Icon// style={{ right: '40px' }}\n,{onClick:function onClick(){// Add a delay to prevent the click from triggering onClickOutside\nvar curr=_this2.state.isPickerOpen;setTimeout(function(){return _this2.setState({isPickerOpen:!curr});},100);},name:undefined,inverted:true,circular:true,link:true,disabled:this.props.isChatDisabled,style:{opacity:1},children:/*#__PURE__*/_jsx(\"span\",{role:\"img\",\"aria-label\":\"Emoji\",children:\"\\uD83D\\uDE00\"})})]})})]});}}]);return Chat;}(React.Component);var ChatMessage=function ChatMessage(_ref){var message=_ref.message,nameMap=_ref.nameMap,pictureMap=_ref.pictureMap,formatMessage=_ref.formatMessage,user=_ref.user,socket=_ref.socket,owner=_ref.owner,isChatDisabled=_ref.isChatDisabled,setReactionMenu=_ref.setReactionMenu,handleReactionClick=_ref.handleReactionClick,className=_ref.className;var id=message.id,timestamp=message.timestamp,cmd=message.cmd,msg=message.msg,system=message.system,isSub=message.isSub,reactions=message.reactions,videoTS=message.videoTS;var spellFull=5;// the number of people whose names should be written out in full in the reaction popup\nreturn/*#__PURE__*/_jsxs(Comment,{className:\"\".concat(classes.comment,\" \").concat(className),children:[id?/*#__PURE__*/_jsx(Popup,{content:\"WatchParty Plus subscriber\",disabled:!isSub,trigger:/*#__PURE__*/_jsx(Comment.Avatar,{className:isSub?classes.subscriber:'',src:pictureMap[id]||getDefaultPicture(nameMap[id],getColorForStringHex(id))})}):null,/*#__PURE__*/_jsxs(Comment.Content,{children:[/*#__PURE__*/_jsx(UserMenu,{displayName:nameMap[id]||id,user:user,timestamp:timestamp,socket:socket,userToManage:id,isChatMessage:true,disabled:!Boolean(owner&&owner===(user===null||user===void 0?void 0:user.uid)),trigger:/*#__PURE__*/_jsxs(Comment.Author,{as:\"a\",className:styles.light,children:[Boolean(system)&&'System',nameMap[id]||id]})}),/*#__PURE__*/_jsx(Comment.Metadata,{className:styles.dark,children:/*#__PURE__*/_jsxs(\"div\",{title:new Date(timestamp).toLocaleDateString(),children:[new Date(timestamp).toLocaleTimeString(),Boolean(videoTS)&&' @ ',formatTimestamp(videoTS)]})}),/*#__PURE__*/_jsx(Comment.Text,{className:styles.light+' '+styles.system,children:cmd&&formatMessage(cmd,msg)}),/*#__PURE__*/_jsx(Linkify,{componentDecorator:function componentDecorator(decoratedHref,decoratedText,key){return/*#__PURE__*/_jsx(SecureLink,{href:decoratedHref,children:decoratedText},key);},children:/*#__PURE__*/_jsx(Comment.Text,{className:\"\".concat(styles.light,\" \").concat(isEmojiString(msg)?styles.emoji:''),children:!cmd&&msg})}),/*#__PURE__*/_jsx(\"div\",{className:classes.commentMenu,children:/*#__PURE__*/_jsx(Icon,{onClick:function onClick(e){var viewportOffset=e.target.getBoundingClientRect();setTimeout(function(){setReactionMenu(true,id,timestamp,viewportOffset.top,viewportOffset.right);},100);},name:undefined,inverted:true,link:true,disabled:isChatDisabled,style:{opacity:1,display:'flex',justifyContent:'center',alignItems:'center',padding:10,margin:0},children:/*#__PURE__*/_jsx(\"span\",{role:\"img\",\"aria-label\":\"React\",style:{margin:0,fontSize:18},children:\"\\uD83D\\uDE00\"})})}),/*#__PURE__*/_jsx(TransitionGroup,{children:Object.keys(reactions!==null&&reactions!==void 0?reactions:[]).map(function(key){return reactions!==null&&reactions!==void 0&&reactions[key].length?/*#__PURE__*/_jsx(CSSTransition,{timeout:200,classNames:{enter:classes['reaction-enter'],enterActive:classes['reaction-enter-active'],exit:classes['reaction-exit'],exitActive:classes['reaction-exit-active']},unmountOnExit:true,children:/*#__PURE__*/_jsx(Popup,{content:\"\".concat(reactions[key].slice(0,spellFull).map(function(id){return nameMap[id]||'Unknown';}).concat(reactions[key].length>spellFull?[\"\".concat(reactions[key].length-spellFull,\" more\")]:[]).reduce(function(text,value,i,array){return text+(i<array.length-1?', ':' and ')+value;}),\" reacted.\"),offset:[0,6],trigger:/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(classes.reactionContainer,\" \").concat(reactions[key].includes(socket.id)?classes.highlighted:''),onClick:function onClick(){return handleReactionClick(key,message.id,message.timestamp);},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:17,position:'relative',bottom:1},children:key}),/*#__PURE__*/_jsx(SwitchTransition,{children:/*#__PURE__*/_jsx(CSSTransition,{classNames:{enter:classes['reactionCounter-enter'],enterActive:classes['reactionCounter-enter-active'],exit:classes['reactionCounter-exit'],exitActive:classes['reactionCounter-exit-active']},addEndListener:function addEndListener(node,done){return node.addEventListener('transitionend',done,false);},unmountOnExit:true,children:/*#__PURE__*/_jsx(\"span\",{className:classes.reactionCounter,style:{color:'rgba(255, 255, 255, 0.85)',marginLeft:3},children:reactions[key].length})},key+'-'+reactions[key].length)})]})})},key):null;})})]})]});};// class ReactionMenuInner extends React.Component<{\n//   handleReactionClick: (value: string, id?: string, timestamp?: string) => void;\n//   closeMenu: () => void;\n//   yPosition: number;\n//   xPosition: number;\n// }> {\n//   state = {\n//     containerWidth: 0,\n//   };\n//   handleClickOutside = () => {\n//     this.props.closeMenu();\n//   };\n//   containerRef = React.createRef<HTMLDivElement>();\n//   componentDidMount() {\n//     this.setState({ containerWidth: this.containerRef.current?.offsetWidth });\n//   }\n//   render() {\n//     return (\n//       <div\n//         ref={this.containerRef}\n//         className={classes.reactionMenuContainer}\n//         style={{\n//           top: this.props.yPosition - 9,\n//           left: this.props.xPosition - this.state.containerWidth - 35,\n//         }}\n//       >\n//         {reactionEmojis.map((reaction) => (\n//           <div\n//             onClick={() => {\n//               this.props.handleReactionClick(reaction);\n//               this.props.closeMenu();\n//             }}\n//             style={{ cursor: 'pointer' }}\n//           >\n//             {reaction}\n//           </div>\n//         ))}\n//       </div>\n//     );\n//   }\n// }\n// const ReactionMenu = onClickOutside(ReactionMenuInner);","map":{"version":3,"names":["React","Button","Comment","Form","Icon","Input","Popup","Picker","init","Linkify","SecureLink","styles","formatTimestamp","formatUnixTime","getColorForStringHex","getDefaultPicture","isEmojiString","Separator","UserMenu","classes","CSSTransition","SwitchTransition","TransitionGroup","Chat","state","chatMsg","isNearBottom","isPickerOpen","reactionMenu","isOpen","selectedMsgId","selectedMsgTimestamp","yPosition","xPosition","messagesRef","createRef","setReactionMenu","setState","handleReactionClick","value","id","timestamp","msg","props","chat","find","m","data","msgId","msgTimestamp","reactions","includes","socket","emit","updateChatMsg","_e","sendChatMsg","chatTooLong","Boolean","length","onScroll","isChatNearBottom","current","scrollHeight","scrollTop","offsetHeight","scrollToBottom","formatMessage","cmd","textTransform","getMediaDisplayName","isLiveHls","addEmoji","emoji","native","addEventListener","prevProps","scrollTimestamp","hide","className","display","flexDirection","flexGrow","minHeight","marginTop","marginBottom","padding","chatContainer","position","paddingTop","map","selected","pictureMap","nameMap","owner","user","isChatDisabled","bottom","margin","enter","enterActive","exit","exitActive","top","Math","min","window","innerHeight","left","e","key","curr","setTimeout","undefined","opacity","Component","ChatMessage","message","system","isSub","videoTS","spellFull","comment","subscriber","uid","light","dark","Date","toLocaleDateString","toLocaleTimeString","decoratedHref","decoratedText","commentMenu","viewportOffset","target","getBoundingClientRect","right","justifyContent","alignItems","fontSize","Object","keys","slice","concat","reduce","text","i","array","reactionContainer","highlighted","node","done","reactionCounter","color","marginLeft"],"sources":["/home/runner/work/watchparty/watchparty/src/components/Chat/Chat.tsx"],"sourcesContent":["import React, { RefObject } from 'react';\nimport { Button, Comment, Form, Icon, Input, Popup } from 'semantic-ui-react';\n// import data from '@emoji-mart/data';\nimport Picker from '@emoji-mart/react';\nimport { init } from 'emoji-mart';\n// import onClickOutside from 'react-onclickoutside';\n//@ts-ignore\nimport Linkify from 'react-linkify';\nimport { SecureLink } from 'react-secure-link';\nimport styles from './Chat.module.css';\n\nimport {\n  formatTimestamp,\n  formatUnixTime,\n  getColorForStringHex,\n  getDefaultPicture,\n  isEmojiString,\n} from '../../utils';\nimport { Separator } from '../App/App';\nimport { UserMenu } from '../UserMenu/UserMenu';\nimport { Socket } from 'socket.io-client';\nimport firebase from 'firebase/compat/app';\nimport classes from './Chat.module.css';\nimport {\n  CSSTransition,\n  SwitchTransition,\n  TransitionGroup,\n} from 'react-transition-group';\n\ninterface ChatProps {\n  chat: ChatMessage[];\n  nameMap: StringDict;\n  pictureMap: StringDict;\n  socket: Socket;\n  scrollTimestamp: number;\n  className?: string;\n  getMediaDisplayName: (input: string) => string;\n  hide?: boolean;\n  isChatDisabled?: boolean;\n  user: firebase.User | undefined;\n  owner: string | undefined;\n  ref: RefObject<Chat>;\n  isLiveHls: boolean;\n}\n\nexport class Chat extends React.Component<ChatProps> {\n  public state = {\n    chatMsg: '',\n    isNearBottom: true,\n    isPickerOpen: false,\n    reactionMenu: {\n      isOpen: false,\n      selectedMsgId: '',\n      selectedMsgTimestamp: '',\n      yPosition: 0,\n      xPosition: 0,\n    },\n  };\n  messagesRef = React.createRef<HTMLDivElement>();\n\n  async componentDidMount() {\n    this.scrollToBottom();\n    this.messagesRef.current?.addEventListener('scroll', this.onScroll);\n    init({});\n  }\n\n  componentDidUpdate(prevProps: ChatProps) {\n    if (this.props.scrollTimestamp !== prevProps.scrollTimestamp) {\n      if (prevProps.scrollTimestamp === 0 || this.state.isNearBottom) {\n        this.scrollToBottom();\n      }\n    }\n    if (this.props.hide !== prevProps.hide) {\n      this.scrollToBottom();\n    }\n  }\n\n  setReactionMenu = (\n    isOpen: boolean,\n    selectedMsgId?: string,\n    selectedMsgTimestamp?: string,\n    yPosition?: number,\n    xPosition?: number\n  ) => {\n    this.setState({\n      reactionMenu: {\n        isOpen,\n        selectedMsgId,\n        selectedMsgTimestamp,\n        yPosition,\n        xPosition,\n      },\n    });\n  };\n\n  handleReactionClick = (value: string, id?: string, timestamp?: string) => {\n    const msg = this.props.chat.find(\n      (m) => m.id === id && m.timestamp === timestamp\n    );\n    const data = {\n      value,\n      msgId: id || this.state.reactionMenu.selectedMsgId,\n      msgTimestamp: timestamp || this.state.reactionMenu.selectedMsgTimestamp,\n    };\n    if (msg?.reactions?.[value].includes(this.props.socket.id)) {\n      this.props.socket.emit('CMD:removeReaction', data);\n    } else {\n      this.props.socket.emit('CMD:addReaction', data);\n    }\n  };\n\n  updateChatMsg = (_e: any, data: { value: string }) => {\n    // console.log(e.target.selectionStart);\n    this.setState({ chatMsg: data.value });\n  };\n\n  sendChatMsg = () => {\n    if (!this.state.chatMsg) {\n      return;\n    }\n    if (this.chatTooLong()) {\n      return;\n    }\n    this.setState({ chatMsg: '' });\n    this.props.socket.emit('CMD:chat', this.state.chatMsg);\n  };\n\n  chatTooLong = () => {\n    return Boolean(this.state.chatMsg?.length > 10000);\n  };\n\n  onScroll = () => {\n    this.setState({ isNearBottom: this.isChatNearBottom() });\n  };\n\n  isChatNearBottom = () => {\n    return (\n      this.messagesRef.current &&\n      this.messagesRef.current.scrollHeight -\n        this.messagesRef.current.scrollTop -\n        this.messagesRef.current.offsetHeight <\n        100\n    );\n  };\n\n  scrollToBottom = () => {\n    if (this.messagesRef.current) {\n      this.messagesRef.current.scrollTop =\n        this.messagesRef.current.scrollHeight;\n    }\n  };\n\n  formatMessage = (cmd: string, msg: string): React.ReactNode | string => {\n    if (cmd === 'host') {\n      return (\n        <React.Fragment>\n          {`changed the video to `}\n          <span style={{ textTransform: 'initial' }}>\n            {this.props.getMediaDisplayName(msg)}\n          </span>\n        </React.Fragment>\n      );\n    } else if (cmd === 'playlistAdd') {\n      return (\n        <React.Fragment>\n          {`added to the playlist: `}\n          <span style={{ textTransform: 'initial' }}>\n            {this.props.getMediaDisplayName(msg)}\n          </span>\n        </React.Fragment>\n      );\n    } else if (cmd === 'seek') {\n      return `jumped to ${\n        this.props.isLiveHls ? formatUnixTime(msg) : formatTimestamp(msg)\n      }`;\n    } else if (cmd === 'play') {\n      return `started the video at ${formatTimestamp(msg)}`;\n    } else if (cmd === 'pause') {\n      return `paused the video at ${formatTimestamp(msg)}`;\n    } else if (cmd === 'playbackRate') {\n      return `set the playback rate to ${msg === '0' ? 'auto' : `${msg}x`}`;\n    } else if (cmd === 'lock') {\n      return `locked the room`;\n    } else if (cmd === 'unlock') {\n      return 'unlocked the room';\n    } else if (cmd === 'vBrowserTimeout') {\n      return (\n        <React.Fragment>\n          The VBrowser shut down automatically.\n          <br />\n          Subscribe for longer sessions.\n        </React.Fragment>\n      );\n    } else if (cmd === 'vBrowserAlmostTimeout') {\n      return (\n        <React.Fragment>\n          The VBrowser will shut down soon.\n          <br />\n          Subscribe for longer sessions.\n        </React.Fragment>\n      );\n    }\n    return cmd;\n  };\n\n  addEmoji = (emoji: any) => {\n    this.setState({ chatMsg: this.state.chatMsg + emoji.native });\n  };\n\n  render() {\n    return (\n      <div\n        className={this.props.className}\n        style={{\n          display: this.props.hide ? 'none' : 'flex',\n          flexDirection: 'column',\n          flexGrow: 1,\n          minHeight: 0,\n          marginTop: 0,\n          marginBottom: 0,\n          padding: '8px',\n        }}\n      >\n        <div\n          className={styles.chatContainer}\n          ref={this.messagesRef}\n          style={{ position: 'relative', paddingTop: 13 }}\n        >\n          <Comment.Group>\n            {this.props.chat.map((msg) => (\n              <ChatMessage\n                key={msg.timestamp + msg.id}\n                className={\n                  msg.id === this.state.reactionMenu.selectedMsgId &&\n                  msg.timestamp === this.state.reactionMenu.selectedMsgTimestamp\n                    ? classes.selected\n                    : ''\n                }\n                message={msg}\n                pictureMap={this.props.pictureMap}\n                nameMap={this.props.nameMap}\n                formatMessage={this.formatMessage}\n                owner={this.props.owner}\n                user={this.props.user}\n                socket={this.props.socket}\n                isChatDisabled={this.props.isChatDisabled}\n                setReactionMenu={this.setReactionMenu}\n                handleReactionClick={this.handleReactionClick}\n              />\n            ))}\n            {/* <div ref={this.messagesEndRef} /> */}\n          </Comment.Group>\n          {!this.state.isNearBottom && (\n            <Button\n              size=\"tiny\"\n              onClick={this.scrollToBottom}\n              style={{\n                position: 'sticky',\n                bottom: 0,\n                display: 'block',\n                margin: '0 auto',\n              }}\n            >\n              Jump to bottom\n            </Button>\n          )}\n        </div>\n        <Separator />\n        {this.state.isPickerOpen && (\n          <div style={{ position: 'absolute', bottom: '60px' }}>\n            <Picker\n              theme=\"dark\"\n              previewPosition=\"none\"\n              maxFrequentRows={1}\n              onEmojiSelect={this.addEmoji}\n              onClickOutside={() => this.setState({ isPickerOpen: false })}\n            />\n          </div>\n        )}\n        <CSSTransition\n          in={this.state.reactionMenu.isOpen}\n          timeout={300}\n          classNames={{\n            enter: classes['reactionMenu-enter'],\n            enterActive: classes['reactionMenu-enter-active'],\n            exit: classes['reactionMenu-exit'],\n            exitActive: classes['reactionMenu-exit-active'],\n          }}\n          unmountOnExit\n        >\n          <div\n            style={{\n              position: 'fixed',\n              top: Math.min(\n                this.state.reactionMenu.yPosition - 150,\n                window.innerHeight - 450\n              ),\n              left: this.state.reactionMenu.xPosition - 240,\n            }}\n          >\n            <Picker\n              theme=\"dark\"\n              previewPosition=\"none\"\n              maxFrequentRows={1}\n              perLine={6}\n              onClickOutside={() => this.setReactionMenu(false)}\n              onEmojiSelect={(emoji: any) => {\n                this.handleReactionClick(emoji.native);\n                this.setReactionMenu(false);\n              }}\n            />\n          </div>\n          {/* <ReactionMenu\n            handleReactionClick={this.handleReactionClick}\n            closeMenu={() => this.setReactionMenu(false)}\n            yPosition={this.state.reactionMenu.yPosition}\n            xPosition={this.state.reactionMenu.xPosition}\n          /> */}\n        </CSSTransition>\n        <Form autoComplete=\"off\">\n          <Input\n            inverted\n            fluid\n            onKeyPress={(e: any) => e.key === 'Enter' && this.sendChatMsg()}\n            onChange={this.updateChatMsg}\n            value={this.state.chatMsg}\n            error={this.chatTooLong()}\n            icon\n            disabled={this.props.isChatDisabled}\n            placeholder={\n              this.props.isChatDisabled\n                ? 'The chat was disabled by the room owner.'\n                : 'Enter a message...'\n            }\n          >\n            <input />\n            <Icon\n              // style={{ right: '40px' }}\n              onClick={() => {\n                // Add a delay to prevent the click from triggering onClickOutside\n                const curr = this.state.isPickerOpen;\n                setTimeout(() => this.setState({ isPickerOpen: !curr }), 100);\n              }}\n              name={undefined}\n              inverted\n              circular\n              link\n              disabled={this.props.isChatDisabled}\n              style={{ opacity: 1 }}\n            >\n              <span role=\"img\" aria-label=\"Emoji\">\n                😀\n              </span>\n            </Icon>\n            {/* <Icon onClick={this.sendChatMsg} name=\"send\" inverted circular link /> */}\n          </Input>\n        </Form>\n      </div>\n    );\n  }\n}\n\nconst ChatMessage = ({\n  message,\n  nameMap,\n  pictureMap,\n  formatMessage,\n  user,\n  socket,\n  owner,\n  isChatDisabled,\n  setReactionMenu,\n  handleReactionClick,\n  className,\n}: {\n  message: ChatMessage;\n  nameMap: StringDict;\n  pictureMap: StringDict;\n  formatMessage: (cmd: string, msg: string) => React.ReactNode;\n  user: firebase.User | undefined;\n  socket: Socket;\n  owner: string | undefined;\n  isChatDisabled: boolean | undefined;\n  setReactionMenu: (\n    isOpen: boolean,\n    selectedMsgId?: string,\n    selectedMsgTimestamp?: string,\n    yPosition?: number,\n    xPosition?: number\n  ) => void;\n  handleReactionClick: (value: string, id?: string, timestamp?: string) => void;\n  className: string;\n}) => {\n  const { id, timestamp, cmd, msg, system, isSub, reactions, videoTS } =\n    message;\n  const spellFull = 5; // the number of people whose names should be written out in full in the reaction popup\n  return (\n    <Comment className={`${classes.comment} ${className}`}>\n      {id ? (\n        <Popup\n          content=\"WatchParty Plus subscriber\"\n          disabled={!isSub}\n          trigger={\n            <Comment.Avatar\n              className={isSub ? classes.subscriber : ''}\n              src={\n                pictureMap[id] ||\n                getDefaultPicture(nameMap[id], getColorForStringHex(id))\n              }\n            />\n          }\n        />\n      ) : null}\n      <Comment.Content>\n        <UserMenu\n          displayName={nameMap[id] || id}\n          user={user}\n          timestamp={timestamp}\n          socket={socket}\n          userToManage={id}\n          isChatMessage\n          disabled={!Boolean(owner && owner === user?.uid)}\n          trigger={\n            <Comment.Author as=\"a\" className={styles.light}>\n              {Boolean(system) && 'System'}\n              {nameMap[id] || id}\n            </Comment.Author>\n          }\n        />\n        <Comment.Metadata className={styles.dark}>\n          <div title={new Date(timestamp).toLocaleDateString()}>\n            {new Date(timestamp).toLocaleTimeString()}\n            {Boolean(videoTS) && ' @ '}\n            {formatTimestamp(videoTS)}\n          </div>\n        </Comment.Metadata>\n        <Comment.Text className={styles.light + ' ' + styles.system}>\n          {cmd && formatMessage(cmd, msg)}\n        </Comment.Text>\n        <Linkify\n          componentDecorator={(\n            decoratedHref: string,\n            decoratedText: string,\n            key: string\n          ) => (\n            <SecureLink href={decoratedHref} key={key}>\n              {decoratedText}\n            </SecureLink>\n          )}\n        >\n          <Comment.Text\n            className={`${styles.light} ${\n              isEmojiString(msg) ? styles.emoji : ''\n            }`}\n          >\n            {!cmd && msg}\n          </Comment.Text>\n        </Linkify>\n        <div className={classes.commentMenu}>\n          <Icon\n            onClick={(e: MouseEvent) => {\n              const viewportOffset = (e.target as any).getBoundingClientRect();\n              setTimeout(() => {\n                setReactionMenu(\n                  true,\n                  id,\n                  timestamp,\n                  viewportOffset.top,\n                  viewportOffset.right\n                );\n              }, 100);\n            }}\n            name={undefined}\n            inverted\n            link\n            disabled={isChatDisabled}\n            style={{\n              opacity: 1,\n              display: 'flex',\n              justifyContent: 'center',\n              alignItems: 'center',\n              padding: 10,\n              margin: 0,\n            }}\n          >\n            <span\n              role=\"img\"\n              aria-label=\"React\"\n              style={{ margin: 0, fontSize: 18 }}\n            >\n              😀\n            </span>\n          </Icon>\n        </div>\n        <TransitionGroup>\n          {Object.keys(reactions ?? []).map((key) =>\n            reactions?.[key].length ? (\n              <CSSTransition\n                key={key}\n                timeout={200}\n                classNames={{\n                  enter: classes['reaction-enter'],\n                  enterActive: classes['reaction-enter-active'],\n                  exit: classes['reaction-exit'],\n                  exitActive: classes['reaction-exit-active'],\n                }}\n                unmountOnExit\n              >\n                <Popup\n                  content={`${reactions[key]\n                    .slice(0, spellFull)\n                    .map((id) => nameMap[id] || 'Unknown')\n                    .concat(\n                      reactions[key].length > spellFull\n                        ? [`${reactions[key].length - spellFull} more`]\n                        : []\n                    )\n                    .reduce(\n                      (text, value, i, array) =>\n                        text + (i < array.length - 1 ? ', ' : ' and ') + value\n                    )} reacted.`}\n                  offset={[0, 6]}\n                  trigger={\n                    <div\n                      className={`${classes.reactionContainer} ${\n                        reactions[key].includes(socket.id)\n                          ? classes.highlighted\n                          : ''\n                      }`}\n                      onClick={() =>\n                        handleReactionClick(key, message.id, message.timestamp)\n                      }\n                    >\n                      <span\n                        style={{\n                          fontSize: 17,\n                          position: 'relative',\n                          bottom: 1,\n                        }}\n                      >\n                        {key}\n                      </span>\n                      <SwitchTransition>\n                        <CSSTransition\n                          key={key + '-' + reactions[key].length}\n                          classNames={{\n                            enter: classes['reactionCounter-enter'],\n                            enterActive:\n                              classes['reactionCounter-enter-active'],\n                            exit: classes['reactionCounter-exit'],\n                            exitActive: classes['reactionCounter-exit-active'],\n                          }}\n                          addEndListener={(node, done) =>\n                            node.addEventListener('transitionend', done, false)\n                          }\n                          unmountOnExit\n                        >\n                          <span\n                            className={classes.reactionCounter}\n                            style={{\n                              color: 'rgba(255, 255, 255, 0.85)',\n                              marginLeft: 3,\n                            }}\n                          >\n                            {reactions[key].length}\n                          </span>\n                        </CSSTransition>\n                      </SwitchTransition>\n                    </div>\n                  }\n                />\n              </CSSTransition>\n            ) : null\n          )}\n        </TransitionGroup>\n      </Comment.Content>\n    </Comment>\n  );\n};\n\n// class ReactionMenuInner extends React.Component<{\n//   handleReactionClick: (value: string, id?: string, timestamp?: string) => void;\n//   closeMenu: () => void;\n//   yPosition: number;\n//   xPosition: number;\n// }> {\n//   state = {\n//     containerWidth: 0,\n//   };\n//   handleClickOutside = () => {\n//     this.props.closeMenu();\n//   };\n//   containerRef = React.createRef<HTMLDivElement>();\n//   componentDidMount() {\n//     this.setState({ containerWidth: this.containerRef.current?.offsetWidth });\n//   }\n//   render() {\n//     return (\n//       <div\n//         ref={this.containerRef}\n//         className={classes.reactionMenuContainer}\n//         style={{\n//           top: this.props.yPosition - 9,\n//           left: this.props.xPosition - this.state.containerWidth - 35,\n//         }}\n//       >\n//         {reactionEmojis.map((reaction) => (\n//           <div\n//             onClick={() => {\n//               this.props.handleReactionClick(reaction);\n//               this.props.closeMenu();\n//             }}\n//             style={{ cursor: 'pointer' }}\n//           >\n//             {reaction}\n//           </div>\n//         ))}\n//       </div>\n//     );\n//   }\n// }\n// const ReactionMenu = onClickOutside(ReactionMenuInner);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}