{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\n\nvar _createClass = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/createClass.js\").default;\n\nvar _inherits = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/inherits.js\").default;\n\nvar _createSuper = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/createSuper.js\").default;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DataProducer = void 0;\n\nvar Logger_1 = require(\"./Logger\");\n\nvar EnhancedEventEmitter_1 = require(\"./EnhancedEventEmitter\");\n\nvar errors_1 = require(\"./errors\");\n\nvar logger = new Logger_1.Logger('DataProducer');\n\nvar DataProducer = /*#__PURE__*/function (_EnhancedEventEmitter) {\n  _inherits(DataProducer, _EnhancedEventEmitter);\n\n  var _super = _createSuper(DataProducer);\n\n  function DataProducer(_ref) {\n    var _this;\n\n    var id = _ref.id,\n        dataChannel = _ref.dataChannel,\n        sctpStreamParameters = _ref.sctpStreamParameters,\n        appData = _ref.appData;\n\n    _classCallCheck(this, DataProducer);\n\n    _this = _super.call(this); // Closed flag.\n\n    _this._closed = false; // Observer instance.\n\n    _this._observer = new EnhancedEventEmitter_1.EnhancedEventEmitter();\n    logger.debug('constructor()');\n    _this._id = id;\n    _this._dataChannel = dataChannel;\n    _this._sctpStreamParameters = sctpStreamParameters;\n    _this._appData = appData || {};\n\n    _this.handleDataChannel();\n\n    return _this;\n  }\n  /**\n   * DataProducer id.\n   */\n\n\n  _createClass(DataProducer, [{\n    key: \"id\",\n    get: function get() {\n      return this._id;\n    }\n    /**\n     * Whether the DataProducer is closed.\n     */\n\n  }, {\n    key: \"closed\",\n    get: function get() {\n      return this._closed;\n    }\n    /**\n     * SCTP stream parameters.\n     */\n\n  }, {\n    key: \"sctpStreamParameters\",\n    get: function get() {\n      return this._sctpStreamParameters;\n    }\n    /**\n     * DataChannel readyState.\n     */\n\n  }, {\n    key: \"readyState\",\n    get: function get() {\n      return this._dataChannel.readyState;\n    }\n    /**\n     * DataChannel label.\n     */\n\n  }, {\n    key: \"label\",\n    get: function get() {\n      return this._dataChannel.label;\n    }\n    /**\n     * DataChannel protocol.\n     */\n\n  }, {\n    key: \"protocol\",\n    get: function get() {\n      return this._dataChannel.protocol;\n    }\n    /**\n     * DataChannel bufferedAmount.\n     */\n\n  }, {\n    key: \"bufferedAmount\",\n    get: function get() {\n      return this._dataChannel.bufferedAmount;\n    }\n    /**\n     * DataChannel bufferedAmountLowThreshold.\n     */\n\n  }, {\n    key: \"bufferedAmountLowThreshold\",\n    get: function get() {\n      return this._dataChannel.bufferedAmountLowThreshold;\n    }\n    /**\n     * Set DataChannel bufferedAmountLowThreshold.\n     */\n    ,\n    set: function set(bufferedAmountLowThreshold) {\n      this._dataChannel.bufferedAmountLowThreshold = bufferedAmountLowThreshold;\n    }\n    /**\n     * App custom data.\n     */\n\n  }, {\n    key: \"appData\",\n    get: function get() {\n      return this._appData;\n    }\n    /**\n     * Invalid setter.\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    ,\n    set: function set(appData) {\n      throw new Error('cannot override appData object');\n    }\n  }, {\n    key: \"observer\",\n    get: function get() {\n      return this._observer;\n    }\n    /**\n     * Closes the DataProducer.\n     */\n\n  }, {\n    key: \"close\",\n    value: function close() {\n      if (this._closed) {\n        return;\n      }\n\n      logger.debug('close()');\n      this._closed = true;\n\n      this._dataChannel.close();\n\n      this.emit('@close'); // Emit observer event.\n\n      this._observer.safeEmit('close');\n    }\n    /**\n     * Transport was closed.\n     */\n\n  }, {\n    key: \"transportClosed\",\n    value: function transportClosed() {\n      if (this._closed) {\n        return;\n      }\n\n      logger.debug('transportClosed()');\n      this._closed = true;\n\n      this._dataChannel.close();\n\n      this.safeEmit('transportclose'); // Emit observer event.\n\n      this._observer.safeEmit('close');\n    }\n    /**\n     * Send a message.\n     *\n     * @param {String|Blob|ArrayBuffer|ArrayBufferView} data.\n     */\n\n  }, {\n    key: \"send\",\n    value: function send(data) {\n      logger.debug('send()');\n\n      if (this._closed) {\n        throw new errors_1.InvalidStateError('closed');\n      }\n\n      this._dataChannel.send(data);\n    }\n  }, {\n    key: \"handleDataChannel\",\n    value: function handleDataChannel() {\n      var _this2 = this;\n\n      this._dataChannel.addEventListener('open', function () {\n        if (_this2._closed) {\n          return;\n        }\n\n        logger.debug('DataChannel \"open\" event');\n\n        _this2.safeEmit('open');\n      });\n\n      this._dataChannel.addEventListener('error', function (event) {\n        if (_this2._closed) {\n          return;\n        }\n\n        var error = event.error;\n\n        if (!error) {\n          error = new Error('unknown DataChannel error');\n        }\n\n        if (error.errorDetail === 'sctp-failure') {\n          logger.error('DataChannel SCTP error [sctpCauseCode:%s]: %s', error.sctpCauseCode, error.message);\n        } else {\n          logger.error('DataChannel \"error\" event: %o', error);\n        }\n\n        _this2.safeEmit('error', error);\n      });\n\n      this._dataChannel.addEventListener('close', function () {\n        if (_this2._closed) {\n          return;\n        }\n\n        logger.warn('DataChannel \"close\" event');\n        _this2._closed = true;\n\n        _this2.emit('@close');\n\n        _this2.safeEmit('close'); // Emit observer event.\n\n\n        _this2._observer.safeEmit('close');\n      });\n\n      this._dataChannel.addEventListener('message', function () {\n        if (_this2._closed) {\n          return;\n        }\n\n        logger.warn('DataChannel \"message\" event in a DataProducer, message discarded');\n      });\n\n      this._dataChannel.addEventListener('bufferedamountlow', function () {\n        if (_this2._closed) {\n          return;\n        }\n\n        _this2.safeEmit('bufferedamountlow');\n      });\n    }\n  }]);\n\n  return DataProducer;\n}(EnhancedEventEmitter_1.EnhancedEventEmitter);\n\nexports.DataProducer = DataProducer;","map":{"version":3,"names":["Object","defineProperty","exports","value","DataProducer","Logger_1","require","EnhancedEventEmitter_1","errors_1","logger","Logger","id","dataChannel","sctpStreamParameters","appData","_closed","_observer","EnhancedEventEmitter","debug","_id","_dataChannel","_sctpStreamParameters","_appData","handleDataChannel","readyState","label","protocol","bufferedAmount","bufferedAmountLowThreshold","Error","close","emit","safeEmit","data","InvalidStateError","send","addEventListener","event","error","errorDetail","sctpCauseCode","message","warn"],"sources":["/home/runner/work/watchparty/watchparty/node_modules/mediasoup-client/lib/DataProducer.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DataProducer = void 0;\nconst Logger_1 = require(\"./Logger\");\nconst EnhancedEventEmitter_1 = require(\"./EnhancedEventEmitter\");\nconst errors_1 = require(\"./errors\");\nconst logger = new Logger_1.Logger('DataProducer');\nclass DataProducer extends EnhancedEventEmitter_1.EnhancedEventEmitter {\n    constructor({ id, dataChannel, sctpStreamParameters, appData }) {\n        super();\n        // Closed flag.\n        this._closed = false;\n        // Observer instance.\n        this._observer = new EnhancedEventEmitter_1.EnhancedEventEmitter();\n        logger.debug('constructor()');\n        this._id = id;\n        this._dataChannel = dataChannel;\n        this._sctpStreamParameters = sctpStreamParameters;\n        this._appData = appData || {};\n        this.handleDataChannel();\n    }\n    /**\n     * DataProducer id.\n     */\n    get id() {\n        return this._id;\n    }\n    /**\n     * Whether the DataProducer is closed.\n     */\n    get closed() {\n        return this._closed;\n    }\n    /**\n     * SCTP stream parameters.\n     */\n    get sctpStreamParameters() {\n        return this._sctpStreamParameters;\n    }\n    /**\n     * DataChannel readyState.\n     */\n    get readyState() {\n        return this._dataChannel.readyState;\n    }\n    /**\n     * DataChannel label.\n     */\n    get label() {\n        return this._dataChannel.label;\n    }\n    /**\n     * DataChannel protocol.\n     */\n    get protocol() {\n        return this._dataChannel.protocol;\n    }\n    /**\n     * DataChannel bufferedAmount.\n     */\n    get bufferedAmount() {\n        return this._dataChannel.bufferedAmount;\n    }\n    /**\n     * DataChannel bufferedAmountLowThreshold.\n     */\n    get bufferedAmountLowThreshold() {\n        return this._dataChannel.bufferedAmountLowThreshold;\n    }\n    /**\n     * Set DataChannel bufferedAmountLowThreshold.\n     */\n    set bufferedAmountLowThreshold(bufferedAmountLowThreshold) {\n        this._dataChannel.bufferedAmountLowThreshold = bufferedAmountLowThreshold;\n    }\n    /**\n     * App custom data.\n     */\n    get appData() {\n        return this._appData;\n    }\n    /**\n     * Invalid setter.\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    set appData(appData) {\n        throw new Error('cannot override appData object');\n    }\n    get observer() {\n        return this._observer;\n    }\n    /**\n     * Closes the DataProducer.\n     */\n    close() {\n        if (this._closed) {\n            return;\n        }\n        logger.debug('close()');\n        this._closed = true;\n        this._dataChannel.close();\n        this.emit('@close');\n        // Emit observer event.\n        this._observer.safeEmit('close');\n    }\n    /**\n     * Transport was closed.\n     */\n    transportClosed() {\n        if (this._closed) {\n            return;\n        }\n        logger.debug('transportClosed()');\n        this._closed = true;\n        this._dataChannel.close();\n        this.safeEmit('transportclose');\n        // Emit observer event.\n        this._observer.safeEmit('close');\n    }\n    /**\n     * Send a message.\n     *\n     * @param {String|Blob|ArrayBuffer|ArrayBufferView} data.\n     */\n    send(data) {\n        logger.debug('send()');\n        if (this._closed) {\n            throw new errors_1.InvalidStateError('closed');\n        }\n        this._dataChannel.send(data);\n    }\n    handleDataChannel() {\n        this._dataChannel.addEventListener('open', () => {\n            if (this._closed) {\n                return;\n            }\n            logger.debug('DataChannel \"open\" event');\n            this.safeEmit('open');\n        });\n        this._dataChannel.addEventListener('error', (event) => {\n            if (this._closed) {\n                return;\n            }\n            let { error } = event;\n            if (!error) {\n                error = new Error('unknown DataChannel error');\n            }\n            if (error.errorDetail === 'sctp-failure') {\n                logger.error('DataChannel SCTP error [sctpCauseCode:%s]: %s', error.sctpCauseCode, error.message);\n            }\n            else {\n                logger.error('DataChannel \"error\" event: %o', error);\n            }\n            this.safeEmit('error', error);\n        });\n        this._dataChannel.addEventListener('close', () => {\n            if (this._closed) {\n                return;\n            }\n            logger.warn('DataChannel \"close\" event');\n            this._closed = true;\n            this.emit('@close');\n            this.safeEmit('close');\n            // Emit observer event.\n            this._observer.safeEmit('close');\n        });\n        this._dataChannel.addEventListener('message', () => {\n            if (this._closed) {\n                return;\n            }\n            logger.warn('DataChannel \"message\" event in a DataProducer, message discarded');\n        });\n        this._dataChannel.addEventListener('bufferedamountlow', () => {\n            if (this._closed) {\n                return;\n            }\n            this.safeEmit('bufferedamountlow');\n        });\n    }\n}\nexports.DataProducer = DataProducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}