{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import axios from'axios';import React,{useCallback,useEffect,useState}from'react';import ReactMarkdown from'react-markdown';import{Button}from'semantic-ui-react';import styles from'./Announce.module.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var GITHUB_REPO='howardchung/watchparty-announcements';var Announce=function Announce(){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),announcement=_useState2[0],setAnnouncement=_useState2[1];useEffect(function(){var fetch=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _data$items;var response,data,top;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('https://api.github.com/search/issues',{params:{q:\"repo:\".concat(GITHUB_REPO,\" label:\").concat(process.env.NODE_ENV==='development'?'test':'release'),order:'desc',page:1,per_page:1}});case 2:response=_context.sent;data=response.data;//   console.log(data);\ntop=data===null||data===void 0?void 0:(_data$items=data.items)===null||_data$items===void 0?void 0:_data$items[0];if((top===null||top===void 0?void 0:top.number)>Number(localStorage.getItem('announcement-dismiss'))&&new Date(top.updated_at)>new Date(Date.now()-7*24*60*60*1000)){setAnnouncement(top);}case 6:case\"end\":return _context.stop();}}},_callee);}));return function fetch(){return _ref.apply(this,arguments);};}();fetch();},[]);var onDismiss=useCallback(function(value){localStorage.setItem('announcement-dismiss',value.toString());setAnnouncement(null);},[]);return announcement!=null?/*#__PURE__*/_jsxs(\"div\",{className:styles.announce,children:[/*#__PURE__*/_jsx(\"main\",{children:announcement.body&&/*#__PURE__*/_jsx(ReactMarkdown,{children:announcement.body})}),/*#__PURE__*/_jsx(\"aside\",{children:/*#__PURE__*/_jsx(Button,{color:\"blue\",onClick:function onClick(){return onDismiss(announcement.number);},children:\"Dismiss\"})})]}):null;};export default Announce;","map":{"version":3,"names":["axios","React","useCallback","useEffect","useState","ReactMarkdown","Button","styles","GITHUB_REPO","Announce","announcement","setAnnouncement","fetch","get","params","q","process","env","NODE_ENV","order","page","per_page","response","data","top","items","number","Number","localStorage","getItem","Date","updated_at","now","onDismiss","value","setItem","toString","announce","body"],"sources":["/home/runner/work/watchparty/watchparty/src/components/Announce/Announce.tsx"],"sourcesContent":["import axios from 'axios';\nimport React, { useCallback, useEffect, useState } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport { Button } from 'semantic-ui-react';\nimport styles from './Announce.module.css';\n\nconst GITHUB_REPO = 'howardchung/watchparty-announcements';\n\ntype Issue = {\n  title: string;\n  body: string;\n  number: number;\n  updated_at: string;\n};\nconst Announce = () => {\n  const [announcement, setAnnouncement] = useState<Issue | null>(null);\n  useEffect(() => {\n    const fetch = async () => {\n      const response = await axios.get<{ items: Issue[] }>(\n        'https://api.github.com/search/issues',\n        {\n          params: {\n            q: `repo:${GITHUB_REPO} label:${\n              process.env.NODE_ENV === 'development' ? 'test' : 'release'\n            }`,\n            order: 'desc',\n            page: 1,\n            per_page: 1,\n          },\n        }\n      );\n      const data = response.data;\n      //   console.log(data);\n      const top = data?.items?.[0];\n      if (\n        top?.number > Number(localStorage.getItem('announcement-dismiss')) &&\n        new Date(top.updated_at) >\n          new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)\n      ) {\n        setAnnouncement(top);\n      }\n    };\n    fetch();\n  }, []);\n\n  const onDismiss = useCallback((value: number) => {\n    localStorage.setItem('announcement-dismiss', value.toString());\n    setAnnouncement(null);\n  }, []);\n\n  return announcement != null ? (\n    <div className={styles.announce}>\n      <main>\n        {/* <h4>{announcement.title}</h4> */}\n        {announcement.body && (\n          <ReactMarkdown>{announcement.body}</ReactMarkdown>\n        )}\n      </main>\n      <aside>\n        <Button color=\"blue\" onClick={() => onDismiss(announcement.number)}>\n          Dismiss\n        </Button>\n      </aside>\n    </div>\n  ) : null;\n};\n\nexport default Announce;\n"],"mappings":"uYAAA,MAAOA,MAAP,KAAkB,OAAlB,CACA,MAAOC,MAAP,EAAgBC,WAAhB,CAA6BC,SAA7B,CAAwCC,QAAxC,KAAwD,OAAxD,CACA,MAAOC,cAAP,KAA0B,gBAA1B,CACA,OAASC,MAAT,KAAuB,mBAAvB,CACA,MAAOC,OAAP,KAAmB,uBAAnB,C,wFAEA,GAAMC,YAAW,CAAG,sCAApB,CAQA,GAAMC,SAAQ,CAAG,QAAXA,SAAW,EAAM,CACrB,cAAwCL,QAAQ,CAAe,IAAf,CAAhD,wCAAOM,YAAP,eAAqBC,eAArB,eACAR,SAAS,CAAC,UAAM,CACd,GAAMS,MAAK,4FAAG,iMACWZ,MAAK,CAACa,GAAN,CACrB,sCADqB,CAErB,CACEC,MAAM,CAAE,CACNC,CAAC,gBAAUP,WAAV,mBACCQ,OAAO,CAACC,GAAR,CAAYC,QAAZ,GAAyB,aAAzB,CAAyC,MAAzC,CAAkD,SADnD,CADK,CAINC,KAAK,CAAE,MAJD,CAKNC,IAAI,CAAE,CALA,CAMNC,QAAQ,CAAE,CANJ,CADV,CAFqB,CADX,QACNC,QADM,eAcNC,IAdM,CAcCD,QAAQ,CAACC,IAdV,CAeZ;AACMC,GAhBM,CAgBAD,IAhBA,SAgBAA,IAhBA,8BAgBAA,IAAI,CAAEE,KAhBN,sCAgBA,YAAc,CAAd,CAhBA,CAiBZ,GACE,CAAAD,GAAG,OAAH,EAAAA,GAAG,SAAH,QAAAA,GAAG,CAAEE,MAAL,EAAcC,MAAM,CAACC,YAAY,CAACC,OAAb,CAAqB,sBAArB,CAAD,CAApB,EACA,GAAIC,KAAJ,CAASN,GAAG,CAACO,UAAb,EACE,GAAID,KAAJ,CAASA,IAAI,CAACE,GAAL,GAAa,EAAI,EAAJ,CAAS,EAAT,CAAc,EAAd,CAAmB,IAAzC,CAHJ,CAIE,CACArB,eAAe,CAACa,GAAD,CAAf,CACD,CAvBW,sDAAH,kBAALZ,MAAK,0CAAX,CAyBAA,KAAK,GACN,CA3BQ,CA2BN,EA3BM,CAAT,CA6BA,GAAMqB,UAAS,CAAG/B,WAAW,CAAC,SAACgC,KAAD,CAAmB,CAC/CN,YAAY,CAACO,OAAb,CAAqB,sBAArB,CAA6CD,KAAK,CAACE,QAAN,EAA7C,EACAzB,eAAe,CAAC,IAAD,CAAf,CACD,CAH4B,CAG1B,EAH0B,CAA7B,CAKA,MAAOD,aAAY,EAAI,IAAhB,cACL,aAAK,SAAS,CAAEH,MAAM,CAAC8B,QAAvB,wBACE,sBAEG3B,YAAY,CAAC4B,IAAb,eACC,KAAC,aAAD,WAAgB5B,YAAY,CAAC4B,IAA7B,EAHJ,EADF,cAOE,oCACE,KAAC,MAAD,EAAQ,KAAK,CAAC,MAAd,CAAqB,OAAO,CAAE,yBAAML,UAAS,CAACvB,YAAY,CAACgB,MAAd,CAAf,EAA9B,qBADF,EAPF,GADK,CAcH,IAdJ,CAeD,CAnDD,CAqDA,cAAejB,SAAf"},"metadata":{},"sourceType":"module"}