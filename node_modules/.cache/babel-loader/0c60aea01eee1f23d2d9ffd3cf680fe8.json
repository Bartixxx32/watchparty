{"ast":null,"code":"\"use strict\";\n\nvar _createForOfIteratorHelper = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\n\nvar _objectSpread = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/objectSpread2.js\").default;\n\nvar _regeneratorRuntime = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\n\nvar _asyncToGenerator = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nvar _classCallCheck = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\n\nvar _createClass = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/createClass.js\").default;\n\nvar _inherits = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/inherits.js\").default;\n\nvar _createSuper = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/createSuper.js\").default;\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function get() {\n        return m[k];\n      }\n    };\n  }\n\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Chrome70 = void 0;\n\nvar sdpTransform = __importStar(require(\"sdp-transform\"));\n\nvar Logger_1 = require(\"../Logger\");\n\nvar utils = __importStar(require(\"../utils\"));\n\nvar ortc = __importStar(require(\"../ortc\"));\n\nvar sdpCommonUtils = __importStar(require(\"./sdp/commonUtils\"));\n\nvar sdpUnifiedPlanUtils = __importStar(require(\"./sdp/unifiedPlanUtils\"));\n\nvar HandlerInterface_1 = require(\"./HandlerInterface\");\n\nvar RemoteSdp_1 = require(\"./sdp/RemoteSdp\");\n\nvar scalabilityModes_1 = require(\"../scalabilityModes\");\n\nvar logger = new Logger_1.Logger('Chrome70');\nvar SCTP_NUM_STREAMS = {\n  OS: 1024,\n  MIS: 1024\n};\n\nvar Chrome70 = /*#__PURE__*/function (_HandlerInterface_1$H) {\n  _inherits(Chrome70, _HandlerInterface_1$H);\n\n  var _super = _createSuper(Chrome70);\n\n  function Chrome70() {\n    var _this;\n\n    _classCallCheck(this, Chrome70);\n\n    _this = _super.call(this); // Map of RTCTransceivers indexed by MID.\n\n    _this._mapMidTransceiver = new Map(); // Local stream for sending.\n\n    _this._sendStream = new MediaStream(); // Whether a DataChannel m=application section has been created.\n\n    _this._hasDataChannelMediaSection = false; // Sending DataChannel id value counter. Incremented for each new DataChannel.\n\n    _this._nextSendSctpStreamId = 0; // Got transport local and remote parameters.\n\n    _this._transportReady = false;\n    return _this;\n  }\n\n  _createClass(Chrome70, [{\n    key: \"name\",\n    get: function get() {\n      return 'Chrome70';\n    }\n  }, {\n    key: \"close\",\n    value: function close() {\n      logger.debug('close()'); // Close RTCPeerConnection.\n\n      if (this._pc) {\n        try {\n          this._pc.close();\n        } catch (error) {}\n      }\n\n      this.emit('@close');\n    }\n  }, {\n    key: \"getNativeRtpCapabilities\",\n    value: function () {\n      var _getNativeRtpCapabilities = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var pc, offer, sdpObject, nativeRtpCapabilities;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                logger.debug('getNativeRtpCapabilities()');\n                pc = new RTCPeerConnection({\n                  iceServers: [],\n                  iceTransportPolicy: 'all',\n                  bundlePolicy: 'max-bundle',\n                  rtcpMuxPolicy: 'require',\n                  sdpSemantics: 'unified-plan'\n                });\n                _context.prev = 2;\n                pc.addTransceiver('audio');\n                pc.addTransceiver('video');\n                _context.next = 7;\n                return pc.createOffer();\n\n              case 7:\n                offer = _context.sent;\n\n                try {\n                  pc.close();\n                } catch (error) {}\n\n                sdpObject = sdpTransform.parse(offer.sdp);\n                nativeRtpCapabilities = sdpCommonUtils.extractRtpCapabilities({\n                  sdpObject: sdpObject\n                });\n                return _context.abrupt(\"return\", nativeRtpCapabilities);\n\n              case 14:\n                _context.prev = 14;\n                _context.t0 = _context[\"catch\"](2);\n\n                try {\n                  pc.close();\n                } catch (error2) {}\n\n                throw _context.t0;\n\n              case 18:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[2, 14]]);\n      }));\n\n      function getNativeRtpCapabilities() {\n        return _getNativeRtpCapabilities.apply(this, arguments);\n      }\n\n      return getNativeRtpCapabilities;\n    }()\n  }, {\n    key: \"getNativeSctpCapabilities\",\n    value: function () {\n      var _getNativeSctpCapabilities = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                logger.debug('getNativeSctpCapabilities()');\n                return _context2.abrupt(\"return\", {\n                  numStreams: SCTP_NUM_STREAMS\n                });\n\n              case 2:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function getNativeSctpCapabilities() {\n        return _getNativeSctpCapabilities.apply(this, arguments);\n      }\n\n      return getNativeSctpCapabilities;\n    }()\n  }, {\n    key: \"run\",\n    value: function run(_ref) {\n      var _this2 = this;\n\n      var direction = _ref.direction,\n          iceParameters = _ref.iceParameters,\n          iceCandidates = _ref.iceCandidates,\n          dtlsParameters = _ref.dtlsParameters,\n          sctpParameters = _ref.sctpParameters,\n          iceServers = _ref.iceServers,\n          iceTransportPolicy = _ref.iceTransportPolicy,\n          additionalSettings = _ref.additionalSettings,\n          proprietaryConstraints = _ref.proprietaryConstraints,\n          extendedRtpCapabilities = _ref.extendedRtpCapabilities;\n      logger.debug('run()');\n      this._direction = direction;\n      this._remoteSdp = new RemoteSdp_1.RemoteSdp({\n        iceParameters: iceParameters,\n        iceCandidates: iceCandidates,\n        dtlsParameters: dtlsParameters,\n        sctpParameters: sctpParameters\n      });\n      this._sendingRtpParametersByKind = {\n        audio: ortc.getSendingRtpParameters('audio', extendedRtpCapabilities),\n        video: ortc.getSendingRtpParameters('video', extendedRtpCapabilities)\n      };\n      this._sendingRemoteRtpParametersByKind = {\n        audio: ortc.getSendingRemoteRtpParameters('audio', extendedRtpCapabilities),\n        video: ortc.getSendingRemoteRtpParameters('video', extendedRtpCapabilities)\n      };\n\n      if (dtlsParameters.role && dtlsParameters.role !== 'auto') {\n        this._forcedLocalDtlsRole = dtlsParameters.role === 'server' ? 'client' : 'server';\n      }\n\n      this._pc = new RTCPeerConnection(_objectSpread({\n        iceServers: iceServers || [],\n        iceTransportPolicy: iceTransportPolicy || 'all',\n        bundlePolicy: 'max-bundle',\n        rtcpMuxPolicy: 'require',\n        sdpSemantics: 'unified-plan'\n      }, additionalSettings), proprietaryConstraints);\n\n      if (this._pc.connectionState) {\n        this._pc.addEventListener('connectionstatechange', function () {\n          _this2.emit('@connectionstatechange', _this2._pc.connectionState);\n        });\n      } else {\n        this._pc.addEventListener('iceconnectionstatechange', function () {\n          logger.warn('run() | pc.connectionState not supported, using pc.iceConnectionState');\n\n          switch (_this2._pc.iceConnectionState) {\n            case 'checking':\n              _this2.emit('@connectionstatechange', 'connecting');\n\n              break;\n\n            case 'connected':\n            case 'completed':\n              _this2.emit('@connectionstatechange', 'connected');\n\n              break;\n\n            case 'failed':\n              _this2.emit('@connectionstatechange', 'failed');\n\n              break;\n\n            case 'disconnected':\n              _this2.emit('@connectionstatechange', 'disconnected');\n\n              break;\n\n            case 'closed':\n              _this2.emit('@connectionstatechange', 'closed');\n\n              break;\n          }\n        });\n      }\n    }\n  }, {\n    key: \"updateIceServers\",\n    value: function () {\n      var _updateIceServers = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(iceServers) {\n        var configuration;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                logger.debug('updateIceServers()');\n                configuration = this._pc.getConfiguration();\n                configuration.iceServers = iceServers;\n\n                this._pc.setConfiguration(configuration);\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function updateIceServers(_x) {\n        return _updateIceServers.apply(this, arguments);\n      }\n\n      return updateIceServers;\n    }()\n  }, {\n    key: \"restartIce\",\n    value: function () {\n      var _restartIce = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(iceParameters) {\n        var offer, answer, _offer, _answer;\n\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                logger.debug('restartIce()'); // Provide the remote SDP handler with new remote ICE parameters.\n\n                this._remoteSdp.updateIceParameters(iceParameters);\n\n                if (this._transportReady) {\n                  _context4.next = 4;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\");\n\n              case 4:\n                if (!(this._direction === 'send')) {\n                  _context4.next = 17;\n                  break;\n                }\n\n                _context4.next = 7;\n                return this._pc.createOffer({\n                  iceRestart: true\n                });\n\n              case 7:\n                offer = _context4.sent;\n                logger.debug('restartIce() | calling pc.setLocalDescription() [offer:%o]', offer);\n                _context4.next = 11;\n                return this._pc.setLocalDescription(offer);\n\n              case 11:\n                answer = {\n                  type: 'answer',\n                  sdp: this._remoteSdp.getSdp()\n                };\n                logger.debug('restartIce() | calling pc.setRemoteDescription() [answer:%o]', answer);\n                _context4.next = 15;\n                return this._pc.setRemoteDescription(answer);\n\n              case 15:\n                _context4.next = 27;\n                break;\n\n              case 17:\n                _offer = {\n                  type: 'offer',\n                  sdp: this._remoteSdp.getSdp()\n                };\n                logger.debug('restartIce() | calling pc.setRemoteDescription() [offer:%o]', _offer);\n                _context4.next = 21;\n                return this._pc.setRemoteDescription(_offer);\n\n              case 21:\n                _context4.next = 23;\n                return this._pc.createAnswer();\n\n              case 23:\n                _answer = _context4.sent;\n                logger.debug('restartIce() | calling pc.setLocalDescription() [answer:%o]', _answer);\n                _context4.next = 27;\n                return this._pc.setLocalDescription(_answer);\n\n              case 27:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function restartIce(_x2) {\n        return _restartIce.apply(this, arguments);\n      }\n\n      return restartIce;\n    }()\n  }, {\n    key: \"getTransportStats\",\n    value: function () {\n      var _getTransportStats = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                return _context5.abrupt(\"return\", this._pc.getStats());\n\n              case 1:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function getTransportStats() {\n        return _getTransportStats.apply(this, arguments);\n      }\n\n      return getTransportStats;\n    }()\n  }, {\n    key: \"send\",\n    value: function () {\n      var _send = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6(_ref2) {\n        var track, encodings, codecOptions, codec, _a, sendingRtpParameters, sendingRemoteRtpParameters, mediaSectionIdx, transceiver, offer, localSdpObject, offerMediaObject, hackVp9Svc, layers, parameters, idx, encoding, desiredEncoding, localId, _idx, _iterator, _step, _encoding, answer;\n\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                track = _ref2.track, encodings = _ref2.encodings, codecOptions = _ref2.codecOptions, codec = _ref2.codec;\n                this.assertSendDirection();\n                logger.debug('send() [kind:%s, track.id:%s]', track.kind, track.id);\n                sendingRtpParameters = utils.clone(this._sendingRtpParametersByKind[track.kind], {}); // This may throw.\n\n                sendingRtpParameters.codecs = ortc.reduceCodecs(sendingRtpParameters.codecs, codec);\n                sendingRemoteRtpParameters = utils.clone(this._sendingRemoteRtpParametersByKind[track.kind], {}); // This may throw.\n\n                sendingRemoteRtpParameters.codecs = ortc.reduceCodecs(sendingRemoteRtpParameters.codecs, codec);\n                mediaSectionIdx = this._remoteSdp.getNextMediaSectionIdx();\n                transceiver = this._pc.addTransceiver(track, {\n                  direction: 'sendonly',\n                  streams: [this._sendStream]\n                });\n                _context6.next = 11;\n                return this._pc.createOffer();\n\n              case 11:\n                offer = _context6.sent;\n                localSdpObject = sdpTransform.parse(offer.sdp);\n\n                if (this._transportReady) {\n                  _context6.next = 16;\n                  break;\n                }\n\n                _context6.next = 16;\n                return this.setupTransport({\n                  localDtlsRole: (_a = this._forcedLocalDtlsRole) !== null && _a !== void 0 ? _a : 'client',\n                  localSdpObject: localSdpObject\n                });\n\n              case 16:\n                if (encodings && encodings.length > 1) {\n                  logger.debug('send() | enabling legacy simulcast');\n                  localSdpObject = sdpTransform.parse(offer.sdp);\n                  offerMediaObject = localSdpObject.media[mediaSectionIdx.idx];\n                  sdpUnifiedPlanUtils.addLegacySimulcast({\n                    offerMediaObject: offerMediaObject,\n                    numStreams: encodings.length\n                  });\n                  offer = {\n                    type: 'offer',\n                    sdp: sdpTransform.write(localSdpObject)\n                  };\n                } // Special case for VP9 with SVC.\n\n\n                hackVp9Svc = false;\n                layers = (0, scalabilityModes_1.parse)((encodings || [{}])[0].scalabilityMode);\n\n                if (encodings && encodings.length === 1 && layers.spatialLayers > 1 && sendingRtpParameters.codecs[0].mimeType.toLowerCase() === 'video/vp9') {\n                  logger.debug('send() | enabling legacy simulcast for VP9 SVC');\n                  hackVp9Svc = true;\n                  localSdpObject = sdpTransform.parse(offer.sdp);\n                  offerMediaObject = localSdpObject.media[mediaSectionIdx.idx];\n                  sdpUnifiedPlanUtils.addLegacySimulcast({\n                    offerMediaObject: offerMediaObject,\n                    numStreams: layers.spatialLayers\n                  });\n                  offer = {\n                    type: 'offer',\n                    sdp: sdpTransform.write(localSdpObject)\n                  };\n                }\n\n                logger.debug('send() | calling pc.setLocalDescription() [offer:%o]', offer);\n                _context6.next = 23;\n                return this._pc.setLocalDescription(offer);\n\n              case 23:\n                if (!encodings) {\n                  _context6.next = 38;\n                  break;\n                }\n\n                logger.debug('send() | applying given encodings');\n                parameters = transceiver.sender.getParameters();\n                idx = 0;\n\n              case 27:\n                if (!(idx < (parameters.encodings || []).length)) {\n                  _context6.next = 36;\n                  break;\n                }\n\n                encoding = parameters.encodings[idx];\n                desiredEncoding = encodings[idx]; // Should not happen but just in case.\n\n                if (desiredEncoding) {\n                  _context6.next = 32;\n                  break;\n                }\n\n                return _context6.abrupt(\"break\", 36);\n\n              case 32:\n                parameters.encodings[idx] = Object.assign(encoding, desiredEncoding);\n\n              case 33:\n                ++idx;\n                _context6.next = 27;\n                break;\n\n              case 36:\n                _context6.next = 38;\n                return transceiver.sender.setParameters(parameters);\n\n              case 38:\n                // We can now get the transceiver.mid.\n                localId = transceiver.mid; // Set MID.\n\n                sendingRtpParameters.mid = localId;\n                localSdpObject = sdpTransform.parse(this._pc.localDescription.sdp);\n                offerMediaObject = localSdpObject.media[mediaSectionIdx.idx]; // Set RTCP CNAME.\n\n                sendingRtpParameters.rtcp.cname = sdpCommonUtils.getCname({\n                  offerMediaObject: offerMediaObject\n                }); // Set RTP encodings.\n\n                sendingRtpParameters.encodings = sdpUnifiedPlanUtils.getRtpEncodings({\n                  offerMediaObject: offerMediaObject\n                }); // Complete encodings with given values.\n\n                if (encodings) {\n                  for (_idx = 0; _idx < sendingRtpParameters.encodings.length; ++_idx) {\n                    if (encodings[_idx]) {\n                      Object.assign(sendingRtpParameters.encodings[_idx], encodings[_idx]);\n                    }\n                  }\n                } // Hack for VP9 SVC.\n\n\n                if (hackVp9Svc) {\n                  sendingRtpParameters.encodings = [sendingRtpParameters.encodings[0]];\n                } // If VP8 or H264 and there is effective simulcast, add scalabilityMode to\n                // each encoding.\n\n\n                if (sendingRtpParameters.encodings.length > 1 && (sendingRtpParameters.codecs[0].mimeType.toLowerCase() === 'video/vp8' || sendingRtpParameters.codecs[0].mimeType.toLowerCase() === 'video/h264')) {\n                  _iterator = _createForOfIteratorHelper(sendingRtpParameters.encodings);\n\n                  try {\n                    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                      _encoding = _step.value;\n                      _encoding.scalabilityMode = 'L1T3';\n                    }\n                  } catch (err) {\n                    _iterator.e(err);\n                  } finally {\n                    _iterator.f();\n                  }\n                }\n\n                this._remoteSdp.send({\n                  offerMediaObject: offerMediaObject,\n                  reuseMid: mediaSectionIdx.reuseMid,\n                  offerRtpParameters: sendingRtpParameters,\n                  answerRtpParameters: sendingRemoteRtpParameters,\n                  codecOptions: codecOptions\n                });\n\n                answer = {\n                  type: 'answer',\n                  sdp: this._remoteSdp.getSdp()\n                };\n                logger.debug('send() | calling pc.setRemoteDescription() [answer:%o]', answer);\n                _context6.next = 52;\n                return this._pc.setRemoteDescription(answer);\n\n              case 52:\n                // Store in the map.\n                this._mapMidTransceiver.set(localId, transceiver);\n\n                return _context6.abrupt(\"return\", {\n                  localId: localId,\n                  rtpParameters: sendingRtpParameters,\n                  rtpSender: transceiver.sender\n                });\n\n              case 54:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function send(_x3) {\n        return _send.apply(this, arguments);\n      }\n\n      return send;\n    }()\n  }, {\n    key: \"stopSending\",\n    value: function () {\n      var _stopSending = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7(localId) {\n        var transceiver, mediaSectionClosed, offer, answer;\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                this.assertSendDirection();\n                logger.debug('stopSending() [localId:%s]', localId);\n                transceiver = this._mapMidTransceiver.get(localId);\n\n                if (transceiver) {\n                  _context7.next = 5;\n                  break;\n                }\n\n                throw new Error('associated RTCRtpTransceiver not found');\n\n              case 5:\n                transceiver.sender.replaceTrack(null);\n\n                this._pc.removeTrack(transceiver.sender);\n\n                mediaSectionClosed = this._remoteSdp.closeMediaSection(transceiver.mid);\n\n                if (mediaSectionClosed) {\n                  try {\n                    transceiver.stop();\n                  } catch (error) {}\n                }\n\n                _context7.next = 11;\n                return this._pc.createOffer();\n\n              case 11:\n                offer = _context7.sent;\n                logger.debug('stopSending() | calling pc.setLocalDescription() [offer:%o]', offer);\n                _context7.next = 15;\n                return this._pc.setLocalDescription(offer);\n\n              case 15:\n                answer = {\n                  type: 'answer',\n                  sdp: this._remoteSdp.getSdp()\n                };\n                logger.debug('stopSending() | calling pc.setRemoteDescription() [answer:%o]', answer);\n                _context7.next = 19;\n                return this._pc.setRemoteDescription(answer);\n\n              case 19:\n                this._mapMidTransceiver.delete(localId);\n\n              case 20:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function stopSending(_x4) {\n        return _stopSending.apply(this, arguments);\n      }\n\n      return stopSending;\n    }() // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n  }, {\n    key: \"pauseSending\",\n    value: function () {\n      var _pauseSending = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8(localId) {\n        return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8);\n      }));\n\n      function pauseSending(_x5) {\n        return _pauseSending.apply(this, arguments);\n      }\n\n      return pauseSending;\n    }() // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n  }, {\n    key: \"resumeSending\",\n    value: function () {\n      var _resumeSending = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee9(localId) {\n        return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9);\n      }));\n\n      function resumeSending(_x6) {\n        return _resumeSending.apply(this, arguments);\n      }\n\n      return resumeSending;\n    }()\n  }, {\n    key: \"replaceTrack\",\n    value: function () {\n      var _replaceTrack = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee10(localId, track) {\n        var transceiver;\n        return _regeneratorRuntime().wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                this.assertSendDirection();\n\n                if (track) {\n                  logger.debug('replaceTrack() [localId:%s, track.id:%s]', localId, track.id);\n                } else {\n                  logger.debug('replaceTrack() [localId:%s, no track]', localId);\n                }\n\n                transceiver = this._mapMidTransceiver.get(localId);\n\n                if (transceiver) {\n                  _context10.next = 5;\n                  break;\n                }\n\n                throw new Error('associated RTCRtpTransceiver not found');\n\n              case 5:\n                _context10.next = 7;\n                return transceiver.sender.replaceTrack(track);\n\n              case 7:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function replaceTrack(_x7, _x8) {\n        return _replaceTrack.apply(this, arguments);\n      }\n\n      return replaceTrack;\n    }()\n  }, {\n    key: \"setMaxSpatialLayer\",\n    value: function () {\n      var _setMaxSpatialLayer = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee11(localId, spatialLayer) {\n        var transceiver, parameters, offer, answer;\n        return _regeneratorRuntime().wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                this.assertSendDirection();\n                logger.debug('setMaxSpatialLayer() [localId:%s, spatialLayer:%s]', localId, spatialLayer);\n                transceiver = this._mapMidTransceiver.get(localId);\n\n                if (transceiver) {\n                  _context11.next = 5;\n                  break;\n                }\n\n                throw new Error('associated RTCRtpTransceiver not found');\n\n              case 5:\n                parameters = transceiver.sender.getParameters();\n                parameters.encodings.forEach(function (encoding, idx) {\n                  if (idx <= spatialLayer) {\n                    encoding.active = true;\n                  } else {\n                    encoding.active = false;\n                  }\n                });\n                _context11.next = 9;\n                return transceiver.sender.setParameters(parameters);\n\n              case 9:\n                this._remoteSdp.muxMediaSectionSimulcast(localId, parameters.encodings);\n\n                _context11.next = 12;\n                return this._pc.createOffer();\n\n              case 12:\n                offer = _context11.sent;\n                logger.debug('setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]', offer);\n                _context11.next = 16;\n                return this._pc.setLocalDescription(offer);\n\n              case 16:\n                answer = {\n                  type: 'answer',\n                  sdp: this._remoteSdp.getSdp()\n                };\n                logger.debug('setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n                _context11.next = 20;\n                return this._pc.setRemoteDescription(answer);\n\n              case 20:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function setMaxSpatialLayer(_x9, _x10) {\n        return _setMaxSpatialLayer.apply(this, arguments);\n      }\n\n      return setMaxSpatialLayer;\n    }()\n  }, {\n    key: \"setRtpEncodingParameters\",\n    value: function () {\n      var _setRtpEncodingParameters = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee12(localId, params) {\n        var transceiver, parameters, offer, answer;\n        return _regeneratorRuntime().wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                this.assertSendDirection();\n                logger.debug('setRtpEncodingParameters() [localId:%s, params:%o]', localId, params);\n                transceiver = this._mapMidTransceiver.get(localId);\n\n                if (transceiver) {\n                  _context12.next = 5;\n                  break;\n                }\n\n                throw new Error('associated RTCRtpTransceiver not found');\n\n              case 5:\n                parameters = transceiver.sender.getParameters();\n                parameters.encodings.forEach(function (encoding, idx) {\n                  parameters.encodings[idx] = _objectSpread(_objectSpread({}, encoding), params);\n                });\n                _context12.next = 9;\n                return transceiver.sender.setParameters(parameters);\n\n              case 9:\n                this._remoteSdp.muxMediaSectionSimulcast(localId, parameters.encodings);\n\n                _context12.next = 12;\n                return this._pc.createOffer();\n\n              case 12:\n                offer = _context12.sent;\n                logger.debug('setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]', offer);\n                _context12.next = 16;\n                return this._pc.setLocalDescription(offer);\n\n              case 16:\n                answer = {\n                  type: 'answer',\n                  sdp: this._remoteSdp.getSdp()\n                };\n                logger.debug('setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]', answer);\n                _context12.next = 20;\n                return this._pc.setRemoteDescription(answer);\n\n              case 20:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n\n      function setRtpEncodingParameters(_x11, _x12) {\n        return _setRtpEncodingParameters.apply(this, arguments);\n      }\n\n      return setRtpEncodingParameters;\n    }()\n  }, {\n    key: \"getSenderStats\",\n    value: function () {\n      var _getSenderStats = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee13(localId) {\n        var transceiver;\n        return _regeneratorRuntime().wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                this.assertSendDirection();\n                transceiver = this._mapMidTransceiver.get(localId);\n\n                if (transceiver) {\n                  _context13.next = 4;\n                  break;\n                }\n\n                throw new Error('associated RTCRtpTransceiver not found');\n\n              case 4:\n                return _context13.abrupt(\"return\", transceiver.sender.getStats());\n\n              case 5:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n\n      function getSenderStats(_x13) {\n        return _getSenderStats.apply(this, arguments);\n      }\n\n      return getSenderStats;\n    }()\n  }, {\n    key: \"sendDataChannel\",\n    value: function () {\n      var _sendDataChannel = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee14(_ref3) {\n        var ordered, maxPacketLifeTime, maxRetransmits, label, protocol, _a, options, dataChannel, offer, localSdpObject, offerMediaObject, answer, sctpStreamParameters;\n\n        return _regeneratorRuntime().wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                ordered = _ref3.ordered, maxPacketLifeTime = _ref3.maxPacketLifeTime, maxRetransmits = _ref3.maxRetransmits, label = _ref3.label, protocol = _ref3.protocol;\n                this.assertSendDirection();\n                options = {\n                  negotiated: true,\n                  id: this._nextSendSctpStreamId,\n                  ordered: ordered,\n                  maxPacketLifeTime: maxPacketLifeTime,\n                  maxRetransmitTime: maxPacketLifeTime,\n                  maxRetransmits: maxRetransmits,\n                  protocol: protocol\n                };\n                logger.debug('sendDataChannel() [options:%o]', options);\n                dataChannel = this._pc.createDataChannel(label, options); // Increase next id.\n\n                this._nextSendSctpStreamId = ++this._nextSendSctpStreamId % SCTP_NUM_STREAMS.MIS; // If this is the first DataChannel we need to create the SDP answer with\n                // m=application section.\n\n                if (this._hasDataChannelMediaSection) {\n                  _context14.next = 24;\n                  break;\n                }\n\n                _context14.next = 9;\n                return this._pc.createOffer();\n\n              case 9:\n                offer = _context14.sent;\n                localSdpObject = sdpTransform.parse(offer.sdp);\n                offerMediaObject = localSdpObject.media.find(function (m) {\n                  return m.type === 'application';\n                });\n\n                if (this._transportReady) {\n                  _context14.next = 15;\n                  break;\n                }\n\n                _context14.next = 15;\n                return this.setupTransport({\n                  localDtlsRole: (_a = this._forcedLocalDtlsRole) !== null && _a !== void 0 ? _a : 'client',\n                  localSdpObject: localSdpObject\n                });\n\n              case 15:\n                logger.debug('sendDataChannel() | calling pc.setLocalDescription() [offer:%o]', offer);\n                _context14.next = 18;\n                return this._pc.setLocalDescription(offer);\n\n              case 18:\n                this._remoteSdp.sendSctpAssociation({\n                  offerMediaObject: offerMediaObject\n                });\n\n                answer = {\n                  type: 'answer',\n                  sdp: this._remoteSdp.getSdp()\n                };\n                logger.debug('sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]', answer);\n                _context14.next = 23;\n                return this._pc.setRemoteDescription(answer);\n\n              case 23:\n                this._hasDataChannelMediaSection = true;\n\n              case 24:\n                sctpStreamParameters = {\n                  streamId: options.id,\n                  ordered: options.ordered,\n                  maxPacketLifeTime: options.maxPacketLifeTime,\n                  maxRetransmits: options.maxRetransmits\n                };\n                return _context14.abrupt(\"return\", {\n                  dataChannel: dataChannel,\n                  sctpStreamParameters: sctpStreamParameters\n                });\n\n              case 26:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14, this);\n      }));\n\n      function sendDataChannel(_x14) {\n        return _sendDataChannel.apply(this, arguments);\n      }\n\n      return sendDataChannel;\n    }()\n  }, {\n    key: \"receive\",\n    value: function () {\n      var _receive = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee15(optionsList) {\n        var _this3 = this;\n\n        var _a, results, mapLocalId, _iterator2, _step2, options, trackId, kind, rtpParameters, streamId, localId, offer, answer, localSdpObject, _iterator3, _step3, _loop, _iterator4, _step4, _loop2;\n\n        return _regeneratorRuntime().wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                this.assertRecvDirection();\n                results = [];\n                mapLocalId = new Map();\n                _iterator2 = _createForOfIteratorHelper(optionsList);\n\n                try {\n                  for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n                    options = _step2.value;\n                    trackId = options.trackId, kind = options.kind, rtpParameters = options.rtpParameters, streamId = options.streamId;\n                    logger.debug('receive() [trackId:%s, kind:%s]', trackId, kind);\n                    localId = rtpParameters.mid || String(this._mapMidTransceiver.size);\n                    mapLocalId.set(trackId, localId);\n\n                    this._remoteSdp.receive({\n                      mid: localId,\n                      kind: kind,\n                      offerRtpParameters: rtpParameters,\n                      streamId: streamId || rtpParameters.rtcp.cname,\n                      trackId: trackId\n                    });\n                  }\n                } catch (err) {\n                  _iterator2.e(err);\n                } finally {\n                  _iterator2.f();\n                }\n\n                offer = {\n                  type: 'offer',\n                  sdp: this._remoteSdp.getSdp()\n                };\n                logger.debug('receive() | calling pc.setRemoteDescription() [offer:%o]', offer);\n                _context15.next = 9;\n                return this._pc.setRemoteDescription(offer);\n\n              case 9:\n                _context15.next = 11;\n                return this._pc.createAnswer();\n\n              case 11:\n                answer = _context15.sent;\n                localSdpObject = sdpTransform.parse(answer.sdp);\n                _iterator3 = _createForOfIteratorHelper(optionsList);\n\n                try {\n                  _loop = function _loop() {\n                    var options = _step3.value;\n                    var trackId = options.trackId,\n                        rtpParameters = options.rtpParameters;\n                    var localId = mapLocalId.get(trackId);\n                    var answerMediaObject = localSdpObject.media.find(function (m) {\n                      return String(m.mid) === localId;\n                    }); // May need to modify codec parameters in the answer based on codec\n                    // parameters in the offer.\n\n                    sdpCommonUtils.applyCodecParameters({\n                      offerRtpParameters: rtpParameters,\n                      answerMediaObject: answerMediaObject\n                    });\n                  };\n\n                  for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n                    _loop();\n                  }\n                } catch (err) {\n                  _iterator3.e(err);\n                } finally {\n                  _iterator3.f();\n                }\n\n                answer = {\n                  type: 'answer',\n                  sdp: sdpTransform.write(localSdpObject)\n                };\n\n                if (this._transportReady) {\n                  _context15.next = 19;\n                  break;\n                }\n\n                _context15.next = 19;\n                return this.setupTransport({\n                  localDtlsRole: (_a = this._forcedLocalDtlsRole) !== null && _a !== void 0 ? _a : 'client',\n                  localSdpObject: localSdpObject\n                });\n\n              case 19:\n                logger.debug('receive() | calling pc.setLocalDescription() [answer:%o]', answer);\n                _context15.next = 22;\n                return this._pc.setLocalDescription(answer);\n\n              case 22:\n                _iterator4 = _createForOfIteratorHelper(optionsList);\n\n                try {\n                  _loop2 = function _loop2() {\n                    var options = _step4.value;\n                    var trackId = options.trackId;\n                    var localId = mapLocalId.get(trackId);\n\n                    var transceiver = _this3._pc.getTransceivers().find(function (t) {\n                      return t.mid === localId;\n                    });\n\n                    if (!transceiver) {\n                      throw new Error('new RTCRtpTransceiver not found');\n                    } // Store in the map.\n\n\n                    _this3._mapMidTransceiver.set(localId, transceiver);\n\n                    results.push({\n                      localId: localId,\n                      track: transceiver.receiver.track,\n                      rtpReceiver: transceiver.receiver\n                    });\n                  };\n\n                  for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n                    _loop2();\n                  }\n                } catch (err) {\n                  _iterator4.e(err);\n                } finally {\n                  _iterator4.f();\n                }\n\n                return _context15.abrupt(\"return\", results);\n\n              case 25:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15, this);\n      }));\n\n      function receive(_x15) {\n        return _receive.apply(this, arguments);\n      }\n\n      return receive;\n    }()\n  }, {\n    key: \"stopReceiving\",\n    value: function () {\n      var _stopReceiving = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee16(localIds) {\n        var _iterator5, _step5, localId, transceiver, offer, answer, _iterator6, _step6, _localId;\n\n        return _regeneratorRuntime().wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                this.assertRecvDirection();\n                _iterator5 = _createForOfIteratorHelper(localIds);\n                _context16.prev = 2;\n\n                _iterator5.s();\n\n              case 4:\n                if ((_step5 = _iterator5.n()).done) {\n                  _context16.next = 13;\n                  break;\n                }\n\n                localId = _step5.value;\n                logger.debug('stopReceiving() [localId:%s]', localId);\n                transceiver = this._mapMidTransceiver.get(localId);\n\n                if (transceiver) {\n                  _context16.next = 10;\n                  break;\n                }\n\n                throw new Error('associated RTCRtpTransceiver not found');\n\n              case 10:\n                this._remoteSdp.closeMediaSection(transceiver.mid);\n\n              case 11:\n                _context16.next = 4;\n                break;\n\n              case 13:\n                _context16.next = 18;\n                break;\n\n              case 15:\n                _context16.prev = 15;\n                _context16.t0 = _context16[\"catch\"](2);\n\n                _iterator5.e(_context16.t0);\n\n              case 18:\n                _context16.prev = 18;\n\n                _iterator5.f();\n\n                return _context16.finish(18);\n\n              case 21:\n                offer = {\n                  type: 'offer',\n                  sdp: this._remoteSdp.getSdp()\n                };\n                logger.debug('stopReceiving() | calling pc.setRemoteDescription() [offer:%o]', offer);\n                _context16.next = 25;\n                return this._pc.setRemoteDescription(offer);\n\n              case 25:\n                _context16.next = 27;\n                return this._pc.createAnswer();\n\n              case 27:\n                answer = _context16.sent;\n                logger.debug('stopReceiving() | calling pc.setLocalDescription() [answer:%o]', answer);\n                _context16.next = 31;\n                return this._pc.setLocalDescription(answer);\n\n              case 31:\n                _iterator6 = _createForOfIteratorHelper(localIds);\n\n                try {\n                  for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {\n                    _localId = _step6.value;\n\n                    this._mapMidTransceiver.delete(_localId);\n                  }\n                } catch (err) {\n                  _iterator6.e(err);\n                } finally {\n                  _iterator6.f();\n                }\n\n              case 33:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16, this, [[2, 15, 18, 21]]);\n      }));\n\n      function stopReceiving(_x16) {\n        return _stopReceiving.apply(this, arguments);\n      }\n\n      return stopReceiving;\n    }()\n  }, {\n    key: \"pauseReceiving\",\n    value: function () {\n      var _pauseReceiving = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee17( // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      localIds) {\n        return _regeneratorRuntime().wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17);\n      }));\n\n      function pauseReceiving(_x17) {\n        return _pauseReceiving.apply(this, arguments);\n      }\n\n      return pauseReceiving;\n    }()\n  }, {\n    key: \"resumeReceiving\",\n    value: function () {\n      var _resumeReceiving = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee18( // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      localIds) {\n        return _regeneratorRuntime().wrap(function _callee18$(_context18) {\n          while (1) {\n            switch (_context18.prev = _context18.next) {\n              case 0:\n              case \"end\":\n                return _context18.stop();\n            }\n          }\n        }, _callee18);\n      }));\n\n      function resumeReceiving(_x18) {\n        return _resumeReceiving.apply(this, arguments);\n      }\n\n      return resumeReceiving;\n    }()\n  }, {\n    key: \"getReceiverStats\",\n    value: function () {\n      var _getReceiverStats = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee19(localId) {\n        var transceiver;\n        return _regeneratorRuntime().wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                this.assertRecvDirection();\n                transceiver = this._mapMidTransceiver.get(localId);\n\n                if (transceiver) {\n                  _context19.next = 4;\n                  break;\n                }\n\n                throw new Error('associated RTCRtpTransceiver not found');\n\n              case 4:\n                return _context19.abrupt(\"return\", transceiver.receiver.getStats());\n\n              case 5:\n              case \"end\":\n                return _context19.stop();\n            }\n          }\n        }, _callee19, this);\n      }));\n\n      function getReceiverStats(_x19) {\n        return _getReceiverStats.apply(this, arguments);\n      }\n\n      return getReceiverStats;\n    }()\n  }, {\n    key: \"receiveDataChannel\",\n    value: function () {\n      var _receiveDataChannel = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee20(_ref4) {\n        var sctpStreamParameters, label, protocol, _a, streamId, ordered, maxPacketLifeTime, maxRetransmits, options, dataChannel, offer, answer, _localSdpObject;\n\n        return _regeneratorRuntime().wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                sctpStreamParameters = _ref4.sctpStreamParameters, label = _ref4.label, protocol = _ref4.protocol;\n                this.assertRecvDirection();\n                streamId = sctpStreamParameters.streamId, ordered = sctpStreamParameters.ordered, maxPacketLifeTime = sctpStreamParameters.maxPacketLifeTime, maxRetransmits = sctpStreamParameters.maxRetransmits;\n                options = {\n                  negotiated: true,\n                  id: streamId,\n                  ordered: ordered,\n                  maxPacketLifeTime: maxPacketLifeTime,\n                  maxRetransmitTime: maxPacketLifeTime,\n                  maxRetransmits: maxRetransmits,\n                  protocol: protocol\n                };\n                logger.debug('receiveDataChannel() [options:%o]', options);\n                dataChannel = this._pc.createDataChannel(label, options); // If this is the first DataChannel we need to create the SDP offer with\n                // m=application section.\n\n                if (this._hasDataChannelMediaSection) {\n                  _context20.next = 23;\n                  break;\n                }\n\n                this._remoteSdp.receiveSctpAssociation();\n\n                offer = {\n                  type: 'offer',\n                  sdp: this._remoteSdp.getSdp()\n                };\n                logger.debug('receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]', offer);\n                _context20.next = 12;\n                return this._pc.setRemoteDescription(offer);\n\n              case 12:\n                _context20.next = 14;\n                return this._pc.createAnswer();\n\n              case 14:\n                answer = _context20.sent;\n\n                if (this._transportReady) {\n                  _context20.next = 19;\n                  break;\n                }\n\n                _localSdpObject = sdpTransform.parse(answer.sdp);\n                _context20.next = 19;\n                return this.setupTransport({\n                  localDtlsRole: (_a = this._forcedLocalDtlsRole) !== null && _a !== void 0 ? _a : 'client',\n                  localSdpObject: _localSdpObject\n                });\n\n              case 19:\n                logger.debug('receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]', answer);\n                _context20.next = 22;\n                return this._pc.setLocalDescription(answer);\n\n              case 22:\n                this._hasDataChannelMediaSection = true;\n\n              case 23:\n                return _context20.abrupt(\"return\", {\n                  dataChannel: dataChannel\n                });\n\n              case 24:\n              case \"end\":\n                return _context20.stop();\n            }\n          }\n        }, _callee20, this);\n      }));\n\n      function receiveDataChannel(_x20) {\n        return _receiveDataChannel.apply(this, arguments);\n      }\n\n      return receiveDataChannel;\n    }()\n  }, {\n    key: \"setupTransport\",\n    value: function () {\n      var _setupTransport = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee21(_ref5) {\n        var _this4 = this;\n\n        var localDtlsRole, localSdpObject, dtlsParameters;\n        return _regeneratorRuntime().wrap(function _callee21$(_context21) {\n          while (1) {\n            switch (_context21.prev = _context21.next) {\n              case 0:\n                localDtlsRole = _ref5.localDtlsRole, localSdpObject = _ref5.localSdpObject;\n\n                if (!localSdpObject) {\n                  localSdpObject = sdpTransform.parse(this._pc.localDescription.sdp);\n                } // Get our local DTLS parameters.\n\n\n                dtlsParameters = sdpCommonUtils.extractDtlsParameters({\n                  sdpObject: localSdpObject\n                }); // Set our DTLS role.\n\n                dtlsParameters.role = localDtlsRole; // Update the remote DTLS role in the SDP.\n\n                this._remoteSdp.updateDtlsRole(localDtlsRole === 'client' ? 'server' : 'client'); // Need to tell the remote transport about our parameters.\n\n\n                _context21.next = 7;\n                return new Promise(function (resolve, reject) {\n                  _this4.safeEmit('@connect', {\n                    dtlsParameters: dtlsParameters\n                  }, resolve, reject);\n                });\n\n              case 7:\n                this._transportReady = true;\n\n              case 8:\n              case \"end\":\n                return _context21.stop();\n            }\n          }\n        }, _callee21, this);\n      }));\n\n      function setupTransport(_x21) {\n        return _setupTransport.apply(this, arguments);\n      }\n\n      return setupTransport;\n    }()\n  }, {\n    key: \"assertSendDirection\",\n    value: function assertSendDirection() {\n      if (this._direction !== 'send') {\n        throw new Error('method can just be called for handlers with \"send\" direction');\n      }\n    }\n  }, {\n    key: \"assertRecvDirection\",\n    value: function assertRecvDirection() {\n      if (this._direction !== 'recv') {\n        throw new Error('method can just be called for handlers with \"recv\" direction');\n      }\n    }\n  }], [{\n    key: \"createFactory\",\n    value:\n    /**\n     * Creates a factory function.\n     */\n    function createFactory() {\n      return function () {\n        return new Chrome70();\n      };\n    }\n  }]);\n\n  return Chrome70;\n}(HandlerInterface_1.HandlerInterface);\n\nexports.Chrome70 = Chrome70;","map":{"version":3,"names":["__createBinding","Object","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","prototype","hasOwnProperty","call","exports","Chrome70","sdpTransform","require","Logger_1","utils","ortc","sdpCommonUtils","sdpUnifiedPlanUtils","HandlerInterface_1","RemoteSdp_1","scalabilityModes_1","logger","Logger","SCTP_NUM_STREAMS","OS","MIS","_mapMidTransceiver","Map","_sendStream","MediaStream","_hasDataChannelMediaSection","_nextSendSctpStreamId","_transportReady","debug","_pc","close","error","emit","pc","RTCPeerConnection","iceServers","iceTransportPolicy","bundlePolicy","rtcpMuxPolicy","sdpSemantics","addTransceiver","createOffer","offer","sdpObject","parse","sdp","nativeRtpCapabilities","extractRtpCapabilities","error2","numStreams","direction","iceParameters","iceCandidates","dtlsParameters","sctpParameters","additionalSettings","proprietaryConstraints","extendedRtpCapabilities","_direction","_remoteSdp","RemoteSdp","_sendingRtpParametersByKind","audio","getSendingRtpParameters","video","_sendingRemoteRtpParametersByKind","getSendingRemoteRtpParameters","role","_forcedLocalDtlsRole","connectionState","addEventListener","warn","iceConnectionState","configuration","getConfiguration","setConfiguration","updateIceParameters","iceRestart","setLocalDescription","answer","type","getSdp","setRemoteDescription","createAnswer","getStats","track","encodings","codecOptions","codec","assertSendDirection","kind","id","sendingRtpParameters","clone","codecs","reduceCodecs","sendingRemoteRtpParameters","mediaSectionIdx","getNextMediaSectionIdx","transceiver","streams","localSdpObject","setupTransport","localDtlsRole","_a","length","offerMediaObject","media","idx","addLegacySimulcast","write","hackVp9Svc","layers","scalabilityMode","spatialLayers","mimeType","toLowerCase","parameters","sender","getParameters","encoding","desiredEncoding","assign","setParameters","localId","mid","localDescription","rtcp","cname","getCname","getRtpEncodings","send","reuseMid","offerRtpParameters","answerRtpParameters","set","rtpParameters","rtpSender","Error","replaceTrack","removeTrack","mediaSectionClosed","closeMediaSection","stop","delete","spatialLayer","forEach","active","muxMediaSectionSimulcast","params","ordered","maxPacketLifeTime","maxRetransmits","label","protocol","options","negotiated","maxRetransmitTime","dataChannel","createDataChannel","find","sendSctpAssociation","sctpStreamParameters","streamId","optionsList","assertRecvDirection","results","mapLocalId","trackId","String","size","receive","answerMediaObject","applyCodecParameters","getTransceivers","t","push","receiver","rtpReceiver","localIds","receiveSctpAssociation","extractDtlsParameters","updateDtlsRole","Promise","resolve","reject","safeEmit","HandlerInterface"],"sources":["/home/runner/work/watchparty/watchparty/node_modules/mediasoup-client/lib/handlers/Chrome70.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Chrome70 = void 0;\nconst sdpTransform = __importStar(require(\"sdp-transform\"));\nconst Logger_1 = require(\"../Logger\");\nconst utils = __importStar(require(\"../utils\"));\nconst ortc = __importStar(require(\"../ortc\"));\nconst sdpCommonUtils = __importStar(require(\"./sdp/commonUtils\"));\nconst sdpUnifiedPlanUtils = __importStar(require(\"./sdp/unifiedPlanUtils\"));\nconst HandlerInterface_1 = require(\"./HandlerInterface\");\nconst RemoteSdp_1 = require(\"./sdp/RemoteSdp\");\nconst scalabilityModes_1 = require(\"../scalabilityModes\");\nconst logger = new Logger_1.Logger('Chrome70');\nconst SCTP_NUM_STREAMS = { OS: 1024, MIS: 1024 };\nclass Chrome70 extends HandlerInterface_1.HandlerInterface {\n    /**\n     * Creates a factory function.\n     */\n    static createFactory() {\n        return () => new Chrome70();\n    }\n    constructor() {\n        super();\n        // Map of RTCTransceivers indexed by MID.\n        this._mapMidTransceiver = new Map();\n        // Local stream for sending.\n        this._sendStream = new MediaStream();\n        // Whether a DataChannel m=application section has been created.\n        this._hasDataChannelMediaSection = false;\n        // Sending DataChannel id value counter. Incremented for each new DataChannel.\n        this._nextSendSctpStreamId = 0;\n        // Got transport local and remote parameters.\n        this._transportReady = false;\n    }\n    get name() {\n        return 'Chrome70';\n    }\n    close() {\n        logger.debug('close()');\n        // Close RTCPeerConnection.\n        if (this._pc) {\n            try {\n                this._pc.close();\n            }\n            catch (error) { }\n        }\n        this.emit('@close');\n    }\n    async getNativeRtpCapabilities() {\n        logger.debug('getNativeRtpCapabilities()');\n        const pc = new RTCPeerConnection({\n            iceServers: [],\n            iceTransportPolicy: 'all',\n            bundlePolicy: 'max-bundle',\n            rtcpMuxPolicy: 'require',\n            sdpSemantics: 'unified-plan'\n        });\n        try {\n            pc.addTransceiver('audio');\n            pc.addTransceiver('video');\n            const offer = await pc.createOffer();\n            try {\n                pc.close();\n            }\n            catch (error) { }\n            const sdpObject = sdpTransform.parse(offer.sdp);\n            const nativeRtpCapabilities = sdpCommonUtils.extractRtpCapabilities({ sdpObject });\n            return nativeRtpCapabilities;\n        }\n        catch (error) {\n            try {\n                pc.close();\n            }\n            catch (error2) { }\n            throw error;\n        }\n    }\n    async getNativeSctpCapabilities() {\n        logger.debug('getNativeSctpCapabilities()');\n        return {\n            numStreams: SCTP_NUM_STREAMS\n        };\n    }\n    run({ direction, iceParameters, iceCandidates, dtlsParameters, sctpParameters, iceServers, iceTransportPolicy, additionalSettings, proprietaryConstraints, extendedRtpCapabilities }) {\n        logger.debug('run()');\n        this._direction = direction;\n        this._remoteSdp = new RemoteSdp_1.RemoteSdp({\n            iceParameters,\n            iceCandidates,\n            dtlsParameters,\n            sctpParameters\n        });\n        this._sendingRtpParametersByKind =\n            {\n                audio: ortc.getSendingRtpParameters('audio', extendedRtpCapabilities),\n                video: ortc.getSendingRtpParameters('video', extendedRtpCapabilities)\n            };\n        this._sendingRemoteRtpParametersByKind =\n            {\n                audio: ortc.getSendingRemoteRtpParameters('audio', extendedRtpCapabilities),\n                video: ortc.getSendingRemoteRtpParameters('video', extendedRtpCapabilities)\n            };\n        if (dtlsParameters.role && dtlsParameters.role !== 'auto') {\n            this._forcedLocalDtlsRole = dtlsParameters.role === 'server'\n                ? 'client'\n                : 'server';\n        }\n        this._pc = new RTCPeerConnection({\n            iceServers: iceServers || [],\n            iceTransportPolicy: iceTransportPolicy || 'all',\n            bundlePolicy: 'max-bundle',\n            rtcpMuxPolicy: 'require',\n            sdpSemantics: 'unified-plan',\n            ...additionalSettings\n        }, proprietaryConstraints);\n        if (this._pc.connectionState) {\n            this._pc.addEventListener('connectionstatechange', () => {\n                this.emit('@connectionstatechange', this._pc.connectionState);\n            });\n        }\n        else {\n            this._pc.addEventListener('iceconnectionstatechange', () => {\n                logger.warn('run() | pc.connectionState not supported, using pc.iceConnectionState');\n                switch (this._pc.iceConnectionState) {\n                    case 'checking':\n                        this.emit('@connectionstatechange', 'connecting');\n                        break;\n                    case 'connected':\n                    case 'completed':\n                        this.emit('@connectionstatechange', 'connected');\n                        break;\n                    case 'failed':\n                        this.emit('@connectionstatechange', 'failed');\n                        break;\n                    case 'disconnected':\n                        this.emit('@connectionstatechange', 'disconnected');\n                        break;\n                    case 'closed':\n                        this.emit('@connectionstatechange', 'closed');\n                        break;\n                }\n            });\n        }\n    }\n    async updateIceServers(iceServers) {\n        logger.debug('updateIceServers()');\n        const configuration = this._pc.getConfiguration();\n        configuration.iceServers = iceServers;\n        this._pc.setConfiguration(configuration);\n    }\n    async restartIce(iceParameters) {\n        logger.debug('restartIce()');\n        // Provide the remote SDP handler with new remote ICE parameters.\n        this._remoteSdp.updateIceParameters(iceParameters);\n        if (!this._transportReady) {\n            return;\n        }\n        if (this._direction === 'send') {\n            const offer = await this._pc.createOffer({ iceRestart: true });\n            logger.debug('restartIce() | calling pc.setLocalDescription() [offer:%o]', offer);\n            await this._pc.setLocalDescription(offer);\n            const answer = { type: 'answer', sdp: this._remoteSdp.getSdp() };\n            logger.debug('restartIce() | calling pc.setRemoteDescription() [answer:%o]', answer);\n            await this._pc.setRemoteDescription(answer);\n        }\n        else {\n            const offer = { type: 'offer', sdp: this._remoteSdp.getSdp() };\n            logger.debug('restartIce() | calling pc.setRemoteDescription() [offer:%o]', offer);\n            await this._pc.setRemoteDescription(offer);\n            const answer = await this._pc.createAnswer();\n            logger.debug('restartIce() | calling pc.setLocalDescription() [answer:%o]', answer);\n            await this._pc.setLocalDescription(answer);\n        }\n    }\n    async getTransportStats() {\n        return this._pc.getStats();\n    }\n    async send({ track, encodings, codecOptions, codec }) {\n        var _a;\n        this.assertSendDirection();\n        logger.debug('send() [kind:%s, track.id:%s]', track.kind, track.id);\n        const sendingRtpParameters = utils.clone(this._sendingRtpParametersByKind[track.kind], {});\n        // This may throw.\n        sendingRtpParameters.codecs =\n            ortc.reduceCodecs(sendingRtpParameters.codecs, codec);\n        const sendingRemoteRtpParameters = utils.clone(this._sendingRemoteRtpParametersByKind[track.kind], {});\n        // This may throw.\n        sendingRemoteRtpParameters.codecs =\n            ortc.reduceCodecs(sendingRemoteRtpParameters.codecs, codec);\n        const mediaSectionIdx = this._remoteSdp.getNextMediaSectionIdx();\n        const transceiver = this._pc.addTransceiver(track, { direction: 'sendonly', streams: [this._sendStream] });\n        let offer = await this._pc.createOffer();\n        let localSdpObject = sdpTransform.parse(offer.sdp);\n        let offerMediaObject;\n        if (!this._transportReady) {\n            await this.setupTransport({\n                localDtlsRole: (_a = this._forcedLocalDtlsRole) !== null && _a !== void 0 ? _a : 'client',\n                localSdpObject\n            });\n        }\n        if (encodings && encodings.length > 1) {\n            logger.debug('send() | enabling legacy simulcast');\n            localSdpObject = sdpTransform.parse(offer.sdp);\n            offerMediaObject = localSdpObject.media[mediaSectionIdx.idx];\n            sdpUnifiedPlanUtils.addLegacySimulcast({\n                offerMediaObject,\n                numStreams: encodings.length\n            });\n            offer = { type: 'offer', sdp: sdpTransform.write(localSdpObject) };\n        }\n        // Special case for VP9 with SVC.\n        let hackVp9Svc = false;\n        const layers = (0, scalabilityModes_1.parse)((encodings || [{}])[0].scalabilityMode);\n        if (encodings &&\n            encodings.length === 1 &&\n            layers.spatialLayers > 1 &&\n            sendingRtpParameters.codecs[0].mimeType.toLowerCase() === 'video/vp9') {\n            logger.debug('send() | enabling legacy simulcast for VP9 SVC');\n            hackVp9Svc = true;\n            localSdpObject = sdpTransform.parse(offer.sdp);\n            offerMediaObject = localSdpObject.media[mediaSectionIdx.idx];\n            sdpUnifiedPlanUtils.addLegacySimulcast({\n                offerMediaObject,\n                numStreams: layers.spatialLayers\n            });\n            offer = { type: 'offer', sdp: sdpTransform.write(localSdpObject) };\n        }\n        logger.debug('send() | calling pc.setLocalDescription() [offer:%o]', offer);\n        await this._pc.setLocalDescription(offer);\n        // If encodings are given, apply them now.\n        if (encodings) {\n            logger.debug('send() | applying given encodings');\n            const parameters = transceiver.sender.getParameters();\n            for (let idx = 0; idx < (parameters.encodings || []).length; ++idx) {\n                const encoding = parameters.encodings[idx];\n                const desiredEncoding = encodings[idx];\n                // Should not happen but just in case.\n                if (!desiredEncoding) {\n                    break;\n                }\n                parameters.encodings[idx] = Object.assign(encoding, desiredEncoding);\n            }\n            await transceiver.sender.setParameters(parameters);\n        }\n        // We can now get the transceiver.mid.\n        const localId = transceiver.mid;\n        // Set MID.\n        sendingRtpParameters.mid = localId;\n        localSdpObject = sdpTransform.parse(this._pc.localDescription.sdp);\n        offerMediaObject = localSdpObject.media[mediaSectionIdx.idx];\n        // Set RTCP CNAME.\n        sendingRtpParameters.rtcp.cname =\n            sdpCommonUtils.getCname({ offerMediaObject });\n        // Set RTP encodings.\n        sendingRtpParameters.encodings =\n            sdpUnifiedPlanUtils.getRtpEncodings({ offerMediaObject });\n        // Complete encodings with given values.\n        if (encodings) {\n            for (let idx = 0; idx < sendingRtpParameters.encodings.length; ++idx) {\n                if (encodings[idx]) {\n                    Object.assign(sendingRtpParameters.encodings[idx], encodings[idx]);\n                }\n            }\n        }\n        // Hack for VP9 SVC.\n        if (hackVp9Svc) {\n            sendingRtpParameters.encodings = [sendingRtpParameters.encodings[0]];\n        }\n        // If VP8 or H264 and there is effective simulcast, add scalabilityMode to\n        // each encoding.\n        if (sendingRtpParameters.encodings.length > 1 &&\n            (sendingRtpParameters.codecs[0].mimeType.toLowerCase() === 'video/vp8' ||\n                sendingRtpParameters.codecs[0].mimeType.toLowerCase() === 'video/h264')) {\n            for (const encoding of sendingRtpParameters.encodings) {\n                encoding.scalabilityMode = 'L1T3';\n            }\n        }\n        this._remoteSdp.send({\n            offerMediaObject,\n            reuseMid: mediaSectionIdx.reuseMid,\n            offerRtpParameters: sendingRtpParameters,\n            answerRtpParameters: sendingRemoteRtpParameters,\n            codecOptions\n        });\n        const answer = { type: 'answer', sdp: this._remoteSdp.getSdp() };\n        logger.debug('send() | calling pc.setRemoteDescription() [answer:%o]', answer);\n        await this._pc.setRemoteDescription(answer);\n        // Store in the map.\n        this._mapMidTransceiver.set(localId, transceiver);\n        return {\n            localId,\n            rtpParameters: sendingRtpParameters,\n            rtpSender: transceiver.sender\n        };\n    }\n    async stopSending(localId) {\n        this.assertSendDirection();\n        logger.debug('stopSending() [localId:%s]', localId);\n        const transceiver = this._mapMidTransceiver.get(localId);\n        if (!transceiver) {\n            throw new Error('associated RTCRtpTransceiver not found');\n        }\n        transceiver.sender.replaceTrack(null);\n        this._pc.removeTrack(transceiver.sender);\n        const mediaSectionClosed = this._remoteSdp.closeMediaSection(transceiver.mid);\n        if (mediaSectionClosed) {\n            try {\n                transceiver.stop();\n            }\n            catch (error) { }\n        }\n        const offer = await this._pc.createOffer();\n        logger.debug('stopSending() | calling pc.setLocalDescription() [offer:%o]', offer);\n        await this._pc.setLocalDescription(offer);\n        const answer = { type: 'answer', sdp: this._remoteSdp.getSdp() };\n        logger.debug('stopSending() | calling pc.setRemoteDescription() [answer:%o]', answer);\n        await this._pc.setRemoteDescription(answer);\n        this._mapMidTransceiver.delete(localId);\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    async pauseSending(localId) {\n        // Unimplemented.\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    async resumeSending(localId) {\n        // Unimplemented.\n    }\n    async replaceTrack(localId, track) {\n        this.assertSendDirection();\n        if (track) {\n            logger.debug('replaceTrack() [localId:%s, track.id:%s]', localId, track.id);\n        }\n        else {\n            logger.debug('replaceTrack() [localId:%s, no track]', localId);\n        }\n        const transceiver = this._mapMidTransceiver.get(localId);\n        if (!transceiver) {\n            throw new Error('associated RTCRtpTransceiver not found');\n        }\n        await transceiver.sender.replaceTrack(track);\n    }\n    async setMaxSpatialLayer(localId, spatialLayer) {\n        this.assertSendDirection();\n        logger.debug('setMaxSpatialLayer() [localId:%s, spatialLayer:%s]', localId, spatialLayer);\n        const transceiver = this._mapMidTransceiver.get(localId);\n        if (!transceiver) {\n            throw new Error('associated RTCRtpTransceiver not found');\n        }\n        const parameters = transceiver.sender.getParameters();\n        parameters.encodings.forEach((encoding, idx) => {\n            if (idx <= spatialLayer) {\n                encoding.active = true;\n            }\n            else {\n                encoding.active = false;\n            }\n        });\n        await transceiver.sender.setParameters(parameters);\n        this._remoteSdp.muxMediaSectionSimulcast(localId, parameters.encodings);\n        const offer = await this._pc.createOffer();\n        logger.debug('setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]', offer);\n        await this._pc.setLocalDescription(offer);\n        const answer = { type: 'answer', sdp: this._remoteSdp.getSdp() };\n        logger.debug('setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]', answer);\n        await this._pc.setRemoteDescription(answer);\n    }\n    async setRtpEncodingParameters(localId, params) {\n        this.assertSendDirection();\n        logger.debug('setRtpEncodingParameters() [localId:%s, params:%o]', localId, params);\n        const transceiver = this._mapMidTransceiver.get(localId);\n        if (!transceiver) {\n            throw new Error('associated RTCRtpTransceiver not found');\n        }\n        const parameters = transceiver.sender.getParameters();\n        parameters.encodings.forEach((encoding, idx) => {\n            parameters.encodings[idx] = { ...encoding, ...params };\n        });\n        await transceiver.sender.setParameters(parameters);\n        this._remoteSdp.muxMediaSectionSimulcast(localId, parameters.encodings);\n        const offer = await this._pc.createOffer();\n        logger.debug('setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]', offer);\n        await this._pc.setLocalDescription(offer);\n        const answer = { type: 'answer', sdp: this._remoteSdp.getSdp() };\n        logger.debug('setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]', answer);\n        await this._pc.setRemoteDescription(answer);\n    }\n    async getSenderStats(localId) {\n        this.assertSendDirection();\n        const transceiver = this._mapMidTransceiver.get(localId);\n        if (!transceiver) {\n            throw new Error('associated RTCRtpTransceiver not found');\n        }\n        return transceiver.sender.getStats();\n    }\n    async sendDataChannel({ ordered, maxPacketLifeTime, maxRetransmits, label, protocol }) {\n        var _a;\n        this.assertSendDirection();\n        const options = {\n            negotiated: true,\n            id: this._nextSendSctpStreamId,\n            ordered,\n            maxPacketLifeTime,\n            maxRetransmitTime: maxPacketLifeTime,\n            maxRetransmits,\n            protocol\n        };\n        logger.debug('sendDataChannel() [options:%o]', options);\n        const dataChannel = this._pc.createDataChannel(label, options);\n        // Increase next id.\n        this._nextSendSctpStreamId =\n            ++this._nextSendSctpStreamId % SCTP_NUM_STREAMS.MIS;\n        // If this is the first DataChannel we need to create the SDP answer with\n        // m=application section.\n        if (!this._hasDataChannelMediaSection) {\n            const offer = await this._pc.createOffer();\n            const localSdpObject = sdpTransform.parse(offer.sdp);\n            const offerMediaObject = localSdpObject.media\n                .find((m) => m.type === 'application');\n            if (!this._transportReady) {\n                await this.setupTransport({\n                    localDtlsRole: (_a = this._forcedLocalDtlsRole) !== null && _a !== void 0 ? _a : 'client',\n                    localSdpObject\n                });\n            }\n            logger.debug('sendDataChannel() | calling pc.setLocalDescription() [offer:%o]', offer);\n            await this._pc.setLocalDescription(offer);\n            this._remoteSdp.sendSctpAssociation({ offerMediaObject });\n            const answer = { type: 'answer', sdp: this._remoteSdp.getSdp() };\n            logger.debug('sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]', answer);\n            await this._pc.setRemoteDescription(answer);\n            this._hasDataChannelMediaSection = true;\n        }\n        const sctpStreamParameters = {\n            streamId: options.id,\n            ordered: options.ordered,\n            maxPacketLifeTime: options.maxPacketLifeTime,\n            maxRetransmits: options.maxRetransmits\n        };\n        return { dataChannel, sctpStreamParameters };\n    }\n    async receive(optionsList) {\n        var _a;\n        this.assertRecvDirection();\n        const results = [];\n        const mapLocalId = new Map();\n        for (const options of optionsList) {\n            const { trackId, kind, rtpParameters, streamId } = options;\n            logger.debug('receive() [trackId:%s, kind:%s]', trackId, kind);\n            const localId = rtpParameters.mid || String(this._mapMidTransceiver.size);\n            mapLocalId.set(trackId, localId);\n            this._remoteSdp.receive({\n                mid: localId,\n                kind,\n                offerRtpParameters: rtpParameters,\n                streamId: streamId || rtpParameters.rtcp.cname,\n                trackId\n            });\n        }\n        const offer = { type: 'offer', sdp: this._remoteSdp.getSdp() };\n        logger.debug('receive() | calling pc.setRemoteDescription() [offer:%o]', offer);\n        await this._pc.setRemoteDescription(offer);\n        let answer = await this._pc.createAnswer();\n        const localSdpObject = sdpTransform.parse(answer.sdp);\n        for (const options of optionsList) {\n            const { trackId, rtpParameters } = options;\n            const localId = mapLocalId.get(trackId);\n            const answerMediaObject = localSdpObject.media\n                .find((m) => String(m.mid) === localId);\n            // May need to modify codec parameters in the answer based on codec\n            // parameters in the offer.\n            sdpCommonUtils.applyCodecParameters({\n                offerRtpParameters: rtpParameters,\n                answerMediaObject\n            });\n        }\n        answer = { type: 'answer', sdp: sdpTransform.write(localSdpObject) };\n        if (!this._transportReady) {\n            await this.setupTransport({\n                localDtlsRole: (_a = this._forcedLocalDtlsRole) !== null && _a !== void 0 ? _a : 'client',\n                localSdpObject\n            });\n        }\n        logger.debug('receive() | calling pc.setLocalDescription() [answer:%o]', answer);\n        await this._pc.setLocalDescription(answer);\n        for (const options of optionsList) {\n            const { trackId } = options;\n            const localId = mapLocalId.get(trackId);\n            const transceiver = this._pc.getTransceivers()\n                .find((t) => t.mid === localId);\n            if (!transceiver) {\n                throw new Error('new RTCRtpTransceiver not found');\n            }\n            // Store in the map.\n            this._mapMidTransceiver.set(localId, transceiver);\n            results.push({\n                localId,\n                track: transceiver.receiver.track,\n                rtpReceiver: transceiver.receiver\n            });\n        }\n        return results;\n    }\n    async stopReceiving(localIds) {\n        this.assertRecvDirection();\n        for (const localId of localIds) {\n            logger.debug('stopReceiving() [localId:%s]', localId);\n            const transceiver = this._mapMidTransceiver.get(localId);\n            if (!transceiver) {\n                throw new Error('associated RTCRtpTransceiver not found');\n            }\n            this._remoteSdp.closeMediaSection(transceiver.mid);\n        }\n        const offer = { type: 'offer', sdp: this._remoteSdp.getSdp() };\n        logger.debug('stopReceiving() | calling pc.setRemoteDescription() [offer:%o]', offer);\n        await this._pc.setRemoteDescription(offer);\n        const answer = await this._pc.createAnswer();\n        logger.debug('stopReceiving() | calling pc.setLocalDescription() [answer:%o]', answer);\n        await this._pc.setLocalDescription(answer);\n        for (const localId of localIds) {\n            this._mapMidTransceiver.delete(localId);\n        }\n    }\n    async pauseReceiving(\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    localIds) {\n        // Unimplemented.\n    }\n    async resumeReceiving(\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    localIds) {\n        // Unimplemented.\n    }\n    async getReceiverStats(localId) {\n        this.assertRecvDirection();\n        const transceiver = this._mapMidTransceiver.get(localId);\n        if (!transceiver) {\n            throw new Error('associated RTCRtpTransceiver not found');\n        }\n        return transceiver.receiver.getStats();\n    }\n    async receiveDataChannel({ sctpStreamParameters, label, protocol }) {\n        var _a;\n        this.assertRecvDirection();\n        const { streamId, ordered, maxPacketLifeTime, maxRetransmits } = sctpStreamParameters;\n        const options = {\n            negotiated: true,\n            id: streamId,\n            ordered,\n            maxPacketLifeTime,\n            maxRetransmitTime: maxPacketLifeTime,\n            maxRetransmits,\n            protocol\n        };\n        logger.debug('receiveDataChannel() [options:%o]', options);\n        const dataChannel = this._pc.createDataChannel(label, options);\n        // If this is the first DataChannel we need to create the SDP offer with\n        // m=application section.\n        if (!this._hasDataChannelMediaSection) {\n            this._remoteSdp.receiveSctpAssociation();\n            const offer = { type: 'offer', sdp: this._remoteSdp.getSdp() };\n            logger.debug('receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]', offer);\n            await this._pc.setRemoteDescription(offer);\n            const answer = await this._pc.createAnswer();\n            if (!this._transportReady) {\n                const localSdpObject = sdpTransform.parse(answer.sdp);\n                await this.setupTransport({\n                    localDtlsRole: (_a = this._forcedLocalDtlsRole) !== null && _a !== void 0 ? _a : 'client',\n                    localSdpObject\n                });\n            }\n            logger.debug('receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]', answer);\n            await this._pc.setLocalDescription(answer);\n            this._hasDataChannelMediaSection = true;\n        }\n        return { dataChannel };\n    }\n    async setupTransport({ localDtlsRole, localSdpObject }) {\n        if (!localSdpObject) {\n            localSdpObject = sdpTransform.parse(this._pc.localDescription.sdp);\n        }\n        // Get our local DTLS parameters.\n        const dtlsParameters = sdpCommonUtils.extractDtlsParameters({ sdpObject: localSdpObject });\n        // Set our DTLS role.\n        dtlsParameters.role = localDtlsRole;\n        // Update the remote DTLS role in the SDP.\n        this._remoteSdp.updateDtlsRole(localDtlsRole === 'client' ? 'server' : 'client');\n        // Need to tell the remote transport about our parameters.\n        await new Promise((resolve, reject) => {\n            this.safeEmit('@connect', { dtlsParameters }, resolve, reject);\n        });\n        this._transportReady = true;\n    }\n    assertSendDirection() {\n        if (this._direction !== 'send') {\n            throw new Error('method can just be called for handlers with \"send\" direction');\n        }\n    }\n    assertRecvDirection() {\n        if (this._direction !== 'recv') {\n            throw new Error('method can just be called for handlers with \"recv\" direction');\n        }\n    }\n}\nexports.Chrome70 = Chrome70;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}