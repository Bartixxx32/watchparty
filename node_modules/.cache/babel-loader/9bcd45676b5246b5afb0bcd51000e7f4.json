{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\n\nvar _asyncToGenerator = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nvar _classCallCheck = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\n\nvar _createClass = require(\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/createClass.js\").default;\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function get() {\n        return m[k];\n      }\n    };\n  }\n\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Device = exports.detectDevice = void 0;\n\nvar bowser_1 = __importDefault(require(\"bowser\"));\n\nvar Logger_1 = require(\"./Logger\");\n\nvar EnhancedEventEmitter_1 = require(\"./EnhancedEventEmitter\");\n\nvar errors_1 = require(\"./errors\");\n\nvar utils = __importStar(require(\"./utils\"));\n\nvar ortc = __importStar(require(\"./ortc\"));\n\nvar Transport_1 = require(\"./Transport\");\n\nvar Chrome111_1 = require(\"./handlers/Chrome111\");\n\nvar Chrome74_1 = require(\"./handlers/Chrome74\");\n\nvar Chrome70_1 = require(\"./handlers/Chrome70\");\n\nvar Chrome67_1 = require(\"./handlers/Chrome67\");\n\nvar Chrome55_1 = require(\"./handlers/Chrome55\");\n\nvar Firefox60_1 = require(\"./handlers/Firefox60\");\n\nvar Safari12_1 = require(\"./handlers/Safari12\");\n\nvar Safari11_1 = require(\"./handlers/Safari11\");\n\nvar Edge11_1 = require(\"./handlers/Edge11\");\n\nvar ReactNativeUnifiedPlan_1 = require(\"./handlers/ReactNativeUnifiedPlan\");\n\nvar ReactNative_1 = require(\"./handlers/ReactNative\");\n\nvar logger = new Logger_1.Logger('Device');\n\nfunction detectDevice() {\n  // React-Native.\n  // NOTE: react-native-webrtc >= 1.75.0 is required.\n  // NOTE: react-native-webrtc with Unified Plan requires version >= 106.0.0.\n  if (typeof navigator === 'object' && navigator.product === 'ReactNative') {\n    if (typeof RTCPeerConnection === 'undefined') {\n      logger.warn('this._detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?');\n      return undefined;\n    }\n\n    if (typeof RTCRtpTransceiver !== 'undefined') {\n      logger.debug('this._detectDevice() | ReactNative UnifiedPlan handler chosen');\n      return 'ReactNativeUnifiedPlan';\n    } else {\n      logger.debug('this._detectDevice() | ReactNative PlanB handler chosen');\n      return 'ReactNative';\n    }\n  } // Browser.\n  else if (typeof navigator === 'object' && typeof navigator.userAgent === 'string') {\n    var ua = navigator.userAgent;\n    var browser = bowser_1.default.getParser(ua);\n    var engine = browser.getEngine(); // Chrome, Chromium, and Edge.\n\n    if (browser.satisfies({\n      chrome: '>=111',\n      chromium: '>=111',\n      'microsoft edge': '>=111'\n    })) {\n      return 'Chrome111';\n    } else if (browser.satisfies({\n      chrome: '>=74',\n      chromium: '>=74',\n      'microsoft edge': '>=88'\n    })) {\n      return 'Chrome74';\n    } else if (browser.satisfies({\n      chrome: '>=70',\n      chromium: '>=70'\n    })) {\n      return 'Chrome70';\n    } else if (browser.satisfies({\n      chrome: '>=67',\n      chromium: '>=67'\n    })) {\n      return 'Chrome67';\n    } else if (browser.satisfies({\n      chrome: '>=55',\n      chromium: '>=55'\n    })) {\n      return 'Chrome55';\n    } // Firefox.\n    else if (browser.satisfies({\n      firefox: '>=60'\n    })) {\n      return 'Firefox60';\n    } // Firefox on iOS.\n    else if (browser.satisfies({\n      ios: {\n        OS: '>=14.3',\n        firefox: '>=30.0'\n      }\n    })) {\n      return 'Safari12';\n    } // Safari with Unified-Plan support enabled.\n    else if (browser.satisfies({\n      safari: '>=12.0'\n    }) && typeof RTCRtpTransceiver !== 'undefined' && RTCRtpTransceiver.prototype.hasOwnProperty('currentDirection')) {\n      return 'Safari12';\n    } // Safari with Plab-B support.\n    else if (browser.satisfies({\n      safari: '>=11'\n    })) {\n      return 'Safari11';\n    } // Old Edge with ORTC support.\n    else if (browser.satisfies({\n      'microsoft edge': '>=11'\n    }) && browser.satisfies({\n      'microsoft edge': '<=18'\n    })) {\n      return 'Edge11';\n    } // Best effort for Chromium based browsers.\n    else if (engine.name && engine.name.toLowerCase() === 'blink') {\n      var match = ua.match(/(?:(?:Chrome|Chromium))[ /](\\w+)/i);\n\n      if (match) {\n        var version = Number(match[1]);\n\n        if (version >= 111) {\n          return 'Chrome111';\n        } else if (version >= 74) {\n          return 'Chrome74';\n        } else if (version >= 70) {\n          return 'Chrome70';\n        } else if (version >= 67) {\n          return 'Chrome67';\n        } else {\n          return 'Chrome55';\n        }\n      } else {\n        return 'Chrome111';\n      }\n    } // Unsupported browser.\n    else {\n      logger.warn('this._detectDevice() | browser not supported [name:%s, version:%s]', browser.getBrowserName(), browser.getBrowserVersion());\n      return undefined;\n    }\n  } // Unknown device.\n  else {\n    logger.warn('this._detectDevice() | unknown device');\n    return undefined;\n  }\n}\n\nexports.detectDevice = detectDevice;\n\nvar Device = /*#__PURE__*/function () {\n  /**\n   * Create a new Device to connect to mediasoup server.\n   *\n   * @throws {UnsupportedError} if device is not supported.\n   */\n  function Device() {\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        handlerName = _ref.handlerName,\n        handlerFactory = _ref.handlerFactory,\n        Handler = _ref.Handler;\n\n    _classCallCheck(this, Device);\n\n    // Loaded flag.\n    this._loaded = false; // Observer instance.\n\n    this._observer = new EnhancedEventEmitter_1.EnhancedEventEmitter();\n    logger.debug('constructor()'); // Handle deprecated option.\n\n    if (Handler) {\n      logger.warn('constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead');\n\n      if (typeof Handler === 'string') {\n        handlerName = Handler;\n      } else {\n        throw new TypeError('non string Handler option no longer supported, use handlerFactory instead');\n      }\n    }\n\n    if (handlerName && handlerFactory) {\n      throw new TypeError('just one of handlerName or handlerInterface can be given');\n    }\n\n    if (handlerFactory) {\n      this._handlerFactory = handlerFactory;\n    } else {\n      if (handlerName) {\n        logger.debug('constructor() | handler given: %s', handlerName);\n      } else {\n        handlerName = detectDevice();\n\n        if (handlerName) {\n          logger.debug('constructor() | detected handler: %s', handlerName);\n        } else {\n          throw new errors_1.UnsupportedError('device not supported');\n        }\n      }\n\n      switch (handlerName) {\n        case 'Chrome111':\n          this._handlerFactory = Chrome111_1.Chrome111.createFactory();\n          break;\n\n        case 'Chrome74':\n          this._handlerFactory = Chrome74_1.Chrome74.createFactory();\n          break;\n\n        case 'Chrome70':\n          this._handlerFactory = Chrome70_1.Chrome70.createFactory();\n          break;\n\n        case 'Chrome67':\n          this._handlerFactory = Chrome67_1.Chrome67.createFactory();\n          break;\n\n        case 'Chrome55':\n          this._handlerFactory = Chrome55_1.Chrome55.createFactory();\n          break;\n\n        case 'Firefox60':\n          this._handlerFactory = Firefox60_1.Firefox60.createFactory();\n          break;\n\n        case 'Safari12':\n          this._handlerFactory = Safari12_1.Safari12.createFactory();\n          break;\n\n        case 'Safari11':\n          this._handlerFactory = Safari11_1.Safari11.createFactory();\n          break;\n\n        case 'Edge11':\n          this._handlerFactory = Edge11_1.Edge11.createFactory();\n          break;\n\n        case 'ReactNativeUnifiedPlan':\n          this._handlerFactory = ReactNativeUnifiedPlan_1.ReactNativeUnifiedPlan.createFactory();\n          break;\n\n        case 'ReactNative':\n          this._handlerFactory = ReactNative_1.ReactNative.createFactory();\n          break;\n\n        default:\n          throw new TypeError(\"unknown handlerName \\\"\".concat(handlerName, \"\\\"\"));\n      }\n    } // Create a temporal handler to get its name.\n\n\n    var handler = this._handlerFactory();\n\n    this._handlerName = handler.name;\n    handler.close();\n    this._extendedRtpCapabilities = undefined;\n    this._recvRtpCapabilities = undefined;\n    this._canProduceByKind = {\n      audio: false,\n      video: false\n    };\n    this._sctpCapabilities = undefined;\n  }\n  /**\n   * The RTC handler name.\n   */\n\n\n  _createClass(Device, [{\n    key: \"handlerName\",\n    get: function get() {\n      return this._handlerName;\n    }\n    /**\n     * Whether the Device is loaded.\n     */\n\n  }, {\n    key: \"loaded\",\n    get: function get() {\n      return this._loaded;\n    }\n    /**\n     * RTP capabilities of the Device for receiving media.\n     *\n     * @throws {InvalidStateError} if not loaded.\n     */\n\n  }, {\n    key: \"rtpCapabilities\",\n    get: function get() {\n      if (!this._loaded) {\n        throw new errors_1.InvalidStateError('not loaded');\n      }\n\n      return this._recvRtpCapabilities;\n    }\n    /**\n     * SCTP capabilities of the Device.\n     *\n     * @throws {InvalidStateError} if not loaded.\n     */\n\n  }, {\n    key: \"sctpCapabilities\",\n    get: function get() {\n      if (!this._loaded) {\n        throw new errors_1.InvalidStateError('not loaded');\n      }\n\n      return this._sctpCapabilities;\n    }\n  }, {\n    key: \"observer\",\n    get: function get() {\n      return this._observer;\n    }\n    /**\n     * Initialize the Device.\n     */\n\n  }, {\n    key: \"load\",\n    value: function () {\n      var _load = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(_ref2) {\n        var routerRtpCapabilities, handler, nativeRtpCapabilities;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                routerRtpCapabilities = _ref2.routerRtpCapabilities;\n                logger.debug('load() [routerRtpCapabilities:%o]', routerRtpCapabilities);\n                routerRtpCapabilities = utils.clone(routerRtpCapabilities, undefined); // Temporal handler to get its capabilities.\n\n                _context.prev = 3;\n\n                if (!this._loaded) {\n                  _context.next = 6;\n                  break;\n                }\n\n                throw new errors_1.InvalidStateError('already loaded');\n\n              case 6:\n                // This may throw.\n                ortc.validateRtpCapabilities(routerRtpCapabilities);\n                handler = this._handlerFactory();\n                _context.next = 10;\n                return handler.getNativeRtpCapabilities();\n\n              case 10:\n                nativeRtpCapabilities = _context.sent;\n                logger.debug('load() | got native RTP capabilities:%o', nativeRtpCapabilities); // This may throw.\n\n                ortc.validateRtpCapabilities(nativeRtpCapabilities); // Get extended RTP capabilities.\n\n                this._extendedRtpCapabilities = ortc.getExtendedRtpCapabilities(nativeRtpCapabilities, routerRtpCapabilities);\n                logger.debug('load() | got extended RTP capabilities:%o', this._extendedRtpCapabilities); // Check whether we can produce audio/video.\n\n                this._canProduceByKind.audio = ortc.canSend('audio', this._extendedRtpCapabilities);\n                this._canProduceByKind.video = ortc.canSend('video', this._extendedRtpCapabilities); // Generate our receiving RTP capabilities for receiving media.\n\n                this._recvRtpCapabilities = ortc.getRecvRtpCapabilities(this._extendedRtpCapabilities); // This may throw.\n\n                ortc.validateRtpCapabilities(this._recvRtpCapabilities);\n                logger.debug('load() | got receiving RTP capabilities:%o', this._recvRtpCapabilities); // Generate our SCTP capabilities.\n\n                _context.next = 22;\n                return handler.getNativeSctpCapabilities();\n\n              case 22:\n                this._sctpCapabilities = _context.sent;\n                logger.debug('load() | got native SCTP capabilities:%o', this._sctpCapabilities); // This may throw.\n\n                ortc.validateSctpCapabilities(this._sctpCapabilities);\n                logger.debug('load() succeeded');\n                this._loaded = true;\n                handler.close();\n                _context.next = 34;\n                break;\n\n              case 30:\n                _context.prev = 30;\n                _context.t0 = _context[\"catch\"](3);\n\n                if (handler) {\n                  handler.close();\n                }\n\n                throw _context.t0;\n\n              case 34:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[3, 30]]);\n      }));\n\n      function load(_x) {\n        return _load.apply(this, arguments);\n      }\n\n      return load;\n    }()\n    /**\n     * Whether we can produce audio/video.\n     *\n     * @throws {InvalidStateError} if not loaded.\n     * @throws {TypeError} if wrong arguments.\n     */\n\n  }, {\n    key: \"canProduce\",\n    value: function canProduce(kind) {\n      if (!this._loaded) {\n        throw new errors_1.InvalidStateError('not loaded');\n      } else if (kind !== 'audio' && kind !== 'video') {\n        throw new TypeError(\"invalid kind \\\"\".concat(kind, \"\\\"\"));\n      }\n\n      return this._canProduceByKind[kind];\n    }\n    /**\n     * Creates a Transport for sending media.\n     *\n     * @throws {InvalidStateError} if not loaded.\n     * @throws {TypeError} if wrong arguments.\n     */\n\n  }, {\n    key: \"createSendTransport\",\n    value: function createSendTransport(_ref3) {\n      var id = _ref3.id,\n          iceParameters = _ref3.iceParameters,\n          iceCandidates = _ref3.iceCandidates,\n          dtlsParameters = _ref3.dtlsParameters,\n          sctpParameters = _ref3.sctpParameters,\n          iceServers = _ref3.iceServers,\n          iceTransportPolicy = _ref3.iceTransportPolicy,\n          additionalSettings = _ref3.additionalSettings,\n          proprietaryConstraints = _ref3.proprietaryConstraints,\n          appData = _ref3.appData;\n      logger.debug('createSendTransport()');\n      return this.createTransport({\n        direction: 'send',\n        id: id,\n        iceParameters: iceParameters,\n        iceCandidates: iceCandidates,\n        dtlsParameters: dtlsParameters,\n        sctpParameters: sctpParameters,\n        iceServers: iceServers,\n        iceTransportPolicy: iceTransportPolicy,\n        additionalSettings: additionalSettings,\n        proprietaryConstraints: proprietaryConstraints,\n        appData: appData\n      });\n    }\n    /**\n     * Creates a Transport for receiving media.\n     *\n     * @throws {InvalidStateError} if not loaded.\n     * @throws {TypeError} if wrong arguments.\n     */\n\n  }, {\n    key: \"createRecvTransport\",\n    value: function createRecvTransport(_ref4) {\n      var id = _ref4.id,\n          iceParameters = _ref4.iceParameters,\n          iceCandidates = _ref4.iceCandidates,\n          dtlsParameters = _ref4.dtlsParameters,\n          sctpParameters = _ref4.sctpParameters,\n          iceServers = _ref4.iceServers,\n          iceTransportPolicy = _ref4.iceTransportPolicy,\n          additionalSettings = _ref4.additionalSettings,\n          proprietaryConstraints = _ref4.proprietaryConstraints,\n          appData = _ref4.appData;\n      logger.debug('createRecvTransport()');\n      return this.createTransport({\n        direction: 'recv',\n        id: id,\n        iceParameters: iceParameters,\n        iceCandidates: iceCandidates,\n        dtlsParameters: dtlsParameters,\n        sctpParameters: sctpParameters,\n        iceServers: iceServers,\n        iceTransportPolicy: iceTransportPolicy,\n        additionalSettings: additionalSettings,\n        proprietaryConstraints: proprietaryConstraints,\n        appData: appData\n      });\n    }\n  }, {\n    key: \"createTransport\",\n    value: function createTransport(_ref5) {\n      var direction = _ref5.direction,\n          id = _ref5.id,\n          iceParameters = _ref5.iceParameters,\n          iceCandidates = _ref5.iceCandidates,\n          dtlsParameters = _ref5.dtlsParameters,\n          sctpParameters = _ref5.sctpParameters,\n          iceServers = _ref5.iceServers,\n          iceTransportPolicy = _ref5.iceTransportPolicy,\n          additionalSettings = _ref5.additionalSettings,\n          proprietaryConstraints = _ref5.proprietaryConstraints,\n          appData = _ref5.appData;\n\n      if (!this._loaded) {\n        throw new errors_1.InvalidStateError('not loaded');\n      } else if (typeof id !== 'string') {\n        throw new TypeError('missing id');\n      } else if (typeof iceParameters !== 'object') {\n        throw new TypeError('missing iceParameters');\n      } else if (!Array.isArray(iceCandidates)) {\n        throw new TypeError('missing iceCandidates');\n      } else if (typeof dtlsParameters !== 'object') {\n        throw new TypeError('missing dtlsParameters');\n      } else if (sctpParameters && typeof sctpParameters !== 'object') {\n        throw new TypeError('wrong sctpParameters');\n      } else if (appData && typeof appData !== 'object') {\n        throw new TypeError('if given, appData must be an object');\n      } // Create a new Transport.\n\n\n      var transport = new Transport_1.Transport({\n        direction: direction,\n        id: id,\n        iceParameters: iceParameters,\n        iceCandidates: iceCandidates,\n        dtlsParameters: dtlsParameters,\n        sctpParameters: sctpParameters,\n        iceServers: iceServers,\n        iceTransportPolicy: iceTransportPolicy,\n        additionalSettings: additionalSettings,\n        proprietaryConstraints: proprietaryConstraints,\n        appData: appData,\n        handlerFactory: this._handlerFactory,\n        extendedRtpCapabilities: this._extendedRtpCapabilities,\n        canProduceByKind: this._canProduceByKind\n      }); // Emit observer event.\n\n      this._observer.safeEmit('newtransport', transport);\n\n      return transport;\n    }\n  }]);\n\n  return Device;\n}();\n\nexports.Device = Device;","map":{"version":3,"names":["__createBinding","Object","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","prototype","hasOwnProperty","call","__importDefault","exports","Device","detectDevice","bowser_1","require","Logger_1","EnhancedEventEmitter_1","errors_1","utils","ortc","Transport_1","Chrome111_1","Chrome74_1","Chrome70_1","Chrome67_1","Chrome55_1","Firefox60_1","Safari12_1","Safari11_1","Edge11_1","ReactNativeUnifiedPlan_1","ReactNative_1","logger","Logger","navigator","product","RTCPeerConnection","warn","RTCRtpTransceiver","debug","userAgent","ua","browser","default","getParser","engine","getEngine","satisfies","chrome","chromium","firefox","ios","OS","safari","name","toLowerCase","match","version","Number","getBrowserName","getBrowserVersion","handlerName","handlerFactory","Handler","_loaded","_observer","EnhancedEventEmitter","TypeError","_handlerFactory","UnsupportedError","Chrome111","createFactory","Chrome74","Chrome70","Chrome67","Chrome55","Firefox60","Safari12","Safari11","Edge11","ReactNativeUnifiedPlan","ReactNative","handler","_handlerName","close","_extendedRtpCapabilities","_recvRtpCapabilities","_canProduceByKind","audio","video","_sctpCapabilities","InvalidStateError","routerRtpCapabilities","clone","validateRtpCapabilities","getNativeRtpCapabilities","nativeRtpCapabilities","getExtendedRtpCapabilities","canSend","getRecvRtpCapabilities","getNativeSctpCapabilities","validateSctpCapabilities","kind","id","iceParameters","iceCandidates","dtlsParameters","sctpParameters","iceServers","iceTransportPolicy","additionalSettings","proprietaryConstraints","appData","createTransport","direction","Array","isArray","transport","Transport","extendedRtpCapabilities","canProduceByKind","safeEmit"],"sources":["/home/runner/work/watchparty/watchparty/node_modules/mediasoup-client/lib/Device.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Device = exports.detectDevice = void 0;\nconst bowser_1 = __importDefault(require(\"bowser\"));\nconst Logger_1 = require(\"./Logger\");\nconst EnhancedEventEmitter_1 = require(\"./EnhancedEventEmitter\");\nconst errors_1 = require(\"./errors\");\nconst utils = __importStar(require(\"./utils\"));\nconst ortc = __importStar(require(\"./ortc\"));\nconst Transport_1 = require(\"./Transport\");\nconst Chrome111_1 = require(\"./handlers/Chrome111\");\nconst Chrome74_1 = require(\"./handlers/Chrome74\");\nconst Chrome70_1 = require(\"./handlers/Chrome70\");\nconst Chrome67_1 = require(\"./handlers/Chrome67\");\nconst Chrome55_1 = require(\"./handlers/Chrome55\");\nconst Firefox60_1 = require(\"./handlers/Firefox60\");\nconst Safari12_1 = require(\"./handlers/Safari12\");\nconst Safari11_1 = require(\"./handlers/Safari11\");\nconst Edge11_1 = require(\"./handlers/Edge11\");\nconst ReactNativeUnifiedPlan_1 = require(\"./handlers/ReactNativeUnifiedPlan\");\nconst ReactNative_1 = require(\"./handlers/ReactNative\");\nconst logger = new Logger_1.Logger('Device');\nfunction detectDevice() {\n    // React-Native.\n    // NOTE: react-native-webrtc >= 1.75.0 is required.\n    // NOTE: react-native-webrtc with Unified Plan requires version >= 106.0.0.\n    if (typeof navigator === 'object' && navigator.product === 'ReactNative') {\n        if (typeof RTCPeerConnection === 'undefined') {\n            logger.warn('this._detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?');\n            return undefined;\n        }\n        if (typeof RTCRtpTransceiver !== 'undefined') {\n            logger.debug('this._detectDevice() | ReactNative UnifiedPlan handler chosen');\n            return 'ReactNativeUnifiedPlan';\n        }\n        else {\n            logger.debug('this._detectDevice() | ReactNative PlanB handler chosen');\n            return 'ReactNative';\n        }\n    }\n    // Browser.\n    else if (typeof navigator === 'object' && typeof navigator.userAgent === 'string') {\n        const ua = navigator.userAgent;\n        const browser = bowser_1.default.getParser(ua);\n        const engine = browser.getEngine();\n        // Chrome, Chromium, and Edge.\n        if (browser.satisfies({ chrome: '>=111', chromium: '>=111', 'microsoft edge': '>=111' })) {\n            return 'Chrome111';\n        }\n        else if (browser.satisfies({ chrome: '>=74', chromium: '>=74', 'microsoft edge': '>=88' })) {\n            return 'Chrome74';\n        }\n        else if (browser.satisfies({ chrome: '>=70', chromium: '>=70' })) {\n            return 'Chrome70';\n        }\n        else if (browser.satisfies({ chrome: '>=67', chromium: '>=67' })) {\n            return 'Chrome67';\n        }\n        else if (browser.satisfies({ chrome: '>=55', chromium: '>=55' })) {\n            return 'Chrome55';\n        }\n        // Firefox.\n        else if (browser.satisfies({ firefox: '>=60' })) {\n            return 'Firefox60';\n        }\n        // Firefox on iOS.\n        else if (browser.satisfies({ ios: { OS: '>=14.3', firefox: '>=30.0' } })) {\n            return 'Safari12';\n        }\n        // Safari with Unified-Plan support enabled.\n        else if (browser.satisfies({ safari: '>=12.0' }) &&\n            typeof RTCRtpTransceiver !== 'undefined' &&\n            RTCRtpTransceiver.prototype.hasOwnProperty('currentDirection')) {\n            return 'Safari12';\n        }\n        // Safari with Plab-B support.\n        else if (browser.satisfies({ safari: '>=11' })) {\n            return 'Safari11';\n        }\n        // Old Edge with ORTC support.\n        else if (browser.satisfies({ 'microsoft edge': '>=11' }) &&\n            browser.satisfies({ 'microsoft edge': '<=18' })) {\n            return 'Edge11';\n        }\n        // Best effort for Chromium based browsers.\n        else if (engine.name && engine.name.toLowerCase() === 'blink') {\n            const match = ua.match(/(?:(?:Chrome|Chromium))[ /](\\w+)/i);\n            if (match) {\n                const version = Number(match[1]);\n                if (version >= 111) {\n                    return 'Chrome111';\n                }\n                else if (version >= 74) {\n                    return 'Chrome74';\n                }\n                else if (version >= 70) {\n                    return 'Chrome70';\n                }\n                else if (version >= 67) {\n                    return 'Chrome67';\n                }\n                else {\n                    return 'Chrome55';\n                }\n            }\n            else {\n                return 'Chrome111';\n            }\n        }\n        // Unsupported browser.\n        else {\n            logger.warn('this._detectDevice() | browser not supported [name:%s, version:%s]', browser.getBrowserName(), browser.getBrowserVersion());\n            return undefined;\n        }\n    }\n    // Unknown device.\n    else {\n        logger.warn('this._detectDevice() | unknown device');\n        return undefined;\n    }\n}\nexports.detectDevice = detectDevice;\nclass Device {\n    /**\n     * Create a new Device to connect to mediasoup server.\n     *\n     * @throws {UnsupportedError} if device is not supported.\n     */\n    constructor({ handlerName, handlerFactory, Handler } = {}) {\n        // Loaded flag.\n        this._loaded = false;\n        // Observer instance.\n        this._observer = new EnhancedEventEmitter_1.EnhancedEventEmitter();\n        logger.debug('constructor()');\n        // Handle deprecated option.\n        if (Handler) {\n            logger.warn('constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead');\n            if (typeof Handler === 'string') {\n                handlerName = Handler;\n            }\n            else {\n                throw new TypeError('non string Handler option no longer supported, use handlerFactory instead');\n            }\n        }\n        if (handlerName && handlerFactory) {\n            throw new TypeError('just one of handlerName or handlerInterface can be given');\n        }\n        if (handlerFactory) {\n            this._handlerFactory = handlerFactory;\n        }\n        else {\n            if (handlerName) {\n                logger.debug('constructor() | handler given: %s', handlerName);\n            }\n            else {\n                handlerName = detectDevice();\n                if (handlerName) {\n                    logger.debug('constructor() | detected handler: %s', handlerName);\n                }\n                else {\n                    throw new errors_1.UnsupportedError('device not supported');\n                }\n            }\n            switch (handlerName) {\n                case 'Chrome111':\n                    this._handlerFactory = Chrome111_1.Chrome111.createFactory();\n                    break;\n                case 'Chrome74':\n                    this._handlerFactory = Chrome74_1.Chrome74.createFactory();\n                    break;\n                case 'Chrome70':\n                    this._handlerFactory = Chrome70_1.Chrome70.createFactory();\n                    break;\n                case 'Chrome67':\n                    this._handlerFactory = Chrome67_1.Chrome67.createFactory();\n                    break;\n                case 'Chrome55':\n                    this._handlerFactory = Chrome55_1.Chrome55.createFactory();\n                    break;\n                case 'Firefox60':\n                    this._handlerFactory = Firefox60_1.Firefox60.createFactory();\n                    break;\n                case 'Safari12':\n                    this._handlerFactory = Safari12_1.Safari12.createFactory();\n                    break;\n                case 'Safari11':\n                    this._handlerFactory = Safari11_1.Safari11.createFactory();\n                    break;\n                case 'Edge11':\n                    this._handlerFactory = Edge11_1.Edge11.createFactory();\n                    break;\n                case 'ReactNativeUnifiedPlan':\n                    this._handlerFactory = ReactNativeUnifiedPlan_1.ReactNativeUnifiedPlan.createFactory();\n                    break;\n                case 'ReactNative':\n                    this._handlerFactory = ReactNative_1.ReactNative.createFactory();\n                    break;\n                default:\n                    throw new TypeError(`unknown handlerName \"${handlerName}\"`);\n            }\n        }\n        // Create a temporal handler to get its name.\n        const handler = this._handlerFactory();\n        this._handlerName = handler.name;\n        handler.close();\n        this._extendedRtpCapabilities = undefined;\n        this._recvRtpCapabilities = undefined;\n        this._canProduceByKind =\n            {\n                audio: false,\n                video: false\n            };\n        this._sctpCapabilities = undefined;\n    }\n    /**\n     * The RTC handler name.\n     */\n    get handlerName() {\n        return this._handlerName;\n    }\n    /**\n     * Whether the Device is loaded.\n     */\n    get loaded() {\n        return this._loaded;\n    }\n    /**\n     * RTP capabilities of the Device for receiving media.\n     *\n     * @throws {InvalidStateError} if not loaded.\n     */\n    get rtpCapabilities() {\n        if (!this._loaded) {\n            throw new errors_1.InvalidStateError('not loaded');\n        }\n        return this._recvRtpCapabilities;\n    }\n    /**\n     * SCTP capabilities of the Device.\n     *\n     * @throws {InvalidStateError} if not loaded.\n     */\n    get sctpCapabilities() {\n        if (!this._loaded) {\n            throw new errors_1.InvalidStateError('not loaded');\n        }\n        return this._sctpCapabilities;\n    }\n    get observer() {\n        return this._observer;\n    }\n    /**\n     * Initialize the Device.\n     */\n    async load({ routerRtpCapabilities }) {\n        logger.debug('load() [routerRtpCapabilities:%o]', routerRtpCapabilities);\n        routerRtpCapabilities = utils.clone(routerRtpCapabilities, undefined);\n        // Temporal handler to get its capabilities.\n        let handler;\n        try {\n            if (this._loaded) {\n                throw new errors_1.InvalidStateError('already loaded');\n            }\n            // This may throw.\n            ortc.validateRtpCapabilities(routerRtpCapabilities);\n            handler = this._handlerFactory();\n            const nativeRtpCapabilities = await handler.getNativeRtpCapabilities();\n            logger.debug('load() | got native RTP capabilities:%o', nativeRtpCapabilities);\n            // This may throw.\n            ortc.validateRtpCapabilities(nativeRtpCapabilities);\n            // Get extended RTP capabilities.\n            this._extendedRtpCapabilities = ortc.getExtendedRtpCapabilities(nativeRtpCapabilities, routerRtpCapabilities);\n            logger.debug('load() | got extended RTP capabilities:%o', this._extendedRtpCapabilities);\n            // Check whether we can produce audio/video.\n            this._canProduceByKind.audio =\n                ortc.canSend('audio', this._extendedRtpCapabilities);\n            this._canProduceByKind.video =\n                ortc.canSend('video', this._extendedRtpCapabilities);\n            // Generate our receiving RTP capabilities for receiving media.\n            this._recvRtpCapabilities =\n                ortc.getRecvRtpCapabilities(this._extendedRtpCapabilities);\n            // This may throw.\n            ortc.validateRtpCapabilities(this._recvRtpCapabilities);\n            logger.debug('load() | got receiving RTP capabilities:%o', this._recvRtpCapabilities);\n            // Generate our SCTP capabilities.\n            this._sctpCapabilities = await handler.getNativeSctpCapabilities();\n            logger.debug('load() | got native SCTP capabilities:%o', this._sctpCapabilities);\n            // This may throw.\n            ortc.validateSctpCapabilities(this._sctpCapabilities);\n            logger.debug('load() succeeded');\n            this._loaded = true;\n            handler.close();\n        }\n        catch (error) {\n            if (handler) {\n                handler.close();\n            }\n            throw error;\n        }\n    }\n    /**\n     * Whether we can produce audio/video.\n     *\n     * @throws {InvalidStateError} if not loaded.\n     * @throws {TypeError} if wrong arguments.\n     */\n    canProduce(kind) {\n        if (!this._loaded) {\n            throw new errors_1.InvalidStateError('not loaded');\n        }\n        else if (kind !== 'audio' && kind !== 'video') {\n            throw new TypeError(`invalid kind \"${kind}\"`);\n        }\n        return this._canProduceByKind[kind];\n    }\n    /**\n     * Creates a Transport for sending media.\n     *\n     * @throws {InvalidStateError} if not loaded.\n     * @throws {TypeError} if wrong arguments.\n     */\n    createSendTransport({ id, iceParameters, iceCandidates, dtlsParameters, sctpParameters, iceServers, iceTransportPolicy, additionalSettings, proprietaryConstraints, appData }) {\n        logger.debug('createSendTransport()');\n        return this.createTransport({\n            direction: 'send',\n            id: id,\n            iceParameters: iceParameters,\n            iceCandidates: iceCandidates,\n            dtlsParameters: dtlsParameters,\n            sctpParameters: sctpParameters,\n            iceServers: iceServers,\n            iceTransportPolicy: iceTransportPolicy,\n            additionalSettings: additionalSettings,\n            proprietaryConstraints: proprietaryConstraints,\n            appData: appData\n        });\n    }\n    /**\n     * Creates a Transport for receiving media.\n     *\n     * @throws {InvalidStateError} if not loaded.\n     * @throws {TypeError} if wrong arguments.\n     */\n    createRecvTransport({ id, iceParameters, iceCandidates, dtlsParameters, sctpParameters, iceServers, iceTransportPolicy, additionalSettings, proprietaryConstraints, appData }) {\n        logger.debug('createRecvTransport()');\n        return this.createTransport({\n            direction: 'recv',\n            id: id,\n            iceParameters: iceParameters,\n            iceCandidates: iceCandidates,\n            dtlsParameters: dtlsParameters,\n            sctpParameters: sctpParameters,\n            iceServers: iceServers,\n            iceTransportPolicy: iceTransportPolicy,\n            additionalSettings: additionalSettings,\n            proprietaryConstraints: proprietaryConstraints,\n            appData: appData\n        });\n    }\n    createTransport({ direction, id, iceParameters, iceCandidates, dtlsParameters, sctpParameters, iceServers, iceTransportPolicy, additionalSettings, proprietaryConstraints, appData }) {\n        if (!this._loaded) {\n            throw new errors_1.InvalidStateError('not loaded');\n        }\n        else if (typeof id !== 'string') {\n            throw new TypeError('missing id');\n        }\n        else if (typeof iceParameters !== 'object') {\n            throw new TypeError('missing iceParameters');\n        }\n        else if (!Array.isArray(iceCandidates)) {\n            throw new TypeError('missing iceCandidates');\n        }\n        else if (typeof dtlsParameters !== 'object') {\n            throw new TypeError('missing dtlsParameters');\n        }\n        else if (sctpParameters && typeof sctpParameters !== 'object') {\n            throw new TypeError('wrong sctpParameters');\n        }\n        else if (appData && typeof appData !== 'object') {\n            throw new TypeError('if given, appData must be an object');\n        }\n        // Create a new Transport.\n        const transport = new Transport_1.Transport({\n            direction,\n            id,\n            iceParameters,\n            iceCandidates,\n            dtlsParameters,\n            sctpParameters,\n            iceServers,\n            iceTransportPolicy,\n            additionalSettings,\n            proprietaryConstraints,\n            appData,\n            handlerFactory: this._handlerFactory,\n            extendedRtpCapabilities: this._extendedRtpCapabilities,\n            canProduceByKind: this._canProduceByKind\n        });\n        // Emit observer event.\n        this._observer.safeEmit('newtransport', transport);\n        return transport;\n    }\n}\nexports.Device = Device;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}