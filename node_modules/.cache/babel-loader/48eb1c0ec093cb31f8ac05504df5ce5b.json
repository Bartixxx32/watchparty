{"ast":null,"code":"import _toConsumableArray from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import axios from'axios';import React from'react';import{Button,Dimmer,Dropdown,Grid,Icon,Input,Loader,Message,Popup,Menu,Modal,Label,Form}from'semantic-ui-react';import io from'socket.io-client';import{formatSpeed,iceServers,isMobile,serverPath,testAutoplay,openFileSelector,getAndSaveClientId,calculateMedian,getUserImage,getColorForString,isYouTube,isMagnet,isHttp,isHls,isScreenShare,isFileShare,isVBrowser}from'../../utils';import{generateName}from'../../utils/generateName';import{Chat}from'../Chat';import{TopBar}from'../TopBar';import{VBrowser}from'../VBrowser';import{VideoChat}from'../VideoChat';import{getCurrentSettings}from'../Settings';import{MultiStreamModal}from'../Modal/MultiStreamModal';import{ComboBox}from'../ComboBox/ComboBox';import{SearchComponent}from'../SearchComponent/SearchComponent';import{Controls}from'../Controls/Controls';import{VBrowserModal}from'../Modal/VBrowserModal';import{SettingsTab}from'../Settings/SettingsTab';import{ErrorModal}from'../Modal/ErrorModal';import{PasswordModal}from'../Modal/PasswordModal';import{ScreenShareModal}from'../Modal/ScreenShareModal';import{FileShareModal}from'../Modal/FileShareModal';import{SubtitleModal}from'../Modal/SubtitleModal';import{HTML}from'./HTML';import{YouTube}from'./YouTube';import styles from'./App.module.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";window.watchparty={ourStream:undefined,videoRefs:{},videoPCs:{},webtorrent:null};var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(){var _URLSearchParams$get;var _this;_classCallCheck(this,App);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={state:'starting',roomMedia:'',roomPaused:false,roomSubtitle:'',roomLoop:false,participants:[],rosterUpdateTS:Number(new Date()),chat:[],playlist:[],tsMap:{},nameMap:{},pictureMap:{},myName:'',myPicture:'',loading:true,scrollTimestamp:0,unreadCount:0,fullScreen:false,controlsTimestamp:0,watchOptions:[],isVBrowser:false,isAutoPlayable:true,downloaded:0,total:0,speed:0,connections:0,multiStreamSelection:undefined,overlayMsg:'',isErrorAuth:false,settings:{},vBrowserResolution:'1280x720@30',isVBrowserLarge:false,nonPlayableMedia:false,currentTab:(_URLSearchParams$get=new URLSearchParams(window.location.search).get('tab'))!==null&&_URLSearchParams$get!==void 0?_URLSearchParams$get:'chat',isSubscribeModalOpen:false,isVBrowserModalOpen:false,isScreenShareModalOpen:false,isFileShareModalOpen:false,isSubtitleModalOpen:false,roomLock:'',controller:'',roomId:'',savedPasswords:{},errorMessage:'',successMessage:'',warningMessage:'',isChatDisabled:false,showRightBar:true,owner:undefined,vanity:undefined,password:undefined,inviteLink:'',roomTitle:'',roomDescription:'',roomTitleColor:'',mediaPath:undefined,roomPlaybackRate:0,isLiveHls:false};_this.socket=null;_this.mediasoupPubSocket=null;_this.mediasoupSubSocket=null;_this.ytDebounce=true;_this.localStreamToPublish=void 0;_this.isLocalStreamAFile=false;_this.publisherConns={};_this.consumerConn=void 0;_this.progressUpdater=void 0;_this.heartbeat=undefined;_this.YouTubeInterface=new YouTube(null);_this.HTMLInterface=new HTML('leftVideo');_this.Player=function(){if(_this.usingYoutube()){return _this.YouTubeInterface;}else{return _this.HTMLInterface;}};_this.chatRef=/*#__PURE__*/React.createRef();_this.init=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var roomId,response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:roomId='/'+_this.props.urlRoomId;// if a vanity name, resolve the url to a room id\nif(!_this.props.vanity){_context.next=14;break;}_context.prev=2;_context.next=5;return axios.get(serverPath+'/resolveRoom/'+_this.props.vanity);case 5:response=_context.sent;if(response.data.roomId){roomId=response.data.roomId;}else{_this.setState({overlayMsg:\"Couldn't load this room.\"});}_context.next=14;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](2);console.error(_context.t0);_this.setState({overlayMsg:\"Couldn't load this room.\"});return _context.abrupt(\"return\");case 14:_this.setState({roomId:roomId},function(){_this.join(roomId);});case 15:case\"end\":return _context.stop();}}},_callee,null,[[2,9]]);}));_this.join=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9(roomId){var _Number;var password,savedPasswordsString,savedPasswords,response,shard,socket;return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:password='';try{savedPasswordsString=window.localStorage.getItem('watchparty-passwords');savedPasswords=JSON.parse(savedPasswordsString||'{}');_this.setState({savedPasswords:savedPasswords});password=savedPasswords[roomId]||'';}catch(e){console.warn('[ALERT] Could not parse saved passwords');}_context9.next=4;return axios.get(serverPath+'/resolveShard'+roomId);case 4:response=_context9.sent;shard=(_Number=Number(response.data))!==null&&_Number!==void 0?_Number:'';socket=io(serverPath+roomId,{transports:['websocket'],query:{clientId:getAndSaveClientId(),password:password,shard:shard}});_this.socket=socket;socket.on('connect',/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var userName;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this.setState({state:'connected',overlayMsg:'',errorMessage:'',successMessage:'',warningMessage:''});// Load username from localstorage\nuserName=window.localStorage.getItem('watchparty-username');_context2.t0=_this;_context2.t1=userName;if(_context2.t1){_context2.next=8;break;}_context2.next=7;return generateName();case 7:_context2.t1=_context2.sent;case 8:_context2.t2=_context2.t1;_context2.t3={value:_context2.t2};_context2.t0.updateName.call(_context2.t0,null,_context2.t3);_this.loadSignInData();case 12:case\"end\":return _context2.stop();}}},_callee2);})));socket.on('connect_error',function(err){console.error(err);if(err.message==='Invalid namespace'){_this.setState({overlayMsg:\"Couldn't load this room.\"});}else if(err.message==='not authorized'){_this.setState({isErrorAuth:true});}else if(err.message==='room full'){_this.setState({overlayMsg:'This room is full.'});}});socket.on('disconnect',function(reason){if(reason==='io server disconnect'){// the disconnection was initiated by the server, you need to reconnect manually\n_this.setState({overlayMsg:'Disconnected from server.'});}else{// else the socket will automatically try to reconnect\n// Use the alert pill since it's less disruptive\n_this.setState({warningMessage:'Reconnecting...'});}});socket.on('errorMessage',function(err){_this.setState({errorMessage:err});setTimeout(function(){_this.setState({errorMessage:''});},3000);});socket.on('successMessage',function(success){_this.setState({successMessage:success});setTimeout(function(){_this.setState({successMessage:''});},3000);});socket.on('kicked',function(){window.location.assign('/');});socket.on('REC:play',function(){_this.localPlay();});socket.on('REC:pause',function(){_this.localPause();});socket.on('REC:seek',function(data){_this.localSeek(data);});socket.on('REC:playbackRate',function(data){_this.setState({roomPlaybackRate:data});if(data>0){_this.Player().setPlaybackRate(data);}});socket.on('REC:subtitle',function(data){_this.setState({roomSubtitle:data},function(){_this.Player().loadSubtitles(data);});});socket.on('REC:loop',function(data){_this.setState({roomLoop:data});});socket.on('REC:changeController',function(data){_this.setState({controller:data});});socket.on('REC:host',/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(data){var currentMedia;return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:currentMedia=data.video||'';if(_this.playingScreenShare()&&!isScreenShare(currentMedia)){_this.stopPublishingLocalStream();}if(_this.playingFileShare()&&!isFileShare(currentMedia)){_this.stopPublishingLocalStream();}if(!(_this.playingScreenShare()&&isScreenShare(currentMedia))){_context7.next=5;break;}return _context7.abrupt(\"return\");case 5:if(!(_this.playingFileShare()&&isFileShare(currentMedia))){_context7.next=7;break;}return _context7.abrupt(\"return\");case 7:if(_this.playingVBrowser()&&!isVBrowser(currentMedia)){_this.stopVBrowser();}_this.setState({roomMedia:currentMedia,roomPaused:data.paused,roomSubtitle:data.subtitle,roomLoop:data.loop,roomPlaybackRate:data.playbackRate,loading:Boolean(data.video),nonPlayableMedia:false,isVBrowserLarge:data.isVBrowserLarge,vBrowserResolution:data.isVBrowserLarge?'1920x1080@30':'1280x720@30',controller:data.controller,isLiveHls:false},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(){var leftVideo,src,time,_window$watchparty$we,_window$watchparty$we2,_window$watchparty$we3,_navigator$serviceWor,_controller$active,WebTorrent,controller,server,Hls,hls;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:leftVideo=_this.HTMLInterface.getVideoEl();// Stop all players\n// Unless the user is sharing a file, because we play it in leftVideo and capture stream\nif(!_this.isLocalStreamAFile){_this.HTMLInterface.pauseVideo();}_this.YouTubeInterface.stopVideo();if(!_this.isLocalStreamAFile){_this.Player().clearState();}if(data.subtitle){_this.Player().loadSubtitles(data.subtitle);}if(data.playbackRate){_this.Player().setPlaybackRate(data.playbackRate);}if(!(_this.playingScreenShare()||_this.playingFileShare()||_this.playingVBrowser())){_context6.next=10;break;}console.log('exiting REC:host since we are using webRTC (fileshare, screenshare, or vbrowser). Check setupRTCConnections()');if(!(_this.playingVBrowser()&&!_this.getVBrowserHost())){// Remove the loader unless we're waiting for a vbrowser\n_this.setLoadingFalse();}return _context6.abrupt(\"return\");case 10:if(!(_this.usingYoutube()&&!_this.YouTubeInterface.isReady())){_context6.next=13;break;}console.log('YT player not ready, onReady callback will retry when it is');return _context6.abrupt(\"return\");case 13:src=data.video;time=data.videoTS;if(!isMagnet(src)){_context6.next=40;break;}_context6.next=18;return import('webtorrent/dist/webtorrent.min.js');case 18:WebTorrent=_context6.sent.default;//@ts-ignore\n(_window$watchparty$we=window.watchparty.webtorrent)===null||_window$watchparty$we===void 0?void 0:(_window$watchparty$we2=_window$watchparty$we._server)===null||_window$watchparty$we2===void 0?void 0:_window$watchparty$we2.close();(_window$watchparty$we3=window.watchparty.webtorrent)===null||_window$watchparty$we3===void 0?void 0:_window$watchparty$we3.destroy();window.watchparty.webtorrent=new WebTorrent();_context6.next=24;return(_navigator$serviceWor=navigator.serviceWorker)===null||_navigator$serviceWor===void 0?void 0:_navigator$serviceWor.register('/sw.min.js');case 24:_context6.next=26;return navigator.serviceWorker.ready;case 26:controller=_context6.sent;_context6.next=29;return new Promise(function(resolve){return setTimeout(resolve,500);});case 29:console.log(controller,(_controller$active=controller.active)===null||_controller$active===void 0?void 0:_controller$active.state);// createServer is only in v2, types are outdated\n//@ts-ignore\n_context6.next=32;return window.watchparty.webtorrent.createServer({controller:controller});case 32:server=_context6.sent;console.log(server);_context6.next=36;return new Promise(function(resolve){return setTimeout(resolve,500);});case 36:_context6.next=38;return new Promise(function(resolve){var _window$watchparty$we4;(_window$watchparty$we4=window.watchparty.webtorrent)===null||_window$watchparty$we4===void 0?void 0:_window$watchparty$we4.add(src,{announce:['wss://tracker.btorrent.xyz','wss://tracker.openwebtorrent.com'],destroyStoreOnDestroy:true,maxWebConns:4,path:'/tmp/webtorrent/',storeCacheSlots:20,strategy:'sequential',//@ts-ignore\nnoPeersIntervalTime:30},/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(torrent){var _files$fileIndex;var files,filtered,fileIndex,target;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:// Got torrent metadata!\nconsole.log('Client is downloading:',torrent.infoHash);// Torrents can contain many files.\nfiles=torrent.files;filtered=files.filter(function(f){return f.length>=10*1024*1024;});fileIndex=new URLSearchParams(src).get('fileIndex');// Try to find a single large file to play\ntarget=(_files$fileIndex=files[fileIndex])!==null&&_files$fileIndex!==void 0?_files$fileIndex:filtered.length>1?null:filtered[0];if(!target){// Open the selector\n_this.launchMultiSelect(files.map(function(f,i){return{name:f.name,url:src+\"&fileIndex=\".concat(i),length:f.length};}));}else{//@ts-ignore\ntarget.streamTo(leftVideo);leftVideo.currentTime=time;}resolve(null);case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref6.apply(this,arguments);};}());});case 38:_context6.next=52;break;case 40:if(!(isHls(src)&&window.MediaSource)){_context6.next=50;break;}_context6.next=43;return import('hls.js');case 43:Hls=_context6.sent.default;hls=new Hls();hls.loadSource(src);hls.attachMedia(leftVideo);hls.once(Hls.Events.LEVEL_LOADED,function(_,data){console.log('isLiveHls',data.details.live);_this.setState({isLiveHls:data.details.live});});_context6.next=52;break;case 50:_context6.next=52;return _this.Player().setSrcAndTime(src,time);case 52:// Start this video\nif(!data.paused){_this.localPlay();}// One time, when we're ready to play\nleftVideo===null||leftVideo===void 0?void 0:leftVideo.addEventListener('canplay',function(){_this.setLoadingFalse();_this.localSeek(_this.state.isLiveHls?data.videoTS:undefined);if(data.playbackRate){// Set playback rate again since it might have been lost\nconsole.log('setting playback rate again',data.playbackRate);_this.Player().setPlaybackRate(data.playbackRate);}},{once:true});// Progress updater\nwindow.clearInterval(_this.progressUpdater);_this.setState({downloaded:0,total:0,speed:0});if(currentMedia.includes('/stream?torrent=magnet')){_this.progressUpdater=window.setInterval(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){var response,data;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return window.fetch(currentMedia.replace('/stream','/progress'));case 2:response=_context4.sent;_context4.next=5;return response.json();case 5:data=_context4.sent;_this.setState({downloaded:data.downloaded,total:data.total,speed:data.speed,connections:data.connections});case 7:case\"end\":return _context4.stop();}}},_callee4);})),1000);}if(isMagnet(currentMedia)){_this.progressUpdater=window.setInterval(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(){var client,_client$torrents$,_client$torrents$2,_client$torrents$3,_client$torrents$4;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:client=window.watchparty.webtorrent;if(client){_this.setState({downloaded:(_client$torrents$=client.torrents[0])===null||_client$torrents$===void 0?void 0:_client$torrents$.downloaded,total:(_client$torrents$2=client.torrents[0])===null||_client$torrents$2===void 0?void 0:_client$torrents$2.length,speed:(_client$torrents$3=client.torrents[0])===null||_client$torrents$3===void 0?void 0:_client$torrents$3.downloadSpeed,connections:(_client$torrents$4=client.torrents[0])===null||_client$torrents$4===void 0?void 0:_client$torrents$4.numPeers});}case 2:case\"end\":return _context5.stop();}}},_callee5);})),1000);}case 58:case\"end\":return _context6.stop();}}},_callee6);})));case 9:case\"end\":return _context7.stop();}}},_callee7);}));return function(_x2){return _ref4.apply(this,arguments);};}());socket.on('REC:chat',function(data){if(!getCurrentSettings().disableChatSound&&(document.visibilityState&&document.visibilityState!=='visible'||_this.state.currentTab!=='chat')){new Audio('/clearly.mp3').play();}_this.state.chat.push(data);_this.setState({chat:_this.state.chat,scrollTimestamp:Number(new Date()),unreadCount:_this.state.currentTab==='chat'?_this.state.unreadCount:_this.state.unreadCount+1});});socket.on('REC:addReaction',function(data){var chat=_this.state.chat;var msgIndex=chat.findIndex(function(m){return m.id===data.msgId&&m.timestamp===data.msgTimestamp;});if(msgIndex===-1){return;}var msg=chat[msgIndex];msg.reactions=msg.reactions||{};msg.reactions[data.value]=msg.reactions[data.value]||[];msg.reactions[data.value].push(data.user);_this.setState({chat:chat},function(){var _this$chatRef$current;// if we add a reaction to the last message we need to scroll down\n// or else the reaction icon might be hidden\nif(msgIndex===chat.length-1&&(_this$chatRef$current=_this.chatRef.current)!==null&&_this$chatRef$current!==void 0&&_this$chatRef$current.state.isNearBottom){var _this$chatRef$current2;(_this$chatRef$current2=_this.chatRef.current)===null||_this$chatRef$current2===void 0?void 0:_this$chatRef$current2.scrollToBottom();}});});socket.on('REC:removeReaction',function(data){var _msg$reactions;var chat=_this.state.chat;var msg=chat.find(function(m){return m.id===data.msgId&&m.timestamp===data.msgTimestamp;});if(!msg||!((_msg$reactions=msg.reactions)!==null&&_msg$reactions!==void 0&&_msg$reactions[data.value])){return;}msg.reactions[data.value]=msg.reactions[data.value].filter(function(id){return id!==data.user;});_this.setState({chat:chat});});socket.on('REC:tsMap',function(data){_this.setState({tsMap:data},function(){// Dynamic playback rate based on timestamps\n// Disable for sharing types where the users can have different timestamps\n// e.g. screenshare, fileshare, .m3u8 HLS streams\n// Also not necessary for WebRTC sharing since it should be close to realtime\nif(!_this.state.roomPaused&&!_this.state.isLiveHls&&_this.hasDuration()&&_this.state.roomPlaybackRate===0){var leader=_this.getLeaderTime();var delta=leader-data[_this.socket.id];// Set leader pbr to 1\nvar pbr=1;// Add .01 pbr for each 100ms delay\nif(delta>0.5){pbr+=Number((delta/10).toFixed(2));pbr=Math.min(pbr,1.2);}// console.log(delta, pbr);\nif(_this.Player().getPlaybackRate()!==pbr){_this.Player().setPlaybackRate(pbr);}}if(_this.state.roomSubtitle){var sharer=_this.state.participants.find(function(p){return p.isScreenShare;});if(sharer&&sharer.id!==_this.socket.id){// Sync only if someone is sharing and it's not us\nvar sharerTime=_this.state.tsMap[sharer.id];_this.Player().syncSubtitles(sharerTime);}}});});socket.on('REC:nameMap',function(data){_this.setState({nameMap:data});});socket.on('REC:pictureMap',function(data){_this.setState({pictureMap:data});});socket.on('REC:lock',function(data){_this.setState({roomLock:data});});socket.on('roster',function(data){_this.setState({participants:data,rosterUpdateTS:Number(new Date())},function(){_this.setupRTCConnections();});});socket.on('chatinit',function(data){_this.setState({chat:data,scrollTimestamp:Number(new Date())});});socket.on('playlist',function(data){_this.setState({playlist:data});});socket.on('signalSS',/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(data){var msg,from,pc,_answer$sdp,_sdp,answer,isChromium,_answer$sdp2;return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:process.env.NODE_ENV==='development'&&console.log(data);// Handle messages received from signaling server\nmsg=data.msg;from=data.from;// Determine whether the message came from the sharer or the sharee\npc=data.sharer?_this.consumerConn:_this.publisherConns[from];if(!(msg.ice!==undefined)){_context8.next=8;break;}pc.addIceCandidate(new RTCIceCandidate(msg.ice));_context8.next=25;break;case 8:if(!(msg.sdp&&msg.sdp.type==='offer')){_context8.next=24;break;}// console.log('offer');\n// TODO Currently ios/Safari cannot handle this property, so remove it from the offer\n_sdp=msg.sdp.sdp.split('\\n').filter(function(line){return line.trim()!=='a=extmap-allow-mixed';}).join('\\n');msg.sdp.sdp=_sdp;_context8.next=13;return pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));case 13:_context8.next=15;return pc.createAnswer();case 15:answer=_context8.sent;// Allow stereo audio\nanswer.sdp=(_answer$sdp=answer.sdp)===null||_answer$sdp===void 0?void 0:_answer$sdp.replace('useinbandfec=1','useinbandfec=1; stereo=1; maxaveragebitrate=510000');// console.log(answer.sdp);\n// Allow multichannel audio if Chromium\nisChromium=Boolean(window.chrome);if(isChromium){answer.sdp=(_answer$sdp2=answer.sdp)===null||_answer$sdp2===void 0?void 0:_answer$sdp2.replace('opus/48000/2','multiopus/48000/6').replace('useinbandfec=1','channel_mapping=0,4,1,2,3,5; num_streams=4; coupled_streams=2;maxaveragebitrate=510000;minptime=10;useinbandfec=1');}_context8.next=21;return pc.setLocalDescription(answer);case 21:_this.sendSignalSS(from,{sdp:pc.localDescription},!data.sharer);_context8.next=25;break;case 24:if(msg.sdp&&msg.sdp.type==='answer'){pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));}case 25:case\"end\":return _context8.stop();}}},_callee8);}));return function(_x4){return _ref9.apply(this,arguments);};}());socket.on('REC:getRoomState',_this.handleRoomState);window.setInterval(function(){if(_this.state.roomMedia){_this.socket.emit('CMD:ts',_this.Player().getCurrentTime());}},1000);case 35:case\"end\":return _context9.stop();}}},_callee9);}));return function(_x){return _ref2.apply(this,arguments);};}();_this.launchMultiSelect=function(data){_this.setState({multiStreamSelection:data});};_this.resetMultiSelect=function(){_this.setState({multiStreamSelection:undefined});};_this.loadSettings=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee10(){var settings;return _regeneratorRuntime().wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:// Load settings from localstorage\nsettings=getCurrentSettings();_this.setState({settings:settings});case 2:case\"end\":return _context10.stop();}}},_callee10);}));_this.loadSignInData=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee11(){var user,_user$displayName,firstName,userImage;return _regeneratorRuntime().wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:user=_this.props.user;if(!(user&&_this.socket)){_context11.next=9;break;}// NOTE: firebase auth doesn't provide the actual first name data that individual providers (G/FB) do\n// It's accessible at the time the user logs in but not afterward\n// If we want accurate surname/given name we'll need to save that somewhere\nfirstName=(_user$displayName=user.displayName)===null||_user$displayName===void 0?void 0:_user$displayName.split(' ')[0];if(firstName){_this.updateName(null,{value:firstName});}_context11.next=6;return getUserImage(user);case 6:userImage=_context11.sent;if(userImage){_this.updatePicture(userImage);}_this.updateUid(user);case 9:case\"end\":return _context11.stop();}}},_callee11);}));_this.loadYouTube=function(){// This code loads the IFrame Player API code asynchronously.\nvar tag=document.createElement('script');tag.src='https://www.youtube.com/iframe_api';document.body.append(tag);window.onYouTubeIframeAPIReady=function(){// Note: this fails silently if the element is not available\nvar ytPlayer=new window.YT.Player('leftYt',{events:{onReady:function onReady(){console.log('yt onReady');_this.YouTubeInterface=new YouTube(ytPlayer);_this.setState({loading:false});// We might have failed to play YT originally, ask for the current video again\nif(_this.usingYoutube()){console.log('requesting host data again after ytReady');_this.socket.emit('CMD:askHost');}},onStateChange:function onStateChange(e){var _window$YT,_window$YT$PlayerStat,_window$YT2,_window$YT2$PlayerSta,_window$YT3,_window$YT3$PlayerSta,_window$YT4,_window$YT4$PlayerSta;if(_this.usingYoutube()&&e.data===((_window$YT=window.YT)===null||_window$YT===void 0?void 0:(_window$YT$PlayerStat=_window$YT.PlayerState)===null||_window$YT$PlayerStat===void 0?void 0:_window$YT$PlayerStat.CUED)){_this.setState({loading:false});}if(_this.usingYoutube()&&e.data===((_window$YT2=window.YT)===null||_window$YT2===void 0?void 0:(_window$YT2$PlayerSta=_window$YT2.PlayerState)===null||_window$YT2$PlayerSta===void 0?void 0:_window$YT2$PlayerSta.ENDED)){_this.onVideoEnded();}if(_this.ytDebounce&&(e.data===((_window$YT3=window.YT)===null||_window$YT3===void 0?void 0:(_window$YT3$PlayerSta=_window$YT3.PlayerState)===null||_window$YT3$PlayerSta===void 0?void 0:_window$YT3$PlayerSta.PLAYING)&&_this.state.roomPaused||e.data===((_window$YT4=window.YT)===null||_window$YT4===void 0?void 0:(_window$YT4$PlayerSta=_window$YT4.PlayerState)===null||_window$YT4$PlayerSta===void 0?void 0:_window$YT4$PlayerSta.PAUSED)&&!_this.state.roomPaused)){var _window$YT5,_window$YT5$PlayerSta;_this.ytDebounce=false;if(e.data===((_window$YT5=window.YT)===null||_window$YT5===void 0?void 0:(_window$YT5$PlayerSta=_window$YT5.PlayerState)===null||_window$YT5$PlayerSta===void 0?void 0:_window$YT5$PlayerSta.PLAYING)){_this.socket.emit('CMD:play');_this.localPlay();}else{_this.socket.emit('CMD:pause');_this.localPause();}window.setTimeout(function(){return _this.ytDebounce=true;},500);}}}});};};_this.getInviteLink=function(vanity){if(vanity){return\"\".concat(window.location.origin,\"/r/\").concat(vanity);}return\"\".concat(window.location.origin,\"/watch\").concat(_this.state.roomId);};_this.handleRoomState=function(data){_this.setOwner(data.owner);_this.setVanity(data.vanity);_this.setPassword(data.password);_this.setInviteLink(_this.getInviteLink(data.vanity));_this.setIsChatDisabled(data.isChatDisabled);_this.setRoomTitle(data.roomTitle);_this.setRoomDescription(data.roomDescription);_this.setRoomTitleColor(data.roomTitleColor);_this.setMediaPath(data.mediaPath);window.history.replaceState('','',_this.getInviteLink(data.vanity));};_this.setOwner=function(owner){_this.setState({owner:owner});};_this.setVanity=function(vanity){_this.setState({vanity:vanity});};_this.setPassword=function(password){_this.setState({password:password});};_this.setInviteLink=function(inviteLink){_this.setState({inviteLink:inviteLink});};_this.setRoomTitle=function(roomTitle){_this.setState({roomTitle:roomTitle});};_this.setRoomDescription=function(roomDescription){_this.setState({roomDescription:roomDescription});};_this.setRoomTitleColor=function(roomTitleColor){_this.setState({roomTitleColor:roomTitleColor});};_this.setMediaPath=function(mediaPath){_this.setState({mediaPath:mediaPath});};_this.setRoomLock=/*#__PURE__*/function(){var _ref12=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee12(locked){var _this$props$user,_this$props$user2;var uid,token;return _regeneratorRuntime().wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:uid=(_this$props$user=_this.props.user)===null||_this$props$user===void 0?void 0:_this$props$user.uid;_context12.next=3;return(_this$props$user2=_this.props.user)===null||_this$props$user2===void 0?void 0:_this$props$user2.getIdToken();case 3:token=_context12.sent;_this.socket.emit('CMD:lock',{uid:uid,token:token,locked:locked});case 5:case\"end\":return _context12.stop();}}},_callee12);}));return function(_x5){return _ref12.apply(this,arguments);};}();_this.haveLock=function(){var _this$props$user3;if(!_this.state.roomLock){return true;}return((_this$props$user3=_this.props.user)===null||_this$props$user3===void 0?void 0:_this$props$user3.uid)===_this.state.roomLock;};_this.setIsChatDisabled=function(val){return _this.setState({isChatDisabled:val});};_this.clearChat=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee13(){var _this$props$user4,_this$props$user5;var uid,token;return _regeneratorRuntime().wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:uid=(_this$props$user4=_this.props.user)===null||_this$props$user4===void 0?void 0:_this$props$user4.uid;_context13.next=3;return(_this$props$user5=_this.props.user)===null||_this$props$user5===void 0?void 0:_this$props$user5.getIdToken();case 3:token=_context13.sent;_this.socket.emit('CMD:deleteChatMessages',{uid:uid,token:token});case 5:case\"end\":return _context13.stop();}}},_callee13);}));_this.startFileShare=/*#__PURE__*/function(){var _ref14=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee14(useMediaSoup){var files,file,leftVideo;return _regeneratorRuntime().wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:_context14.next=2;return openFileSelector();case 2:files=_context14.sent;if(files){_context14.next=5;break;}return _context14.abrupt(\"return\");case 5:file=files[0];_this.Player().clearState();leftVideo=_this.HTMLInterface.getVideoEl();leftVideo.src=URL.createObjectURL(file);leftVideo.play();//@ts-ignore\n_this.localStreamToPublish=leftVideo===null||leftVideo===void 0?void 0:leftVideo.captureStream();_this.isLocalStreamAFile=true;if(_this.localStreamToPublish){_this.socket.emit('CMD:joinScreenShare',{file:true,mediasoup:useMediaSoup});}case 13:case\"end\":return _context14.stop();}}},_callee14);}));return function(_x6){return _ref14.apply(this,arguments);};}();_this.startScreenShare=/*#__PURE__*/function(){var _ref15=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee15(useMediaSoup){var stream;return _regeneratorRuntime().wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:if(!navigator.mediaDevices.getDisplayMedia){_context15.next=7;break;}_context15.next=3;return navigator.mediaDevices.getDisplayMedia({//@ts-ignore\nvideo:{height:720,logicalSurface:true},audio:{autoGainControl:false,channelCount:2,echoCancellation:false,latency:0,noiseSuppression:false,sampleRate:48000,sampleSize:16}});case 3:stream=_context15.sent;_this.localStreamToPublish=stream;_this.isLocalStreamAFile=false;_this.socket.emit('CMD:joinScreenShare',{file:false,mediasoup:useMediaSoup});case 7:case\"end\":return _context15.stop();}}},_callee15);}));return function(_x7){return _ref15.apply(this,arguments);};}();_this.publishMediasoup=/*#__PURE__*/function(){var _ref16=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee20(mediasoupURL){var localStream,device,producerTransport,connectSocket,sendRequest,publish,_publish,loadDevice,_loadDevice,data;return _regeneratorRuntime().wrap(function _callee20$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:_loadDevice=function _loadDevice3(){_loadDevice=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee19(routerRtpCapabilities){var _yield$import,Device;return _regeneratorRuntime().wrap(function _callee19$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:_context19.next=2;return import('mediasoup-client');case 2:_yield$import=_context19.sent;Device=_yield$import.Device;device=new Device();_context19.next=7;return device.load({routerRtpCapabilities:routerRtpCapabilities});case 7:case\"end\":return _context19.stop();}}},_callee19);}));return _loadDevice.apply(this,arguments);};loadDevice=function _loadDevice2(_x9){return _loadDevice.apply(this,arguments);};_publish=function _publish3(){_publish=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee18(){var params,videoTrack,trackParams,audioTrack,_trackParams;return _regeneratorRuntime().wrap(function _callee18$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:// --- get transport info ---\nconsole.log('PUBLISH: --- createProducerTransport --');_context18.next=3;return sendRequest('createProducerTransport',{});case 3:params=_context18.sent;console.log('PUBLISH: transport params:',params);producerTransport=device.createSendTransport(params);console.log('PUBLISH: createSendTransport:',producerTransport);// --- join & start publish --\nproducerTransport.on('connect',/*#__PURE__*/function(){var _ref18=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee16(_ref17,callback,errback){var dtlsParameters;return _regeneratorRuntime().wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:dtlsParameters=_ref17.dtlsParameters;console.log('PUBLISH: --transport connect');sendRequest('connectProducerTransport',{dtlsParameters:dtlsParameters}).then(callback).catch(errback);case 3:case\"end\":return _context16.stop();}}},_callee16);}));return function(_x10,_x11,_x12){return _ref18.apply(this,arguments);};}());producerTransport.on('produce',/*#__PURE__*/function(){var _ref20=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee17(_ref19,callback,errback){var kind,rtpParameters,_yield$sendRequest,id;return _regeneratorRuntime().wrap(function _callee17$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:kind=_ref19.kind,rtpParameters=_ref19.rtpParameters;console.log('PUBLISH: --transport produce');_context17.prev=2;_context17.next=5;return sendRequest('produce',{transportId:producerTransport.id,kind:kind,rtpParameters:rtpParameters});case 5:_yield$sendRequest=_context17.sent;id=_yield$sendRequest.id;callback({id:id});_context17.next=13;break;case 10:_context17.prev=10;_context17.t0=_context17[\"catch\"](2);errback(_context17.t0);case 13:case\"end\":return _context17.stop();}}},_callee17,null,[[2,10]]);}));return function(_x13,_x14,_x15){return _ref20.apply(this,arguments);};}());// producerTransport.on('connectionstatechange', (state: string) => {\n//   switch (state) {\n//     case 'connecting':\n//       console.log('PUBLISH: connecting');\n//       break;\n//     case 'connected':\n//       console.log('PUBLISH: connected');\n//       break;\n//     case 'failed':\n//       console.log('PUBLISH: failed');\n//       producerTransport.close();\n//       break;\n//     default:\n//       break;\n//   }\n// });\nvideoTrack=localStream===null||localStream===void 0?void 0:localStream.getVideoTracks()[0];if(!videoTrack){_context18.next=14;break;}trackParams={track:videoTrack};_context18.next=14;return producerTransport.produce(trackParams);case 14:audioTrack=localStream===null||localStream===void 0?void 0:localStream.getAudioTracks()[0];if(!audioTrack){_context18.next=19;break;}_trackParams={track:audioTrack};_context18.next=19;return producerTransport.produce(_trackParams);case 19:case\"end\":return _context18.stop();}}},_callee18);}));return _publish.apply(this,arguments);};publish=function _publish2(){return _publish.apply(this,arguments);};localStream=_this.localStreamToPublish;device=null;producerTransport=null;// =========== socket.io ==========\nconnectSocket=function connectSocket(mediasoupURL){return new Promise(function(resolve,reject){_this.mediasoupPubSocket=io(mediasoupURL,{transports:['websocket']});var socket=_this.mediasoupPubSocket;socket===null||socket===void 0?void 0:socket.on('connect',function(){console.log('PUBLISH: connected to socket.io');resolve();});socket===null||socket===void 0?void 0:socket.on('error',function(err){console.error('PUBLISH: socket.io ERROR:',err);reject(err);});});};sendRequest=function sendRequest(type,data){return new Promise(function(resolve,reject){var socket=_this.mediasoupPubSocket;socket===null||socket===void 0?void 0:socket.emit(type,data,function(err,response){if(!err){// Success response, so pass the mediasoup response to the local Room.\nresolve(response);}else{reject(err);}});});};_context20.next=11;return connectSocket(mediasoupURL);case 11:_context20.next=13;return sendRequest('getRouterRtpCapabilities',{});case 13:data=_context20.sent;console.log('PUBLISH: getRouterRtpCapabilities:',data);_context20.next=17;return loadDevice(data);case 17:_context20.next=19;return publish();case 19:case\"end\":return _context20.stop();}}},_callee20);}));return function(_x8){return _ref16.apply(this,arguments);};}();_this.subscribeMediasoup=/*#__PURE__*/function(){var _ref21=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee27(mediaSoupURL){var device,consumerTransport,connectSocket,sendRequest,addRemoteTrack,consumeAndResume,_consumeAndResume,loadDevice,_loadDevice4,consume,_consume,subscribe,_subscribe,leftVideo,data;return _regeneratorRuntime().wrap(function _callee27$(_context27){while(1){switch(_context27.prev=_context27.next){case 0:_subscribe=function _subscribe3(){_subscribe=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee26(){var params;return _regeneratorRuntime().wrap(function _callee26$(_context26){while(1){switch(_context26.prev=_context26.next){case 0:console.log('SUBSCRIBE: ---createConsumerTransport --');_context26.next=3;return sendRequest('createConsumerTransport',{});case 3:params=_context26.sent;console.log('SUBSCRIBE: transport params:',params);consumerTransport=device.createRecvTransport(params);console.log('SUBSCRIBE: createConsumerTransport:',consumerTransport);// --- join & start watching\nconsumerTransport.on('connect',/*#__PURE__*/function(){var _ref24=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee25(_ref23,callback,errback){var dtlsParameters;return _regeneratorRuntime().wrap(function _callee25$(_context25){while(1){switch(_context25.prev=_context25.next){case 0:dtlsParameters=_ref23.dtlsParameters;console.log('SUBSCRIBE: ---consumer transport connect');sendRequest('connectConsumerTransport',{dtlsParameters:dtlsParameters}).then(callback).catch(errback);case 3:case\"end\":return _context25.stop();}}},_callee25);}));return function(_x22,_x23,_x24){return _ref24.apply(this,arguments);};}());// consumerTransport.on('connectionstatechange', (state: string) => {\n//   switch (state) {\n//     case 'connecting':\n//       console.log('SUBSCRIBE: connecting');\n//       break;\n//     case 'connected':\n//       console.log('SUBSCRIBE: connected');\n//       break;\n//     case 'failed':\n//       console.log('SUBSCRIBE: failed');\n//       consumerTransport.close();\n//       break;\n//     default:\n//       break;\n//   }\n// });\n_context26.next=10;return consumeAndResume('video');case 10:_context26.next=12;return consumeAndResume('audio');case 12:case\"end\":return _context26.stop();}}},_callee26);}));return _subscribe.apply(this,arguments);};subscribe=function _subscribe2(){return _subscribe.apply(this,arguments);};_consume=function _consume3(){_consume=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee24(transport,trackKind){var _device,rtpCapabilities,data,producerId,id,kind,rtpParameters,codecOptions,consumer;return _regeneratorRuntime().wrap(function _callee24$(_context24){while(1){switch(_context24.prev=_context24.next){case 0:console.log('SUBSCRIBE: --start of consume --kind='+trackKind);_device=device,rtpCapabilities=_device.rtpCapabilities;_context24.next=4;return sendRequest('consume',{rtpCapabilities:rtpCapabilities,kind:trackKind}).catch(function(err){console.error('SUBSCRIBE: ERROR:',err);});case 4:data=_context24.sent;producerId=data.producerId,id=data.id,kind=data.kind,rtpParameters=data.rtpParameters;if(!producerId){_context24.next=16;break;}codecOptions={};_context24.next=10;return transport.consume({id:id,producerId:producerId,kind:kind,rtpParameters:rtpParameters,//@ts-ignore\ncodecOptions:codecOptions});case 10:consumer=_context24.sent;addRemoteTrack(consumer.track);console.log('SUBSCRIBE: --end of consume');return _context24.abrupt(\"return\",consumer);case 16:console.warn('SUBSCRIBE: ---remote producer NOT READY');return _context24.abrupt(\"return\",null);case 18:case\"end\":return _context24.stop();}}},_callee24);}));return _consume.apply(this,arguments);};consume=function _consume2(_x20,_x21){return _consume.apply(this,arguments);};_loadDevice4=function _loadDevice6(){_loadDevice4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee23(routerRtpCapabilities){var _yield$import2,_Device;return _regeneratorRuntime().wrap(function _callee23$(_context23){while(1){switch(_context23.prev=_context23.next){case 0:_context23.prev=0;_context23.next=3;return import('mediasoup-client');case 3:_yield$import2=_context23.sent;_Device=_yield$import2.Device;device=new _Device();_context23.next=8;return device.load({routerRtpCapabilities:routerRtpCapabilities});case 8:_context23.next=13;break;case 10:_context23.prev=10;_context23.t0=_context23[\"catch\"](0);if(_context23.t0.name==='UnsupportedError'){console.error('browser not supported');}case 13:case\"end\":return _context23.stop();}}},_callee23,null,[[0,10]]);}));return _loadDevice4.apply(this,arguments);};loadDevice=function _loadDevice5(_x19){return _loadDevice4.apply(this,arguments);};_consumeAndResume=function _consumeAndResume3(){_consumeAndResume=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee22(kind){var consumer;return _regeneratorRuntime().wrap(function _callee22$(_context22){while(1){switch(_context22.prev=_context22.next){case 0:_context22.next=2;return consume(consumerTransport,kind);case 2:consumer=_context22.sent;if(!consumer){_context22.next=8;break;}console.log('SUBSCRIBE: -- track exist, consumer ready. kind='+kind);if(kind==='video'){console.log('SUBSCRIBE: -- resume kind='+kind);sendRequest('resume',{kind:kind}).then(function(){console.log('SUBSCRIBE: resume OK');return consumer;}).catch(function(err){console.error('SUBSCRIBE: resume ERROR:',err);return consumer;});}else{console.log('SUBSCRIBE: -- do not resume kind='+kind);}_context22.next=10;break;case 8:console.log('SUBSCRIBE: -- no consumer yet. kind='+kind);return _context22.abrupt(\"return\",null);case 10:case\"end\":return _context22.stop();}}},_callee22);}));return _consumeAndResume.apply(this,arguments);};consumeAndResume=function _consumeAndResume2(_x18){return _consumeAndResume.apply(this,arguments);};device=null;consumerTransport=null;// =========== socket.io ==========\nconnectSocket=function connectSocket(){return new Promise(function(resolve,reject){_this.mediasoupSubSocket=io(mediaSoupURL,{transports:['websocket']});var socket=_this.mediasoupSubSocket;socket===null||socket===void 0?void 0:socket.on('connect',function(){console.log('SUBSCRIBE: connected to socket.io');resolve();});socket===null||socket===void 0?void 0:socket.on('error',function(err){console.error('SUBSCRIBE: socket.io ERROR:',err);reject(err);});socket===null||socket===void 0?void 0:socket.on('newProducer',/*#__PURE__*/function(){var _ref22=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee21(message){return _regeneratorRuntime().wrap(function _callee21$(_context21){while(1){switch(_context21.prev=_context21.next){case 0:console.log('SUBSCRIBE: socket.io newProducer:',message);if(!consumerTransport){_context21.next=10;break;}if(!(message.kind==='video')){_context21.next=7;break;}_context21.next=5;return consumeAndResume(message.kind);case 5:_context21.next=10;break;case 7:if(!(message.kind==='audio')){_context21.next=10;break;}_context21.next=10;return consumeAndResume(message.kind);case 10:case\"end\":return _context21.stop();}}},_callee21);}));return function(_x17){return _ref22.apply(this,arguments);};}());// socket?.on('producerClosed', function (message) {\n//   console.log('socket.io producerClosed:', message);\n//   const localId = message.localId;\n//   const remoteId = message.remoteId;\n//   const kind = message.kind;\n//   if (kind === 'video') {\n//     if (videoConsumer) {\n//       videoConsumer.close();\n//       videoConsumer = null;\n//     }\n//   } else if (kind === 'audio') {\n//     if (audioConsumer) {\n//       audioConsumer.close();\n//       audioConsumer = null;\n//     }\n//   }\n// });\n});};sendRequest=function sendRequest(type,data){return new Promise(function(resolve,reject){var socket=_this.mediasoupSubSocket;socket===null||socket===void 0?void 0:socket.emit(type,data,function(err,response){if(!err){// Success response, so pass the mediasoup response to the local Room.\nresolve(response);}else{reject(err);}});});};// =========== media handling ==========\naddRemoteTrack=function addRemoteTrack(track){var video=_this.HTMLInterface.getVideoEl();if(video.srcObject){// Track already exists, add it\nvideo.srcObject.addTrack(track);}else{var mediaStream=new MediaStream();mediaStream.addTrack(track);video.srcObject=mediaStream;}_this.localPlay();};// Clear the srcobject so we load our stream when received\nleftVideo=_this.HTMLInterface.getVideoEl();leftVideo.srcObject=null;_context27.next=17;return connectSocket();case 17:_context27.next=19;return sendRequest('getRouterRtpCapabilities',{});case 19:data=_context27.sent;console.log('getRouterRtpCapabilities:',data);_context27.next=23;return loadDevice(data);case 23:_context27.next=25;return subscribe();case 25:case\"end\":return _context27.stop();}}},_callee27);}));return function(_x16){return _ref21.apply(this,arguments);};}();_this.stopPublishingLocalStream=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee28(){return _regeneratorRuntime().wrap(function _callee28$(_context28){while(1){switch(_context28.prev=_context28.next){case 0:if(_this.localStreamToPublish){_this.socket.emit('CMD:leaveScreenShare');// We don't actually need to unmute if it's a fileshare but this is fine\n_this.localSetMute(false);}_this.localStreamToPublish&&_this.localStreamToPublish.getTracks().forEach(function(track){track.stop();});_this.localStreamToPublish=undefined;if(_this.consumerConn){_this.consumerConn.close();_this.consumerConn=undefined;}Object.values(_this.publisherConns).forEach(function(pc){pc.close();});_this.publisherConns={};_this.isLocalStreamAFile=false;if(_this.mediasoupPubSocket){_this.mediasoupPubSocket.close();_this.mediasoupPubSocket=null;}if(_this.mediasoupSubSocket){_this.mediasoupSubSocket.close();_this.mediasoupSubSocket=null;}case 9:case\"end\":return _context28.stop();}}},_callee28);}));_this.setupRTCConnections=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee30(){var _this$localStreamToPu;var sharer,selfId,localTrack,prefix,unprefixed,mediasoupURL,clientIds,pc;return _regeneratorRuntime().wrap(function _callee30$(_context30){while(1){switch(_context30.prev=_context30.next){case 0:if(!(!_this.playingScreenShare()&&!_this.playingFileShare())){_context30.next=2;break;}return _context30.abrupt(\"return\");case 2:sharer=_this.state.participants.find(function(p){return p.isScreenShare;});selfId=getAndSaveClientId();localTrack=(_this$localStreamToPu=_this.localStreamToPublish)===null||_this$localStreamToPu===void 0?void 0:_this$localStreamToPu.getVideoTracks()[0];if(localTrack&&!localTrack.onended){// Stop sharing if the local stream stops\nlocalTrack.onended=function(){return _this.stopPublishingLocalStream();};}if(!_this.state.roomMedia.includes('@')){_context30.next=18;break;}prefix='screenshare://';if(_this.playingFileShare()){prefix='fileshare://';}unprefixed=_this.state.roomMedia.replace(prefix,'');mediasoupURL=unprefixed.split('@')[1];if(!((sharer===null||sharer===void 0?void 0:sharer.clientId)===selfId&&_this.mediasoupPubSocket==null)){_context30.next=14;break;}_context30.next=14;return _this.publishMediasoup(mediasoupURL);case 14:if(!(!_this.isLocalStreamAFile&&_this.mediasoupSubSocket==null)){_context30.next=17;break;}_context30.next=17;return _this.subscribeMediasoup(mediasoupURL);case 17:return _context30.abrupt(\"return\");case 18:// We're the sharer, create a connection to each other member\nif((sharer===null||sharer===void 0?void 0:sharer.clientId)===selfId){// Delete and close any connections that aren't in the current member list (maybe someone disconnected)\n// This allows them to rejoin later\nclientIds=new Set(_this.state.participants.map(function(p){return p.clientId;}));Object.entries(_this.publisherConns).forEach(function(_ref27){var _ref28=_slicedToArray(_ref27,2),key=_ref28[0],value=_ref28[1];if(!clientIds.has(key)){value.close();delete _this.publisherConns[key];}});_this.state.participants.forEach(function(user){var id=user.clientId;if(id===selfId&&_this.isLocalStreamAFile){// Don't set up a connection to ourselves if sharing file\nreturn;}if(!_this.publisherConns[id]){var _this$localStreamToPu2;// Set up the RTCPeerConnection for sharing media to each member\nvar pc=new RTCPeerConnection({iceServers:iceServers()});_this.publisherConns[id]=pc;(_this$localStreamToPu2=_this.localStreamToPublish)===null||_this$localStreamToPu2===void 0?void 0:_this$localStreamToPu2.getTracks().forEach(function(track){if(_this.localStreamToPublish!=null){pc.addTrack(track,_this.localStreamToPublish);}});pc.onicecandidate=function(event){// We generated an ICE candidate, send it to peer\nif(event.candidate){_this.sendSignalSS(id,{ice:event.candidate},true);}};pc.onnegotiationneeded=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee29(){var offer;return _regeneratorRuntime().wrap(function _callee29$(_context29){while(1){switch(_context29.prev=_context29.next){case 0:_context29.next=2;return pc.createOffer();case 2:offer=_context29.sent;_context29.next=5;return pc.setLocalDescription(offer);case 5:_this.sendSignalSS(id,{sdp:pc.localDescription},true);case 6:case\"end\":return _context29.stop();}}},_callee29);}));}});}// We're a watcher, establish connection to sharer\n// If screensharing, sharer also does this\n// If filesharing, sharer does not do this since we use leftVideo\nif(sharer&&!_this.consumerConn&&!_this.isLocalStreamAFile){pc=new RTCPeerConnection({iceServers:iceServers()});_this.consumerConn=pc;pc.onicecandidate=function(event){// We generated an ICE candidate, send it to sharer\nif(event.candidate){_this.sendSignalSS(sharer.clientId,{ice:event.candidate});}};pc.ontrack=function(event){// Mount the stream from sharer\n// console.log(stream);\nvar leftVideo=_this.HTMLInterface.getVideoEl();if(leftVideo){leftVideo.src='';leftVideo.srcObject=event.streams[0];_this.localPlay();}};}case 20:case\"end\":return _context30.stop();}}},_callee30);}));_this.startVBrowser=/*#__PURE__*/function(){var _ref30=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee31(rcToken,options){var user,uid,token;return _regeneratorRuntime().wrap(function _callee31$(_context31){while(1){switch(_context31.prev=_context31.next){case 0:// user.uid is the public user identifier\n// user.getIdToken() is the secret access token we can send to the server to prove identity\nuser=_this.props.user;uid=user===null||user===void 0?void 0:user.uid;_context31.next=4;return user===null||user===void 0?void 0:user.getIdToken();case 4:token=_context31.sent;_this.socket.emit('CMD:startVBrowser',{options:options,uid:uid,token:token,rcToken:rcToken});case 6:case\"end\":return _context31.stop();}}},_callee31);}));return function(_x25,_x26){return _ref30.apply(this,arguments);};}();_this.stopVBrowser=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee32(){return _regeneratorRuntime().wrap(function _callee32$(_context32){while(1){switch(_context32.prev=_context32.next){case 0:_this.socket.emit('CMD:stopVBrowser');case 1:case\"end\":return _context32.stop();}}},_callee32);}));_this.changeController=/*#__PURE__*/function(){var _ref32=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee33(_e,data){return _regeneratorRuntime().wrap(function _callee33$(_context33){while(1){switch(_context33.prev=_context33.next){case 0:// console.log(data);\n_this.socket.emit('CMD:changeController',data.value);case 1:case\"end\":return _context33.stop();}}},_callee33);}));return function(_x27,_x28){return _ref32.apply(this,arguments);};}();_this.sendSignalSS=/*#__PURE__*/function(){var _ref33=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee34(to,data,sharer){return _regeneratorRuntime().wrap(function _callee34$(_context34){while(1){switch(_context34.prev=_context34.next){case 0:// console.log('sendSS', to, data);\n_this.socket.emit('signalSS',{to:to,msg:data,sharer:sharer});case 1:case\"end\":return _context34.stop();}}},_callee34);}));return function(_x29,_x30,_x31){return _ref33.apply(this,arguments);};}();_this.usingYoutube=function(){return isYouTube(_this.state.roomMedia);};_this.usingNative=function(){// Anything that uses HTML Video (e.g. not YouTube, Vimeo, or other embedded JS player)\nreturn!_this.usingYoutube();};_this.hasDuration=function(){// Youtube, link, or magnet, etc. Has a defined runtime (not WebRTC)\nreturn isHttp(_this.state.roomMedia)||isMagnet(_this.state.roomMedia);};_this.playingScreenShare=function(){return isScreenShare(_this.state.roomMedia);};_this.playingFileShare=function(){return isFileShare(_this.state.roomMedia);};_this.playingVBrowser=function(){return isVBrowser(_this.state.roomMedia);};_this.getVBrowserPass=function(){return _this.state.roomMedia.replace('vbrowser://','').split('@')[0];};_this.getVBrowserHost=function(){return _this.state.roomMedia.replace('vbrowser://','').split('@')[1];};_this.isPauseDisabled=function(){return _this.playingScreenShare()||_this.playingVBrowser();};_this.localSeek=function(customTime){// Jump to the leader's position, or a custom one\n// for HLS the leader is the live stream position\nvar target=customTime!==null&&customTime!==void 0?customTime:_this.getLeaderTime();if(_this.state.isLiveHls){console.log('syncing self for livehls');if(customTime){// Translate the time back to video time\n// TODO Safari reports the duration as Infinity, so keep track of our duration using the max of our current timestamp\nvar zeroTime=Math.floor(Date.now()/1000)-_this.HTMLInterface.getDuration();// Cap the time to the leadertime so we don't try to seek too close to edge\ntarget=Math.min(customTime-zeroTime,_this.getLeaderTime());}else{target=_this.getLeaderTime();}}if(target>=0&&target<Infinity){console.log('syncing self to leader or custom:',target);_this.Player().seekVideo(target);}};_this.localPlay=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee36(){var canAutoplay;return _regeneratorRuntime().wrap(function _callee36$(_context36){while(1){switch(_context36.prev=_context36.next){case 0:if(_this.state.roomMedia){_context36.next=2;break;}return _context36.abrupt(\"return\");case 2:_context36.t0=_this.state.isAutoPlayable;if(_context36.t0){_context36.next=7;break;}_context36.next=6;return testAutoplay();case 6:_context36.t0=_context36.sent;case 7:canAutoplay=_context36.t0;_this.setState({roomPaused:false,isAutoPlayable:canAutoplay},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee35(){return _regeneratorRuntime().wrap(function _callee35$(_context35){while(1){switch(_context35.prev=_context35.next){case 0:if(!_this.state.isAutoPlayable||_this.localStreamToPublish&&!_this.isLocalStreamAFile){console.log('auto-muting to allow autoplay or screenshare host');_this.localSetMute(true);}else{_this.localSetMute(false);}_context35.prev=1;_context35.next=4;return _this.Player().playVideo();case 4:_context35.next=10;break;case 6:_context35.prev=6;_context35.t0=_context35[\"catch\"](1);console.warn(_context35.t0,_context35.t0.name);if(_context35.t0.name==='NotSupportedError'&&_this.usingNative()){_this.setState({loading:false,nonPlayableMedia:true});}case 10:case\"end\":return _context35.stop();}}},_callee35,null,[[1,6]]);})));case 9:case\"end\":return _context36.stop();}}},_callee36);}));_this.localPause=function(){_this.setState({roomPaused:true},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee37(){return _regeneratorRuntime().wrap(function _callee37$(_context37){while(1){switch(_context37.prev=_context37.next){case 0:_this.Player().pauseVideo();case 1:case\"end\":return _context37.stop();}}},_callee37);})));};_this.localSetMute=function(muted){_this.Player().setMute(muted);_this.refreshControls();};_this.localSetVolume=function(volume){_this.Player().setVolume(volume);_this.refreshControls();};_this.localSubtitleModal=function(){// Native player uses subtitle modal.\nif(_this.usingNative()){_this.setState({isSubtitleModalOpen:true});}};_this.roomSetPlaybackRate=function(rate){// emit an event to the server\n_this.socket.emit('CMD:playbackRate',rate);};_this.roomSetLoop=function(loop){_this.socket.emit('CMD:loop',loop);};_this.roomTogglePlay=function(){if(!_this.haveLock()){return;}if(_this.isPauseDisabled()){return;}var shouldPlay=_this.Player().shouldPlay();if(shouldPlay){_this.socket.emit('CMD:play');_this.localPlay();}else{_this.socket.emit('CMD:pause');_this.localPause();}};_this.roomSeek=function(e,time){var target=time;// Read the time from the click event if it exists\nif(e){var rect=e.target.getBoundingClientRect();var x=e.clientX-rect.left;var max=rect.width;target=x/max*_this.Player().getDuration();}target=Math.max(target,0);_this.Player().seekVideo(target);var hlsTarget=Math.floor(Date.now()/1000)-_this.HTMLInterface.getDuration()+target;_this.socket.emit('CMD:seek',_this.state.isLiveHls?hlsTarget:target);};_this.onFullScreenChange=function(){_this.setState({fullScreen:Boolean(document.fullscreenElement)});};_this.onKeydown=function(e){if(!document.activeElement||document.activeElement.tagName==='BODY'){if(e.key===' '){e.preventDefault();_this.roomTogglePlay();}else if(e.key==='ArrowRight'){_this.roomSeek(null,_this.Player().getCurrentTime()+15);}else if(e.key==='ArrowLeft'){_this.roomSeek(null,_this.Player().getCurrentTime()-15);}else if(e.key==='t'){_this.localFullScreen(false);}else if(e.key==='f'){_this.localFullScreen(true);}else if(e.key==='m'){_this.localToggleMute();}}};_this.localFullScreen=/*#__PURE__*/function(){var _ref37=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee38(bVideoOnly){var container,bChangeElements;return _regeneratorRuntime().wrap(function _callee38$(_context38){while(1){switch(_context38.prev=_context38.next){case 0:container=document.getElementById('theaterContainer');if(bVideoOnly||isMobile()){if(_this.playingVBrowser()&&!isMobile()){// Can't really control the VBrowser on mobile anyway, so just fullscreen the video\n// https://github.com/howardchung/watchparty/issues/208\ncontainer=document.getElementById('leftVideoParent');}else{container=_this.Player().getVideoEl();}}if(!(!container.requestFullscreen&&container.webkitEnterFullScreen)){_context38.next=5;break;}// e.g. iPhone doesn't allow requestFullscreen\ncontainer.webkitEnterFullscreen();return _context38.abrupt(\"return\");case 5:if(document.fullscreenElement){_context38.next=9;break;}_context38.next=8;return container.requestFullscreen();case 8:return _context38.abrupt(\"return\");case 9:bChangeElements=document.fullscreenElement!==container;_context38.next=12;return document.exitFullscreen();case 12:if(!bChangeElements){_context38.next=15;break;}_context38.next=15;return container.requestFullscreen();case 15:case\"end\":return _context38.stop();}}},_callee38);}));return function(_x32){return _ref37.apply(this,arguments);};}();_this.localToggleMute=function(){_this.localSetMute(!_this.Player().isMuted());};_this.roomSetMedia=function(_e,data){_this.socket.emit('CMD:host',data.value);};_this.roomPlaylistAdd=function(_e,data){_this.socket.emit('CMD:playlistAdd',data.value);};_this.roomPlaylistMove=function(index,toIndex){_this.socket.emit('CMD:playlistMove',{index:index,toIndex:toIndex});};_this.roomPlaylistDelete=function(index){_this.socket.emit('CMD:playlistDelete',index);};_this.updateName=function(_e,data){_this.setState({myName:data.value});_this.socket.emit('CMD:name',data.value);window.localStorage.setItem('watchparty-username',data.value);};_this.updatePicture=function(url){_this.setState({myPicture:url});_this.socket.emit('CMD:picture',url);};_this.updateUid=/*#__PURE__*/function(){var _ref38=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee39(user){var uid,token;return _regeneratorRuntime().wrap(function _callee39$(_context39){while(1){switch(_context39.prev=_context39.next){case 0:uid=user.uid;_context39.next=3;return user.getIdToken();case 3:token=_context39.sent;_this.socket.emit('CMD:uid',{uid:uid,token:token});case 5:case\"end\":return _context39.stop();}}},_callee39);}));return function(_x33){return _ref38.apply(this,arguments);};}();_this.getMediaDisplayName=function(input){if(!input){return'';}// Show the whole URL for youtube\nif(_this.usingYoutube()){return input;}if(input.startsWith('screenshare://')){var _sharer$id;var sharer=_this.state.participants.find(function(user){return user.isScreenShare;});return _this.state.nameMap[(_sharer$id=sharer===null||sharer===void 0?void 0:sharer.id)!==null&&_sharer$id!==void 0?_sharer$id:'']+\"'s screen\";}if(input.startsWith('fileshare://')){var _sharer$id2;var _sharer=_this.state.participants.find(function(user){return user.isScreenShare;});return _this.state.nameMap[(_sharer$id2=_sharer===null||_sharer===void 0?void 0:_sharer.id)!==null&&_sharer$id2!==void 0?_sharer$id2:'']+\"'s file\";}if(input.startsWith('vbrowser://')){return'Virtual Browser'+(_this.state.isVBrowserLarge?'+':'');}if(isMagnet(input)){var magnetParsed=new URLSearchParams(input);var index=magnetParsed.get('fileIndex');return magnetParsed.get('dn')+(index!=null?\" (file \".concat(index,\")\"):'');}if(input.includes('/stream?torrent=magnet')){var _searchParsed$get;var search=new URL(input).search;var searchParsed=new URLSearchParams(search);var magnetUrl=(_searchParsed$get=searchParsed.get('torrent'))!==null&&_searchParsed$get!==void 0?_searchParsed$get:'';var _magnetParsed=new URLSearchParams(magnetUrl);var _index=searchParsed.get('fileIndex');return _magnetParsed.get('dn')+(_index!=null?\" (file \".concat(_index,\")\"):'');}if(input.includes('/proxy')){var urlParsed=new URLSearchParams(input);var displayName=urlParsed.get('displayName');if(displayName){return displayName;}}return input;};_this.setLoadingFalse=function(){_this.setState({loading:false});};_this.getLeaderTime=function(){if(_this.state.isLiveHls){// Pick a time near the end of the livestream\nreturn _this.HTMLInterface.getDuration()-5;}if(_this.state.participants.length>2){return calculateMedian(Object.values(_this.state.tsMap));}return Math.max.apply(Math,_toConsumableArray(Object.values(_this.state.tsMap)));};_this.onVideoEnded=function(){_this.localPause();// check if looping is on, if so set time back to 0 and restart\nif(_this.state.roomLoop){_this.localSeek(0);_this.localPlay();return;}if(_this.state.playlist.length){_this.socket.emit('CMD:playlistNext',_this.state.roomMedia);return;}// Play next fileIndex\nvar re=/&fileIndex=(\\d+)$/;var match=re.exec(_this.state.roomMedia);if(match){var fileIndex=match[1];var nextNum=Number(fileIndex)+1;var nextUrl=_this.state.roomMedia.replace(/&fileIndex=(\\d+)$/,\"&fileIndex=\".concat(nextNum));_this.roomSetMedia(null,{value:nextUrl});}};_this.refreshControls=function(){_this.setState({controlsTimestamp:Number(new Date())});};return _this;}_createClass(App,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee40(){var canAutoplay;return _regeneratorRuntime().wrap(function _callee40$(_context40){while(1){switch(_context40.prev=_context40.next){case 0:document.onfullscreenchange=this.onFullScreenChange;document.onkeydown=this.onKeydown;// Send heartbeat to the server\nthis.heartbeat=window.setInterval(function(){window.fetch(serverPath+'/ping');},10*60*1000);_context40.next=5;return testAutoplay();case 5:canAutoplay=_context40.sent;this.setState({isAutoPlayable:canAutoplay});this.loadSettings();this.loadYouTube();this.init();case 10:case\"end\":return _context40.stop();}}},_callee40,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"componentWillUnmount\",value:function componentWillUnmount(){document.removeEventListener('fullscreenchange',this.onFullScreenChange);document.removeEventListener('keydown',this.onKeydown);window.clearInterval(this.heartbeat);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(this.props.user&&!prevProps.user){this.loadSignInData();}}},{key:\"render\",value:function render(){var _this2=this,_this$socket;var sharer=this.state.participants.find(function(p){return p.isScreenShare;});var controls=/*#__PURE__*/_jsx(Controls,{beta:this.props.beta,paused:this.state.roomPaused,roomPlaybackRate:this.state.roomPlaybackRate,isLiveHls:this.state.isLiveHls,muted:this.Player().isMuted(),volume:this.Player().getVolume(),subtitled:this.Player().isSubtitled(),currentTime:this.Player().getCurrentTime(),duration:this.Player().getDuration(),disabled:!this.haveLock(),leaderTime:this.hasDuration()?this.getLeaderTime():undefined,isPauseDisabled:this.isPauseDisabled(),playbackRate:this.Player().getPlaybackRate(),isYouTube:this.usingYoutube(),timeRanges:this.Player().getTimeRanges(),loop:this.state.roomLoop,roomSetLoop:this.roomSetLoop,roomTogglePlay:this.roomTogglePlay,roomSeek:this.roomSeek,roomSetPlaybackRate:this.roomSetPlaybackRate,localFullScreen:this.localFullScreen,localToggleMute:this.localToggleMute,localSubtitleModal:this.localSubtitleModal,localSetVolume:this.localSetVolume,localSeek:this.localSeek,localSetSubtitleMode:this.Player().setSubtitleMode},this.state.controlsTimestamp);var displayRightContent=this.state.showRightBar||this.state.fullScreen;var rightBar=/*#__PURE__*/_jsxs(Grid.Column,{width:displayRightContent?4:1,style:{display:'flex',flexDirection:'column'},className:\"\".concat(this.state.fullScreen?styles.fullHeightColumnFullscreen:styles.fullHeightColumn),children:[/*#__PURE__*/_jsx(Form,{autoComplete:\"off\",children:/*#__PURE__*/_jsx(Input,{inverted:true,fluid:true,label:'My name is:',value:this.state.myName,onChange:this.updateName,style:{visibility:displayRightContent?'':'hidden'},icon:/*#__PURE__*/_jsx(Icon,{onClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee41(){return _regeneratorRuntime().wrap(function _callee41$(_context41){while(1){switch(_context41.prev=_context41.next){case 0:_context41.t0=_this2;_context41.next=3;return generateName();case 3:_context41.t1=_context41.sent;_context41.t2={value:_context41.t1};return _context41.abrupt(\"return\",_context41.t0.updateName.call(_context41.t0,null,_context41.t2));case 6:case\"end\":return _context41.stop();}}},_callee41);})),name:\"random\",inverted:true,circular:true,link:true,title:\"Generate a random name\"})})}),/*#__PURE__*/_jsxs(Menu,{inverted:true,widths:3,style:{marginTop:'4px',marginBottom:'4px',visibility:displayRightContent?'':'hidden',height:'40px'},children:[/*#__PURE__*/_jsxs(Menu.Item,{name:\"chat\",active:this.state.currentTab==='chat',onClick:function onClick(){_this2.setState({currentTab:'chat',unreadCount:0});},as:\"a\",children:[\"Chat\",this.state.unreadCount>0&&/*#__PURE__*/_jsx(Label,{circular:true,color:\"red\",children:this.state.unreadCount})]}),/*#__PURE__*/_jsxs(Menu.Item,{name:\"people\",active:this.state.currentTab==='people',onClick:function onClick(){return _this2.setState({currentTab:'people'});},as:\"a\",children:[\"People\",/*#__PURE__*/_jsx(Label,{circular:true,color:getColorForString(this.state.participants.length.toString()),children:this.state.participants.length})]}),/*#__PURE__*/_jsx(Menu.Item,{name:\"settings\",active:this.state.currentTab==='settings',onClick:function onClick(){return _this2.setState({currentTab:'settings'});},as:\"a\",children:\"Settings\"})]}),/*#__PURE__*/_jsx(Chat,{chat:this.state.chat,nameMap:this.state.nameMap,pictureMap:this.state.pictureMap,socket:this.socket,scrollTimestamp:this.state.scrollTimestamp,getMediaDisplayName:this.getMediaDisplayName,hide:this.state.currentTab!=='chat'||!displayRightContent,isChatDisabled:this.state.isChatDisabled,owner:this.state.owner,user:this.props.user,ref:this.chatRef,isLiveHls:this.state.isLiveHls}),this.state.state==='connected'&&/*#__PURE__*/_jsx(VideoChat,{socket:this.socket,participants:this.state.participants,nameMap:this.state.nameMap,pictureMap:this.state.pictureMap,tsMap:this.state.tsMap,rosterUpdateTS:this.state.rosterUpdateTS,hide:this.state.currentTab!=='people'||!displayRightContent,owner:this.state.owner,user:this.props.user,beta:this.props.beta,getLeaderTime:this.getLeaderTime}),/*#__PURE__*/_jsx(SettingsTab,{hide:this.state.currentTab!=='settings'||!displayRightContent,user:this.props.user,roomLock:this.state.roomLock,setRoomLock:this.setRoomLock,socket:this.socket,isSubscriber:this.props.isSubscriber,roomId:this.state.roomId,isChatDisabled:this.state.isChatDisabled,setIsChatDisabled:this.setIsChatDisabled,owner:this.state.owner,setOwner:this.setOwner,vanity:this.state.vanity,setVanity:this.setVanity,inviteLink:this.state.inviteLink,password:this.state.password,setPassword:this.setPassword,clearChat:this.clearChat,roomTitle:this.state.roomTitle,setRoomTitle:this.setRoomTitle,roomDescription:this.state.roomDescription,setRoomDescription:this.setRoomDescription,roomTitleColor:this.state.roomTitleColor,setRoomTitleColor:this.setRoomTitleColor,mediaPath:this.state.mediaPath,setMediaPath:this.setMediaPath})]});return/*#__PURE__*/_jsxs(React.Fragment,{children:[!this.state.isAutoPlayable&&/*#__PURE__*/_jsx(Modal,{inverted:\"true\",basic:true,open:true,children:/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center'},children:/*#__PURE__*/_jsxs(Button,{primary:true,size:\"large\",onClick:function onClick(){_this2.setState({isAutoPlayable:true});_this2.localSetMute(false);_this2.localSetVolume(1);},icon:true,labelPosition:\"left\",children:[/*#__PURE__*/_jsx(Icon,{name:\"volume up\"}),\"Click to unmute\"]})})}),this.state.multiStreamSelection&&/*#__PURE__*/_jsx(MultiStreamModal,{streams:this.state.multiStreamSelection,setMedia:this.roomSetMedia,resetMultiSelect:this.resetMultiSelect}),this.state.isVBrowserModalOpen&&/*#__PURE__*/_jsx(VBrowserModal,{isSubscriber:this.props.isSubscriber,closeModal:function closeModal(){return _this2.setState({isVBrowserModalOpen:false});},startVBrowser:this.startVBrowser,user:this.props.user,beta:this.props.beta}),this.state.isScreenShareModalOpen&&/*#__PURE__*/_jsx(ScreenShareModal,{beta:this.props.beta,isSubscriber:this.props.isSubscriber,user:this.props.user,closeModal:function closeModal(){return _this2.setState({isScreenShareModalOpen:false});},startScreenShare:this.startScreenShare}),this.state.isFileShareModalOpen&&/*#__PURE__*/_jsx(FileShareModal,{beta:this.props.beta,isSubscriber:this.props.isSubscriber,user:this.props.user,closeModal:function closeModal(){return _this2.setState({isFileShareModalOpen:false});},startFileShare:this.startFileShare}),this.state.isSubtitleModalOpen&&/*#__PURE__*/_jsx(SubtitleModal,{closeModal:function closeModal(){return _this2.setState({isSubtitleModalOpen:false});},socket:this.socket,roomSubtitle:this.state.roomSubtitle,roomMedia:this.state.roomMedia,haveLock:this.haveLock,getMediaDisplayName:this.getMediaDisplayName,beta:this.props.beta,setSubtitleMode:this.Player().setSubtitleMode,getSubtitleMode:this.Player().getSubtitleMode}),this.state.overlayMsg&&/*#__PURE__*/_jsx(ErrorModal,{error:this.state.overlayMsg}),this.state.isErrorAuth&&/*#__PURE__*/_jsx(PasswordModal,{savedPasswords:this.state.savedPasswords,roomId:this.state.roomId}),this.state.errorMessage&&/*#__PURE__*/_jsx(Message,{negative:true,header:\"Error\",content:this.state.errorMessage,style:{position:'fixed',bottom:'10px',right:'10px',zIndex:1000}}),this.state.successMessage&&/*#__PURE__*/_jsx(Message,{positive:true,header:\"Success\",content:this.state.successMessage,style:{position:'fixed',bottom:'10px',right:'10px',zIndex:1000}}),this.state.warningMessage&&/*#__PURE__*/_jsx(Message,{warning:true// header={this.state.warningMessage}\n,content:this.state.warningMessage,style:{position:'fixed',top:'10px',left:'50%',transform:'translate(-50%, 0)',zIndex:1000}}),/*#__PURE__*/_jsx(TopBar,{user:this.props.user,isSubscriber:this.props.isSubscriber,roomTitle:this.state.roomTitle,roomDescription:this.state.roomDescription,roomTitleColor:this.state.roomTitleColor,showInviteButton:true}),/*#__PURE__*/_jsx(Grid,{stackable:true,celled:\"internally\",children:/*#__PURE__*/_jsxs(Grid.Row,{id:\"theaterContainer\",children:[/*#__PURE__*/_jsxs(Grid.Column,{width:this.state.showRightBar?12:15,className:this.state.fullScreen?styles.fullHeightColumnFullscreen:styles.fullHeightColumn,children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',height:'100%'},children:[!this.state.fullScreen&&/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(ComboBox,{roomSetMedia:this.roomSetMedia,playlistAdd:this.roomPlaylistAdd,playlistDelete:this.roomPlaylistDelete,playlistMove:this.roomPlaylistMove,roomMedia:this.state.roomMedia,getMediaDisplayName:this.getMediaDisplayName,launchMultiSelect:this.launchMultiSelect,streamPath:this.props.streamPath,mediaPath:this.state.mediaPath,disabled:!this.haveLock(),playlist:this.state.playlist}),/*#__PURE__*/_jsx(Separator,{}),/*#__PURE__*/_jsxs(\"div\",{className:styles.mobileStack,style:{display:'flex',gap:'4px'},children:[this.localStreamToPublish&&/*#__PURE__*/_jsxs(Button,{fluid:true,className:\"toolButton\",icon:true,labelPosition:\"left\",color:\"red\",onClick:this.stopPublishingLocalStream,disabled:(sharer===null||sharer===void 0?void 0:sharer.id)!==((_this$socket=this.socket)===null||_this$socket===void 0?void 0:_this$socket.id),children:[/*#__PURE__*/_jsx(Icon,{name:\"cancel\"}),\"Stop Share\"]}),!this.localStreamToPublish&&!sharer&&!this.playingVBrowser()&&/*#__PURE__*/_jsx(Popup,{content:\"Share a tab or an application.\",trigger:/*#__PURE__*/_jsxs(Button,{fluid:true,className:\"toolButton\",disabled:!this.haveLock(),icon:true,labelPosition:\"left\",color:'instagram',onClick:function onClick(){_this2.setState({isScreenShareModalOpen:true});},children:[/*#__PURE__*/_jsx(Icon,{name:'slideshare'}),\"Screenshare\"]})}),!this.localStreamToPublish&&!sharer&&!this.playingVBrowser()&&/*#__PURE__*/_jsx(Popup,{content:\"Launch a shared virtual browser\",trigger:/*#__PURE__*/_jsxs(Button,{fluid:true,className:\"toolButton\",disabled:!this.haveLock(),icon:true,labelPosition:\"left\",color:\"green\",onClick:function onClick(){_this2.setState({isVBrowserModalOpen:true});},children:[/*#__PURE__*/_jsx(Icon,{name:\"desktop\"}),\"VBrowser\"]})}),this.playingVBrowser()&&/*#__PURE__*/_jsx(Popup,{content:\"Choose the person controlling the VBrowser\",trigger:/*#__PURE__*/_jsx(Dropdown,{icon:\"keyboard\",labeled:true,className:\"icon\",style:{height:'36px'},button:true,value:this.state.controller,placeholder:\"No controller\",clearable:true,onChange:this.changeController,selection:true,disabled:!this.haveLock(),options:this.state.participants.map(function(p){return{text:_this2.state.nameMap[p.id]||p.id,value:p.id};})})}),this.playingVBrowser()&&/*#__PURE__*/_jsx(Dropdown,{icon:\"desktop\",labeled:true,className:\"icon\",style:{height:'36px'},button:true,disabled:!this.haveLock(),value:this.state.vBrowserResolution,onChange:function onChange(_e,data){return _this2.setState({vBrowserResolution:data.value});},selection:true,options:[{text:'1080p (Plus only)',value:'1920x1080@30',disabled:!this.state.isVBrowserLarge},{text:'720p',value:'1280x720@30'},{text:'576p',value:'1024x576@60'},{text:'486p',value:'864x486@60'},{text:'360p',value:'640x360@60'}]}),this.playingVBrowser()&&/*#__PURE__*/_jsxs(Button,{fluid:true,className:\"toolButton\",icon:true,labelPosition:\"left\",color:\"red\",disabled:!this.haveLock(),onClick:this.stopVBrowser,children:[/*#__PURE__*/_jsx(Icon,{name:\"cancel\"}),\"Stop VBrowser\"]}),!this.localStreamToPublish&&!sharer&&!this.playingVBrowser()&&/*#__PURE__*/_jsx(Popup,{content:\"Stream your own video file\",trigger:/*#__PURE__*/_jsxs(Button,{fluid:true,className:\"toolButton\",disabled:!this.haveLock(),icon:true,labelPosition:\"left\",onClick:function onClick(){_this2.setState({isFileShareModalOpen:true});},children:[/*#__PURE__*/_jsx(Icon,{name:\"file\"}),\"File\"]})}),false&&/*#__PURE__*/_jsx(SearchComponent,{setMedia:this.roomSetMedia,playlistAdd:this.roomPlaylistAdd,type:'youtube',streamPath:this.props.streamPath,disabled:!this.haveLock()}),Boolean(this.props.streamPath)&&/*#__PURE__*/_jsx(SearchComponent,{setMedia:this.roomSetMedia,playlistAdd:this.roomPlaylistAdd,type:'stream',streamPath:this.props.streamPath,launchMultiSelect:this.launchMultiSelect,disabled:!this.haveLock()})]}),/*#__PURE__*/_jsx(Separator,{})]}),/*#__PURE__*/_jsx(\"div\",{style:{flexGrow:1},children:/*#__PURE__*/_jsxs(\"div\",{className:styles.playerContainer,children:[(this.state.loading||!this.state.roomMedia||this.state.nonPlayableMedia)&&/*#__PURE__*/_jsxs(\"div\",{id:\"loader\",className:styles.videoContent,style:{display:'flex',alignItems:'center',justifyContent:'center'},children:[this.state.loading&&/*#__PURE__*/_jsx(Dimmer,{active:true,children:/*#__PURE__*/_jsx(Loader,{children:this.playingVBrowser()?'Launching virtual browser. This can take up to a minute.':''})}),!this.state.loading&&!this.state.roomMedia&&/*#__PURE__*/_jsx(Message,{color:\"yellow\",icon:\"hand point up\",header:\"You're not watching anything!\",content:\"Pick something to watch above.\"}),!this.state.loading&&this.state.nonPlayableMedia&&/*#__PURE__*/_jsx(Message,{color:\"red\",icon:\"frown\",header:\"It doesn't look like this is a media file!\",content:\"Maybe you meant to launch a VBrowser if you're trying to visit a web page?\"})]}),/*#__PURE__*/_jsx(\"iframe\",{style:{display:this.usingYoutube()&&!this.state.loading?'block':'none'},title:\"YouTube\",id:\"leftYt\",className:styles.videoContent,allowFullScreen:true,frameBorder:\"0\",allow:\"autoplay\",src:\"https://www.youtube.com/embed/?enablejsapi=1&controls=0&rel=0\"}),this.playingVBrowser()&&this.getVBrowserPass()&&this.getVBrowserHost()?/*#__PURE__*/_jsx(VBrowser,{username:this.socket.id,password:this.getVBrowserPass(),hostname:this.getVBrowserHost(),controlling:this.state.controller===this.socket.id,resolution:this.state.vBrowserResolution,doPlay:this.localPlay,setResolution:function setResolution(data){return _this2.setState({vBrowserResolution:data});}}):/*#__PURE__*/_jsx(\"video\",{style:{display:this.usingNative()&&!this.state.loading||this.state.fullScreen?'block':'none',width:'100%',maxHeight:'calc(100vh - 62px - 36px - 36px - 8px - 41px - 16px)'},id:\"leftVideo\",onEnded:this.onVideoEnded,playsInline:true,onClick:this.roomTogglePlay})]})}),this.state.roomMedia&&controls,Boolean(this.state.total)&&/*#__PURE__*/_jsx(\"div\",{style:{color:'white',textAlign:'center',fontSize:11,fontWeight:700,marginTop:-10},children:Math.min(this.state.downloaded/this.state.total*100,100).toFixed(2)+'% - '+formatSpeed(this.state.speed)+' - '+this.state.connections+' connections'})]}),!isMobile()&&/*#__PURE__*/_jsx(Button,{style:{position:'absolute',top:'50%',right:'calc(0% - 18px)',zIndex:900},circular:true,size:\"mini\",icon:this.state.showRightBar?'angle right':'angle left',onClick:function onClick(){return _this2.setState({showRightBar:!_this2.state.showRightBar});}})]}),rightBar]})})]});}}]);return App;}(React.Component);export{App as default};export var Separator=function Separator(){return/*#__PURE__*/_jsx(\"div\",{style:{height:'4px',flexShrink:0}});};","map":{"version":3,"names":["axios","React","Button","Dimmer","Dropdown","Grid","Icon","Input","Loader","Message","Popup","Menu","Modal","Label","Form","io","formatSpeed","iceServers","isMobile","serverPath","testAutoplay","openFileSelector","getAndSaveClientId","calculateMedian","getUserImage","getColorForString","isYouTube","isMagnet","isHttp","isHls","isScreenShare","isFileShare","isVBrowser","generateName","Chat","TopBar","VBrowser","VideoChat","getCurrentSettings","MultiStreamModal","ComboBox","SearchComponent","Controls","VBrowserModal","SettingsTab","ErrorModal","PasswordModal","ScreenShareModal","FileShareModal","SubtitleModal","HTML","YouTube","styles","window","watchparty","ourStream","undefined","videoRefs","videoPCs","webtorrent","App","state","roomMedia","roomPaused","roomSubtitle","roomLoop","participants","rosterUpdateTS","Number","Date","chat","playlist","tsMap","nameMap","pictureMap","myName","myPicture","loading","scrollTimestamp","unreadCount","fullScreen","controlsTimestamp","watchOptions","isAutoPlayable","downloaded","total","speed","connections","multiStreamSelection","overlayMsg","isErrorAuth","settings","vBrowserResolution","isVBrowserLarge","nonPlayableMedia","currentTab","URLSearchParams","location","search","get","isSubscribeModalOpen","isVBrowserModalOpen","isScreenShareModalOpen","isFileShareModalOpen","isSubtitleModalOpen","roomLock","controller","roomId","savedPasswords","errorMessage","successMessage","warningMessage","isChatDisabled","showRightBar","owner","vanity","password","inviteLink","roomTitle","roomDescription","roomTitleColor","mediaPath","roomPlaybackRate","isLiveHls","socket","mediasoupPubSocket","mediasoupSubSocket","ytDebounce","localStreamToPublish","isLocalStreamAFile","publisherConns","consumerConn","progressUpdater","heartbeat","YouTubeInterface","HTMLInterface","Player","usingYoutube","chatRef","createRef","init","props","urlRoomId","response","data","setState","console","error","join","savedPasswordsString","localStorage","getItem","JSON","parse","e","warn","shard","transports","query","clientId","on","userName","value","updateName","loadSignInData","err","message","reason","setTimeout","success","assign","localPlay","localPause","localSeek","setPlaybackRate","loadSubtitles","currentMedia","video","playingScreenShare","stopPublishingLocalStream","playingFileShare","playingVBrowser","stopVBrowser","paused","subtitle","loop","playbackRate","Boolean","leftVideo","getVideoEl","pauseVideo","stopVideo","clearState","log","getVBrowserHost","setLoadingFalse","isReady","src","time","videoTS","WebTorrent","default","_server","close","destroy","navigator","serviceWorker","register","ready","Promise","resolve","active","createServer","server","add","announce","destroyStoreOnDestroy","maxWebConns","path","storeCacheSlots","strategy","noPeersIntervalTime","torrent","infoHash","files","filtered","filter","f","length","fileIndex","target","launchMultiSelect","map","i","name","url","streamTo","currentTime","MediaSource","Hls","hls","loadSource","attachMedia","once","Events","LEVEL_LOADED","_","details","live","setSrcAndTime","addEventListener","clearInterval","includes","setInterval","fetch","replace","json","client","torrents","downloadSpeed","numPeers","disableChatSound","document","visibilityState","Audio","play","push","msgIndex","findIndex","m","id","msgId","timestamp","msgTimestamp","msg","reactions","user","current","isNearBottom","scrollToBottom","find","hasDuration","leader","getLeaderTime","delta","pbr","toFixed","Math","min","getPlaybackRate","sharer","p","sharerTime","syncSubtitles","setupRTCConnections","process","env","NODE_ENV","from","pc","ice","addIceCandidate","RTCIceCandidate","sdp","type","_sdp","split","line","trim","setRemoteDescription","RTCSessionDescription","createAnswer","answer","isChromium","chrome","setLocalDescription","sendSignalSS","localDescription","handleRoomState","emit","getCurrentTime","resetMultiSelect","loadSettings","firstName","displayName","userImage","updatePicture","updateUid","loadYouTube","tag","createElement","body","append","onYouTubeIframeAPIReady","ytPlayer","YT","events","onReady","onStateChange","PlayerState","CUED","ENDED","onVideoEnded","PLAYING","PAUSED","getInviteLink","origin","setOwner","setVanity","setPassword","setInviteLink","setIsChatDisabled","setRoomTitle","setRoomDescription","setRoomTitleColor","setMediaPath","history","replaceState","setRoomLock","locked","uid","getIdToken","token","haveLock","val","clearChat","startFileShare","useMediaSoup","file","URL","createObjectURL","captureStream","mediasoup","startScreenShare","mediaDevices","getDisplayMedia","height","logicalSurface","audio","autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","stream","publishMediasoup","mediasoupURL","publish","loadDevice","routerRtpCapabilities","Device","device","load","sendRequest","params","producerTransport","createSendTransport","callback","errback","dtlsParameters","then","catch","kind","rtpParameters","transportId","videoTrack","localStream","getVideoTracks","trackParams","track","produce","audioTrack","getAudioTracks","connectSocket","reject","subscribeMediasoup","mediaSoupURL","consumeAndResume","consume","subscribe","consumerTransport","createRecvTransport","transport","trackKind","rtpCapabilities","producerId","codecOptions","consumer","addRemoteTrack","srcObject","addTrack","mediaStream","MediaStream","localSetMute","getTracks","forEach","stop","Object","values","selfId","localTrack","onended","prefix","unprefixed","clientIds","Set","entries","key","has","RTCPeerConnection","onicecandidate","event","candidate","onnegotiationneeded","createOffer","offer","ontrack","streams","startVBrowser","rcToken","options","changeController","_e","to","usingNative","getVBrowserPass","isPauseDisabled","customTime","zeroTime","floor","now","getDuration","Infinity","seekVideo","canAutoplay","playVideo","muted","setMute","refreshControls","localSetVolume","volume","setVolume","localSubtitleModal","roomSetPlaybackRate","rate","roomSetLoop","roomTogglePlay","shouldPlay","roomSeek","rect","getBoundingClientRect","x","clientX","left","max","width","hlsTarget","onFullScreenChange","fullscreenElement","onKeydown","activeElement","tagName","preventDefault","localFullScreen","localToggleMute","bVideoOnly","container","getElementById","requestFullscreen","webkitEnterFullScreen","webkitEnterFullscreen","bChangeElements","exitFullscreen","isMuted","roomSetMedia","roomPlaylistAdd","roomPlaylistMove","index","toIndex","roomPlaylistDelete","setItem","getMediaDisplayName","input","startsWith","magnetParsed","searchParsed","magnetUrl","urlParsed","re","match","exec","nextNum","nextUrl","onfullscreenchange","onkeydown","removeEventListener","prevProps","controls","beta","getVolume","isSubtitled","getTimeRanges","setSubtitleMode","displayRightContent","rightBar","display","flexDirection","fullHeightColumnFullscreen","fullHeightColumn","visibility","marginTop","marginBottom","toString","isSubscriber","justifyContent","getSubtitleMode","position","bottom","right","zIndex","top","transform","streamPath","mobileStack","gap","text","disabled","flexGrow","playerContainer","videoContent","alignItems","maxHeight","color","textAlign","fontSize","fontWeight","Component","Separator","flexShrink"],"sources":["/home/runner/work/watchparty/watchparty/src/components/App/App.tsx"],"sourcesContent":["import type MediasoupClient from 'mediasoup-client';\nimport axios from 'axios';\nimport React from 'react';\nimport {\n  Button,\n  Dimmer,\n  Dropdown,\n  DropdownProps,\n  Grid,\n  Icon,\n  Input,\n  Loader,\n  Message,\n  Popup,\n  Menu,\n  Modal,\n  Label,\n  SemanticCOLORS,\n  Form,\n} from 'semantic-ui-react';\nimport io, { Socket } from 'socket.io-client';\nimport {\n  formatSpeed,\n  iceServers,\n  isMobile,\n  serverPath,\n  testAutoplay,\n  openFileSelector,\n  getAndSaveClientId,\n  calculateMedian,\n  getUserImage,\n  getColorForString,\n  isYouTube,\n  isMagnet,\n  isHttp,\n  isHls,\n  isScreenShare,\n  isFileShare,\n  isVBrowser,\n} from '../../utils';\nimport { generateName } from '../../utils/generateName';\nimport { Chat } from '../Chat';\nimport { TopBar } from '../TopBar';\nimport { VBrowser } from '../VBrowser';\nimport { VideoChat } from '../VideoChat';\nimport { getCurrentSettings } from '../Settings';\nimport { MultiStreamModal } from '../Modal/MultiStreamModal';\nimport { ComboBox } from '../ComboBox/ComboBox';\nimport { SearchComponent } from '../SearchComponent/SearchComponent';\nimport { Controls } from '../Controls/Controls';\nimport { VBrowserModal } from '../Modal/VBrowserModal';\nimport { SettingsTab } from '../Settings/SettingsTab';\nimport { ErrorModal } from '../Modal/ErrorModal';\nimport { PasswordModal } from '../Modal/PasswordModal';\nimport { ScreenShareModal } from '../Modal/ScreenShareModal';\nimport { FileShareModal } from '../Modal/FileShareModal';\nimport firebase from 'firebase/compat/app';\nimport { SubtitleModal } from '../Modal/SubtitleModal';\nimport { HTML } from './HTML';\nimport { YouTube } from './YouTube';\nimport type WebTorrent from 'webtorrent';\nimport styles from './App.module.css';\n\ndeclare global {\n  interface Window {\n    onYouTubeIframeAPIReady: any;\n    YT: YT.JsApi;\n    watchparty: {\n      ourStream: MediaStream | undefined;\n      videoRefs: HTMLVideoElementDict;\n      videoPCs: PCDict;\n      webtorrent: WebTorrent.Instance | null;\n    };\n  }\n}\n\nwindow.watchparty = {\n  ourStream: undefined,\n  videoRefs: {},\n  videoPCs: {},\n  webtorrent: null,\n};\n\ninterface AppProps {\n  vanity?: string;\n  urlRoomId?: string;\n  user?: firebase.User;\n  isSubscriber: boolean;\n  beta: boolean;\n  streamPath: string | undefined;\n}\n\ninterface AppState {\n  state: 'init' | 'starting' | 'connected';\n  roomMedia: string;\n  roomSubtitle: string;\n  roomPaused: boolean;\n  roomLoop: boolean;\n  participants: User[];\n  rosterUpdateTS: Number;\n  chat: ChatMessage[];\n  playlist: PlaylistVideo[];\n  tsMap: NumberDict;\n  nameMap: StringDict;\n  pictureMap: StringDict;\n  myName: string;\n  myPicture: string;\n  loading: boolean;\n  scrollTimestamp: number;\n  unreadCount: number;\n  fullScreen: boolean;\n  controlsTimestamp: number;\n  watchOptions: SearchResult[];\n  isVBrowser: boolean;\n  isAutoPlayable: boolean;\n  downloaded: number;\n  total: number;\n  speed: number;\n  connections: number;\n  multiStreamSelection?: {\n    name: string;\n    url: string;\n    length: number;\n    playFn?: () => void;\n  }[];\n  overlayMsg: string;\n  isErrorAuth: boolean;\n  settings: Settings;\n  vBrowserResolution: string;\n  isVBrowserLarge: boolean;\n  nonPlayableMedia: boolean;\n  currentTab: string;\n  isSubscribeModalOpen: boolean;\n  isVBrowserModalOpen: boolean;\n  isScreenShareModalOpen: boolean;\n  isFileShareModalOpen: boolean;\n  isSubtitleModalOpen: boolean;\n  roomLock: string;\n  controller?: string;\n  savedPasswords: StringDict;\n  roomId: string;\n  errorMessage: string;\n  successMessage: string;\n  warningMessage: string;\n  isChatDisabled: boolean;\n  showRightBar: boolean;\n  owner: string | undefined;\n  vanity: string | undefined;\n  password: string | undefined;\n  inviteLink: string;\n  roomTitle: string | undefined;\n  roomDescription: string | undefined;\n  roomTitleColor: string | undefined;\n  mediaPath: string | undefined;\n  roomPlaybackRate: number;\n  isLiveHls: boolean;\n}\n\nexport default class App extends React.Component<AppProps, AppState> {\n  state: AppState = {\n    state: 'starting',\n    roomMedia: '',\n    roomPaused: false,\n    roomSubtitle: '',\n    roomLoop: false,\n    participants: [],\n    rosterUpdateTS: Number(new Date()),\n    chat: [],\n    playlist: [],\n    tsMap: {},\n    nameMap: {},\n    pictureMap: {},\n    myName: '',\n    myPicture: '',\n    loading: true,\n    scrollTimestamp: 0,\n    unreadCount: 0,\n    fullScreen: false,\n    controlsTimestamp: 0,\n    watchOptions: [],\n    isVBrowser: false,\n    isAutoPlayable: true,\n    downloaded: 0,\n    total: 0,\n    speed: 0,\n    connections: 0,\n    multiStreamSelection: undefined,\n    overlayMsg: '',\n    isErrorAuth: false,\n    settings: {},\n    vBrowserResolution: '1280x720@30',\n    isVBrowserLarge: false,\n    nonPlayableMedia: false,\n    currentTab:\n      new URLSearchParams(window.location.search).get('tab') ?? 'chat',\n    isSubscribeModalOpen: false,\n    isVBrowserModalOpen: false,\n    isScreenShareModalOpen: false,\n    isFileShareModalOpen: false,\n    isSubtitleModalOpen: false,\n    roomLock: '',\n    controller: '',\n    roomId: '',\n    savedPasswords: {},\n    errorMessage: '',\n    successMessage: '',\n    warningMessage: '',\n    isChatDisabled: false,\n    showRightBar: true,\n    owner: undefined,\n    vanity: undefined,\n    password: undefined,\n    inviteLink: '',\n    roomTitle: '',\n    roomDescription: '',\n    roomTitleColor: '',\n    mediaPath: undefined,\n    roomPlaybackRate: 0,\n    isLiveHls: false,\n  };\n  socket: Socket = null as any;\n  mediasoupPubSocket: Socket | null = null;\n  mediasoupSubSocket: Socket | null = null;\n  ytDebounce = true;\n  localStreamToPublish?: MediaStream;\n  isLocalStreamAFile = false;\n  publisherConns: PCDict = {};\n  consumerConn?: RTCPeerConnection;\n  progressUpdater?: number;\n  heartbeat: number | undefined = undefined;\n  YouTubeInterface: YouTube = new YouTube(null);\n  HTMLInterface: HTML = new HTML('leftVideo');\n  Player = () => {\n    if (this.usingYoutube()) {\n      return this.YouTubeInterface;\n    } else {\n      return this.HTMLInterface;\n    }\n  };\n\n  chatRef = React.createRef<Chat>();\n\n  async componentDidMount() {\n    document.onfullscreenchange = this.onFullScreenChange;\n    document.onkeydown = this.onKeydown;\n\n    // Send heartbeat to the server\n    this.heartbeat = window.setInterval(() => {\n      window.fetch(serverPath + '/ping');\n    }, 10 * 60 * 1000);\n\n    const canAutoplay = await testAutoplay();\n    this.setState({ isAutoPlayable: canAutoplay });\n    this.loadSettings();\n    this.loadYouTube();\n    this.init();\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('fullscreenchange', this.onFullScreenChange);\n    document.removeEventListener('keydown', this.onKeydown);\n    window.clearInterval(this.heartbeat);\n  }\n\n  componentDidUpdate(prevProps: AppProps) {\n    if (this.props.user && !prevProps.user) {\n      this.loadSignInData();\n    }\n  }\n\n  init = async () => {\n    let roomId = '/' + this.props.urlRoomId;\n    // if a vanity name, resolve the url to a room id\n    if (this.props.vanity) {\n      try {\n        const response = await axios.get(\n          serverPath + '/resolveRoom/' + this.props.vanity\n        );\n        if (response.data.roomId) {\n          roomId = response.data.roomId;\n        } else {\n          this.setState({ overlayMsg: \"Couldn't load this room.\" });\n        }\n      } catch (e) {\n        console.error(e);\n        this.setState({ overlayMsg: \"Couldn't load this room.\" });\n        return;\n      }\n    }\n    this.setState({ roomId }, () => {\n      this.join(roomId);\n    });\n  };\n\n  join = async (roomId: string) => {\n    let password = '';\n    try {\n      const savedPasswordsString = window.localStorage.getItem(\n        'watchparty-passwords'\n      );\n      const savedPasswords = JSON.parse(savedPasswordsString || '{}');\n      this.setState({ savedPasswords });\n      password = savedPasswords[roomId] || '';\n    } catch (e) {\n      console.warn('[ALERT] Could not parse saved passwords');\n    }\n    const response = await axios.get(serverPath + '/resolveShard' + roomId);\n    const shard = Number(response.data) ?? '';\n    const socket = io(serverPath + roomId, {\n      transports: ['websocket'],\n      query: {\n        clientId: getAndSaveClientId(),\n        password,\n        shard,\n      },\n    });\n    this.socket = socket;\n    socket.on('connect', async () => {\n      this.setState({\n        state: 'connected',\n        overlayMsg: '',\n        errorMessage: '',\n        successMessage: '',\n        warningMessage: '',\n      });\n      // Load username from localstorage\n      let userName = window.localStorage.getItem('watchparty-username');\n      this.updateName(null, { value: userName || (await generateName()) });\n      this.loadSignInData();\n    });\n    socket.on('connect_error', (err: any) => {\n      console.error(err);\n      if (err.message === 'Invalid namespace') {\n        this.setState({ overlayMsg: \"Couldn't load this room.\" });\n      } else if (err.message === 'not authorized') {\n        this.setState({ isErrorAuth: true });\n      } else if (err.message === 'room full') {\n        this.setState({ overlayMsg: 'This room is full.' });\n      }\n    });\n    socket.on('disconnect', (reason) => {\n      if (reason === 'io server disconnect') {\n        // the disconnection was initiated by the server, you need to reconnect manually\n        this.setState({ overlayMsg: 'Disconnected from server.' });\n      } else {\n        // else the socket will automatically try to reconnect\n        // Use the alert pill since it's less disruptive\n        this.setState({ warningMessage: 'Reconnecting...' });\n      }\n    });\n    socket.on('errorMessage', (err: string) => {\n      this.setState({ errorMessage: err });\n      setTimeout(() => {\n        this.setState({ errorMessage: '' });\n      }, 3000);\n    });\n    socket.on('successMessage', (success: string) => {\n      this.setState({ successMessage: success });\n      setTimeout(() => {\n        this.setState({ successMessage: '' });\n      }, 3000);\n    });\n    socket.on('kicked', () => {\n      window.location.assign('/');\n    });\n    socket.on('REC:play', () => {\n      this.localPlay();\n    });\n    socket.on('REC:pause', () => {\n      this.localPause();\n    });\n    socket.on('REC:seek', (data: number) => {\n      this.localSeek(data);\n    });\n    socket.on('REC:playbackRate', (data: number) => {\n      this.setState({ roomPlaybackRate: data });\n      if (data > 0) {\n        this.Player().setPlaybackRate(data);\n      }\n    });\n    socket.on('REC:subtitle', (data: string) => {\n      this.setState({ roomSubtitle: data }, () => {\n        this.Player().loadSubtitles(data);\n      });\n    });\n    socket.on('REC:loop', (data: boolean) => {\n      this.setState({ roomLoop: data });\n    });\n    socket.on('REC:changeController', (data: string) => {\n      this.setState({ controller: data });\n    });\n    socket.on('REC:host', async (data: HostState) => {\n      let currentMedia = data.video || '';\n      if (this.playingScreenShare() && !isScreenShare(currentMedia)) {\n        this.stopPublishingLocalStream();\n      }\n      if (this.playingFileShare() && !isFileShare(currentMedia)) {\n        this.stopPublishingLocalStream();\n      }\n      if (this.playingScreenShare() && isScreenShare(currentMedia)) {\n        // Ignore, it's probably a reconnection\n        return;\n      }\n      if (this.playingFileShare() && isFileShare(currentMedia)) {\n        // Ignore, it's probably a reconnection\n        return;\n      }\n      if (this.playingVBrowser() && !isVBrowser(currentMedia)) {\n        this.stopVBrowser();\n      }\n      this.setState(\n        {\n          roomMedia: currentMedia,\n          roomPaused: data.paused,\n          roomSubtitle: data.subtitle,\n          roomLoop: data.loop,\n          roomPlaybackRate: data.playbackRate,\n          loading: Boolean(data.video),\n          nonPlayableMedia: false,\n          isVBrowserLarge: data.isVBrowserLarge,\n          vBrowserResolution: data.isVBrowserLarge\n            ? '1920x1080@30'\n            : '1280x720@30',\n          controller: data.controller,\n          isLiveHls: false,\n        },\n        async () => {\n          const leftVideo = this.HTMLInterface.getVideoEl();\n\n          // Stop all players\n          // Unless the user is sharing a file, because we play it in leftVideo and capture stream\n          if (!this.isLocalStreamAFile) {\n            this.HTMLInterface.pauseVideo();\n          }\n          this.YouTubeInterface.stopVideo();\n\n          if (!this.isLocalStreamAFile) {\n            this.Player().clearState();\n          }\n          if (data.subtitle) {\n            this.Player().loadSubtitles(data.subtitle);\n          }\n          if (data.playbackRate) {\n            this.Player().setPlaybackRate(data.playbackRate);\n          }\n\n          if (\n            this.playingScreenShare() ||\n            this.playingFileShare() ||\n            this.playingVBrowser()\n          ) {\n            console.log(\n              'exiting REC:host since we are using webRTC (fileshare, screenshare, or vbrowser). Check setupRTCConnections()'\n            );\n            if (!(this.playingVBrowser() && !this.getVBrowserHost())) {\n              // Remove the loader unless we're waiting for a vbrowser\n              this.setLoadingFalse();\n            }\n            return;\n          }\n          if (this.usingYoutube() && !this.YouTubeInterface.isReady()) {\n            console.log(\n              'YT player not ready, onReady callback will retry when it is'\n            );\n            return;\n          }\n          const src = data.video;\n          const time = data.videoTS;\n          if (isMagnet(src)) {\n            // WebTorrent\n            // magnet:?xt=urn:btih:08ada5a7a6183aae1e09d831df6748d566095a10&dn=Sintel&tr=udp%3A%2F%2Fexplodie.org%3A6969&tr=udp%3A%2F%2Ftracker.coppersurfer.tk%3A6969&tr=udp%3A%2F%2Ftracker.empire-js.us%3A1337&tr=udp%3A%2F%2Ftracker.leechers-paradise.org%3A6969&tr=udp%3A%2F%2Ftracker.opentrackr.org%3A1337&tr=wss%3A%2F%2Ftracker.btorrent.xyz&tr=wss%3A%2F%2Ftracker.fastcast.nz&tr=wss%3A%2F%2Ftracker.openwebtorrent.com&ws=https%3A%2F%2Fwebtorrent.io%2Ftorrents%2F&xs=https%3A%2F%2Fwebtorrent.io%2Ftorrents%2Fsintel.torrent\n            // Can't import webtorrent directly yet since it uses importAssertions feature\n            const WebTorrent = //@ts-ignore\n              (await import('webtorrent/dist/webtorrent.min.js')).default;\n            //@ts-ignore\n            window.watchparty.webtorrent?._server?.close();\n            window.watchparty.webtorrent?.destroy();\n            window.watchparty.webtorrent = new WebTorrent();\n            await navigator.serviceWorker?.register('/sw.min.js');\n            const controller = await navigator.serviceWorker.ready;\n            await new Promise((resolve) => setTimeout(resolve, 500));\n            console.log(controller, controller.active?.state);\n            // createServer is only in v2, types are outdated\n            //@ts-ignore\n            const server = await window.watchparty.webtorrent.createServer({\n              controller,\n            });\n            console.log(server);\n            await new Promise((resolve) => setTimeout(resolve, 500));\n            await new Promise((resolve) => {\n              window.watchparty.webtorrent?.add(\n                src,\n                {\n                  announce: [\n                    'wss://tracker.btorrent.xyz',\n                    'wss://tracker.openwebtorrent.com',\n                  ],\n                  destroyStoreOnDestroy: true,\n                  maxWebConns: 4,\n                  path: '/tmp/webtorrent/',\n                  storeCacheSlots: 20,\n                  strategy: 'sequential',\n                  //@ts-ignore\n                  noPeersIntervalTime: 30,\n                },\n                async (torrent: WebTorrent.Torrent) => {\n                  // Got torrent metadata!\n                  console.log('Client is downloading:', torrent.infoHash);\n\n                  // Torrents can contain many files.\n                  const files = torrent.files;\n                  const filtered = files.filter(\n                    (f: WebTorrent.TorrentFile) => f.length >= 10 * 1024 * 1024\n                  );\n                  const fileIndex = new URLSearchParams(src).get(\n                    'fileIndex'\n                  ) as unknown as number;\n                  // Try to find a single large file to play\n                  const target =\n                    files[fileIndex] ??\n                    (filtered.length > 1 ? null : filtered[0]);\n                  if (!target) {\n                    // Open the selector\n                    this.launchMultiSelect(\n                      files.map((f: WebTorrent.TorrentFile, i: number) => ({\n                        name: f.name as string,\n                        url: src + `&fileIndex=${i}`,\n                        length: f.length as number,\n                      }))\n                    );\n                  } else {\n                    //@ts-ignore\n                    target.streamTo(leftVideo);\n                    leftVideo.currentTime = time;\n                  }\n                  resolve(null);\n                }\n              );\n            });\n          } else if (isHls(src) && window.MediaSource) {\n            // Prefer using hls.js if MediaSource Extensions are supported\n            // otherwise fallback to native HLS support using video tag (i.e. iPhones)\n            // https://moctobpltc-i.akamaihd.net/hls/live/571329/eight/playlist.m3u8\n            const Hls = (await import('hls.js')).default;\n            let hls = new Hls();\n            hls.loadSource(src);\n            hls.attachMedia(leftVideo);\n            hls.once(Hls.Events.LEVEL_LOADED, (_, data) => {\n              console.log('isLiveHls', data.details.live);\n              this.setState({ isLiveHls: data.details.live });\n            });\n          } else {\n            await this.Player().setSrcAndTime(src, time);\n          }\n          // Start this video\n          if (!data.paused) {\n            this.localPlay();\n          }\n          // One time, when we're ready to play\n          leftVideo?.addEventListener(\n            'canplay',\n            () => {\n              this.setLoadingFalse();\n              this.localSeek(this.state.isLiveHls ? data.videoTS : undefined);\n              if (data.playbackRate) {\n                // Set playback rate again since it might have been lost\n                console.log('setting playback rate again', data.playbackRate);\n                this.Player().setPlaybackRate(data.playbackRate);\n              }\n            },\n            { once: true }\n          );\n\n          // Progress updater\n          window.clearInterval(this.progressUpdater);\n          this.setState({ downloaded: 0, total: 0, speed: 0 });\n          if (currentMedia.includes('/stream?torrent=magnet')) {\n            this.progressUpdater = window.setInterval(async () => {\n              const response = await window.fetch(\n                currentMedia.replace('/stream', '/progress')\n              );\n              const data = await response.json();\n              this.setState({\n                downloaded: data.downloaded,\n                total: data.total,\n                speed: data.speed,\n                connections: data.connections,\n              });\n            }, 1000);\n          }\n          if (isMagnet(currentMedia)) {\n            this.progressUpdater = window.setInterval(async () => {\n              const client = window.watchparty.webtorrent;\n              if (client) {\n                this.setState({\n                  downloaded: client.torrents[0]?.downloaded,\n                  total: client.torrents[0]?.length,\n                  speed: client.torrents[0]?.downloadSpeed,\n                  connections: client.torrents[0]?.numPeers,\n                });\n              }\n            }, 1000);\n          }\n        }\n      );\n    });\n    socket.on('REC:chat', (data: ChatMessage) => {\n      if (\n        !getCurrentSettings().disableChatSound &&\n        ((document.visibilityState && document.visibilityState !== 'visible') ||\n          this.state.currentTab !== 'chat')\n      ) {\n        new Audio('/clearly.mp3').play();\n      }\n      this.state.chat.push(data);\n      this.setState({\n        chat: this.state.chat,\n        scrollTimestamp: Number(new Date()),\n        unreadCount:\n          this.state.currentTab === 'chat'\n            ? this.state.unreadCount\n            : this.state.unreadCount + 1,\n      });\n    });\n    socket.on('REC:addReaction', (data: Reaction) => {\n      const { chat } = this.state;\n      const msgIndex = chat.findIndex(\n        (m) => m.id === data.msgId && m.timestamp === data.msgTimestamp\n      );\n      if (msgIndex === -1) {\n        return;\n      }\n      const msg = chat[msgIndex];\n      msg.reactions = msg.reactions || {};\n      msg.reactions[data.value] = msg.reactions[data.value] || [];\n      msg.reactions[data.value].push(data.user);\n      this.setState({ chat }, () => {\n        // if we add a reaction to the last message we need to scroll down\n        // or else the reaction icon might be hidden\n        if (\n          msgIndex === chat.length - 1 &&\n          this.chatRef.current?.state.isNearBottom\n        ) {\n          this.chatRef.current?.scrollToBottom();\n        }\n      });\n    });\n    socket.on('REC:removeReaction', (data: Reaction) => {\n      const { chat } = this.state;\n      const msg = chat.find(\n        (m) => m.id === data.msgId && m.timestamp === data.msgTimestamp\n      );\n      if (!msg || !msg.reactions?.[data.value]) {\n        return;\n      }\n      msg.reactions[data.value] = msg.reactions[data.value].filter(\n        (id) => id !== data.user\n      );\n      this.setState({ chat });\n    });\n    socket.on('REC:tsMap', (data: NumberDict) => {\n      this.setState({ tsMap: data }, () => {\n        // Dynamic playback rate based on timestamps\n        // Disable for sharing types where the users can have different timestamps\n        // e.g. screenshare, fileshare, .m3u8 HLS streams\n        // Also not necessary for WebRTC sharing since it should be close to realtime\n        if (\n          !this.state.roomPaused &&\n          !this.state.isLiveHls &&\n          this.hasDuration() &&\n          this.state.roomPlaybackRate === 0\n        ) {\n          const leader = this.getLeaderTime();\n          const delta = leader - data[this.socket.id];\n          // Set leader pbr to 1\n          let pbr = 1;\n          // Add .01 pbr for each 100ms delay\n          if (delta > 0.5) {\n            pbr += Number((delta / 10).toFixed(2));\n            pbr = Math.min(pbr, 1.2);\n          }\n          // console.log(delta, pbr);\n          if (this.Player().getPlaybackRate() !== pbr) {\n            this.Player().setPlaybackRate(pbr);\n          }\n        }\n        if (this.state.roomSubtitle) {\n          const sharer = this.state.participants.find((p) => p.isScreenShare);\n          if (sharer && sharer.id !== this.socket.id) {\n            // Sync only if someone is sharing and it's not us\n            const sharerTime = this.state.tsMap[sharer.id];\n            this.Player().syncSubtitles(sharerTime);\n          }\n        }\n      });\n    });\n    socket.on('REC:nameMap', (data: StringDict) => {\n      this.setState({ nameMap: data });\n    });\n    socket.on('REC:pictureMap', (data: StringDict) => {\n      this.setState({ pictureMap: data });\n    });\n    socket.on('REC:lock', (data: string) => {\n      this.setState({ roomLock: data });\n    });\n    socket.on('roster', (data: User[]) => {\n      this.setState(\n        { participants: data, rosterUpdateTS: Number(new Date()) },\n        () => {\n          this.setupRTCConnections();\n        }\n      );\n    });\n    socket.on('chatinit', (data: ChatMessage[]) => {\n      this.setState({ chat: data, scrollTimestamp: Number(new Date()) });\n    });\n    socket.on('playlist', (data: PlaylistVideo[]) => {\n      this.setState({ playlist: data });\n    });\n    socket.on(\n      'signalSS',\n      async (data: {\n        msg: { ice: any; sdp: any };\n        from: string;\n        sharer: boolean;\n      }) => {\n        process.env.NODE_ENV === 'development' && console.log(data);\n        // Handle messages received from signaling server\n        const msg = data.msg;\n        const from = data.from;\n        // Determine whether the message came from the sharer or the sharee\n        const pc = (\n          data.sharer ? this.consumerConn : this.publisherConns[from]\n        ) as RTCPeerConnection;\n        if (msg.ice !== undefined) {\n          pc.addIceCandidate(new RTCIceCandidate(msg.ice));\n        } else if (msg.sdp && msg.sdp.type === 'offer') {\n          // console.log('offer');\n          // TODO Currently ios/Safari cannot handle this property, so remove it from the offer\n          const _sdp = msg.sdp.sdp\n            .split('\\n')\n            .filter((line: string) => {\n              return line.trim() !== 'a=extmap-allow-mixed';\n            })\n            .join('\\n');\n          msg.sdp.sdp = _sdp;\n          await pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));\n          const answer = await pc.createAnswer();\n          // Allow stereo audio\n          answer.sdp = answer.sdp?.replace(\n            'useinbandfec=1',\n            'useinbandfec=1; stereo=1; maxaveragebitrate=510000'\n          );\n          // console.log(answer.sdp);\n          // Allow multichannel audio if Chromium\n          const isChromium = Boolean((window as any).chrome);\n          if (isChromium) {\n            answer.sdp = answer.sdp\n              ?.replace('opus/48000/2', 'multiopus/48000/6')\n              .replace(\n                'useinbandfec=1',\n                'channel_mapping=0,4,1,2,3,5; num_streams=4; coupled_streams=2;maxaveragebitrate=510000;minptime=10;useinbandfec=1'\n              );\n          }\n          await pc.setLocalDescription(answer);\n          this.sendSignalSS(from, { sdp: pc.localDescription }, !data.sharer);\n        } else if (msg.sdp && msg.sdp.type === 'answer') {\n          pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));\n        }\n      }\n    );\n    socket.on('REC:getRoomState', this.handleRoomState);\n    window.setInterval(() => {\n      if (this.state.roomMedia) {\n        this.socket.emit('CMD:ts', this.Player().getCurrentTime());\n      }\n    }, 1000);\n  };\n\n  launchMultiSelect = (\n    data?: { name: string; url: string; length: number; playFn?: () => void }[]\n  ) => {\n    this.setState({ multiStreamSelection: data });\n  };\n\n  resetMultiSelect = () => {\n    this.setState({ multiStreamSelection: undefined });\n  };\n\n  loadSettings = async () => {\n    // Load settings from localstorage\n    let settings = getCurrentSettings();\n    this.setState({ settings });\n  };\n\n  loadSignInData = async () => {\n    const user = this.props.user;\n    if (user && this.socket) {\n      // NOTE: firebase auth doesn't provide the actual first name data that individual providers (G/FB) do\n      // It's accessible at the time the user logs in but not afterward\n      // If we want accurate surname/given name we'll need to save that somewhere\n      const firstName = user.displayName?.split(' ')[0];\n      if (firstName) {\n        this.updateName(null, { value: firstName });\n      }\n      const userImage = await getUserImage(user);\n      if (userImage) {\n        this.updatePicture(userImage);\n      }\n      this.updateUid(user);\n    }\n  };\n\n  loadYouTube = () => {\n    // This code loads the IFrame Player API code asynchronously.\n    const tag = document.createElement('script');\n    tag.src = 'https://www.youtube.com/iframe_api';\n    document.body.append(tag);\n    window.onYouTubeIframeAPIReady = () => {\n      // Note: this fails silently if the element is not available\n      const ytPlayer = new window.YT.Player('leftYt', {\n        events: {\n          onReady: () => {\n            console.log('yt onReady');\n            this.YouTubeInterface = new YouTube(ytPlayer);\n            this.setState({ loading: false });\n            // We might have failed to play YT originally, ask for the current video again\n            if (this.usingYoutube()) {\n              console.log('requesting host data again after ytReady');\n              this.socket.emit('CMD:askHost');\n            }\n          },\n          onStateChange: (e: any) => {\n            if (\n              this.usingYoutube() &&\n              e.data === window.YT?.PlayerState?.CUED\n            ) {\n              this.setState({ loading: false });\n            }\n            if (\n              this.usingYoutube() &&\n              e.data === window.YT?.PlayerState?.ENDED\n            ) {\n              this.onVideoEnded();\n            }\n            if (\n              this.ytDebounce &&\n              ((e.data === window.YT?.PlayerState?.PLAYING &&\n                this.state.roomPaused) ||\n                (e.data === window.YT?.PlayerState?.PAUSED &&\n                  !this.state.roomPaused))\n            ) {\n              this.ytDebounce = false;\n              if (e.data === window.YT?.PlayerState?.PLAYING) {\n                this.socket.emit('CMD:play');\n                this.localPlay();\n              } else {\n                this.socket.emit('CMD:pause');\n                this.localPause();\n              }\n              window.setTimeout(() => (this.ytDebounce = true), 500);\n            }\n          },\n        },\n      });\n    };\n  };\n\n  // Functions for managing room settings\n  getInviteLink = (vanity: string) => {\n    if (vanity) {\n      return `${window.location.origin}/r/${vanity}`;\n    }\n    return `${window.location.origin}/watch${this.state.roomId}`;\n  };\n\n  handleRoomState = (data: any) => {\n    this.setOwner(data.owner);\n    this.setVanity(data.vanity);\n    this.setPassword(data.password);\n    this.setInviteLink(this.getInviteLink(data.vanity));\n    this.setIsChatDisabled(data.isChatDisabled);\n    this.setRoomTitle(data.roomTitle);\n    this.setRoomDescription(data.roomDescription);\n    this.setRoomTitleColor(data.roomTitleColor);\n    this.setMediaPath(data.mediaPath);\n    window.history.replaceState('', '', this.getInviteLink(data.vanity));\n  };\n\n  setOwner = (owner: string) => {\n    this.setState({ owner });\n  };\n  setVanity = (vanity: string | undefined) => {\n    this.setState({ vanity });\n  };\n  setPassword = (password: string | undefined) => {\n    this.setState({ password });\n  };\n  setInviteLink = (inviteLink: string) => {\n    this.setState({ inviteLink });\n  };\n  setRoomTitle = (roomTitle: string | undefined) => {\n    this.setState({ roomTitle });\n  };\n  setRoomDescription = (roomDescription: string | undefined) => {\n    this.setState({ roomDescription });\n  };\n  setRoomTitleColor = (roomTitleColor: string | undefined) => {\n    this.setState({ roomTitleColor });\n  };\n  setMediaPath = (mediaPath: string | undefined) => {\n    this.setState({ mediaPath });\n  };\n\n  setRoomLock = async (locked: boolean) => {\n    const uid = this.props.user?.uid;\n    const token = await this.props.user?.getIdToken();\n    this.socket.emit('CMD:lock', { uid, token, locked });\n  };\n\n  haveLock = () => {\n    if (!this.state.roomLock) {\n      return true;\n    }\n    return this.props.user?.uid === this.state.roomLock;\n  };\n\n  setIsChatDisabled = (val: boolean) => this.setState({ isChatDisabled: val });\n\n  clearChat = async () => {\n    const uid = this.props.user?.uid;\n    const token = await this.props.user?.getIdToken();\n    this.socket.emit('CMD:deleteChatMessages', { uid, token });\n  };\n\n  startFileShare = async (useMediaSoup: boolean) => {\n    const files = await openFileSelector();\n    if (!files) {\n      return;\n    }\n    const file = files[0];\n    this.Player().clearState();\n    const leftVideo = this.HTMLInterface.getVideoEl();\n    leftVideo.src = URL.createObjectURL(file);\n    leftVideo.play();\n    //@ts-ignore\n    this.localStreamToPublish = leftVideo?.captureStream();\n    this.isLocalStreamAFile = true;\n    if (this.localStreamToPublish) {\n      this.socket.emit('CMD:joinScreenShare', {\n        file: true,\n        mediasoup: useMediaSoup,\n      });\n    }\n  };\n\n  startScreenShare = async (useMediaSoup: boolean) => {\n    if (navigator.mediaDevices.getDisplayMedia) {\n      const stream = await navigator.mediaDevices.getDisplayMedia({\n        //@ts-ignore\n        video: { height: 720, logicalSurface: true },\n        audio: {\n          autoGainControl: false,\n          channelCount: 2,\n          echoCancellation: false,\n          latency: 0,\n          noiseSuppression: false,\n          sampleRate: 48000,\n          sampleSize: 16,\n        },\n      });\n      this.localStreamToPublish = stream;\n      this.isLocalStreamAFile = false;\n      this.socket.emit('CMD:joinScreenShare', {\n        file: false,\n        mediasoup: useMediaSoup,\n      });\n    }\n  };\n\n  // Share the video to mediasoup\n  publishMediasoup = async (mediasoupURL: string) => {\n    const localStream = this.localStreamToPublish;\n    let device: MediasoupClient.types.Device = null as any;\n    let producerTransport: MediasoupClient.types.Transport = null as any;\n\n    // =========== socket.io ==========\n    const connectSocket = (mediasoupURL: string) => {\n      return new Promise<void>((resolve, reject) => {\n        this.mediasoupPubSocket = io(mediasoupURL, {\n          transports: ['websocket'],\n        });\n\n        const socket = this.mediasoupPubSocket;\n        socket?.on('connect', function () {\n          console.log('PUBLISH: connected to socket.io');\n          resolve();\n        });\n        socket?.on('error', function (err) {\n          console.error('PUBLISH: socket.io ERROR:', err);\n          reject(err);\n        });\n      });\n    };\n\n    const sendRequest = (type: string, data: any) => {\n      return new Promise<any>((resolve, reject) => {\n        const socket = this.mediasoupPubSocket;\n        socket?.emit(type, data, (err: any, response: any) => {\n          if (!err) {\n            // Success response, so pass the mediasoup response to the local Room.\n            resolve(response);\n          } else {\n            reject(err);\n          }\n        });\n      });\n    };\n\n    async function publish() {\n      // --- get transport info ---\n      console.log('PUBLISH: --- createProducerTransport --');\n      const params = await sendRequest('createProducerTransport', {});\n      console.log('PUBLISH: transport params:', params);\n      producerTransport = device.createSendTransport(params);\n      console.log('PUBLISH: createSendTransport:', producerTransport);\n\n      // --- join & start publish --\n      producerTransport.on(\n        'connect',\n        async (\n          {\n            dtlsParameters,\n          }: { dtlsParameters: MediasoupClient.types.DtlsParameters },\n          callback: () => void,\n          errback: (error: Error) => void\n        ) => {\n          console.log('PUBLISH: --transport connect');\n          sendRequest('connectProducerTransport', {\n            dtlsParameters: dtlsParameters,\n          })\n            .then(callback)\n            .catch(errback);\n        }\n      );\n\n      producerTransport.on(\n        'produce',\n        async (\n          {\n            kind,\n            rtpParameters,\n          }: {\n            kind: string;\n            rtpParameters: MediasoupClient.types.RtpParameters;\n          },\n          callback: ({ id }: { id: string }) => void,\n          errback: (error: Error) => void\n        ) => {\n          console.log('PUBLISH: --transport produce');\n          try {\n            const { id } = await sendRequest('produce', {\n              transportId: producerTransport.id,\n              kind,\n              rtpParameters,\n            });\n            callback({ id });\n          } catch (err: any) {\n            errback(err);\n          }\n        }\n      );\n\n      // producerTransport.on('connectionstatechange', (state: string) => {\n      //   switch (state) {\n      //     case 'connecting':\n      //       console.log('PUBLISH: connecting');\n      //       break;\n\n      //     case 'connected':\n      //       console.log('PUBLISH: connected');\n      //       break;\n\n      //     case 'failed':\n      //       console.log('PUBLISH: failed');\n      //       producerTransport.close();\n      //       break;\n\n      //     default:\n      //       break;\n      //   }\n      // });\n\n      const videoTrack = localStream?.getVideoTracks()[0];\n      if (videoTrack) {\n        const trackParams = { track: videoTrack };\n        await producerTransport.produce(trackParams);\n      }\n      const audioTrack = localStream?.getAudioTracks()[0];\n      if (audioTrack) {\n        const trackParams = { track: audioTrack };\n        await producerTransport.produce(trackParams);\n      }\n    }\n\n    async function loadDevice(\n      routerRtpCapabilities: MediasoupClient.types.RtpCapabilities\n    ) {\n      const { Device } = await import('mediasoup-client');\n      device = new Device();\n      await device.load({ routerRtpCapabilities });\n    }\n\n    await connectSocket(mediasoupURL);\n    // --- get capabilities --\n    const data = await sendRequest('getRouterRtpCapabilities', {});\n    console.log('PUBLISH: getRouterRtpCapabilities:', data);\n    await loadDevice(data);\n    await publish();\n  };\n\n  // Play the video from MediaSoup\n  subscribeMediasoup = async (mediaSoupURL: string) => {\n    let device: MediasoupClient.types.Device = null as any;\n    let consumerTransport: MediasoupClient.types.Transport = null as any;\n    // =========== socket.io ==========\n\n    const connectSocket = () => {\n      return new Promise<void>((resolve, reject) => {\n        this.mediasoupSubSocket = io(mediaSoupURL, {\n          transports: ['websocket'],\n        });\n        const socket = this.mediasoupSubSocket;\n        socket?.on('connect', function () {\n          console.log('SUBSCRIBE: connected to socket.io');\n          resolve();\n        });\n        socket?.on('error', function (err) {\n          console.error('SUBSCRIBE: socket.io ERROR:', err);\n          reject(err);\n        });\n        socket?.on('newProducer', async function (message) {\n          console.log('SUBSCRIBE: socket.io newProducer:', message);\n          if (consumerTransport) {\n            // start consume\n            if (message.kind === 'video') {\n              await consumeAndResume(message.kind);\n            } else if (message.kind === 'audio') {\n              await consumeAndResume(message.kind);\n            }\n          }\n        });\n\n        // socket?.on('producerClosed', function (message) {\n        //   console.log('socket.io producerClosed:', message);\n        //   const localId = message.localId;\n        //   const remoteId = message.remoteId;\n        //   const kind = message.kind;\n        //   if (kind === 'video') {\n        //     if (videoConsumer) {\n        //       videoConsumer.close();\n        //       videoConsumer = null;\n        //     }\n        //   } else if (kind === 'audio') {\n        //     if (audioConsumer) {\n        //       audioConsumer.close();\n        //       audioConsumer = null;\n        //     }\n        //   }\n        // });\n      });\n    };\n\n    const sendRequest = (type: string, data: any) => {\n      return new Promise<any>((resolve, reject) => {\n        const socket = this.mediasoupSubSocket;\n        socket?.emit(type, data, (err: Error, response: any) => {\n          if (!err) {\n            // Success response, so pass the mediasoup response to the local Room.\n            resolve(response);\n          } else {\n            reject(err);\n          }\n        });\n      });\n    };\n\n    // =========== media handling ==========\n    const addRemoteTrack = (track: MediaStreamTrack) => {\n      let video = this.HTMLInterface.getVideoEl();\n      if (video.srcObject) {\n        // Track already exists, add it\n        (video.srcObject as MediaStream).addTrack(track);\n      } else {\n        const mediaStream = new MediaStream();\n        mediaStream.addTrack(track);\n        video.srcObject = mediaStream;\n      }\n      this.localPlay();\n    };\n\n    async function consumeAndResume(kind: string) {\n      const consumer = await consume(consumerTransport, kind);\n      if (consumer) {\n        console.log('SUBSCRIBE: -- track exist, consumer ready. kind=' + kind);\n        if (kind === 'video') {\n          console.log('SUBSCRIBE: -- resume kind=' + kind);\n          sendRequest('resume', { kind: kind })\n            .then(() => {\n              console.log('SUBSCRIBE: resume OK');\n              return consumer;\n            })\n            .catch((err) => {\n              console.error('SUBSCRIBE: resume ERROR:', err);\n              return consumer;\n            });\n        } else {\n          console.log('SUBSCRIBE: -- do not resume kind=' + kind);\n        }\n      } else {\n        console.log('SUBSCRIBE: -- no consumer yet. kind=' + kind);\n        return null;\n      }\n    }\n\n    async function loadDevice(\n      routerRtpCapabilities: MediasoupClient.types.RtpCapabilities\n    ) {\n      try {\n        const { Device } = await import('mediasoup-client');\n        device = new Device();\n        await device.load({ routerRtpCapabilities });\n      } catch (error: any) {\n        if (error.name === 'UnsupportedError') {\n          console.error('browser not supported');\n        }\n      }\n    }\n\n    async function consume(\n      transport: MediasoupClient.types.Transport,\n      trackKind: string\n    ) {\n      console.log('SUBSCRIBE: --start of consume --kind=' + trackKind);\n      const { rtpCapabilities } = device;\n      const data = await sendRequest('consume', {\n        rtpCapabilities: rtpCapabilities,\n        kind: trackKind,\n      }).catch((err) => {\n        console.error('SUBSCRIBE: ERROR:', err);\n      });\n      const { producerId, id, kind, rtpParameters } = data;\n\n      if (producerId) {\n        let codecOptions = {};\n        const consumer = await transport.consume({\n          id,\n          producerId,\n          kind,\n          rtpParameters,\n          //@ts-ignore\n          codecOptions,\n        });\n\n        addRemoteTrack(consumer.track);\n        console.log('SUBSCRIBE: --end of consume');\n        return consumer;\n      } else {\n        console.warn('SUBSCRIBE: ---remote producer NOT READY');\n        return null;\n      }\n    }\n\n    async function subscribe() {\n      console.log('SUBSCRIBE: ---createConsumerTransport --');\n      const params = await sendRequest('createConsumerTransport', {});\n      console.log('SUBSCRIBE: transport params:', params);\n      consumerTransport = device.createRecvTransport(params);\n      console.log('SUBSCRIBE: createConsumerTransport:', consumerTransport);\n\n      // --- join & start watching\n      consumerTransport.on(\n        'connect',\n        async (\n          {\n            dtlsParameters,\n          }: { dtlsParameters: MediasoupClient.types.DtlsParameters },\n          callback: () => void,\n          errback: (err: Error) => void\n        ) => {\n          console.log('SUBSCRIBE: ---consumer transport connect');\n          sendRequest('connectConsumerTransport', {\n            dtlsParameters: dtlsParameters,\n          })\n            .then(callback)\n            .catch(errback);\n        }\n      );\n\n      // consumerTransport.on('connectionstatechange', (state: string) => {\n      //   switch (state) {\n      //     case 'connecting':\n      //       console.log('SUBSCRIBE: connecting');\n      //       break;\n\n      //     case 'connected':\n      //       console.log('SUBSCRIBE: connected');\n      //       break;\n\n      //     case 'failed':\n      //       console.log('SUBSCRIBE: failed');\n      //       consumerTransport.close();\n      //       break;\n\n      //     default:\n      //       break;\n      //   }\n      // });\n\n      await consumeAndResume('video');\n      await consumeAndResume('audio');\n    }\n\n    // Clear the srcobject so we load our stream when received\n    const leftVideo = this.HTMLInterface.getVideoEl();\n    leftVideo.srcObject = null;\n    await connectSocket();\n    // --- get capabilities --\n    const data = await sendRequest('getRouterRtpCapabilities', {});\n    console.log('getRouterRtpCapabilities:', data);\n    await loadDevice(data);\n    await subscribe();\n  };\n\n  stopPublishingLocalStream = async () => {\n    if (this.localStreamToPublish) {\n      this.socket.emit('CMD:leaveScreenShare');\n      // We don't actually need to unmute if it's a fileshare but this is fine\n      this.localSetMute(false);\n    }\n    this.localStreamToPublish &&\n      this.localStreamToPublish.getTracks().forEach((track) => {\n        track.stop();\n      });\n    this.localStreamToPublish = undefined;\n    if (this.consumerConn) {\n      this.consumerConn.close();\n      this.consumerConn = undefined;\n    }\n    Object.values(this.publisherConns).forEach((pc) => {\n      pc.close();\n    });\n    this.publisherConns = {};\n    this.isLocalStreamAFile = false;\n    if (this.mediasoupPubSocket) {\n      this.mediasoupPubSocket.close();\n      this.mediasoupPubSocket = null;\n    }\n    if (this.mediasoupSubSocket) {\n      this.mediasoupSubSocket.close();\n      this.mediasoupSubSocket = null;\n    }\n  };\n\n  setupRTCConnections = async () => {\n    if (!this.playingScreenShare() && !this.playingFileShare()) {\n      return;\n    }\n    const sharer = this.state.participants.find((p) => p.isScreenShare);\n    const selfId = getAndSaveClientId();\n    const localTrack = this.localStreamToPublish?.getVideoTracks()[0];\n    if (localTrack && !localTrack.onended) {\n      // Stop sharing if the local stream stops\n      localTrack.onended = () => this.stopPublishingLocalStream();\n    }\n    if (this.state.roomMedia.includes('@')) {\n      let prefix = 'screenshare://';\n      if (this.playingFileShare()) {\n        prefix = 'fileshare://';\n      }\n      const unprefixed = this.state.roomMedia.replace(prefix, '');\n      const mediasoupURL = unprefixed.split('@')[1];\n      if (sharer?.clientId === selfId && this.mediasoupPubSocket == null) {\n        await this.publishMediasoup(mediasoupURL);\n      }\n      // If we're not sharing a file, also start watching\n      // avoid duplicate watching if the socket already exists\n      if (!this.isLocalStreamAFile && this.mediasoupSubSocket == null) {\n        await this.subscribeMediasoup(mediasoupURL);\n      }\n      return;\n    }\n\n    // We're the sharer, create a connection to each other member\n    if (sharer?.clientId === selfId) {\n      // Delete and close any connections that aren't in the current member list (maybe someone disconnected)\n      // This allows them to rejoin later\n      const clientIds = new Set(this.state.participants.map((p) => p.clientId));\n      Object.entries(this.publisherConns).forEach(([key, value]) => {\n        if (!clientIds.has(key)) {\n          value.close();\n          delete this.publisherConns[key];\n        }\n      });\n\n      this.state.participants.forEach((user) => {\n        const id = user.clientId;\n        if (id === selfId && this.isLocalStreamAFile) {\n          // Don't set up a connection to ourselves if sharing file\n          return;\n        }\n        if (!this.publisherConns[id]) {\n          // Set up the RTCPeerConnection for sharing media to each member\n          const pc = new RTCPeerConnection({ iceServers: iceServers() });\n          this.publisherConns[id] = pc;\n          this.localStreamToPublish?.getTracks().forEach((track) => {\n            if (this.localStreamToPublish != null) {\n              pc.addTrack(track, this.localStreamToPublish);\n            }\n          });\n          pc.onicecandidate = (event) => {\n            // We generated an ICE candidate, send it to peer\n            if (event.candidate) {\n              this.sendSignalSS(id, { ice: event.candidate }, true);\n            }\n          };\n          pc.onnegotiationneeded = async () => {\n            // Start connection for peer's video\n            const offer = await pc.createOffer();\n            await pc.setLocalDescription(offer);\n            this.sendSignalSS(id, { sdp: pc.localDescription }, true);\n          };\n        }\n      });\n    }\n    // We're a watcher, establish connection to sharer\n    // If screensharing, sharer also does this\n    // If filesharing, sharer does not do this since we use leftVideo\n    if (sharer && !this.consumerConn && !this.isLocalStreamAFile) {\n      const pc = new RTCPeerConnection({ iceServers: iceServers() });\n      this.consumerConn = pc;\n      pc.onicecandidate = (event) => {\n        // We generated an ICE candidate, send it to sharer\n        if (event.candidate) {\n          this.sendSignalSS(sharer.clientId, { ice: event.candidate });\n        }\n      };\n      pc.ontrack = (event: RTCTrackEvent) => {\n        // Mount the stream from sharer\n        // console.log(stream);\n        const leftVideo = this.HTMLInterface.getVideoEl();\n        if (leftVideo) {\n          leftVideo.src = '';\n          leftVideo.srcObject = event.streams[0];\n          this.localPlay();\n        }\n      };\n    }\n  };\n\n  startVBrowser = async (rcToken: string, options: { size: string }) => {\n    // user.uid is the public user identifier\n    // user.getIdToken() is the secret access token we can send to the server to prove identity\n    const user = this.props.user;\n    const uid = user?.uid;\n    const token = await user?.getIdToken();\n    this.socket.emit('CMD:startVBrowser', { options, uid, token, rcToken });\n  };\n\n  stopVBrowser = async () => {\n    this.socket.emit('CMD:stopVBrowser');\n  };\n\n  changeController = async (_e: any, data: DropdownProps) => {\n    // console.log(data);\n    this.socket.emit('CMD:changeController', data.value);\n  };\n\n  sendSignalSS = async (to: string, data: any, sharer?: boolean) => {\n    // console.log('sendSS', to, data);\n    this.socket.emit('signalSS', { to, msg: data, sharer });\n  };\n\n  usingYoutube = () => {\n    return isYouTube(this.state.roomMedia);\n  };\n\n  usingNative = () => {\n    // Anything that uses HTML Video (e.g. not YouTube, Vimeo, or other embedded JS player)\n    return !this.usingYoutube();\n  };\n\n  hasDuration = () => {\n    // Youtube, link, or magnet, etc. Has a defined runtime (not WebRTC)\n    return isHttp(this.state.roomMedia) || isMagnet(this.state.roomMedia);\n  };\n\n  playingScreenShare = () => {\n    return isScreenShare(this.state.roomMedia);\n  };\n\n  playingFileShare = () => {\n    return isFileShare(this.state.roomMedia);\n  };\n\n  playingVBrowser = () => {\n    return isVBrowser(this.state.roomMedia);\n  };\n\n  getVBrowserPass = () => {\n    return this.state.roomMedia.replace('vbrowser://', '').split('@')[0];\n  };\n\n  getVBrowserHost = () => {\n    return this.state.roomMedia.replace('vbrowser://', '').split('@')[1];\n  };\n\n  isPauseDisabled = () => {\n    return this.playingScreenShare() || this.playingVBrowser();\n  };\n\n  localSeek = (customTime?: number) => {\n    // Jump to the leader's position, or a custom one\n    // for HLS the leader is the live stream position\n    let target = customTime ?? this.getLeaderTime();\n    if (this.state.isLiveHls) {\n      console.log('syncing self for livehls');\n      if (customTime) {\n        // Translate the time back to video time\n        // TODO Safari reports the duration as Infinity, so keep track of our duration using the max of our current timestamp\n        const zeroTime =\n          Math.floor(Date.now() / 1000) - this.HTMLInterface.getDuration();\n        // Cap the time to the leadertime so we don't try to seek too close to edge\n        target = Math.min(customTime - zeroTime, this.getLeaderTime());\n      } else {\n        target = this.getLeaderTime();\n      }\n    }\n    if (target >= 0 && target < Infinity) {\n      console.log('syncing self to leader or custom:', target);\n      this.Player().seekVideo(target);\n    }\n  };\n\n  localPlay = async () => {\n    if (!this.state.roomMedia) {\n      return;\n    }\n    const canAutoplay = this.state.isAutoPlayable || (await testAutoplay());\n    this.setState(\n      { roomPaused: false, isAutoPlayable: canAutoplay },\n      async () => {\n        if (\n          !this.state.isAutoPlayable ||\n          (this.localStreamToPublish && !this.isLocalStreamAFile)\n        ) {\n          console.log('auto-muting to allow autoplay or screenshare host');\n          this.localSetMute(true);\n        } else {\n          this.localSetMute(false);\n        }\n        try {\n          await this.Player().playVideo();\n        } catch (e: any) {\n          console.warn(e, e.name);\n          if (e.name === 'NotSupportedError' && this.usingNative()) {\n            this.setState({ loading: false, nonPlayableMedia: true });\n          }\n        }\n      }\n    );\n  };\n\n  localPause = () => {\n    this.setState({ roomPaused: true }, async () => {\n      this.Player().pauseVideo();\n    });\n  };\n\n  localSetMute = (muted: boolean) => {\n    this.Player().setMute(muted);\n    this.refreshControls();\n  };\n\n  localSetVolume = (volume: number) => {\n    this.Player().setVolume(volume);\n    this.refreshControls();\n  };\n\n  localSubtitleModal = () => {\n    // Native player uses subtitle modal.\n    if (this.usingNative()) {\n      this.setState({ isSubtitleModalOpen: true });\n    }\n  };\n\n  roomSetPlaybackRate = (rate: number) => {\n    // emit an event to the server\n    this.socket.emit('CMD:playbackRate', rate);\n  };\n\n  roomSetLoop = (loop: boolean) => {\n    this.socket.emit('CMD:loop', loop);\n  };\n\n  roomTogglePlay = () => {\n    if (!this.haveLock()) {\n      return;\n    }\n    if (this.isPauseDisabled()) {\n      return;\n    }\n    const shouldPlay = this.Player().shouldPlay();\n    if (shouldPlay) {\n      this.socket.emit('CMD:play');\n      this.localPlay();\n    } else {\n      this.socket.emit('CMD:pause');\n      this.localPause();\n    }\n  };\n\n  roomSeek = (e: any, time: number) => {\n    let target = time;\n    // Read the time from the click event if it exists\n    if (e) {\n      const rect = e.target.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const max = rect.width;\n      target = (x / max) * this.Player().getDuration();\n    }\n    target = Math.max(target, 0);\n    this.Player().seekVideo(target);\n    const hlsTarget =\n      Math.floor(Date.now() / 1000) - this.HTMLInterface.getDuration() + target;\n    this.socket.emit('CMD:seek', this.state.isLiveHls ? hlsTarget : target);\n  };\n\n  onFullScreenChange = () => {\n    this.setState({ fullScreen: Boolean(document.fullscreenElement) });\n  };\n\n  onKeydown = (e: any) => {\n    if (!document.activeElement || document.activeElement.tagName === 'BODY') {\n      if (e.key === ' ') {\n        e.preventDefault();\n        this.roomTogglePlay();\n      } else if (e.key === 'ArrowRight') {\n        this.roomSeek(null, this.Player().getCurrentTime() + 15);\n      } else if (e.key === 'ArrowLeft') {\n        this.roomSeek(null, this.Player().getCurrentTime() - 15);\n      } else if (e.key === 't') {\n        this.localFullScreen(false);\n      } else if (e.key === 'f') {\n        this.localFullScreen(true);\n      } else if (e.key === 'm') {\n        this.localToggleMute();\n      }\n    }\n  };\n\n  localFullScreen = async (bVideoOnly: boolean) => {\n    let container = document.getElementById('theaterContainer') as HTMLElement;\n    if (bVideoOnly || isMobile()) {\n      if (this.playingVBrowser() && !isMobile()) {\n        // Can't really control the VBrowser on mobile anyway, so just fullscreen the video\n        // https://github.com/howardchung/watchparty/issues/208\n        container = document.getElementById('leftVideoParent') as HTMLElement;\n      } else {\n        container = this.Player().getVideoEl();\n      }\n    }\n    if (\n      !container.requestFullscreen &&\n      (container as any).webkitEnterFullScreen\n    ) {\n      // e.g. iPhone doesn't allow requestFullscreen\n      (container as any).webkitEnterFullscreen();\n      return;\n    }\n    if (!document.fullscreenElement) {\n      await container.requestFullscreen();\n      return;\n    }\n    const bChangeElements = document.fullscreenElement !== container;\n    await document.exitFullscreen();\n    if (bChangeElements) {\n      await container.requestFullscreen();\n    }\n  };\n\n  localToggleMute = () => {\n    this.localSetMute(!this.Player().isMuted());\n  };\n\n  roomSetMedia = (_e: any, data: DropdownProps) => {\n    this.socket.emit('CMD:host', data.value);\n  };\n\n  roomPlaylistAdd = (_e: any, data: DropdownProps) => {\n    this.socket.emit('CMD:playlistAdd', data.value);\n  };\n\n  roomPlaylistMove = (index: number, toIndex: number) => {\n    this.socket.emit('CMD:playlistMove', { index, toIndex });\n  };\n\n  roomPlaylistDelete = (index: number) => {\n    this.socket.emit('CMD:playlistDelete', index);\n  };\n\n  updateName = (_e: any, data: { value: string }) => {\n    this.setState({ myName: data.value });\n    this.socket.emit('CMD:name', data.value);\n    window.localStorage.setItem('watchparty-username', data.value);\n  };\n\n  updatePicture = (url: string) => {\n    this.setState({ myPicture: url });\n    this.socket.emit('CMD:picture', url);\n  };\n\n  updateUid = async (user: firebase.User) => {\n    const uid = user.uid;\n    const token = await user.getIdToken();\n    this.socket.emit('CMD:uid', { uid, token });\n  };\n\n  getMediaDisplayName = (input: string) => {\n    if (!input) {\n      return '';\n    }\n    // Show the whole URL for youtube\n    if (this.usingYoutube()) {\n      return input;\n    }\n    if (input.startsWith('screenshare://')) {\n      const sharer = this.state.participants.find((user) => user.isScreenShare);\n      return this.state.nameMap[sharer?.id ?? ''] + \"'s screen\";\n    }\n    if (input.startsWith('fileshare://')) {\n      const sharer = this.state.participants.find((user) => user.isScreenShare);\n      return this.state.nameMap[sharer?.id ?? ''] + \"'s file\";\n    }\n    if (input.startsWith('vbrowser://')) {\n      return 'Virtual Browser' + (this.state.isVBrowserLarge ? '+' : '');\n    }\n    if (isMagnet(input)) {\n      const magnetParsed = new URLSearchParams(input);\n      const index = magnetParsed.get('fileIndex');\n      return magnetParsed.get('dn') + (index != null ? ` (file ${index})` : '');\n    }\n    if (input.includes('/stream?torrent=magnet')) {\n      const search = new URL(input).search;\n      const searchParsed = new URLSearchParams(search);\n      const magnetUrl = searchParsed.get('torrent') ?? '';\n      const magnetParsed = new URLSearchParams(magnetUrl);\n      const index = searchParsed.get('fileIndex');\n      return magnetParsed.get('dn') + (index != null ? ` (file ${index})` : '');\n    }\n    if (input.includes('/proxy')) {\n      const urlParsed = new URLSearchParams(input);\n      const displayName = urlParsed.get('displayName');\n      if (displayName) {\n        return displayName;\n      }\n    }\n    return input;\n  };\n\n  setLoadingFalse = () => {\n    this.setState({ loading: false });\n  };\n\n  getLeaderTime = () => {\n    if (this.state.isLiveHls) {\n      // Pick a time near the end of the livestream\n      return this.HTMLInterface.getDuration() - 5;\n    }\n    if (this.state.participants.length > 2) {\n      return calculateMedian(Object.values(this.state.tsMap));\n    }\n    return Math.max(...Object.values(this.state.tsMap));\n  };\n\n  onVideoEnded = () => {\n    this.localPause();\n    // check if looping is on, if so set time back to 0 and restart\n    if (this.state.roomLoop) {\n      this.localSeek(0);\n      this.localPlay();\n      return;\n    }\n    if (this.state.playlist.length) {\n      this.socket.emit('CMD:playlistNext', this.state.roomMedia);\n      return;\n    }\n    // Play next fileIndex\n    const re = /&fileIndex=(\\d+)$/;\n    const match = re.exec(this.state.roomMedia);\n    if (match) {\n      const fileIndex = match[1];\n      const nextNum = Number(fileIndex) + 1;\n      const nextUrl = this.state.roomMedia.replace(\n        /&fileIndex=(\\d+)$/,\n        `&fileIndex=${nextNum}`\n      );\n      this.roomSetMedia(null, { value: nextUrl });\n    }\n  };\n\n  refreshControls = () => {\n    this.setState({ controlsTimestamp: Number(new Date()) });\n  };\n\n  render() {\n    const sharer = this.state.participants.find((p) => p.isScreenShare);\n    const controls = (\n      <Controls\n        key={this.state.controlsTimestamp}\n        beta={this.props.beta}\n        paused={this.state.roomPaused}\n        roomPlaybackRate={this.state.roomPlaybackRate}\n        isLiveHls={this.state.isLiveHls}\n        muted={this.Player().isMuted()}\n        volume={this.Player().getVolume()}\n        subtitled={this.Player().isSubtitled()}\n        currentTime={this.Player().getCurrentTime()}\n        duration={this.Player().getDuration()}\n        disabled={!this.haveLock()}\n        leaderTime={this.hasDuration() ? this.getLeaderTime() : undefined}\n        isPauseDisabled={this.isPauseDisabled()}\n        playbackRate={this.Player().getPlaybackRate()}\n        isYouTube={this.usingYoutube()}\n        timeRanges={this.Player().getTimeRanges()}\n        loop={this.state.roomLoop}\n        roomSetLoop={this.roomSetLoop}\n        roomTogglePlay={this.roomTogglePlay}\n        roomSeek={this.roomSeek}\n        roomSetPlaybackRate={this.roomSetPlaybackRate}\n        localFullScreen={this.localFullScreen}\n        localToggleMute={this.localToggleMute}\n        localSubtitleModal={this.localSubtitleModal}\n        localSetVolume={this.localSetVolume}\n        localSeek={this.localSeek}\n        localSetSubtitleMode={this.Player().setSubtitleMode}\n      />\n    );\n    const displayRightContent =\n      this.state.showRightBar || this.state.fullScreen;\n    const rightBar = (\n      <Grid.Column\n        width={displayRightContent ? 4 : 1}\n        style={{ display: 'flex', flexDirection: 'column' }}\n        className={`${\n          this.state.fullScreen\n            ? styles.fullHeightColumnFullscreen\n            : styles.fullHeightColumn\n        }`}\n      >\n        <Form autoComplete=\"off\">\n          <Input\n            inverted\n            fluid\n            label={'My name is:'}\n            value={this.state.myName}\n            onChange={this.updateName}\n            style={{ visibility: displayRightContent ? '' : 'hidden' }}\n            icon={\n              <Icon\n                onClick={async () =>\n                  this.updateName(null, { value: await generateName() })\n                }\n                name=\"random\"\n                inverted\n                circular\n                link\n                title=\"Generate a random name\"\n              />\n            }\n          />\n        </Form>\n        {\n          <Menu\n            inverted\n            widths={3}\n            style={{\n              marginTop: '4px',\n              marginBottom: '4px',\n              visibility: displayRightContent ? '' : 'hidden',\n              height: '40px',\n            }}\n          >\n            <Menu.Item\n              name=\"chat\"\n              active={this.state.currentTab === 'chat'}\n              onClick={() => {\n                this.setState({ currentTab: 'chat', unreadCount: 0 });\n              }}\n              as=\"a\"\n            >\n              Chat\n              {this.state.unreadCount > 0 && (\n                <Label circular color=\"red\">\n                  {this.state.unreadCount}\n                </Label>\n              )}\n            </Menu.Item>\n            <Menu.Item\n              name=\"people\"\n              active={this.state.currentTab === 'people'}\n              onClick={() => this.setState({ currentTab: 'people' })}\n              as=\"a\"\n            >\n              People\n              <Label\n                circular\n                color={\n                  getColorForString(\n                    this.state.participants.length.toString()\n                  ) as SemanticCOLORS\n                }\n              >\n                {this.state.participants.length}\n              </Label>\n            </Menu.Item>\n            <Menu.Item\n              name=\"settings\"\n              active={this.state.currentTab === 'settings'}\n              onClick={() => this.setState({ currentTab: 'settings' })}\n              as=\"a\"\n            >\n              {/* <Icon name=\"setting\" /> */}\n              Settings\n            </Menu.Item>\n          </Menu>\n        }\n        <Chat\n          chat={this.state.chat}\n          nameMap={this.state.nameMap}\n          pictureMap={this.state.pictureMap}\n          socket={this.socket}\n          scrollTimestamp={this.state.scrollTimestamp}\n          getMediaDisplayName={this.getMediaDisplayName}\n          hide={this.state.currentTab !== 'chat' || !displayRightContent}\n          isChatDisabled={this.state.isChatDisabled}\n          owner={this.state.owner}\n          user={this.props.user}\n          ref={this.chatRef}\n          isLiveHls={this.state.isLiveHls}\n        />\n        {this.state.state === 'connected' && (\n          <VideoChat\n            socket={this.socket}\n            participants={this.state.participants}\n            nameMap={this.state.nameMap}\n            pictureMap={this.state.pictureMap}\n            tsMap={this.state.tsMap}\n            rosterUpdateTS={this.state.rosterUpdateTS}\n            hide={this.state.currentTab !== 'people' || !displayRightContent}\n            owner={this.state.owner}\n            user={this.props.user}\n            beta={this.props.beta}\n            getLeaderTime={this.getLeaderTime}\n          />\n        )}\n        <SettingsTab\n          hide={this.state.currentTab !== 'settings' || !displayRightContent}\n          user={this.props.user}\n          roomLock={this.state.roomLock}\n          setRoomLock={this.setRoomLock}\n          socket={this.socket}\n          isSubscriber={this.props.isSubscriber}\n          roomId={this.state.roomId}\n          isChatDisabled={this.state.isChatDisabled}\n          setIsChatDisabled={this.setIsChatDisabled}\n          owner={this.state.owner}\n          setOwner={this.setOwner}\n          vanity={this.state.vanity}\n          setVanity={this.setVanity}\n          inviteLink={this.state.inviteLink}\n          password={this.state.password}\n          setPassword={this.setPassword}\n          clearChat={this.clearChat}\n          roomTitle={this.state.roomTitle}\n          setRoomTitle={this.setRoomTitle}\n          roomDescription={this.state.roomDescription}\n          setRoomDescription={this.setRoomDescription}\n          roomTitleColor={this.state.roomTitleColor}\n          setRoomTitleColor={this.setRoomTitleColor}\n          mediaPath={this.state.mediaPath}\n          setMediaPath={this.setMediaPath}\n        />\n      </Grid.Column>\n    );\n    return (\n      <React.Fragment>\n        {!this.state.isAutoPlayable && (\n          <Modal inverted=\"true\" basic open>\n            <div style={{ display: 'flex', justifyContent: 'center' }}>\n              <Button\n                primary\n                size=\"large\"\n                onClick={() => {\n                  this.setState({ isAutoPlayable: true });\n                  this.localSetMute(false);\n                  this.localSetVolume(1);\n                }}\n                icon\n                labelPosition=\"left\"\n              >\n                <Icon name=\"volume up\" />\n                Click to unmute\n              </Button>\n            </div>\n          </Modal>\n        )}\n        {this.state.multiStreamSelection && (\n          <MultiStreamModal\n            streams={this.state.multiStreamSelection}\n            setMedia={this.roomSetMedia}\n            resetMultiSelect={this.resetMultiSelect}\n          />\n        )}\n        {this.state.isVBrowserModalOpen && (\n          <VBrowserModal\n            isSubscriber={this.props.isSubscriber}\n            closeModal={() => this.setState({ isVBrowserModalOpen: false })}\n            startVBrowser={this.startVBrowser}\n            user={this.props.user}\n            beta={this.props.beta}\n          />\n        )}\n        {this.state.isScreenShareModalOpen && (\n          <ScreenShareModal\n            beta={this.props.beta}\n            isSubscriber={this.props.isSubscriber}\n            user={this.props.user}\n            closeModal={() => this.setState({ isScreenShareModalOpen: false })}\n            startScreenShare={this.startScreenShare}\n          />\n        )}\n        {this.state.isFileShareModalOpen && (\n          <FileShareModal\n            beta={this.props.beta}\n            isSubscriber={this.props.isSubscriber}\n            user={this.props.user}\n            closeModal={() => this.setState({ isFileShareModalOpen: false })}\n            startFileShare={this.startFileShare}\n          />\n        )}\n        {this.state.isSubtitleModalOpen && (\n          <SubtitleModal\n            closeModal={() => this.setState({ isSubtitleModalOpen: false })}\n            socket={this.socket}\n            roomSubtitle={this.state.roomSubtitle}\n            roomMedia={this.state.roomMedia}\n            haveLock={this.haveLock}\n            getMediaDisplayName={this.getMediaDisplayName}\n            beta={this.props.beta}\n            setSubtitleMode={this.Player().setSubtitleMode}\n            getSubtitleMode={this.Player().getSubtitleMode}\n          />\n        )}\n        {this.state.overlayMsg && <ErrorModal error={this.state.overlayMsg} />}\n        {this.state.isErrorAuth && (\n          <PasswordModal\n            savedPasswords={this.state.savedPasswords}\n            roomId={this.state.roomId}\n          />\n        )}\n        {this.state.errorMessage && (\n          <Message\n            negative\n            header=\"Error\"\n            content={this.state.errorMessage}\n            style={{\n              position: 'fixed',\n              bottom: '10px',\n              right: '10px',\n              zIndex: 1000,\n            }}\n          ></Message>\n        )}\n        {this.state.successMessage && (\n          <Message\n            positive\n            header=\"Success\"\n            content={this.state.successMessage}\n            style={{\n              position: 'fixed',\n              bottom: '10px',\n              right: '10px',\n              zIndex: 1000,\n            }}\n          ></Message>\n        )}\n        {this.state.warningMessage && (\n          <Message\n            warning\n            // header={this.state.warningMessage}\n            content={this.state.warningMessage}\n            style={{\n              position: 'fixed',\n              top: '10px',\n              left: '50%',\n              transform: 'translate(-50%, 0)',\n              zIndex: 1000,\n            }}\n          ></Message>\n        )}\n        <TopBar\n          user={this.props.user}\n          isSubscriber={this.props.isSubscriber}\n          roomTitle={this.state.roomTitle}\n          roomDescription={this.state.roomDescription}\n          roomTitleColor={this.state.roomTitleColor}\n          showInviteButton\n        />\n        {\n          <Grid stackable celled=\"internally\">\n            <Grid.Row id=\"theaterContainer\">\n              <Grid.Column\n                width={this.state.showRightBar ? 12 : 15}\n                className={\n                  this.state.fullScreen\n                    ? styles.fullHeightColumnFullscreen\n                    : styles.fullHeightColumn\n                }\n              >\n                <div\n                  style={{\n                    display: 'flex',\n                    flexDirection: 'column',\n                    height: '100%',\n                  }}\n                >\n                  {!this.state.fullScreen && (\n                    <React.Fragment>\n                      <ComboBox\n                        roomSetMedia={this.roomSetMedia}\n                        playlistAdd={this.roomPlaylistAdd}\n                        playlistDelete={this.roomPlaylistDelete}\n                        playlistMove={this.roomPlaylistMove}\n                        roomMedia={this.state.roomMedia}\n                        getMediaDisplayName={this.getMediaDisplayName}\n                        launchMultiSelect={this.launchMultiSelect}\n                        streamPath={this.props.streamPath}\n                        mediaPath={this.state.mediaPath}\n                        disabled={!this.haveLock()}\n                        playlist={this.state.playlist}\n                      />\n                      <Separator />\n                      <div\n                        className={styles.mobileStack}\n                        style={{ display: 'flex', gap: '4px' }}\n                      >\n                        {this.localStreamToPublish && (\n                          <Button\n                            fluid\n                            className=\"toolButton\"\n                            icon\n                            labelPosition=\"left\"\n                            color=\"red\"\n                            onClick={this.stopPublishingLocalStream}\n                            disabled={sharer?.id !== this.socket?.id}\n                          >\n                            <Icon name=\"cancel\" />\n                            Stop Share\n                          </Button>\n                        )}\n                        {!this.localStreamToPublish &&\n                          !sharer &&\n                          !this.playingVBrowser() && (\n                            <Popup\n                              content={`Share a tab or an application.`}\n                              trigger={\n                                <Button\n                                  fluid\n                                  className=\"toolButton\"\n                                  disabled={!this.haveLock()}\n                                  icon\n                                  labelPosition=\"left\"\n                                  color={'instagram'}\n                                  onClick={() => {\n                                    this.setState({\n                                      isScreenShareModalOpen: true,\n                                    });\n                                  }}\n                                >\n                                  <Icon name={'slideshare'} />\n                                  Screenshare\n                                </Button>\n                              }\n                            />\n                          )}\n                        {!this.localStreamToPublish &&\n                          !sharer &&\n                          !this.playingVBrowser() && (\n                            <Popup\n                              content=\"Launch a shared virtual browser\"\n                              trigger={\n                                <Button\n                                  fluid\n                                  className=\"toolButton\"\n                                  disabled={!this.haveLock()}\n                                  icon\n                                  labelPosition=\"left\"\n                                  color=\"green\"\n                                  onClick={() => {\n                                    this.setState({\n                                      isVBrowserModalOpen: true,\n                                    });\n                                  }}\n                                >\n                                  <Icon name=\"desktop\" />\n                                  VBrowser\n                                </Button>\n                              }\n                            />\n                          )}\n                        {this.playingVBrowser() && (\n                          <Popup\n                            content=\"Choose the person controlling the VBrowser\"\n                            trigger={\n                              <Dropdown\n                                icon=\"keyboard\"\n                                labeled\n                                className=\"icon\"\n                                style={{ height: '36px' }}\n                                button\n                                value={this.state.controller}\n                                placeholder=\"No controller\"\n                                clearable\n                                onChange={this.changeController}\n                                selection\n                                disabled={!this.haveLock()}\n                                options={this.state.participants.map((p) => ({\n                                  text: this.state.nameMap[p.id] || p.id,\n                                  value: p.id,\n                                }))}\n                              ></Dropdown>\n                            }\n                          />\n                        )}\n                        {this.playingVBrowser() && (\n                          <Dropdown\n                            icon=\"desktop\"\n                            labeled\n                            className=\"icon\"\n                            style={{ height: '36px' }}\n                            button\n                            disabled={!this.haveLock()}\n                            value={this.state.vBrowserResolution}\n                            onChange={(_e, data) =>\n                              this.setState({\n                                vBrowserResolution: data.value as string,\n                              })\n                            }\n                            selection\n                            options={[\n                              {\n                                text: '1080p (Plus only)',\n                                value: '1920x1080@30',\n                                disabled: !this.state.isVBrowserLarge,\n                              },\n                              {\n                                text: '720p',\n                                value: '1280x720@30',\n                              },\n                              {\n                                text: '576p',\n                                value: '1024x576@60',\n                              },\n                              {\n                                text: '486p',\n                                value: '864x486@60',\n                              },\n                              {\n                                text: '360p',\n                                value: '640x360@60',\n                              },\n                            ]}\n                          ></Dropdown>\n                        )}\n                        {this.playingVBrowser() && (\n                          <Button\n                            fluid\n                            className=\"toolButton\"\n                            icon\n                            labelPosition=\"left\"\n                            color=\"red\"\n                            disabled={!this.haveLock()}\n                            onClick={this.stopVBrowser}\n                          >\n                            <Icon name=\"cancel\" />\n                            Stop VBrowser\n                          </Button>\n                        )}\n                        {!this.localStreamToPublish &&\n                          !sharer &&\n                          !this.playingVBrowser() && (\n                            <Popup\n                              content=\"Stream your own video file\"\n                              trigger={\n                                <Button\n                                  fluid\n                                  className=\"toolButton\"\n                                  disabled={!this.haveLock()}\n                                  icon\n                                  labelPosition=\"left\"\n                                  onClick={() => {\n                                    this.setState({\n                                      isFileShareModalOpen: true,\n                                    });\n                                  }}\n                                >\n                                  <Icon name=\"file\" />\n                                  File\n                                </Button>\n                              }\n                            />\n                          )}\n                        {false && (\n                          <SearchComponent\n                            setMedia={this.roomSetMedia}\n                            playlistAdd={this.roomPlaylistAdd}\n                            type={'youtube'}\n                            streamPath={this.props.streamPath}\n                            disabled={!this.haveLock()}\n                          />\n                        )}\n                        {Boolean(this.props.streamPath) && (\n                          <SearchComponent\n                            setMedia={this.roomSetMedia}\n                            playlistAdd={this.roomPlaylistAdd}\n                            type={'stream'}\n                            streamPath={this.props.streamPath}\n                            launchMultiSelect={this.launchMultiSelect}\n                            disabled={!this.haveLock()}\n                          />\n                        )}\n                      </div>\n                      <Separator />\n                    </React.Fragment>\n                  )}\n                  <div style={{ flexGrow: 1 }}>\n                    <div className={styles.playerContainer}>\n                      {(this.state.loading ||\n                        !this.state.roomMedia ||\n                        this.state.nonPlayableMedia) && (\n                        <div\n                          id=\"loader\"\n                          className={styles.videoContent}\n                          style={{\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                          }}\n                        >\n                          {this.state.loading && (\n                            <Dimmer active>\n                              <Loader>\n                                {this.playingVBrowser()\n                                  ? 'Launching virtual browser. This can take up to a minute.'\n                                  : ''}\n                              </Loader>\n                            </Dimmer>\n                          )}\n                          {!this.state.loading && !this.state.roomMedia && (\n                            <Message\n                              color=\"yellow\"\n                              icon=\"hand point up\"\n                              header=\"You're not watching anything!\"\n                              content=\"Pick something to watch above.\"\n                            />\n                          )}\n                          {!this.state.loading &&\n                            this.state.nonPlayableMedia && (\n                              <Message\n                                color=\"red\"\n                                icon=\"frown\"\n                                header=\"It doesn't look like this is a media file!\"\n                                content=\"Maybe you meant to launch a VBrowser if you're trying to visit a web page?\"\n                              />\n                            )}\n                        </div>\n                      )}\n                      <iframe\n                        style={{\n                          display:\n                            this.usingYoutube() && !this.state.loading\n                              ? 'block'\n                              : 'none',\n                        }}\n                        title=\"YouTube\"\n                        id=\"leftYt\"\n                        className={styles.videoContent}\n                        allowFullScreen\n                        frameBorder=\"0\"\n                        allow=\"autoplay\"\n                        src=\"https://www.youtube.com/embed/?enablejsapi=1&controls=0&rel=0\"\n                      />\n                      {this.playingVBrowser() &&\n                      this.getVBrowserPass() &&\n                      this.getVBrowserHost() ? (\n                        <VBrowser\n                          username={this.socket.id}\n                          password={this.getVBrowserPass()}\n                          hostname={this.getVBrowserHost()}\n                          controlling={this.state.controller === this.socket.id}\n                          resolution={this.state.vBrowserResolution}\n                          doPlay={this.localPlay}\n                          setResolution={(data: string) =>\n                            this.setState({ vBrowserResolution: data })\n                          }\n                        />\n                      ) : (\n                        <video\n                          style={{\n                            display:\n                              (this.usingNative() && !this.state.loading) ||\n                              this.state.fullScreen\n                                ? 'block'\n                                : 'none',\n                            width: '100%',\n                            maxHeight:\n                              'calc(100vh - 62px - 36px - 36px - 8px - 41px - 16px)',\n                          }}\n                          id=\"leftVideo\"\n                          onEnded={this.onVideoEnded}\n                          playsInline\n                          onClick={this.roomTogglePlay}\n                        ></video>\n                      )}\n                    </div>\n                  </div>\n                  {this.state.roomMedia && controls}\n                  {Boolean(this.state.total) && (\n                    <div\n                      style={{\n                        color: 'white',\n                        textAlign: 'center',\n                        fontSize: 11,\n                        fontWeight: 700,\n                        marginTop: -10,\n                      }}\n                    >\n                      {/* <Progress\n                        size=\"tiny\"\n                        color=\"green\"\n                        inverted\n                        value={this.state.downloaded}\n                        total={this.state.total}\n                        // indicating\n                        label={}\n                      ></Progress> */}\n                      {Math.min(\n                        (this.state.downloaded / this.state.total) * 100,\n                        100\n                      ).toFixed(2) +\n                        '% - ' +\n                        formatSpeed(this.state.speed) +\n                        ' - ' +\n                        this.state.connections +\n                        ' connections'}\n                    </div>\n                  )}\n                </div>\n                {!isMobile() && (\n                  <Button\n                    style={{\n                      position: 'absolute',\n                      top: '50%',\n                      right: 'calc(0% - 18px)',\n                      zIndex: 900,\n                    }}\n                    circular\n                    size=\"mini\"\n                    icon={\n                      this.state.showRightBar ? 'angle right' : 'angle left'\n                    }\n                    onClick={() =>\n                      this.setState({ showRightBar: !this.state.showRightBar })\n                    }\n                  />\n                )}\n              </Grid.Column>\n              {rightBar}\n            </Grid.Row>\n          </Grid>\n        }\n      </React.Fragment>\n    );\n  }\n}\n\nexport const Separator = () => <div style={{ height: '4px', flexShrink: 0 }} />;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}