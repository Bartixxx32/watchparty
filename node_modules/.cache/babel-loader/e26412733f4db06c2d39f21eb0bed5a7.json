{"ast":null,"code":"import _objectSpread from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import{Button,Icon}from'semantic-ui-react';import{formatTimestamp,getAndSaveClientId,getColorForStringHex,getDefaultPicture,iceServers}from'../../utils';import{UserMenu}from'../UserMenu/UserMenu';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var VideoChat=/*#__PURE__*/function(_React$Component){_inherits(VideoChat,_React$Component);var _super=_createSuper(VideoChat);function VideoChat(){var _this;_classCallCheck(this,VideoChat);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.socket=_this.props.socket;_this.emitUserMute=function(){_this.socket.emit('CMD:userMute',{isMuted:!_this.getAudioWebRTC()});};_this.handleSignal=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(data){var msg,from,pc,answer;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// Handle messages received from signaling server\nmsg=data.msg;from=data.from;pc=window.watchparty.videoPCs[from];console.log('recv',from,data);if(!(msg.ice!==undefined)){_context.next=8;break;}pc.addIceCandidate(new RTCIceCandidate(msg.ice));_context.next=20;break;case 8:if(!(msg.sdp&&msg.sdp.type==='offer')){_context.next=19;break;}_context.next=11;return pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));case 11:_context.next=13;return pc.createAnswer();case 13:answer=_context.sent;_context.next=16;return pc.setLocalDescription(answer);case 16:_this.sendSignal(from,{sdp:pc.localDescription});_context.next=20;break;case 19:if(msg.sdp&&msg.sdp.type==='answer'){pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));}case 20:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.setupWebRTC=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var black,stream,_navigator,_navigator2,_navigator2$mediaDevi;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:// Set up our own video\n// Create default stream\nblack=function black(){var _canvas$getContext;var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref3$width=_ref3.width,width=_ref3$width===void 0?640:_ref3$width,_ref3$height=_ref3.height,height=_ref3$height===void 0?480:_ref3$height;var canvas=Object.assign(document.createElement('canvas'),{width:width,height:height});(_canvas$getContext=canvas.getContext('2d'))===null||_canvas$getContext===void 0?void 0:_canvas$getContext.fillRect(0,0,width,height);var stream=canvas.captureStream();return Object.assign(stream.getVideoTracks()[0],{enabled:false});};stream=new MediaStream([black()]);_context2.prev=2;_context2.next=5;return(_navigator=navigator)===null||_navigator===void 0?void 0:_navigator.mediaDevices.getUserMedia({audio:true,video:true});case 5:stream=_context2.sent;_context2.next=21;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](2);console.warn(_context2.t0);_context2.prev=11;console.log('attempt audio only stream');_context2.next=15;return(_navigator2=navigator)===null||_navigator2===void 0?void 0:(_navigator2$mediaDevi=_navigator2.mediaDevices)===null||_navigator2$mediaDevi===void 0?void 0:_navigator2$mediaDevi.getUserMedia({audio:true,video:false});case 15:stream=_context2.sent;_context2.next=21;break;case 18:_context2.prev=18;_context2.t1=_context2[\"catch\"](11);console.warn(_context2.t1);case 21:window.watchparty.ourStream=stream;// alert server we've joined video chat\n_this.socket.emit('CMD:joinVideo');_this.emitUserMute();case 24:case\"end\":return _context2.stop();}}},_callee2,null,[[2,8],[11,18]]);}));_this.stopWebRTC=function(){var ourStream=window.watchparty.ourStream;var videoPCs=window.watchparty.videoPCs;ourStream&&ourStream.getTracks().forEach(function(track){track.stop();});window.watchparty.ourStream=undefined;Object.keys(videoPCs).forEach(function(key){videoPCs[key].close();delete videoPCs[key];});_this.socket.emit('CMD:leaveVideo');};_this.toggleVideoWebRTC=function(){var ourStream=window.watchparty.ourStream;if(ourStream&&ourStream.getVideoTracks()[0]){var _ourStream$getVideoTr;ourStream.getVideoTracks()[0].enabled=!((_ourStream$getVideoTr=ourStream.getVideoTracks()[0])!==null&&_ourStream$getVideoTr!==void 0&&_ourStream$getVideoTr.enabled);}_this.forceUpdate();};_this.getVideoWebRTC=function(){var _ourStream$getVideoTr2;var ourStream=window.watchparty.ourStream;return ourStream&&((_ourStream$getVideoTr2=ourStream.getVideoTracks()[0])===null||_ourStream$getVideoTr2===void 0?void 0:_ourStream$getVideoTr2.enabled);};_this.toggleAudioWebRTC=function(){var ourStream=window.watchparty.ourStream;if(ourStream&&ourStream.getAudioTracks()[0]){var _ourStream$getAudioTr;ourStream.getAudioTracks()[0].enabled=!((_ourStream$getAudioTr=ourStream.getAudioTracks()[0])!==null&&_ourStream$getAudioTr!==void 0&&_ourStream$getAudioTr.enabled);}_this.emitUserMute();_this.forceUpdate();};_this.getAudioWebRTC=function(){var ourStream=window.watchparty.ourStream;return ourStream&&ourStream.getAudioTracks()[0]&&ourStream.getAudioTracks()[0].enabled;};_this.updateWebRTC=function(){var ourStream=window.watchparty.ourStream;var videoPCs=window.watchparty.videoPCs;var videoRefs=window.watchparty.videoRefs;if(!ourStream){// We haven't started video chat, exit\nreturn;}var selfId=getAndSaveClientId();// Delete and close any connections that aren't in the current member list (maybe someone disconnected)\n// This allows them to rejoin later\nvar clientIds=new Set(_this.props.participants.filter(function(p){return p.isVideoChat;}).map(function(p){return p.clientId;}));Object.entries(videoPCs).forEach(function(_ref4){var _ref5=_slicedToArray(_ref4,2),key=_ref5[0],value=_ref5[1];if(!clientIds.has(key)){value.close();delete videoPCs[key];}});_this.props.participants.forEach(function(user){var id=user.clientId;if(!user.isVideoChat||videoPCs[id]){// User isn't in video chat, or we already have a connection to them\nreturn;}if(id===selfId){videoPCs[id]=new RTCPeerConnection();videoRefs[id].srcObject=ourStream;}else{var pc=new RTCPeerConnection({iceServers:iceServers()});videoPCs[id]=pc;// Add our own video as outgoing stream\nourStream===null||ourStream===void 0?void 0:ourStream.getTracks().forEach(function(track){if(ourStream){pc.addTrack(track,ourStream);}});pc.onicecandidate=function(event){// We generated an ICE candidate, send it to peer\nif(event.candidate){_this.sendSignal(id,{ice:event.candidate});}};pc.ontrack=function(event){// Mount the stream from peer\n// console.log(stream);\nvideoRefs[id].srcObject=event.streams[0];};// For each pair, have the lexicographically smaller ID be the offerer\nvar isOfferer=selfId<id;if(isOfferer){pc.onnegotiationneeded=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var offer;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return pc.createOffer();case 2:offer=_context3.sent;_context3.next=5;return pc.setLocalDescription(offer);case 5:_this.sendSignal(id,{sdp:pc.localDescription});case 6:case\"end\":return _context3.stop();}}},_callee3);}));}}});};_this.sendSignal=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(to,data){return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:console.log('send',to,data);_this.socket.emit('signal',{to:to,msg:data});case 2:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x2,_x3){return _ref7.apply(this,arguments);};}();return _this;}_createClass(VideoChat,[{key:\"componentDidMount\",value:function componentDidMount(){this.socket.on('signal',this.handleSignal);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.socket.off('signal',this.handleSignal);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(this.props.rosterUpdateTS!==prevProps.rosterUpdateTS){this.updateWebRTC();}}},{key:\"render\",value:function render(){var _this2=this;var _this$props=this.props,participants=_this$props.participants,pictureMap=_this$props.pictureMap,nameMap=_this$props.nameMap,tsMap=_this$props.tsMap,socket=_this$props.socket,owner=_this$props.owner,user=_this$props.user;var ourStream=window.watchparty.ourStream;var videoRefs=window.watchparty.videoRefs;var videoChatContentStyle={height:participants.length<3?220:110,borderRadius:'4px',objectFit:'contain'// ObjectFit\n};var selfId=getAndSaveClientId();return/*#__PURE__*/_jsxs(\"div\",{style:{display:this.props.hide?'none':'flex',width:'100%',flexDirection:'column',overflow:'auto'},children:[!ourStream&&/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',flexWrap:'wrap',marginTop:'8px'},children:/*#__PURE__*/_jsxs(Button,{fluid:true,title:\"Join Video Chat\",color:'purple',size:\"medium\",icon:true,labelPosition:\"left\",onClick:this.setupWebRTC,children:[/*#__PURE__*/_jsx(Icon,{name:\"video\"}),\"Join Video Chat\"]})}),ourStream&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexWrap:'wrap'},children:[/*#__PURE__*/_jsxs(Button,{fluid:true,color:'red',size:\"medium\",icon:true,labelPosition:\"left\",onClick:this.stopWebRTC,children:[/*#__PURE__*/_jsx(Icon,{name:\"external\"}),\"Leave Video Chat\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'center',marginTop:'8px',width:'100%'},children:[/*#__PURE__*/_jsxs(Button,{color:this.getVideoWebRTC()?'green':'red',fluid:true,size:\"medium\",icon:true,labelPosition:\"left\",onClick:this.toggleVideoWebRTC,children:[/*#__PURE__*/_jsx(Icon,{name:\"video\"}),this.getVideoWebRTC()?'On':'Off']}),/*#__PURE__*/_jsxs(Button,{color:this.getAudioWebRTC()?'green':'red',fluid:true,size:\"medium\",icon:true,labelPosition:\"left\",onClick:this.toggleAudioWebRTC,children:[/*#__PURE__*/_jsx(Icon,{name:this.getAudioWebRTC()?'microphone':'microphone slash'}),this.getAudioWebRTC()?'On':'Off']})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',flexWrap:'wrap',justifyContent:'center',marginTop:'8px'},children:participants.map(function(p){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"div\",{style:{position:'relative'//marginLeft: '4px',\n},children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(UserMenu,{displayName:nameMap[p.id]||p.id,user:user,disabled:!Boolean(owner&&owner===(user===null||user===void 0?void 0:user.uid)),position:'left center',socket:socket,userToManage:p.id,trigger:/*#__PURE__*/_jsx(Icon,{name:\"ellipsis vertical\",size:\"large\",style:{position:'absolute',right:-7,top:5,cursor:'pointer',opacity:0.75,visibility:Boolean(owner&&owner===(user===null||user===void 0?void 0:user.uid))?'visible':'hidden'}})}),ourStream&&p.isVideoChat?/*#__PURE__*/_jsx(\"video\",{ref:function ref(el){if(el){videoRefs[p.clientId]=el;}},style:_objectSpread(_objectSpread({},videoChatContentStyle),{},{// mirror the video if it's our stream. this style mimics Zoom where your\n// video is mirrored only for you)\ntransform:\"scaleX(\".concat(p.clientId===selfId?'-1':'1',\")\")}),autoPlay:true,muted:p.clientId===selfId,\"data-id\":p.id}):/*#__PURE__*/_jsx(\"img\",{style:videoChatContentStyle,src:pictureMap[p.id]||getDefaultPicture(nameMap[p.id],getColorForStringHex(p.id)),alt:\"\"}),/*#__PURE__*/_jsxs(\"div\",{style:{position:'absolute',bottom:'4px',left:'0px',width:'100%',backgroundColor:'rgba(0,0,0,0)',color:'white',borderRadius:'4px',fontSize:'10px',fontWeight:700,display:'flex'},children:[/*#__PURE__*/_jsxs(\"div\",{title:nameMap[p.id]||p.id,style:{width:'80px',backdropFilter:'brightness(80%)',padding:'4px',textOverflow:'ellipsis',whiteSpace:'nowrap',overflow:'hidden',display:'inline-block'},children:[p.isScreenShare&&/*#__PURE__*/_jsx(Icon,{size:\"small\",name:\"slideshare\"}),p.isVideoChat&&/*#__PURE__*/_jsx(Icon,{size:\"small\",name:\"video\"}),p.isMuted&&/*#__PURE__*/_jsx(Icon,{size:\"large\",name:\"microphone slash\",color:\"red\"}),nameMap[p.id]||p.id]}),/*#__PURE__*/_jsxs(\"div\",{style:{backdropFilter:'brightness(60%)',padding:'4px',flexGrow:1,display:'flex',justifyContent:'center'},children:[formatTimestamp(tsMap[p.id]||0),' ',_this2.props.beta&&\"(\".concat(((tsMap[p.id]-_this2.props.getLeaderTime())*1000).toFixed(0),\"ms)\")]})]})]})})},p.id);})})]});}}]);return VideoChat;}(React.Component);","map":{"version":3,"names":["React","Button","Icon","formatTimestamp","getAndSaveClientId","getColorForStringHex","getDefaultPicture","iceServers","UserMenu","VideoChat","socket","props","emitUserMute","emit","isMuted","getAudioWebRTC","handleSignal","data","msg","from","pc","window","watchparty","videoPCs","console","log","ice","undefined","addIceCandidate","RTCIceCandidate","sdp","type","setRemoteDescription","RTCSessionDescription","createAnswer","answer","setLocalDescription","sendSignal","localDescription","setupWebRTC","black","width","height","canvas","Object","assign","document","createElement","getContext","fillRect","stream","captureStream","getVideoTracks","enabled","MediaStream","navigator","mediaDevices","getUserMedia","audio","video","warn","ourStream","stopWebRTC","getTracks","forEach","track","stop","keys","key","close","toggleVideoWebRTC","forceUpdate","getVideoWebRTC","toggleAudioWebRTC","getAudioTracks","updateWebRTC","videoRefs","selfId","clientIds","Set","participants","filter","p","isVideoChat","map","clientId","entries","value","has","user","id","RTCPeerConnection","srcObject","addTrack","onicecandidate","event","candidate","ontrack","streams","isOfferer","onnegotiationneeded","createOffer","offer","to","on","off","prevProps","rosterUpdateTS","pictureMap","nameMap","tsMap","owner","videoChatContentStyle","length","borderRadius","objectFit","display","hide","flexDirection","overflow","flexWrap","marginTop","justifyContent","position","Boolean","uid","right","top","cursor","opacity","visibility","el","transform","bottom","left","backgroundColor","color","fontSize","fontWeight","backdropFilter","padding","textOverflow","whiteSpace","isScreenShare","flexGrow","beta","getLeaderTime","toFixed","Component"],"sources":["/home/runner/work/watchparty/watchparty/src/components/VideoChat/VideoChat.tsx"],"sourcesContent":["import React from 'react';\nimport { Button, Icon } from 'semantic-ui-react';\nimport { Socket } from 'socket.io-client';\n\nimport {\n  formatTimestamp,\n  getAndSaveClientId,\n  getColorForStringHex,\n  getDefaultPicture,\n  iceServers,\n} from '../../utils';\nimport { UserMenu } from '../UserMenu/UserMenu';\nimport firebase from 'firebase/compat/app';\n\ninterface VideoChatProps {\n  socket: Socket;\n  participants: User[];\n  pictureMap: StringDict;\n  nameMap: StringDict;\n  tsMap: NumberDict;\n  rosterUpdateTS: Number;\n  hide?: boolean;\n  owner: string | undefined;\n  user: firebase.User | undefined;\n  beta: boolean;\n  getLeaderTime: () => number;\n}\n\nexport class VideoChat extends React.Component<VideoChatProps> {\n  socket = this.props.socket;\n\n  componentDidMount() {\n    this.socket.on('signal', this.handleSignal);\n  }\n\n  componentWillUnmount() {\n    this.socket.off('signal', this.handleSignal);\n  }\n\n  componentDidUpdate(prevProps: VideoChatProps) {\n    if (this.props.rosterUpdateTS !== prevProps.rosterUpdateTS) {\n      this.updateWebRTC();\n    }\n  }\n\n  emitUserMute = () => {\n    this.socket.emit('CMD:userMute', { isMuted: !this.getAudioWebRTC() });\n  };\n\n  handleSignal = async (data: any) => {\n    // Handle messages received from signaling server\n    const msg = data.msg;\n    const from = data.from;\n    const pc = window.watchparty.videoPCs[from];\n    console.log('recv', from, data);\n    if (msg.ice !== undefined) {\n      pc.addIceCandidate(new RTCIceCandidate(msg.ice));\n    } else if (msg.sdp && msg.sdp.type === 'offer') {\n      // console.log('offer');\n      await pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));\n      const answer = await pc.createAnswer();\n      await pc.setLocalDescription(answer);\n      this.sendSignal(from, { sdp: pc.localDescription });\n    } else if (msg.sdp && msg.sdp.type === 'answer') {\n      pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));\n    }\n  };\n\n  setupWebRTC = async () => {\n    // Set up our own video\n    // Create default stream\n    let black = ({ width = 640, height = 480 } = {}) => {\n      let canvas: any = Object.assign(document.createElement('canvas'), {\n        width,\n        height,\n      });\n      canvas.getContext('2d')?.fillRect(0, 0, width, height);\n      let stream = canvas.captureStream();\n      return Object.assign(stream.getVideoTracks()[0], { enabled: false });\n    };\n    let stream = new MediaStream([black()]);\n\n    try {\n      stream = await navigator?.mediaDevices.getUserMedia({\n        audio: true,\n        video: true,\n      });\n    } catch (e) {\n      console.warn(e);\n      try {\n        console.log('attempt audio only stream');\n        stream = await navigator?.mediaDevices?.getUserMedia({\n          audio: true,\n          video: false,\n        });\n      } catch (e) {\n        console.warn(e);\n      }\n    }\n    window.watchparty.ourStream = stream;\n    // alert server we've joined video chat\n    this.socket.emit('CMD:joinVideo');\n    this.emitUserMute();\n  };\n\n  stopWebRTC = () => {\n    const ourStream = window.watchparty.ourStream;\n    const videoPCs = window.watchparty.videoPCs;\n    ourStream &&\n      ourStream.getTracks().forEach((track) => {\n        track.stop();\n      });\n    window.watchparty.ourStream = undefined;\n    Object.keys(videoPCs).forEach((key) => {\n      videoPCs[key].close();\n      delete videoPCs[key];\n    });\n    this.socket.emit('CMD:leaveVideo');\n  };\n\n  toggleVideoWebRTC = () => {\n    const ourStream = window.watchparty.ourStream;\n    if (ourStream && ourStream.getVideoTracks()[0]) {\n      ourStream.getVideoTracks()[0].enabled =\n        !ourStream.getVideoTracks()[0]?.enabled;\n    }\n    this.forceUpdate();\n  };\n\n  getVideoWebRTC = () => {\n    const ourStream = window.watchparty.ourStream;\n    return ourStream && ourStream.getVideoTracks()[0]?.enabled;\n  };\n\n  toggleAudioWebRTC = () => {\n    const ourStream = window.watchparty.ourStream;\n    if (ourStream && ourStream.getAudioTracks()[0]) {\n      ourStream.getAudioTracks()[0].enabled =\n        !ourStream.getAudioTracks()[0]?.enabled;\n    }\n    this.emitUserMute();\n    this.forceUpdate();\n  };\n\n  getAudioWebRTC = () => {\n    const ourStream = window.watchparty.ourStream;\n    return (\n      ourStream &&\n      ourStream.getAudioTracks()[0] &&\n      ourStream.getAudioTracks()[0].enabled\n    );\n  };\n\n  updateWebRTC = () => {\n    const ourStream = window.watchparty.ourStream;\n    const videoPCs = window.watchparty.videoPCs;\n    const videoRefs = window.watchparty.videoRefs;\n    if (!ourStream) {\n      // We haven't started video chat, exit\n      return;\n    }\n    const selfId = getAndSaveClientId();\n\n    // Delete and close any connections that aren't in the current member list (maybe someone disconnected)\n    // This allows them to rejoin later\n    const clientIds = new Set(\n      this.props.participants\n        .filter((p) => p.isVideoChat)\n        .map((p) => p.clientId)\n    );\n    Object.entries(videoPCs).forEach(([key, value]) => {\n      if (!clientIds.has(key)) {\n        value.close();\n        delete videoPCs[key];\n      }\n    });\n\n    this.props.participants.forEach((user) => {\n      const id = user.clientId;\n      if (!user.isVideoChat || videoPCs[id]) {\n        // User isn't in video chat, or we already have a connection to them\n        return;\n      }\n      if (id === selfId) {\n        videoPCs[id] = new RTCPeerConnection();\n        videoRefs[id].srcObject = ourStream;\n      } else {\n        const pc = new RTCPeerConnection({ iceServers: iceServers() });\n        videoPCs[id] = pc;\n        // Add our own video as outgoing stream\n        ourStream?.getTracks().forEach((track) => {\n          if (ourStream) {\n            pc.addTrack(track, ourStream);\n          }\n        });\n        pc.onicecandidate = (event) => {\n          // We generated an ICE candidate, send it to peer\n          if (event.candidate) {\n            this.sendSignal(id, { ice: event.candidate });\n          }\n        };\n        pc.ontrack = (event: RTCTrackEvent) => {\n          // Mount the stream from peer\n          // console.log(stream);\n          videoRefs[id].srcObject = event.streams[0];\n        };\n        // For each pair, have the lexicographically smaller ID be the offerer\n        const isOfferer = selfId < id;\n        if (isOfferer) {\n          pc.onnegotiationneeded = async () => {\n            // Start connection for peer's video\n            const offer = await pc.createOffer();\n            await pc.setLocalDescription(offer);\n            this.sendSignal(id, { sdp: pc.localDescription });\n          };\n        }\n      }\n    });\n  };\n\n  sendSignal = async (to: string, data: any) => {\n    console.log('send', to, data);\n    this.socket.emit('signal', { to, msg: data });\n  };\n\n  render() {\n    const { participants, pictureMap, nameMap, tsMap, socket, owner, user } =\n      this.props;\n    const ourStream = window.watchparty.ourStream;\n    const videoRefs = window.watchparty.videoRefs;\n    const videoChatContentStyle = {\n      height: participants.length < 3 ? 220 : 110,\n      borderRadius: '4px',\n      objectFit: 'contain' as any, // ObjectFit\n    };\n    const selfId = getAndSaveClientId();\n    return (\n      <div\n        style={{\n          display: this.props.hide ? 'none' : 'flex',\n          width: '100%',\n          flexDirection: 'column',\n          overflow: 'auto',\n        }}\n      >\n        {!ourStream && (\n          <div\n            style={{\n              display: 'flex',\n              flexWrap: 'wrap',\n              marginTop: '8px',\n            }}\n          >\n            <Button\n              fluid\n              title=\"Join Video Chat\"\n              color={'purple'}\n              size=\"medium\"\n              icon\n              labelPosition=\"left\"\n              onClick={this.setupWebRTC}\n            >\n              <Icon name=\"video\" />\n              {`Join Video Chat`}\n            </Button>\n          </div>\n        )}\n        {ourStream && (\n          <div\n            style={{\n              display: 'flex',\n              flexWrap: 'wrap',\n            }}\n          >\n            <Button\n              fluid\n              color={'red'}\n              size=\"medium\"\n              icon\n              labelPosition=\"left\"\n              onClick={this.stopWebRTC}\n            >\n              <Icon name=\"external\" />\n              {`Leave Video Chat`}\n            </Button>\n            <div\n              style={{\n                display: 'flex',\n                justifyContent: 'center',\n                marginTop: '8px',\n                width: '100%',\n              }}\n            >\n              <Button\n                color={this.getVideoWebRTC() ? 'green' : 'red'}\n                fluid\n                size=\"medium\"\n                icon\n                labelPosition=\"left\"\n                onClick={this.toggleVideoWebRTC}\n              >\n                <Icon name=\"video\" />\n                {this.getVideoWebRTC() ? 'On' : 'Off'}\n              </Button>\n              <Button\n                color={this.getAudioWebRTC() ? 'green' : 'red'}\n                fluid\n                size=\"medium\"\n                icon\n                labelPosition=\"left\"\n                onClick={this.toggleAudioWebRTC}\n              >\n                <Icon\n                  name={\n                    this.getAudioWebRTC() ? 'microphone' : 'microphone slash'\n                  }\n                />\n                {this.getAudioWebRTC() ? 'On' : 'Off'}\n              </Button>\n            </div>\n          </div>\n        )}\n        <div\n          style={{\n            display: 'flex',\n            flexWrap: 'wrap',\n            justifyContent: 'center',\n            marginTop: '8px',\n          }}\n        >\n          {participants.map((p) => {\n            return (\n              <div key={p.id}>\n                <div\n                  style={{\n                    position: 'relative',\n                    //marginLeft: '4px',\n                  }}\n                >\n                  <div>\n                    <UserMenu\n                      displayName={nameMap[p.id] || p.id}\n                      user={user}\n                      disabled={!Boolean(owner && owner === user?.uid)}\n                      position={'left center'}\n                      socket={socket}\n                      userToManage={p.id}\n                      trigger={\n                        <Icon\n                          name=\"ellipsis vertical\"\n                          size=\"large\"\n                          style={{\n                            position: 'absolute',\n                            right: -7,\n                            top: 5,\n                            cursor: 'pointer',\n                            opacity: 0.75,\n                            visibility: Boolean(owner && owner === user?.uid)\n                              ? 'visible'\n                              : 'hidden',\n                          }}\n                        />\n                      }\n                    />\n                    {ourStream && p.isVideoChat ? (\n                      <video\n                        ref={(el) => {\n                          if (el) {\n                            videoRefs[p.clientId] = el;\n                          }\n                        }}\n                        style={{\n                          ...videoChatContentStyle,\n                          // mirror the video if it's our stream. this style mimics Zoom where your\n                          // video is mirrored only for you)\n                          transform: `scaleX(${\n                            p.clientId === selfId ? '-1' : '1'\n                          })`,\n                        }}\n                        autoPlay\n                        muted={p.clientId === selfId}\n                        data-id={p.id}\n                      />\n                    ) : (\n                      <img\n                        style={videoChatContentStyle}\n                        src={\n                          pictureMap[p.id] ||\n                          getDefaultPicture(\n                            nameMap[p.id],\n                            getColorForStringHex(p.id)\n                          )\n                        }\n                        alt=\"\"\n                      />\n                    )}\n                    <div\n                      style={{\n                        position: 'absolute',\n                        bottom: '4px',\n                        left: '0px',\n                        width: '100%',\n                        backgroundColor: 'rgba(0,0,0,0)',\n                        color: 'white',\n                        borderRadius: '4px',\n                        fontSize: '10px',\n                        fontWeight: 700,\n                        display: 'flex',\n                      }}\n                    >\n                      <div\n                        title={nameMap[p.id] || p.id}\n                        style={{\n                          width: '80px',\n                          backdropFilter: 'brightness(80%)',\n                          padding: '4px',\n                          textOverflow: 'ellipsis',\n                          whiteSpace: 'nowrap',\n                          overflow: 'hidden',\n                          display: 'inline-block',\n                        }}\n                      >\n                        {p.isScreenShare && (\n                          <Icon size=\"small\" name=\"slideshare\" />\n                        )}\n                        {p.isVideoChat && <Icon size=\"small\" name=\"video\" />}\n                        {p.isMuted && (\n                          <Icon\n                            size=\"large\"\n                            name=\"microphone slash\"\n                            color=\"red\"\n                          />\n                        )}\n                        {nameMap[p.id] || p.id}\n                      </div>\n                      <div\n                        style={{\n                          backdropFilter: 'brightness(60%)',\n                          padding: '4px',\n                          flexGrow: 1,\n                          display: 'flex',\n                          justifyContent: 'center',\n                        }}\n                      >\n                        {formatTimestamp(tsMap[p.id] || 0)}{' '}\n                        {this.props.beta &&\n                          `(${(\n                            (tsMap[p.id] - this.props.getLeaderTime()) *\n                            1000\n                          ).toFixed(0)}ms)`}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    );\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}