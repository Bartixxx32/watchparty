{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useState}from'react';import{serverPath}from'../../utils';import{jsx as _jsx}from\"react/jsx-runtime\";export var Discord=function Discord(_ref){var user=_ref.user;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),errorMsg=_useState2[0],setErrorMsg=_useState2[1];console.log(user);useEffect(function(){function auth(){return _auth.apply(this,arguments);}function _auth(){_auth=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var fragment,_ref2,accessToken,tokenType,token,authResponse,body;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:fragment=new URLSearchParams(window.location.hash.slice(1));_ref2=[fragment.get('access_token'),fragment.get('token_type')],accessToken=_ref2[0],tokenType=_ref2[1];_context.next=4;return user===null||user===void 0?void 0:user.getIdToken();case 4:token=_context.sent;_context.next=7;return window.fetch(serverPath+'/linkAccount',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({uid:user===null||user===void 0?void 0:user.uid,kind:'discord',token:token,tokenType:tokenType,accessToken:accessToken})});case 7:authResponse=_context.sent;if(!(authResponse.status!==200)){_context.next=15;break;}_context.next=11;return authResponse.json();case 11:body=_context.sent;setErrorMsg(body.error);_context.next=17;break;case 15:window.opener.location.reload(false);window.close();case 17:case\"end\":return _context.stop();}}},_callee);}));return _auth.apply(this,arguments);}if(user){auth();}},[user]);if(errorMsg){return/*#__PURE__*/_jsx(\"div\",{style:{color:'red',fontSize:20},children:errorMsg});}return null;};","map":{"version":3,"names":["useEffect","useState","serverPath","Discord","user","errorMsg","setErrorMsg","console","log","auth","fragment","URLSearchParams","window","location","hash","slice","get","accessToken","tokenType","getIdToken","token","fetch","method","headers","body","JSON","stringify","uid","kind","authResponse","status","json","error","opener","reload","close","color","fontSize"],"sources":["/home/runner/work/watchparty/watchparty/src/components/Discord/Discord.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport firebase from 'firebase/compat/app';\nimport { serverPath } from '../../utils';\n\ntype DiscordProps = {\n  user?: firebase.User;\n};\n\nexport const Discord = ({ user }: DiscordProps) => {\n  const [errorMsg, setErrorMsg] = useState('');\n\n  console.log(user);\n  useEffect(() => {\n    async function auth() {\n      const fragment = new URLSearchParams(window.location.hash.slice(1));\n      const [accessToken, tokenType] = [\n        fragment.get('access_token'),\n        fragment.get('token_type'),\n      ];\n      const token = await user?.getIdToken();\n      const authResponse = await window.fetch(serverPath + '/linkAccount', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          uid: user?.uid,\n          kind: 'discord',\n          token: token,\n          tokenType,\n          accessToken,\n        }),\n      });\n      if (authResponse.status !== 200) {\n        const body = await authResponse.json();\n        setErrorMsg(body.error);\n      } else {\n        window.opener.location.reload(false);\n        window.close();\n      }\n    }\n    if (user) {\n      auth();\n    }\n  }, [user]);\n\n  if (errorMsg) {\n    return <div style={{ color: 'red', fontSize: 20 }}>{errorMsg}</div>;\n  }\n  return null;\n};\n"],"mappings":"uYAAA,OAASA,SAAT,CAAoBC,QAApB,KAAoC,OAApC,CAEA,OAASC,UAAT,KAA2B,aAA3B,C,2CAMA,MAAO,IAAMC,QAAO,CAAG,QAAVA,QAAU,MAA4B,IAAzBC,KAAyB,MAAzBA,IAAyB,CACjD,cAAgCH,QAAQ,CAAC,EAAD,CAAxC,wCAAOI,QAAP,eAAiBC,WAAjB,eAEAC,OAAO,CAACC,GAAR,CAAYJ,IAAZ,EACAJ,SAAS,CAAC,UAAM,SACCS,KADD,wHACd,sMACQC,QADR,CACmB,GAAIC,gBAAJ,CAAoBC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,KAArB,CAA2B,CAA3B,CAApB,CADnB,OAEmC,CAC/BL,QAAQ,CAACM,GAAT,CAAa,cAAb,CAD+B,CAE/BN,QAAQ,CAACM,GAAT,CAAa,YAAb,CAF+B,CAFnC,CAESC,WAFT,UAEsBC,SAFtB,gCAMsBd,KANtB,SAMsBA,IANtB,iBAMsBA,IAAI,CAAEe,UAAN,EANtB,QAMQC,KANR,qCAO6BR,OAAM,CAACS,KAAP,CAAanB,UAAU,CAAG,cAA1B,CAA0C,CACnEoB,MAAM,CAAE,MAD2D,CAEnEC,OAAO,CAAE,CACP,eAAgB,kBADT,CAF0D,CAKnEC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe,CACnBC,GAAG,CAAEvB,IAAF,SAAEA,IAAF,iBAAEA,IAAI,CAAEuB,GADQ,CAEnBC,IAAI,CAAE,SAFa,CAGnBR,KAAK,CAAEA,KAHY,CAInBF,SAAS,CAATA,SAJmB,CAKnBD,WAAW,CAAXA,WALmB,CAAf,CAL6D,CAA1C,CAP7B,QAOQY,YAPR,oBAoBMA,YAAY,CAACC,MAAb,GAAwB,GApB9B,kDAqBuBD,aAAY,CAACE,IAAb,EArBvB,SAqBUP,IArBV,eAsBIlB,WAAW,CAACkB,IAAI,CAACQ,KAAN,CAAX,CAtBJ,+BAwBIpB,MAAM,CAACqB,MAAP,CAAcpB,QAAd,CAAuBqB,MAAvB,CAA8B,KAA9B,EACAtB,MAAM,CAACuB,KAAP,GAzBJ,uDADc,uCA6Bd,GAAI/B,IAAJ,CAAU,CACRK,IAAI,GACL,CACF,CAhCQ,CAgCN,CAACL,IAAD,CAhCM,CAAT,CAkCA,GAAIC,QAAJ,CAAc,CACZ,mBAAO,YAAK,KAAK,CAAE,CAAE+B,KAAK,CAAE,KAAT,CAAgBC,QAAQ,CAAE,EAA1B,CAAZ,UAA6ChC,QAA7C,EAAP,CACD,CACD,MAAO,KAAP,CACD,CA1CM"},"metadata":{},"sourceType":"module"}