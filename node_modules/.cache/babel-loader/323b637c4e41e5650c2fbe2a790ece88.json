{"ast":null,"code":"var grammar = require('./grammar'); // customized util.format - discards excess arguments and can void middle ones\n\n\nvar formatRegExp = /%[sdv%]/g;\n\nvar format = function format(formatStr) {\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  return formatStr.replace(formatRegExp, function (x) {\n    if (i >= len) {\n      return x; // missing argument\n    }\n\n    var arg = args[i];\n    i += 1;\n\n    switch (x) {\n      case '%%':\n        return '%';\n\n      case '%s':\n        return String(arg);\n\n      case '%d':\n        return Number(arg);\n\n      case '%v':\n        return '';\n    }\n  }); // NB: we discard excess arguments - they are typically undefined from makeLine\n};\n\nvar makeLine = function makeLine(type, obj, location) {\n  var str = obj.format instanceof Function ? obj.format(obj.push ? location : location[obj.name]) : obj.format;\n  var args = [type + '=' + str];\n\n  if (obj.names) {\n    for (var i = 0; i < obj.names.length; i += 1) {\n      var n = obj.names[i];\n\n      if (obj.name) {\n        args.push(location[obj.name][n]);\n      } else {\n        // for mLine and push attributes\n        args.push(location[obj.names[i]]);\n      }\n    }\n  } else {\n    args.push(location[obj.name]);\n  }\n\n  return format.apply(null, args);\n}; // RFC specified order\n// TODO: extend this with all the rest\n\n\nvar defaultOuterOrder = ['v', 'o', 's', 'i', 'u', 'e', 'p', 'c', 'b', 't', 'r', 'z', 'a'];\nvar defaultInnerOrder = ['i', 'c', 'b', 'a'];\n\nmodule.exports = function (session, opts) {\n  opts = opts || {}; // ensure certain properties exist\n\n  if (session.version == null) {\n    session.version = 0; // 'v=0' must be there (only defined version atm)\n  }\n\n  if (session.name == null) {\n    session.name = ' '; // 's= ' must be there if no meaningful name set\n  }\n\n  session.media.forEach(function (mLine) {\n    if (mLine.payloads == null) {\n      mLine.payloads = '';\n    }\n  });\n  var outerOrder = opts.outerOrder || defaultOuterOrder;\n  var innerOrder = opts.innerOrder || defaultInnerOrder;\n  var sdp = []; // loop through outerOrder for matching properties on session\n\n  outerOrder.forEach(function (type) {\n    grammar[type].forEach(function (obj) {\n      if (obj.name in session && session[obj.name] != null) {\n        sdp.push(makeLine(type, obj, session));\n      } else if (obj.push in session && session[obj.push] != null) {\n        session[obj.push].forEach(function (el) {\n          sdp.push(makeLine(type, obj, el));\n        });\n      }\n    });\n  }); // then for each media line, follow the innerOrder\n\n  session.media.forEach(function (mLine) {\n    sdp.push(makeLine('m', grammar.m[0], mLine));\n    innerOrder.forEach(function (type) {\n      grammar[type].forEach(function (obj) {\n        if (obj.name in mLine && mLine[obj.name] != null) {\n          sdp.push(makeLine(type, obj, mLine));\n        } else if (obj.push in mLine && mLine[obj.push] != null) {\n          mLine[obj.push].forEach(function (el) {\n            sdp.push(makeLine(type, obj, el));\n          });\n        }\n      });\n    });\n  });\n  return sdp.join('\\r\\n') + '\\r\\n';\n};","map":{"version":3,"names":["grammar","require","formatRegExp","format","formatStr","i","args","arguments","len","length","replace","x","arg","String","Number","makeLine","type","obj","location","str","Function","push","name","names","n","apply","defaultOuterOrder","defaultInnerOrder","module","exports","session","opts","version","media","forEach","mLine","payloads","outerOrder","innerOrder","sdp","el","m","join"],"sources":["/home/runner/work/watchparty/watchparty/node_modules/sdp-transform/lib/writer.js"],"sourcesContent":["var grammar = require('./grammar');\n\n// customized util.format - discards excess arguments and can void middle ones\nvar formatRegExp = /%[sdv%]/g;\nvar format = function (formatStr) {\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  return formatStr.replace(formatRegExp, function (x) {\n    if (i >= len) {\n      return x; // missing argument\n    }\n    var arg = args[i];\n    i += 1;\n    switch (x) {\n    case '%%':\n      return '%';\n    case '%s':\n      return String(arg);\n    case '%d':\n      return Number(arg);\n    case '%v':\n      return '';\n    }\n  });\n  // NB: we discard excess arguments - they are typically undefined from makeLine\n};\n\nvar makeLine = function (type, obj, location) {\n  var str = obj.format instanceof Function ?\n    (obj.format(obj.push ? location : location[obj.name])) :\n    obj.format;\n\n  var args = [type + '=' + str];\n  if (obj.names) {\n    for (var i = 0; i < obj.names.length; i += 1) {\n      var n = obj.names[i];\n      if (obj.name) {\n        args.push(location[obj.name][n]);\n      }\n      else { // for mLine and push attributes\n        args.push(location[obj.names[i]]);\n      }\n    }\n  }\n  else {\n    args.push(location[obj.name]);\n  }\n  return format.apply(null, args);\n};\n\n// RFC specified order\n// TODO: extend this with all the rest\nvar defaultOuterOrder = [\n  'v', 'o', 's', 'i',\n  'u', 'e', 'p', 'c',\n  'b', 't', 'r', 'z', 'a'\n];\nvar defaultInnerOrder = ['i', 'c', 'b', 'a'];\n\n\nmodule.exports = function (session, opts) {\n  opts = opts || {};\n  // ensure certain properties exist\n  if (session.version == null) {\n    session.version = 0; // 'v=0' must be there (only defined version atm)\n  }\n  if (session.name == null) {\n    session.name = ' '; // 's= ' must be there if no meaningful name set\n  }\n  session.media.forEach(function (mLine) {\n    if (mLine.payloads == null) {\n      mLine.payloads = '';\n    }\n  });\n\n  var outerOrder = opts.outerOrder || defaultOuterOrder;\n  var innerOrder = opts.innerOrder || defaultInnerOrder;\n  var sdp = [];\n\n  // loop through outerOrder for matching properties on session\n  outerOrder.forEach(function (type) {\n    grammar[type].forEach(function (obj) {\n      if (obj.name in session && session[obj.name] != null) {\n        sdp.push(makeLine(type, obj, session));\n      }\n      else if (obj.push in session && session[obj.push] != null) {\n        session[obj.push].forEach(function (el) {\n          sdp.push(makeLine(type, obj, el));\n        });\n      }\n    });\n  });\n\n  // then for each media line, follow the innerOrder\n  session.media.forEach(function (mLine) {\n    sdp.push(makeLine('m', grammar.m[0], mLine));\n\n    innerOrder.forEach(function (type) {\n      grammar[type].forEach(function (obj) {\n        if (obj.name in mLine && mLine[obj.name] != null) {\n          sdp.push(makeLine(type, obj, mLine));\n        }\n        else if (obj.push in mLine && mLine[obj.push] != null) {\n          mLine[obj.push].forEach(function (el) {\n            sdp.push(makeLine(type, obj, el));\n          });\n        }\n      });\n    });\n  });\n\n  return sdp.join('\\r\\n') + '\\r\\n';\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}