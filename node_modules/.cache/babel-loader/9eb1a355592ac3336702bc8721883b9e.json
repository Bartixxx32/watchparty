{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _createClass from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _classCallCheck from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";export var YouTube=/*#__PURE__*/_createClass(function YouTube(watchPartyYTPlayer){var _this=this;_classCallCheck(this,YouTube);this.watchPartyYTPlayer=void 0;this.getCurrentTime=function(){var _this$watchPartyYTPla,_this$watchPartyYTPla2;return(_this$watchPartyYTPla=(_this$watchPartyYTPla2=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla2===void 0?void 0:_this$watchPartyYTPla2.getCurrentTime())!==null&&_this$watchPartyYTPla!==void 0?_this$watchPartyYTPla:0;};this.getDuration=function(){var _this$watchPartyYTPla3,_this$watchPartyYTPla4;return(_this$watchPartyYTPla3=(_this$watchPartyYTPla4=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla4===void 0?void 0:_this$watchPartyYTPla4.getDuration())!==null&&_this$watchPartyYTPla3!==void 0?_this$watchPartyYTPla3:0;};this.isMuted=function(){var _this$watchPartyYTPla5,_this$watchPartyYTPla6;return(_this$watchPartyYTPla5=(_this$watchPartyYTPla6=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla6===void 0?void 0:_this$watchPartyYTPla6.isMuted())!==null&&_this$watchPartyYTPla5!==void 0?_this$watchPartyYTPla5:false;};this.isSubtitled=function(){// This actually isn't accurate after subtitles have been toggled off because track doesn't update\n// try {\n//   const current = this.watchPartyYTPlayer?.getOption('captions', 'track');\n//   return Boolean(current && current.languageCode);\n// } catch (e) {\n//   console.warn(e);\n//   return false;\n// }\nreturn false;};this.getPlaybackRate=function(){var _this$watchPartyYTPla7,_this$watchPartyYTPla8;return(_this$watchPartyYTPla7=(_this$watchPartyYTPla8=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla8===void 0?void 0:_this$watchPartyYTPla8.getPlaybackRate())!==null&&_this$watchPartyYTPla7!==void 0?_this$watchPartyYTPla7:1;};this.setPlaybackRate=function(rate){var _this$watchPartyYTPla9;(_this$watchPartyYTPla9=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla9===void 0?void 0:_this$watchPartyYTPla9.setPlaybackRate(rate);};this.setSrcAndTime=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(src,time){var _this$watchPartyYTPla10;var url,videoId,altVideoId;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:url=new window.URL(src);// Standard link https://www.youtube.com/watch?v=ID\nvideoId=new URLSearchParams(url.search).get('v');// Link shortener https://youtu.be/ID\naltVideoId=src.split('/').slice(-1)[0];(_this$watchPartyYTPla10=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla10===void 0?void 0:_this$watchPartyYTPla10.cueVideoById(videoId||altVideoId,time);case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();this.playVideo=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setTimeout(function(){var _this$watchPartyYTPla11;console.log('play yt');(_this$watchPartyYTPla11=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla11===void 0?void 0:_this$watchPartyYTPla11.playVideo();},200);case 1:case\"end\":return _context2.stop();}}},_callee2);}));this.pauseVideo=function(){var _this$watchPartyYTPla12;(_this$watchPartyYTPla12=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla12===void 0?void 0:_this$watchPartyYTPla12.pauseVideo();};this.seekVideo=function(time){var _this$watchPartyYTPla13;(_this$watchPartyYTPla13=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla13===void 0?void 0:_this$watchPartyYTPla13.seekTo(time,true);};this.shouldPlay=function(){var _this$watchPartyYTPla14,_window$YT;return((_this$watchPartyYTPla14=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla14===void 0?void 0:_this$watchPartyYTPla14.getPlayerState())===((_window$YT=window.YT)===null||_window$YT===void 0?void 0:_window$YT.PlayerState.PAUSED)||_this.getCurrentTime()===_this.getDuration();};this.setMute=function(muted){if(muted){var _this$watchPartyYTPla15;(_this$watchPartyYTPla15=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla15===void 0?void 0:_this$watchPartyYTPla15.mute();}else{var _this$watchPartyYTPla16;(_this$watchPartyYTPla16=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla16===void 0?void 0:_this$watchPartyYTPla16.unMute();}};this.setVolume=function(volume){var _this$watchPartyYTPla17;(_this$watchPartyYTPla17=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla17===void 0?void 0:_this$watchPartyYTPla17.setVolume(volume*100);};this.getVolume=function(){var _this$watchPartyYTPla18;var volume=(_this$watchPartyYTPla18=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla18===void 0?void 0:_this$watchPartyYTPla18.getVolume();return(volume!==null&&volume!==void 0?volume:0)/100;};this.setSubtitleMode=function(mode,lang){// Show the available options\n// console.log(this.watchPartyYTPlayer?.getOptions('captions'));\nif(mode==='showing'){var _this$watchPartyYTPla19,_this$watchPartyYTPla20;console.log(lang);//@ts-ignore\n(_this$watchPartyYTPla19=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla19===void 0?void 0:_this$watchPartyYTPla19.setOption('captions','reload',true);//@ts-ignore\n(_this$watchPartyYTPla20=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla20===void 0?void 0:_this$watchPartyYTPla20.setOption('captions','track',{languageCode:lang!==null&&lang!==void 0?lang:'en'});}if(mode==='hidden'){var _this$watchPartyYTPla21;// BUG this doesn't actually set the value of track\n// so we can't determine if subtitles are on or off\n// need to provide separate menu options\n//@ts-ignore\n(_this$watchPartyYTPla21=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla21===void 0?void 0:_this$watchPartyYTPla21.setOption('captions','track',{});}};this.getSubtitleMode=function(){return'hidden';};this.isReady=function(){return Boolean(_this.watchPartyYTPlayer);};this.stopVideo=function(){var _this$watchPartyYTPla22;(_this$watchPartyYTPla22=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla22===void 0?void 0:_this$watchPartyYTPla22.stopVideo();};this.clearState=function(){return;};this.loadSubtitles=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(src){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\");case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}();this.syncSubtitles=function(sharerTime){return;};this.getTimeRanges=function(){var _this$watchPartyYTPla23,_this$watchPartyYTPla24;return[{start:0,end:((_this$watchPartyYTPla23=(_this$watchPartyYTPla24=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla24===void 0?void 0:_this$watchPartyYTPla24.getVideoLoadedFraction())!==null&&_this$watchPartyYTPla23!==void 0?_this$watchPartyYTPla23:0)*_this.getDuration()}];};this.setLoop=function(loop){var _this$watchPartyYTPla25;(_this$watchPartyYTPla25=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla25===void 0?void 0:_this$watchPartyYTPla25.setLoop(loop);};this.getVideoEl=function(){return document.getElementById('leftYt');};this.watchPartyYTPlayer=watchPartyYTPlayer;});","map":{"version":3,"names":["YouTube","watchPartyYTPlayer","getCurrentTime","getDuration","isMuted","isSubtitled","getPlaybackRate","setPlaybackRate","rate","setSrcAndTime","src","time","url","window","URL","videoId","URLSearchParams","search","get","altVideoId","split","slice","cueVideoById","playVideo","setTimeout","console","log","pauseVideo","seekVideo","seekTo","shouldPlay","getPlayerState","YT","PlayerState","PAUSED","setMute","muted","mute","unMute","setVolume","volume","getVolume","setSubtitleMode","mode","lang","setOption","languageCode","getSubtitleMode","isReady","Boolean","stopVideo","clearState","loadSubtitles","syncSubtitles","sharerTime","getTimeRanges","start","end","getVideoLoadedFraction","setLoop","loop","getVideoEl","document","getElementById"],"sources":["/home/runner/work/watchparty/watchparty/src/components/App/YouTube.ts"],"sourcesContent":["import { Player } from './Player';\n\nexport class YouTube implements Player {\n  watchPartyYTPlayer: YT.Player | null;\n  constructor(watchPartyYTPlayer: YT.Player | null) {\n    this.watchPartyYTPlayer = watchPartyYTPlayer;\n  }\n  getCurrentTime = () => {\n    return this.watchPartyYTPlayer?.getCurrentTime() ?? 0;\n  };\n\n  getDuration = () => {\n    return this.watchPartyYTPlayer?.getDuration() ?? 0;\n  };\n\n  isMuted = () => {\n    return this.watchPartyYTPlayer?.isMuted() ?? false;\n  };\n\n  isSubtitled = (): boolean => {\n    // This actually isn't accurate after subtitles have been toggled off because track doesn't update\n    // try {\n    //   const current = this.watchPartyYTPlayer?.getOption('captions', 'track');\n    //   return Boolean(current && current.languageCode);\n    // } catch (e) {\n    //   console.warn(e);\n    //   return false;\n    // }\n    return false;\n  };\n\n  getPlaybackRate = (): number => {\n    return this.watchPartyYTPlayer?.getPlaybackRate() ?? 1;\n  };\n\n  setPlaybackRate = (rate: number) => {\n    this.watchPartyYTPlayer?.setPlaybackRate(rate);\n  };\n\n  setSrcAndTime = async (src: string, time: number) => {\n    let url = new window.URL(src);\n    // Standard link https://www.youtube.com/watch?v=ID\n    let videoId = new URLSearchParams(url.search).get('v');\n    // Link shortener https://youtu.be/ID\n    let altVideoId = src.split('/').slice(-1)[0];\n    this.watchPartyYTPlayer?.cueVideoById(videoId || altVideoId, time);\n  };\n\n  playVideo = async () => {\n    setTimeout(() => {\n      console.log('play yt');\n      this.watchPartyYTPlayer?.playVideo();\n    }, 200);\n  };\n\n  pauseVideo = () => {\n    this.watchPartyYTPlayer?.pauseVideo();\n  };\n\n  seekVideo = (time: number) => {\n    this.watchPartyYTPlayer?.seekTo(time, true);\n  };\n\n  shouldPlay = () => {\n    return (\n      this.watchPartyYTPlayer?.getPlayerState() ===\n        window.YT?.PlayerState.PAUSED ||\n      this.getCurrentTime() === this.getDuration()\n    );\n  };\n\n  setMute = (muted: boolean) => {\n    if (muted) {\n      this.watchPartyYTPlayer?.mute();\n    } else {\n      this.watchPartyYTPlayer?.unMute();\n    }\n  };\n\n  setVolume = (volume: number) => {\n    this.watchPartyYTPlayer?.setVolume(volume * 100);\n  };\n\n  getVolume = (): number => {\n    const volume = this.watchPartyYTPlayer?.getVolume();\n    return (volume ?? 0) / 100;\n  };\n\n  setSubtitleMode = (mode?: TextTrackMode, lang?: string) => {\n    // Show the available options\n    // console.log(this.watchPartyYTPlayer?.getOptions('captions'));\n    if (mode === 'showing') {\n      console.log(lang);\n      //@ts-ignore\n      this.watchPartyYTPlayer?.setOption('captions', 'reload', true);\n      //@ts-ignore\n      this.watchPartyYTPlayer?.setOption('captions', 'track', {\n        languageCode: lang ?? 'en',\n      });\n    }\n    if (mode === 'hidden') {\n      // BUG this doesn't actually set the value of track\n      // so we can't determine if subtitles are on or off\n      // need to provide separate menu options\n      //@ts-ignore\n      this.watchPartyYTPlayer?.setOption('captions', 'track', {});\n    }\n  };\n\n  getSubtitleMode = () => {\n    return 'hidden' as TextTrackMode;\n  };\n\n  isReady = () => {\n    return Boolean(this.watchPartyYTPlayer);\n  };\n\n  stopVideo = () => {\n    this.watchPartyYTPlayer?.stopVideo();\n  };\n\n  clearState = () => {\n    return;\n  };\n\n  loadSubtitles = async (src: string) => {\n    return;\n  };\n\n  syncSubtitles = (sharerTime: number) => {\n    return;\n  };\n\n  getTimeRanges = (): { start: number; end: number }[] => {\n    return [\n      {\n        start: 0,\n        end:\n          (this.watchPartyYTPlayer?.getVideoLoadedFraction() ?? 0) *\n          this.getDuration(),\n      },\n    ];\n  };\n\n  setLoop = (loop: boolean): void => {\n    this.watchPartyYTPlayer?.setLoop(loop);\n  };\n\n  getVideoEl = (): HTMLMediaElement => {\n    return document.getElementById('leftYt') as HTMLMediaElement;\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}