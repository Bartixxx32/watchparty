"use strict";(self.webpackChunkwatchparty=self.webpackChunkwatchparty||[]).push([[762],{6884:function(e,t,n){n.r(t),n.d(t,{default:function(){return L}});var r=n(4506),i=n(9439),o=n(1752),s=n(1120),a=n(1413),u=n(5861),c=n(2963),h=n(4942),l=n(3433),f=n(7762),d=n(5671),p=n(3144),v=n(7326),g=n(136),y=n(9388),m=n(4165);function _(e,t){var n={},r=!1;function i(n,i){return r=!0,i=new Promise((function(t){t(e[n](i))})),{done:!1,value:t(i)}}return n["undefined"!==typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},n.next=function(e){return r?(r=!1,e):i("next",e)},"function"===typeof e.throw&&(n.throw=function(e){if(r)throw r=!1,e;return i("throw",e)}),"function"===typeof e.return&&(n.return=function(e){return r?(r=!1,e):i("return",e)}),n}function b(e){this.wrapped=e}function w(e){return new b(e)}function k(e){var t,n;function r(t,n){try{var o=e[t](n),s=o.value,a=s instanceof b;Promise.resolve(a?s.wrapped:s).then((function(e){a?r("return"===t?"return":"next",e):i(o.done?"return":"normal",e)}),(function(e){r("throw",e)}))}catch(u){i("throw",u)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new Promise((function(o,s){var a={key:e,arg:i,resolve:o,reject:s,next:null};n?n=n.next=a:(t=n=a,r(e,i))}))},"function"!==typeof e.return&&(this.return=void 0)}function x(e){return function(){return new k(e.apply(this,arguments))}}function E(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new S(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function S(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return S=function(e){this.s=e,this.n=e.next},S.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new S(e)}k.prototype["function"===typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},k.prototype.next=function(e){return this._invoke("next",e)},k.prototype.throw=function(e){return this._invoke("throw",e)},k.prototype.return=function(e){return this._invoke("return",e)};var T,C,A={9742:function(e,t){t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,o=u(e),s=o[0],a=o[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),h=0,l=a>0?s-4:s;for(n=0;n<l;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[h++]=t>>16&255,c[h++]=t>>8&255,c[h++]=255&t;return 2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[h++]=255&t),1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[h++]=t>>8&255,c[h++]=255&t),c},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],s=16383,a=0,u=r-i;a<u;a+=s)o.push(c(e,a,a+s>u?u:a+s));return 1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),o.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=o.length;s<a;++s)n[s]=o[s],r[o.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,r){for(var i,o,s=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},2090:function(e){function t(e,t){if("string"==typeof e[0])return e.join("");if("number"==typeof e[0])return new Uint8Array(e);for(var n=new Uint8Array(t),r=0,i=0,o=e.length;i<o;i++){var s=e[i];n.set(s,r),r+=s.byteLength||s.length}return n}e.exports=function(){var e=x((0,m.Z)().mark((function e(n){var r,i,o,s,a,u,c,h,l,f,d,p,v,g,y,_,b=arguments;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=b.length>1&&void 0!==b[1]?b[1]:512,i=b.length>2&&void 0!==b[2]?b[2]:{},"object"==typeof r&&(r=(i=r).size),s=(o=i).nopad,a=o.zeroPadding,u=void 0===a||a,s&&(u=!1),c=[],h=0,l=!1,f=!1,e.prev=8,p=E(n);case 10:return e.next=12,w(p.next());case 12:if(!(l=!(v=e.sent).done)){e.next=28;break}if(g=v.value,h+=g.byteLength||g.length||1,c.push(g),!(h>=r)){e.next=25;break}y=t(c,h),_=0;case 17:if(!(h>=r)){e.next=24;break}return e.next=20,y.slice(_,_+r);case 20:h-=r,_+=r;case 22:e.next=17;break;case 24:c=[y.slice(_,y.length)];case 25:l=!1,e.next=10;break;case 28:e.next=34;break;case 30:e.prev=30,e.t0=e.catch(8),f=!0,d=e.t0;case 34:if(e.prev=34,e.prev=35,!l||null==p.return){e.next=39;break}return e.next=39,w(p.return());case 39:if(e.prev=39,!f){e.next=42;break}throw d;case 42:return e.finish(39);case 43:return e.finish(34);case 44:if(e.t1=h,!e.t1){e.next=48;break}return e.next=48,t(c,u?r:h);case 48:case"end":return e.stop()}}),e,null,[[8,30,34,44],[35,,39,43]])})));return function(t){return e.apply(this,arguments)}}()},8764:function(e,t,n){var r=n(9742),i=n(645),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=function(e){return+e!=e&&(e=0),u.alloc(+e)},t.INSPECT_MAX_BYTES=50;var s=2147483647;function a(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,u.prototype),t}function u(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return l(e)}return c(e,t,n)}function c(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|b(e,t),r=a(n),i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(ee(e,Uint8Array)){var t=new Uint8Array(e);return m(t.buffer,t.byteOffset,t.byteLength)}return f(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(ee(e,ArrayBuffer)||e&&ee(e.buffer,ArrayBuffer))return m(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(ee(e,SharedArrayBuffer)||e&&ee(e.buffer,SharedArrayBuffer)))return m(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return u.from(r,t,n);var i=function(e){if(u.isBuffer(e)){var t=0|_(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||te(e.length)?a(0):f(e):"Buffer"===e.type&&Array.isArray(e.data)?f(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function h(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function l(e){return h(e),a(e<0?0:0|_(e))}function f(e){for(var t=e.length<0?0:0|_(e.length),n=a(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function m(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,u.prototype),r}function _(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function b(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||ee(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return J(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return X(e).length;default:if(i)return r?-1:J(e).length;t=(""+t).toLowerCase(),i=!0}}function w(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return B(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return O(this,t,n);case"latin1":case"binary":return Z(this,t,n);case"base64":return P(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function k(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function x(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),te(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:E(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):E(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function E(e,t,n,r,i){var o,s=1,a=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,n/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var h=-1;for(o=n;o<a;o++)if(c(e,o)===c(t,-1===h?0:o-h)){if(-1===h&&(h=o),o-h+1===u)return h*s}else-1!==h&&(o-=o-h),h=-1}else for(n+u>a&&(n=a-u),o=n;o>=0;o--){for(var l=!0,f=0;f<u;f++)if(c(e,o+f)!==c(t,f)){l=!1;break}if(l)return o}return-1}function S(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o,s=t.length;for(r>s/2&&(r=s/2),o=0;o<r;++o){var a=parseInt(t.substr(2*o,2),16);if(te(a))return o;e[n+o]=a}return o}function T(e,t,n,r){return Q(J(t,e.length-n),e,n,r)}function C(e,t,n,r){return Q(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function A(e,t,n,r){return Q(X(t),e,n,r)}function R(e,t,n,r){return Q(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function P(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function I(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o=e[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a<=n){var u=void 0,c=void 0,h=void 0,l=void 0;switch(a){case 1:o<128&&(s=o);break;case 2:128==(192&(u=e[i+1]))&&((l=(31&o)<<6|63&u)>127&&(s=l));break;case 3:u=e[i+1],c=e[i+2],128==(192&u)&&128==(192&c)&&((l=(15&o)<<12|(63&u)<<6|63&c)>2047&&(l<55296||l>57343)&&(s=l));break;case 4:u=e[i+1],c=e[i+2],h=e[i+3],128==(192&u)&&128==(192&c)&&128==(192&h)&&((l=(15&o)<<18|(63&u)<<12|(63&c)<<6|63&h)>65535&&l<1114112&&(s=l))}}null===s?(s=65533,a=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),i+=a}return function(e){var t=e.length;if(t<=L)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=L));return n}(r)}t.kMaxLength=s,u.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1),n={foo:function(){return 42}};return Object.setPrototypeOf(n,Uint8Array.prototype),Object.setPrototypeOf(t,n),42===t.foo()}catch(e){return!1}}(),u.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(e,t,n){return c(e,t,n)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(e,t,n){return function(e,t,n){return h(e),e<=0?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)}(e,t,n)},u.allocUnsafe=function(e){return l(e)},u.allocUnsafeSlow=function(e){return l(e)},u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(ee(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),ee(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(ee(o,Uint8Array))i+o.length>r.length?(u.isBuffer(o)||(o=u.from(o)),o.copy(r,i)):Uint8Array.prototype.set.call(r,o,i);else{if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i)}i+=o.length}return r},u.byteLength=b,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)k(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)k(this,t,t+3),k(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)k(this,t,t+7),k(this,t+1,t+6),k(this,t+2,t+5),k(this,t+3,t+4);return this},u.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):w.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},o&&(u.prototype[o]=u.prototype.inspect),u.prototype.compare=function(e,t,n,r,i){if(ee(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),c=this.slice(r,i),h=e.slice(t,n),l=0;l<a;++l)if(c[l]!==h[l]){o=c[l],s=h[l];break}return o<s?-1:s<o?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return x(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return x(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return S(this,e,t,n);case"utf8":case"utf-8":return T(this,e,t,n);case"ascii":case"latin1":case"binary":return C(this,e,t,n);case"base64":return A(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var L=4096;function O(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function Z(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function B(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=ne[e[o]];return i}function M(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length-1;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function N(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function j(e,t,n,r,i,o){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function U(e,t,n,r,i){V(t,r,i,e,n,7);var o=Number(t&BigInt(4294967295));e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o;var s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,n}function D(e,t,n,r,i){V(t,r,i,e,n,7);var o=Number(t&BigInt(4294967295));e[n+7]=o,o>>=8,e[n+6]=o,o>>=8,e[n+5]=o,o>>=8,e[n+4]=o;var s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=s,s>>=8,e[n+2]=s,s>>=8,e[n+1]=s,s>>=8,e[n]=s,n+8}function H(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function F(e,t,n,r,o){return t=+t,n>>>=0,o||H(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function q(e,t,n,r,o){return t=+t,n>>>=0,o||H(e,0,n,8),i.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,u.prototype),r},u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e>>>=0,t||N(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||N(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||N(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||N(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||N(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readBigUInt64LE=re((function(e){K(e>>>=0,"offset");var t=this[e],n=this[e+7];void 0!==t&&void 0!==n||Y(e,this.length-8);var r=t+256*this[++e]+65536*this[++e]+this[++e]*Math.pow(2,24),i=this[++e]+256*this[++e]+65536*this[++e]+n*Math.pow(2,24);return BigInt(r)+(BigInt(i)<<BigInt(32))})),u.prototype.readBigUInt64BE=re((function(e){K(e>>>=0,"offset");var t=this[e],n=this[e+7];void 0!==t&&void 0!==n||Y(e,this.length-8);var r=t*Math.pow(2,24)+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*Math.pow(2,24)+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)})),u.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},u.prototype.readInt8=function(e,t){return e>>>=0,t||N(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||N(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){e>>>=0,t||N(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||N(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||N(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readBigInt64LE=re((function(e){K(e>>>=0,"offset");var t=this[e],n=this[e+7];void 0!==t&&void 0!==n||Y(e,this.length-8);var r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*Math.pow(2,24))})),u.prototype.readBigInt64BE=re((function(e){K(e>>>=0,"offset");var t=this[e],n=this[e+7];void 0!==t&&void 0!==n||Y(e,this.length-8);var r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*Math.pow(2,24)+65536*this[++e]+256*this[++e]+n)})),u.prototype.readFloatLE=function(e,t){return e>>>=0,t||N(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||N(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||N(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||N(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||j(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||j(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeBigUInt64LE=re((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return U(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),u.prototype.writeBigUInt64BE=re((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return D(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);j(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);j(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeBigInt64LE=re((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return U(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),u.prototype.writeBigInt64BE=re((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return D(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),u.prototype.writeFloatLE=function(e,t,n){return F(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return F(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return q(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return q(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},u.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var i=e.charCodeAt(0);("utf8"===r&&i<128||"latin1"===r)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=u.isBuffer(e)?e:u.from(e,r),a=s.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var W={};function z(e,t,n){W[e]=function(n){(0,g.Z)(i,n);var r=(0,y.Z)(i);function i(){var n;return(0,d.Z)(this,i),n=r.call(this),Object.defineProperty((0,v.Z)(n),"message",{value:t.apply((0,v.Z)(n),arguments),writable:!0,configurable:!0}),n.name="".concat(n.name," [").concat(e,"]"),n.stack,delete n.name,n}return(0,p.Z)(i,[{key:"code",get:function(){return e},set:function(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}},{key:"toString",value:function(){return"".concat(this.name," [").concat(e,"]: ").concat(this.message)}}]),i}(n)}function G(e){for(var t="",n=e.length,r="-"===e[0]?1:0;n>=r+4;n-=3)t="_".concat(e.slice(n-3,n)).concat(t);return"".concat(e.slice(0,n)).concat(t)}function V(e,t,n,r,i,o){if(e>n||e<t){var s,a="bigint"==typeof t?"n":"";throw s=o>3?0===t||t===BigInt(0)?">= 0".concat(a," and < 2").concat(a," ** ").concat(8*(o+1)).concat(a):">= -(2".concat(a," ** ").concat(8*(o+1)-1).concat(a,") and < 2 ** ").concat(8*(o+1)-1).concat(a):">= ".concat(t).concat(a," and <= ").concat(n).concat(a),new W.ERR_OUT_OF_RANGE("value",s,e)}!function(e,t,n){K(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||Y(t,e.length-(n+1))}(r,i,o)}function K(e,t){if("number"!=typeof e)throw new W.ERR_INVALID_ARG_TYPE(t,"number",e)}function Y(e,t,n){if(Math.floor(e)!==e)throw K(e,n),new W.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new W.ERR_BUFFER_OUT_OF_BOUNDS;throw new W.ERR_OUT_OF_RANGE(n||"offset",">= ".concat(n?1:0," and <= ").concat(t),e)}z("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?"".concat(e," is outside of buffer bounds"):"Attempt to access memory outside buffer bounds"}),RangeError),z("ERR_INVALID_ARG_TYPE",(function(e,t){return'The "'.concat(e,'" argument must be of type number. Received type ').concat(typeof t)}),TypeError),z("ERR_OUT_OF_RANGE",(function(e,t,n){var r='The value of "'.concat(e,'" is out of range.'),i=n;return Number.isInteger(n)&&Math.abs(n)>Math.pow(2,32)?i=G(String(n)):"bigint"==typeof n&&(i=String(n),(n>Math.pow(BigInt(2),BigInt(32))||n<-Math.pow(BigInt(2),BigInt(32)))&&(i=G(i)),i+="n"),r+=" It must be ".concat(t,". Received ").concat(i)}),RangeError);var $=/[^+/0-9A-Za-z-_]/g;function J(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function X(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace($,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Q(e,t,n,r){var i;for(i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function ee(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function te(e){return e!=e}var ne=function(){for(var e="0123456789abcdef",t=new Array(256),n=0;n<16;++n)for(var r=16*n,i=0;i<16;++i)t[r+i]=e[n]+e[i];return t}();function re(e){return"undefined"==typeof BigInt?ie:e}function ie(){throw new Error("BigInt not supported")}},9421:function(e,t,n){var r=n(7117),i=n(4375);e.exports=function(){function e(t,n){if((0,d.Z)(this,e),this.store=t,this.chunkLength=t.chunkLength,this.inProgressGets=new Map,!this.store||!this.store.get||!this.store.put)throw new Error("First argument must be abstract-chunk-store compliant");this.cache=new r(n)}return(0,p.Z)(e,[{key:"put",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(!this.cache)return i((function(){return n(new Error("CacheStore closed"))}));this.cache.remove(e),this.store.put(e,t,n)}},{key:"get",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if("function"==typeof t)return this.get(e,null,t);if(!this.cache)return i((function(){return r(new Error("CacheStore closed"))}));t||(t={});var o=this.cache.get(e);if(o){var s=t.offset||0,a=t.length||o.length-s;return 0===s&&a===o.length||(o=o.slice(s,a+s)),i((function(){return r(null,o)}))}var u=this.inProgressGets.get(e),c=!!u;u||(u=[],this.inProgressGets.set(e,u)),u.push({opts:t,cb:r}),c||this.store.get(e,(function(t,r){t||null==n.cache||n.cache.set(e,r);var i=n.inProgressGets.get(e);n.inProgressGets.delete(e);var o,s=(0,f.Z)(i);try{for(s.s();!(o=s.n()).done;){var a=o.value,u=a.opts,c=a.cb;if(t)c(t);else{var h=u.offset||0,l=u.length||r.length-h,d=r;0===h&&l===r.length||(d=r.slice(h,l+h)),c(null,d)}}}catch(p){s.e(p)}finally{s.f()}}))}},{key:"close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(!this.cache)return i((function(){return e(new Error("CacheStore closed"))}));this.cache=null,this.store.close(e)}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(!this.cache)return i((function(){return e(new Error("CacheStore closed"))}));this.cache=null,this.store.destroy(e)}}]),e}()},6313:function(e,t,n){var r=n(8764).Buffer,i=function(){function e(e,t){return null!=t&&e instanceof t}var t,n,i;try{t=Map}catch(e){t=function(){}}try{n=Set}catch(e){n=function(){}}try{i=Promise}catch(e){i=function(){}}function o(s,u,c,h,l){"object"==typeof u&&(c=u.depth,h=u.prototype,l=u.includeNonEnumerable,u=u.circular);var f=[],d=[],p=void 0!==r;return void 0===u&&(u=!0),void 0===c&&(c=1/0),function s(c,v){if(null===c)return null;if(0===v)return c;var g,y;if("object"!=typeof c)return c;if(e(c,t))g=new t;else if(e(c,n))g=new n;else if(e(c,i))g=new i((function(e,t){c.then((function(t){e(s(t,v-1))}),(function(e){t(s(e,v-1))}))}));else if(o.__isArray(c))g=[];else if(o.__isRegExp(c))g=new RegExp(c.source,a(c)),c.lastIndex&&(g.lastIndex=c.lastIndex);else if(o.__isDate(c))g=new Date(c.getTime());else{if(p&&r.isBuffer(c))return g=r.allocUnsafe?r.allocUnsafe(c.length):new r(c.length),c.copy(g),g;e(c,Error)?g=Object.create(c):void 0===h?(y=Object.getPrototypeOf(c),g=Object.create(y)):(g=Object.create(h),y=h)}if(u){var m=f.indexOf(c);if(-1!=m)return d[m];f.push(c),d.push(g)}for(var _ in e(c,t)&&c.forEach((function(e,t){var n=s(t,v-1),r=s(e,v-1);g.set(n,r)})),e(c,n)&&c.forEach((function(e){var t=s(e,v-1);g.add(t)})),c){var b;y&&(b=Object.getOwnPropertyDescriptor(y,_)),b&&null==b.set||(g[_]=s(c[_],v-1))}if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(c);for(_=0;_<w.length;_++){var k=w[_];(!(E=Object.getOwnPropertyDescriptor(c,k))||E.enumerable||l)&&(g[k]=s(c[k],v-1),E.enumerable||Object.defineProperty(g,k,{enumerable:!1}))}}if(l){var x=Object.getOwnPropertyNames(c);for(_=0;_<x.length;_++){var E,S=x[_];(E=Object.getOwnPropertyDescriptor(c,S))&&E.enumerable||(g[S]=s(c[S],v-1),Object.defineProperty(g,S,{enumerable:!1}))}}return g}(s,c)}function s(e){return Object.prototype.toString.call(e)}function a(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return o.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},o.__objToStr=s,o.__isDate=function(e){return"object"==typeof e&&"[object Date]"===s(e)},o.__isArray=function(e){return"object"==typeof e&&"[object Array]"===s(e)},o.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===s(e)},o.__getRegExpFlags=a,o}();e.exports&&(e.exports=i)},9648:function(e){e.exports=function(){for(var e=navigator.hardwareConcurrency||1,t=[],n=0;n<e;n++)t.push({model:"",speed:0,times:{user:0,nice:0,sys:0,idle:0,irq:0}});return t}},1227:function(e,t,n){var r=n(8768);t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=function(){var e=!1;return function(){e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||function(){},e.exports=n(2447)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},2447:function(e,t,n){e.exports=function(e){function t(e){var n,i,o,s=null;function a(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(a.enabled){var o=a,s=Number(new Date),u=s-(n||s);o.diff=u,o.prev=n,o.curr=s,n=s,r[0]=t.coerce(r[0]),"string"!=typeof r[0]&&r.unshift("%O");var c=0;r[0]=r[0].replace(/%([a-zA-Z%])/g,(function(e,n){if("%%"===e)return"%";c++;var i=t.formatters[n];if("function"==typeof i){var s=r[c];e=i.call(o,s),r.splice(c,1),c--}return e})),t.formatArgs.call(o,r),(o.log||t.log).apply(o,r)}}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==s?s:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o)},set:function(e){s=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,n){var r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){var e=[].concat((0,l.Z)(t.names.map(i)),(0,l.Z)(t.skips.map(i).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){var n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(7824),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(n){t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},2840:function(e,t,n){var r=n(8768),i=n(778),o=function(){};e.exports=function e(t,n,s){if("function"==typeof n)return e(t,null,n);n||(n={}),s=i(s||o);var a=t._writableState,u=t._readableState,c=n.readable||!1!==n.readable&&t.readable,h=n.writable||!1!==n.writable&&t.writable,l=!1,f=function(){t.writable||d()},d=function(){h=!1,c||s.call(t)},p=function(){c=!1,h||s.call(t)},v=function(e){s.call(t,e?new Error("exited with error code: "+e):null)},g=function(e){s.call(t,e)},y=function(){r.nextTick(m)},m=function(){if(!l)return(!c||u&&u.ended&&!u.destroyed)&&(!h||a&&a.ended&&!a.destroyed)?void 0:s.call(t,new Error("premature close"))},_=function(){t.req.on("finish",d)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",d),t.on("abort",y),t.req?_():t.on("request",_)):h&&!a&&(t.on("end",f),t.on("close",f)),function(e){return e.stdio&&Array.isArray(e.stdio)&&3===e.stdio.length}(t)&&t.on("exit",v),t.on("end",p),t.on("finish",d),!1!==n.error&&t.on("error",g),t.on("close",y),function(){l=!0,t.removeListener("complete",d),t.removeListener("abort",y),t.removeListener("request",_),t.req&&t.req.removeListener("finish",d),t.removeListener("end",f),t.removeListener("close",f),t.removeListener("finish",d),t.removeListener("exit",v),t.removeListener("end",p),t.removeListener("error",g),t.removeListener("close",y)}}},2114:function(e){function t(e,t){for(var n in t)Object.defineProperty(e,n,{value:t[n],enumerable:!0,configurable:!0});return e}e.exports=function(e,n,r){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");r||(r={}),"object"==typeof n&&(r=n,n=""),n&&(r.code=n);try{return t(e,r)}catch(n){r.message=e.message,r.stack=e.stack;var i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(e)),t(new i,r)}}},5573:function(e){var t=/["'&<>]/;e.exports=function(e){var n,r=""+e,i=t.exec(r);if(!i)return r;var o="",s=0,a=0;for(s=i.index;s<r.length;s++){switch(r.charCodeAt(s)){case 34:n="&quot;";break;case 38:n="&amp;";break;case 39:n="&#39;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}a!==s&&(o+=r.substring(a,s)),a=s+1,o+=n}return a!==s?o+r.substring(a,s):o}},7187:function(e){var t=Object.create||function(e){var t=function(){};return t.prototype=e,new t},n=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n},r=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function i(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=t(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0;var o,s=10;try{var a={};Object.defineProperty&&Object.defineProperty(a,"x",{value:0}),o=0===a.x}catch(e){o=!1}function u(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function c(e,n,r,i){var o,s,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",n,r.listener?r.listener:r),s=e._events),a=s[n]):(s=e._events=t(null),e._eventsCount=0),a){if("function"==typeof a?a=s[n]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),!a.warned&&(o=u(e))&&o>0&&a.length>o){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(n)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');c.name="MaxListenersExceededWarning",c.emitter=e,c.type=n,c.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",c.name,c.message)}}else a=s[n]=r,++e._eventsCount;return e}function h(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function l(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=r.call(h,i);return o.listener=n,i.wrapFn=o,o}function f(e,t,n){var r=e._events;if(!r)return[];var i=r[t];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):p(i,i.length):[]}function d(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function p(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}o?Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');s=e}}):i.defaultMaxListeners=s,i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return u(this)},i.prototype.emit=function(e){var t,n,r,i,o,s,a="error"===e;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var u=new Error('Unhandled "error" event. ('+t+")");throw u.context=t,u}if(!(n=s[e]))return!1;var c="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,i=p(e,r),o=0;o<r;++o)i[o].call(n)}(n,c,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=p(e,i),s=0;s<i;++s)o[s].call(n,r)}(n,c,this,arguments[1]);break;case 3:!function(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,s=p(e,o),a=0;a<o;++a)s[a].call(n,r,i)}(n,c,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var s=e.length,a=p(e,s),u=0;u<s;++u)a[u].call(n,r,i,o)}(n,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];!function(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=p(e,i),s=0;s<i;++s)o[s].apply(n,r)}(n,c,this,i)}return!0},i.prototype.addListener=function(e,t){return c(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return c(this,e,t,!0)},i.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,l(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,l(this,e,t)),this},i.prototype.removeListener=function(e,n){var r,i,o,s,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(r=i[e]))return this;if(r===n||r.listener===n)0==--this._eventsCount?this._events=t(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if("function"!=typeof r){for(o=-1,s=r.length-1;s>=0;s--)if(r[s]===n||r[s].listener===n){a=r[s].listener,o=s;break}if(o<0)return this;0===o?r.shift():function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(r,o),1===r.length&&(i[e]=r[0]),i.removeListener&&this.emit("removeListener",e,a||n)}return this},i.prototype.removeAllListeners=function(e){var r,i,o;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=t(null),this._eventsCount=0):i[e]&&(0==--this._eventsCount?this._events=t(null):delete i[e]),this;if(0===arguments.length){var s,a=n(i);for(o=0;o<a.length;++o)"removeListener"!==(s=a[o])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=t(null),this._eventsCount=0,this}if("function"==typeof(r=i[e]))this.removeListener(e,r);else if(r)for(o=r.length-1;o>=0;o--)this.removeListener(e,r[o]);return this},i.prototype.listeners=function(e){return f(this,e,!0)},i.prototype.rawListeners=function(e){return f(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},i.prototype.listenerCount=d,i.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},3975:function(e){e.exports=function(){function e(t){if((0,d.Z)(this,e),!(t>0)||0!=(t-1&t))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}return(0,p.Z)(e,[{key:"push",value:function(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}},{key:"shift",value:function(){var e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}},{key:"peek",value:function(){return this.buffer[this.btm]}},{key:"isEmpty",value:function(){return void 0===this.buffer[this.btm]}}]),e}()},1607:function(e,t,n){var r=n(3975);e.exports=function(){function e(t){(0,d.Z)(this,e),this.hwm=t||16,this.head=new r(this.hwm),this.tail=this.head}return(0,p.Z)(e,[{key:"push",value:function(e){if(!this.head.push(e)){var t=this.head;this.head=t.next=new r(2*this.head.buffer.length),this.head.push(e)}}},{key:"shift",value:function(){var e=this.tail.shift();if(void 0===e&&this.tail.next){var t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return e}},{key:"peek",value:function(){return this.tail.peek()}},{key:"isEmpty",value:function(){return this.head.isEmpty()}}]),e}()},3811:function(){"undefined"==typeof ReadableStream||ReadableStream.prototype[Symbol.asyncIterator]||(ReadableStream.prototype[Symbol.asyncIterator]=function(){var e=this.getReader(),t=e.read();return(0,h.Z)({next:function(){var n=t;return t=e.read(),n},return:function(){t.then((function(){return e.releaseLock()}))},throw:function(e){throw this.return(),e}},Symbol.asyncIterator,(function(){return this}))})},5177:function(e){e.exports=function(){if("undefined"==typeof globalThis)return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}},4137:function(e,t,n){var r=n(8764).Buffer,i=n(3029),o=n(7187).EventEmitter,s=n(4375);e.exports=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var o;if((0,d.Z)(this,n),r||(r={}),(o=t.call(this)).chunkLength=Number(e),!o.chunkLength)throw new Error("First argument must be a chunk length");return o.closed=!1,o.destroyed=!1,o.length=Number(r.length)||1/0,o.name=r.name||"idb-chunk-store",o.length!==1/0&&(o.lastChunkLength=o.length%o.chunkLength||o.chunkLength,o.lastChunkIndex=Math.ceil(o.length/o.chunkLength)-1),o.dbPromise=i.openDB(o.name,void 0,{upgrade:function(e){e.createObjectStore("chunks")},blocking:function(){o.close()},terminated:function(){o.closed=!0,o.emit("error",new Error("Database unexpectedly closed"))}}),(0,c.Z)(o)}return(0,p.Z)(n,[{key:"put",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(this.closed)return s((function(){return r(new Error("Storage is closed"))}));var i=e===this.lastChunkIndex;return i&&t.length!==this.lastChunkLength?s((function(){return r(new Error("Last chunk length must be "+n.lastChunkLength))})):i||t.length===this.chunkLength?(0===(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)).byteOffset&&t.byteLength===t.buffer.byteLength||(t=t.slice()),void(0,u.Z)((0,m.Z)().mark((function i(){var o;return(0,m.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,n.dbPromise;case 3:return o=i.sent,i.next=6,o.put("chunks",t,e);case 6:i.next=11;break;case 8:return i.prev=8,i.t0=i.catch(0),i.abrupt("return",void r(i.t0));case 11:r(null);case 12:case"end":return i.stop()}}),i,null,[[0,8]])})))()):s((function(){return r(new Error("Chunk length must be "+n.chunkLength))}))}},{key:"get",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};return"function"==typeof t?this.get(e,{},t):(t||(t={}),this.closed?s((function(){return i(new Error("Storage is closed"))})):void(0,u.Z)((0,m.Z)().mark((function o(){var s,a,u,c,h,l;return(0,m.Z)().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,n.dbPromise;case 3:return a=o.sent,o.next=6,a.get("chunks",e);case 6:s=o.sent,o.next=12;break;case 9:return o.prev=9,o.t0=o.catch(0),o.abrupt("return",void i(o.t0));case 12:if(null!=s){o.next=15;break}return u=new Error("Chunk not found"),o.abrupt("return",(u.notFound=!0,void i(u)));case 15:c=r.from(s.buffer,s.byteOffset,s.byteLength),h=t.offset||0,l=t.length||c.length-h,0===h&&l===c.length||(c=c.slice(h,l+h)),i(null,c);case 18:case"end":return o.stop()}}),o,null,[[0,9]])})))())}},{key:"close",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this.closed)return s((function(){return t(new Error("Storage is closed"))}));this.closed=!0,(0,u.Z)((0,m.Z)().mark((function n(){return(0,m.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.dbPromise;case 3:n.sent.close(),n.next=9;break;case 6:return n.prev=6,n.t0=n.catch(0),n.abrupt("return",void t(n.t0));case 9:t(null);case 10:case"end":return n.stop()}}),n,null,[[0,6]])})))()}},{key:"destroy",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};return this.closed?s((function(){return t(new Error("Storage is closed"))})):this.destroyed?s((function(){return t(new Error("Storage is destroyed"))})):(this.destroyed=!0,void this.close(function(){var n=(0,u.Z)((0,m.Z)().mark((function n(r){return(0,m.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!r){n.next=4;break}t(r),n.next=13;break;case 4:return n.prev=4,n.next=7,i.deleteDB(e.name);case 7:n.next=12;break;case 9:return n.prev=9,n.t0=n.catch(4),n.abrupt("return",void t(n.t0));case 12:t(null);case 13:case"end":return n.stop()}}),n,null,[[4,9]])})));return function(e){return n.apply(this,arguments)}}()))}}]),n}(o)},3029:function(e,t,n){n.r(t),n.d(t,{deleteDB:function(){return y},openDB:function(){return g},unwrap:function(){return v},wrap:function(){return p}});var r,i,o=new WeakMap,s=new WeakMap,c=new WeakMap,h=new WeakMap,l=new WeakMap,f={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return s.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function d(e){return"function"==typeof e?function(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(v(this),n),p(o.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return p(e.apply(v(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=e.call.apply(e,[v(this),t].concat(r));return c.set(o,t.sort?t.sort():[t]),p(o)}}(e):(e instanceof IDBTransaction&&function(e){if(!s.has(e)){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=function(){t(),r()},o=function(){n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)}));s.set(e,t)}}(e),function(e,t){return t.some((function(t){return e instanceof t}))}(e,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,f):e)}function p(e){if(e instanceof IDBRequest)return function(e){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("success",i),e.removeEventListener("error",o)},i=function(){t(p(e.result)),r()},o=function(){n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",o)}));return t.then((function(t){t instanceof IDBCursor&&o.set(t,e)})).catch((function(){})),l.set(t,e),t}(e);if(h.has(e))return h.get(e);var t=d(e);return t!==e&&(h.set(e,t),l.set(t,e)),t}var v=function(e){return l.get(e)};function g(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.blocked,i=n.upgrade,o=n.blocking,s=n.terminated,a=indexedDB.open(e,t),u=p(a);return i&&a.addEventListener("upgradeneeded",(function(e){i(p(a.result),e.oldVersion,e.newVersion,p(a.transaction))})),r&&a.addEventListener("blocked",(function(){return r()})),u.then((function(e){s&&e.addEventListener("close",(function(){return s()})),o&&e.addEventListener("versionchange",(function(){return o()}))})).catch((function(){})),u}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.blocked,r=indexedDB.deleteDatabase(e);return n&&r.addEventListener("blocked",(function(){return n()})),p(r).then((function(){}))}var _=["get","getKey","getAll","getAllKeys","count"],b=["put","add","delete","clear"],w=new Map;function k(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(w.get(t))return w.get(t);var n=t.replace(/FromIndex$/,""),r=t!==n,i=b.includes(n);if(n in(r?IDBIndex:IDBObjectStore).prototype&&(i||_.includes(n))){var o=function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var o,s,a,u,c,h,l=arguments;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.transaction(t,i?"readwrite":"readonly"),a=s.store,u=l.length,c=new Array(u>1?u-1:0),h=1;h<u;h++)c[h-1]=l[h];return r&&(a=a.index(c.shift())),e.next=6,Promise.all([(o=a)[n].apply(o,c),i&&s.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return w.set(t,o),o}}}f=function(e){return(0,a.Z)((0,a.Z)({},e),{},{get:function(t,n,r){return k(t,n)||e.get(t,n,r)},has:function(t,n){return!!k(t,n)||e.has(t,n)}})}(f)},645:function(e,t){t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,u=(1<<a)-1,c=u>>1,h=-7,l=n?i-1:0,f=n?-1:1,d=e[t+l];for(l+=f,o=d&(1<<-h)-1,d>>=-h,h+=a;h>0;o=256*o+e[t+l],l+=f,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=r;h>0;s=256*s+e[t+l],l+=f,h-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=c}return(d?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,u,c=8*o-i-1,h=(1<<c)-1,l=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,p=r?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=h):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+l>=1?f/u:f*Math.pow(2,1-l))*u>=2&&(s++,u/=2),s+l>=h?(a=0,s=h):s+l>=1?(a=(t*u-1)*Math.pow(2,i),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;e[n+d]=255&a,d+=p,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[n+d]=255&s,d+=p,s/=256,c-=8);e[n+d-p]|=128*v}},3700:function(e,t,n){var r=n(4375);e.exports=function(){function e(t){if((0,d.Z)(this,e),this.store=t,this.chunkLength=t.chunkLength,!this.store||!this.store.get||!this.store.put)throw new Error("First argument must be abstract-chunk-store compliant");this.mem=[]}return(0,p.Z)(e,[{key:"put",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this.mem[e]=t,this.store.put(e,t,(function(t){n.mem[e]=null,r(t)}))}},{key:"get",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if("function"==typeof t)return this.get(e,null,t);var i=this.mem[e];if(!i)return this.store.get(e,t,n);t||(t={});var o=t.offset||0,s=t.length||i.length-o;0===o&&s===i.length||(i=i.slice(o,s+o)),r((function(){return n(null,i)}))}},{key:"close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.store.close(e)}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.store.destroy(e)}}]),e}()},5717:function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},8225:function(e){e.exports=function(){var e=x((0,m.Z)().mark((function e(t){var n,r,i;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,f.Z)(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return"function"==typeof(i=r.value)&&(i=i()),e.delegateYield(_(E(i),w),"t0",7);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t1=e.catch(1),n.e(e.t1);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})));return function(t){return e.apply(this,arguments)}}()},1351:function(e,t){t.re=function(){throw new Error("`junk.re` was renamed to `junk.regex`")},t.regex=new RegExp(["^npm-debug\\.log$","^\\..*\\.swp$","^\\.DS_Store$","^\\.AppleDouble$","^\\.LSOverride$","^Icon\\r$","^\\._.*","^\\.Spotlight-V100(?:$|\\/)","\\.Trashes","^__MACOSX$","~$","^Thumbs\\.db$","^ehthumbs\\.db$","^Desktop\\.ini$","@eaDir$"].join("|")),t.is=function(e){return t.regex.test(e)},t.not=function(e){return!t.is(e)},t.default=e.exports},5516:function(e,t,n){t.RateLimiter=n(1114),t.TokenBucket=n(4976)},6188:function(e,t,n){var r=n(8768);e.exports=function(){if(void 0!==r&&r.hrtime){var e=r.hrtime(),t=e[0],n=e[1];return 1e3*t+Math.floor(n/1e6)}return(new Date).getTime()}},1114:function(e,t,n){var r=n(8768),i=n(4976),o=n(6188),s=function(e,t,n){this.tokenBucket=new i(e,e,t,null),this.tokenBucket.content=e,this.curIntervalStart=o(),this.tokensThisInterval=0,this.fireImmediately=n};s.prototype={tokenBucket:null,curIntervalStart:0,tokensThisInterval:0,fireImmediately:!1,removeTokens:function(e,t){if(e>this.tokenBucket.bucketSize)return r.nextTick(t.bind(null,"Requested tokens "+e+" exceeds maximum tokens per interval "+this.tokenBucket.bucketSize,null)),!1;var n=this,i=o();if((i<this.curIntervalStart||i-this.curIntervalStart>=this.tokenBucket.interval)&&(this.curIntervalStart=i,this.tokensThisInterval=0),e>this.tokenBucket.tokensPerInterval-this.tokensThisInterval){if(this.fireImmediately)r.nextTick(t.bind(null,null,-1));else{var s=Math.ceil(this.curIntervalStart+this.tokenBucket.interval-i);setTimeout((function(){n.tokenBucket.removeTokens(e,a)}),s)}return!1}return this.tokenBucket.removeTokens(e,a);function a(r,i){if(r)return t(r,null);n.tokensThisInterval+=e,t(null,i)}},tryRemoveTokens:function(e){if(e>this.tokenBucket.bucketSize)return!1;var t=o();if((t<this.curIntervalStart||t-this.curIntervalStart>=this.tokenBucket.interval)&&(this.curIntervalStart=t,this.tokensThisInterval=0),e>this.tokenBucket.tokensPerInterval-this.tokensThisInterval)return!1;var n=this.tokenBucket.tryRemoveTokens(e);return n&&(this.tokensThisInterval+=e),n},getTokensRemaining:function(){return this.tokenBucket.drip(),this.tokenBucket.content}},e.exports=s},4976:function(e,t,n){var r=n(8768),i=function(e,t,n,r){if(this.bucketSize=e,this.tokensPerInterval=t,"string"==typeof n)switch(n){case"sec":case"second":this.interval=1e3;break;case"min":case"minute":this.interval=6e4;break;case"hr":case"hour":this.interval=36e5;break;case"day":this.interval=864e5;break;default:throw new Error("Invaid interval "+n)}else this.interval=n;this.parentBucket=r,this.content=0,this.lastDrip=+new Date};i.prototype={bucketSize:1,tokensPerInterval:1,interval:1e3,parentBucket:null,content:0,lastDrip:0,removeTokens:function(e,t){var n=this;return this.bucketSize?e>this.bucketSize?(r.nextTick(t.bind(null,"Requested tokens "+e+" exceeds bucket size "+this.bucketSize,null)),!1):(this.drip(),e>this.content?i():this.parentBucket?this.parentBucket.removeTokens(e,(function(r,o){return r?t(r,null):e>n.content?i():(n.content-=e,void t(null,Math.min(o,n.content)))})):(this.content-=e,r.nextTick(t.bind(null,null,this.content)),!0)):(r.nextTick(t.bind(null,null,e,Number.POSITIVE_INFINITY)),!0);function i(){var r=Math.ceil((e-n.content)*(n.interval/n.tokensPerInterval));return setTimeout((function(){n.removeTokens(e,t)}),r),!1}},tryRemoveTokens:function(e){return!this.bucketSize||!(e>this.bucketSize)&&(this.drip(),!(e>this.content)&&!(this.parentBucket&&!this.parentBucket.tryRemoveTokens(e))&&(this.content-=e,!0))},drip:function(){if(this.tokensPerInterval){var e=+new Date,t=Math.max(e-this.lastDrip,0);this.lastDrip=e;var n=t*(this.tokensPerInterval/this.interval);this.content=Math.min(this.content+n,this.bucketSize)}else this.content=this.bucketSize}},e.exports=i},7117:function(e,t,n){var r=n(7187),i=n(5717);function o(e){if(!(this instanceof o))return new o(e);"number"==typeof e&&(e={max:e}),e||(e={}),r.EventEmitter.call(this),this.cache={},this.head=this.tail=null,this.length=0,this.max=e.max||1e3,this.maxAge=e.maxAge||0}e.exports=o,i(o,r.EventEmitter),Object.defineProperty(o.prototype,"keys",{get:function(){return Object.keys(this.cache)}}),o.prototype.clear=function(){this.cache={},this.head=this.tail=null,this.length=0},o.prototype.remove=function(e){if("string"!=typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){var t=this.cache[e];return delete this.cache[e],this._unlink(e,t.prev,t.next),t.value}},o.prototype._unlink=function(e,t,n){this.length--,0===this.length?this.head=this.tail=null:this.head===e?(this.head=t,this.cache[this.head].next=null):this.tail===e?(this.tail=n,this.cache[this.tail].prev=null):(this.cache[t].next=n,this.cache[n].prev=t)},o.prototype.peek=function(e){if(this.cache.hasOwnProperty(e)){var t=this.cache[e];if(this._checkAge(e,t))return t.value}},o.prototype.set=function(e,t){var n;if("string"!=typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){if((n=this.cache[e]).value=t,this.maxAge&&(n.modified=Date.now()),e===this.head)return t;this._unlink(e,n.prev,n.next)}else n={value:t,modified:0,next:null,prev:null},this.maxAge&&(n.modified=Date.now()),this.cache[e]=n,this.length===this.max&&this.evict();return this.length++,n.next=null,n.prev=this.head,this.head&&(this.cache[this.head].next=e),this.head=e,this.tail||(this.tail=e),t},o.prototype._checkAge=function(e,t){return!(this.maxAge&&Date.now()-t.modified>this.maxAge)||(this.remove(e),this.emit("evict",{key:e,value:t.value}),!1)},o.prototype.get=function(e){if("string"!=typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){var t=this.cache[e];if(this._checkAge(e,t))return this.head!==e&&(e===this.tail?(this.tail=t.next,this.cache[this.tail].prev=null):this.cache[t.prev].next=t.next,this.cache[t.next].prev=t.prev,this.cache[this.head].next=e,t.prev=this.head,t.next=null,this.head=e),t.value}},o.prototype.evict=function(){if(this.tail){var e=this.tail,t=this.remove(this.tail);this.emit("evict",{key:e,value:t})}}},9417:function(e,t,n){var r=n(8764).Buffer,i=n(6581),o=n(7187).EventEmitter,s=n(1227)("lt_donthave");e.exports=function(){var e=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,d.Z)(this,n),(r=t.call(this))._peerSupports=!1,r._wire=e,r}return(0,p.Z)(n,[{key:"onExtendedHandshake",value:function(){this._peerSupports=!0}},{key:"onMessage",value:function(e){var t;try{t=e.readUInt32BE()}catch(n){return}this._wire.peerPieces.get(t)&&(s("got donthave %d",t),this._wire.peerPieces.set(t,!1),this.emit("donthave",t),this._failRequests(t))}},{key:"donthave",value:function(e){if(this._peerSupports){s("donthave %d",e);var t=r.alloc(4);t.writeUInt32BE(e),this._wire.extended("lt_donthave",t)}}},{key:"_failRequests",value:function(e){for(var t=this._wire.requests,n=0;n<t.length;n++){var r=t[n];r.piece===e&&(i(t,n),n-=1,this._wire._callback(r,new Error("peer sent donthave"),null))}}}]),n}(o);return e.prototype.name="lt_donthave",e}},1191:function(e,t,n){e.exports=i;var r=n(4375);function i(e,t){if(!(this instanceof i))return new i(e,t);if(t||(t={}),this.chunkLength=Number(e),!this.chunkLength)throw new Error("First argument must be a chunk length");this.chunks=[],this.closed=!1,this.length=Number(t.length)||1/0,this.length!==1/0&&(this.lastChunkLength=this.length%this.chunkLength||this.chunkLength,this.lastChunkIndex=Math.ceil(this.length/this.chunkLength)-1)}i.prototype.put=function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(this.closed)return r((function(){return i(new Error("Storage is closed"))}));var o=e===this.lastChunkIndex;return o&&t.length!==this.lastChunkLength?r((function(){return i(new Error("Last chunk length must be "+n.lastChunkLength))})):o||t.length===this.chunkLength?(this.chunks[e]=t,void r((function(){return i(null)}))):r((function(){return i(new Error("Chunk length must be "+n.chunkLength))}))},i.prototype.get=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if("function"==typeof t)return this.get(e,null,t);if(this.closed)return r((function(){return n(new Error("Storage is closed"))}));var i=this.chunks[e];if(!i){var o=new Error("Chunk not found");return o.notFound=!0,r((function(){return n(o)}))}t||(t={});var s=t.offset||0,a=t.length||i.length-s;0===s&&a===i.length||(i=i.slice(s,a+s)),r((function(){return n(null,i)}))},i.prototype.close=i.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this.closed)return r((function(){return e(new Error("Storage is closed"))}));this.closed=!0,this.chunks=null,r((function(){return e(null)}))}},9146:function(e){function t(){this._types=Object.create(null),this._extensions=Object.create(null);for(var e=0;e<arguments.length;e++)this.define(arguments[e]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}t.prototype.define=function(e,t){for(var n in e){var r=e[n].map((function(e){return e.toLowerCase()}));n=n.toLowerCase();for(var i=0;i<r.length;i++){var o=r[i];if("*"!==o[0]){if(!t&&o in this._types)throw new Error('Attempt to change mapping for "'+o+'" extension from "'+this._types[o]+'" to "'+n+'". Pass `force=true` to allow this, otherwise remove "'+o+'" from the list of extensions for "'+n+'".');this._types[o]=n}}if(t||!this._extensions[n]){var s=r[0];this._extensions[n]="*"!==s[0]?s:s.substr(1)}}},t.prototype.getType=function(e){var t=(e=String(e)).replace(/^.*[/\\]/,"").toLowerCase(),n=t.replace(/^.*\./,"").toLowerCase(),r=t.length<e.length;return(n.length<t.length-1||!r)&&this._types[n]||null},t.prototype.getExtension=function(e){return(e=/^\s*([^;\s]*)/.test(e)&&RegExp.$1)&&this._extensions[e.toLowerCase()]||null},e.exports=t},2109:function(e,t,n){var r=n(9146);e.exports=new r(n(4415))},4415:function(e){e.exports={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["es","ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]}},7824:function(e){var t=1e3,n=60*t,r=60*n,i=24*r;function o(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,s){s=s||{};var a=typeof e;if("string"===a&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(o){var s=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return s*i;case"hours":case"hour":case"hrs":case"hr":case"h":return s*r;case"minutes":case"minute":case"mins":case"min":case"m":return s*n;case"seconds":case"second":case"secs":case"sec":case"s":return s*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===a&&isFinite(e))return s.long?function(e){var s=Math.abs(e);return s>=i?o(e,s,i,"day"):s>=r?o(e,s,r,"hour"):s>=n?o(e,s,n,"minute"):s>=t?o(e,s,t,"second"):e+" ms"}(e):function(e){var o=Math.abs(e);return o>=i?Math.round(e/i)+"d":o>=r?Math.round(e/r)+"h":o>=n?Math.round(e/n)+"m":o>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},778:function(e,t,n){var r=n(2479);function i(e){var t=function t(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function o(e){var t=function t(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},n=e.name||"Function wrapped with `once`";return t.onceError=n+" shouldn't be called more than once",t.called=!1,t}e.exports=r(i),e.exports.strict=r(o),i.proto=i((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return i(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return o(this)},configurable:!0})}))},6470:function(e,t,n){var r=n(8768);function i(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function o(e,t){for(var n,r="",i=0,o=-1,s=0,a=0;a<=e.length;++a){if(a<e.length)n=e.charCodeAt(a);else{if(47===n)break;n=47}if(47===n){if(o===a-1||1===s);else if(o!==a-1&&2===s){if(r.length<2||2!==i||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){var u=r.lastIndexOf("/");if(u!==r.length-1){-1===u?(r="",i=0):i=(r=r.slice(0,u)).length-1-r.lastIndexOf("/"),o=a,s=0;continue}}else if(2===r.length||1===r.length){r="",i=0,o=a,s=0;continue}t&&(r.length>0?r+="/..":r="..",i=2)}else r.length>0?r+="/"+e.slice(o+1,a):r=e.slice(o+1,a),i=a-o-1;o=a,s=0}else 46===n&&-1!==s?++s:s=-1}return r}var s={resolve:function(){for(var e,t="",n=!1,s=arguments.length-1;s>=-1&&!n;s--){var a;s>=0?a=arguments[s]:(void 0===e&&(e=r.cwd()),a=e),i(a),0!==a.length&&(t=a+"/"+t,n=47===a.charCodeAt(0))}return t=o(t,!n),n?t.length>0?"/"+t:"/":t.length>0?t:"."},normalize:function(e){if(i(e),0===e.length)return".";var t=47===e.charCodeAt(0),n=47===e.charCodeAt(e.length-1);return 0!==(e=o(e,!t)).length||t||(e="."),e.length>0&&n&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return i(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,t=0;t<arguments.length;++t){var n=arguments[t];i(n),n.length>0&&(void 0===e?e=n:e+="/"+n)}return void 0===e?".":s.normalize(e)},relative:function(e,t){if(i(e),i(t),e===t)return"";if((e=s.resolve(e))===(t=s.resolve(t)))return"";for(var n=1;n<e.length&&47===e.charCodeAt(n);++n);for(var r=e.length,o=r-n,a=1;a<t.length&&47===t.charCodeAt(a);++a);for(var u=t.length-a,c=o<u?o:u,h=-1,l=0;l<=c;++l){if(l===c){if(u>c){if(47===t.charCodeAt(a+l))return t.slice(a+l+1);if(0===l)return t.slice(a+l)}else o>c&&(47===e.charCodeAt(n+l)?h=l:0===l&&(h=0));break}var f=e.charCodeAt(n+l);if(f!==t.charCodeAt(a+l))break;47===f&&(h=l)}var d="";for(l=n+h+1;l<=r;++l)l!==r&&47!==e.charCodeAt(l)||(0===d.length?d+="..":d+="/..");return d.length>0?d+t.slice(a+h):(a+=h,47===t.charCodeAt(a)&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(i(e),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,o=!0,s=e.length-1;s>=1;--s)if(47===(t=e.charCodeAt(s))){if(!o){r=s;break}}else o=!1;return-1===r?n?"/":".":n&&1===r?"//":e.slice(0,r)},basename:function(e,t){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');i(e);var n,r=0,o=-1,s=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,u=-1;for(n=e.length-1;n>=0;--n){var c=e.charCodeAt(n);if(47===c){if(!s){r=n+1;break}}else-1===u&&(s=!1,u=n+1),a>=0&&(c===t.charCodeAt(a)?-1==--a&&(o=n):(a=-1,o=u))}return r===o?o=u:-1===o&&(o=e.length),e.slice(r,o)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!s){r=n+1;break}}else-1===o&&(s=!1,o=n+1);return-1===o?"":e.slice(r,o)},extname:function(e){i(e);for(var t=-1,n=0,r=-1,o=!0,s=0,a=e.length-1;a>=0;--a){var u=e.charCodeAt(a);if(47!==u)-1===r&&(o=!1,r=a+1),46===u?-1===t?t=a:1!==s&&(s=1):-1!==t&&(s=-1);else if(!o){n=a+1;break}}return-1===t||-1===r||0===s||1===s&&t===r-1&&t===n+1?"":e.slice(t,r)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var n=t.dir||t.root,r=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+r:n+"/"+r:r}(0,e)},parse:function(e){i(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;var n,r=e.charCodeAt(0),o=47===r;o?(t.root="/",n=1):n=0;for(var s=-1,a=0,u=-1,c=!0,h=e.length-1,l=0;h>=n;--h)if(47!==(r=e.charCodeAt(h)))-1===u&&(c=!1,u=h+1),46===r?-1===s?s=h:1!==l&&(l=1):-1!==s&&(l=-1);else if(!c){a=h+1;break}return-1===s||-1===u||0===l||1===l&&s===u-1&&s===a+1?-1!==u&&(t.base=t.name=0===a&&o?e.slice(1,u):e.slice(a,u)):(0===a&&o?(t.name=e.slice(1,s),t.base=e.slice(1,u)):(t.name=e.slice(a,s),t.base=e.slice(a,u)),t.ext=e.slice(s,u)),a>0?t.dir=e.slice(0,a-1):o&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};s.posix=s,e.exports=s},3786:function(e){e.exports=function(e){return Math.max(16384,1<<Math.log2(e<1024?1:e/1024)+.5|0)}},4286:function(e,t,n){var r=n(8768),i=n(778),o=n(2840),s=n(1156),a=function(){},u=/^v?\.0/.test(r.version),c=function(e){return"function"==typeof e},h=function(e,t,n,r){r=i(r);var h=!1;e.on("close",(function(){h=!0})),o(e,{readable:t,writable:n},(function(e){if(e)return r(e);h=!0,r()}));var l=!1;return function(t){if(!h&&!l)return l=!0,function(e){return!!u&&!!s&&(e instanceof(s.ReadStream||a)||e instanceof(s.WriteStream||a))&&c(e.close)}(e)?e.close(a):function(e){return e.setHeader&&c(e.abort)}(e)?e.abort():c(e.destroy)?e.destroy():void r(t||new Error("stream was destroyed"))}},l=function(e){e()},f=function(e,t){return e.pipe(t)};e.exports=function(){var e,t=Array.prototype.slice.call(arguments),n=c(t[t.length-1]||a)&&t.pop()||a;if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new Error("pump requires two streams per minimum");var r=t.map((function(i,o){var s=o<t.length-1;return h(i,s,o>0,(function(t){e||(e=t),t&&r.forEach(l),s||(r.forEach(l),n(e))}))}));return t.reduce(f)}},4375:function(e){var t;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:globalThis):function(e){return(t||(t=Promise.resolve())).then(e).catch((function(e){return setTimeout((function(){throw e}),0)}))}},3527:function(e){e.exports="function"==typeof queueMicrotask?queueMicrotask:function(e){return Promise.resolve().then(e)}},5960:function(e){e.exports=function(e){var t=0;return function(){if(t===e.length)return null;var n=e.length-t,r=Math.random()*n|0,i=e[t+r],o=e[t];return e[t]=i,e[t+r]=o,t++,i}}},1798:function(e,t,n){var r=n(8768),i=65536,o=n(9509).Buffer,s=globalThis.crypto||globalThis.msCrypto;s&&s.getRandomValues?e.exports=function(e,t){if(e>4294967295)throw new RangeError("requested too many random bytes");var n=o.allocUnsafe(e);if(e>0)if(e>i)for(var a=0;a<e;a+=i)s.getRandomValues(n.slice(a,a+i));else s.getRandomValues(n);return"function"==typeof t?r.nextTick((function(){t(null,n)})):n}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}},4622:function(e){function t(e,t){return{start:e.start,end:e.end,index:t}}function n(e){return{start:e.start,end:e.end}}function r(e,t){return e.index-t.index}function i(e,t){return e.start-t.start}e.exports=function(e,o,s){if("string"!=typeof o)throw new TypeError("argument str must be a string");var a=o.indexOf("=");if(-1===a)return-2;var u=o.slice(a+1).split(","),c=[];c.type=o.slice(0,a);for(var h=0;h<u.length;h++){var l=u[h].split("-"),f=parseInt(l[0],10),d=parseInt(l[1],10);isNaN(f)?(f=e-d,d=e-1):isNaN(d)&&(d=e-1),d>e-1&&(d=e-1),isNaN(f)||isNaN(d)||f>d||f<0||c.push({start:f,end:d})}return c.length<1?-1:s&&s.combine?function(e){for(var o=e.map(t).sort(i),s=0,a=1;a<o.length;a++){var u=o[a],c=o[s];u.start>c.end+1?o[++s]=u:u.end>c.end&&(c.end=u.end,c.index=Math.min(c.index,u.index))}o.length=s+1;var h=o.sort(r).map(n);return h.type=e.type,h}(c):c}},7830:function(e){function t(e){return parseInt(e,10)===e}function n(e){function n(t){if(void 0===t){t=new Array(e);for(var n=0;n<e;n++)t[n]=Math.floor(Math.random()*e)}else if("string"==typeof t)t=(t=""+t).split("").map((function(t){return t.charCodeAt(0)%e}));else{if(!Array.isArray(t))throw new TypeError("invalid seed key specified");if(!t.every((function(e){return"number"==typeof e&&e===(0|e)})))throw new TypeError("invalid seed key specified: not array of integers")}for(var r=t.length,i=function(){for(var t=new Array(e),n=0;n<e;n++)t[n]=n;return t}(),o=0,s=0;s<e;s++){o=(o+i[s]+t[s%r])%e;var a=i[s];i[s]=i[o],i[o]=a}return i}function r(e){this.s=n(e),this.i=0,this.j=0}return r.prototype.randomNative=function(){this.i=(this.i+1)%e,this.j=(this.j+this.s[this.i])%e;var t=this.s[this.i];return this.s[this.i]=this.s[this.j],this.s[this.j]=t,this.s[(this.s[this.i]+this.s[this.j])%e]},r.prototype.randomUInt32=function(){return 256*(256*(256*this.randomByte()+this.randomByte())+this.randomByte())+this.randomByte()},r.prototype.randomFloat=function(){return this.randomUInt32()/4294967296},r.prototype.random=function(){var e,n;if(1===arguments.length)e=0,n=arguments[0];else{if(2!==arguments.length)throw new TypeError("random takes one or two integer arguments");e=arguments[0],n=arguments[1]}if(!t(e)||!t(n))throw new TypeError("random takes one or two integer arguments");return e+this.randomUInt32()%(n-e+1)},r.prototype.currentState=function(){return{i:this.i,j:this.j,s:this.s.slice()}},r.prototype.setState=function(t){var n=t.s,r=t.i,i=t.j;if(!(r===(0|r)&&0<=r&&r<e))throw new Error("state.i should be integer [0, "+(e-1)+"]");if(!(i===(0|i)&&0<=i&&i<e))throw new Error("state.j should be integer [0, "+(e-1)+"]");if(!Array.isArray(n)||n.length!==e)throw new Error("state should be array of length "+e);for(var o=0;o<e;o++)if(-1===n.indexOf(o))throw new Error("state should be permutation of 0.."+(e-1)+": "+o+" is missing");this.i=r,this.j=i,this.s=n.slice()},r}var r=n(256);r.prototype.randomByte=r.prototype.randomNative;var i=n(16);i.prototype.randomByte=function(){return 16*this.randomNative()+this.randomNative()};var o="a".charCodeAt(0),s="0".charCodeAt(0);function a(e){return e<10?String.fromCharCode(s+e):String.fromCharCode(o+e-10)}function u(e){return parseInt(e,16)}i.prototype.currentStateString=function(){var e=this.currentState();return a(e.i)+a(e.j)+e.s.map(a).join("")},i.prototype.setStateString=function(e){if(!e.match(/^[0-9a-f]{18}$/))throw new TypeError("RC4small stateString should be 18 hex character string");var t=u(e[0]),n=u(e[1]),r=e.split("").slice(2).map(u);this.setState({i:t,j:n,s:r})},r.RC4small=i,e.exports=r},4281:function(e){var t={};function n(e,n,r){r||(r=Error);var i=function(e){var t,r;function i(t,r,i){return e.call(this,function(e,t,r){return"string"==typeof n?n:n(e,t,r)}(t,r,i))||this}return r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,i}(r);i.prototype.name=r.name,i.prototype.code=e,t[e]=i}function r(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}n("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),n("ERR_INVALID_ARG_TYPE",(function(e,t,n){var i,o,s;if("string"==typeof t&&(o="not ",t.substr(0,o.length)===o)?(i="must not be",t=t.replace(/^not /,"")):i="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))s="The ".concat(e," ").concat(i," ").concat(r(t,"type"));else{var a=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+".".length>e.length)&&-1!==e.indexOf(".",n)}(e)?"property":"argument";s='The "'.concat(e,'" ').concat(a," ").concat(i," ").concat(r(t,"type"))}return s+". Received type ".concat(typeof n)}),TypeError),n("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),n("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),n("ERR_STREAM_PREMATURE_CLOSE","Premature close"),n("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),n("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),n("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),n("ERR_STREAM_WRITE_AFTER_END","write after end"),n("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),n("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),n("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.q=t},6753:function(e,t,n){var r=n(8768),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=h;var o=n(9481),s=n(4229);n(5717)(h,o);for(var a=i(s.prototype),u=0;u<a.length;u++){var c=a[u];h.prototype[c]||(h.prototype[c]=s.prototype[c])}function h(e){if(!(this instanceof h))return new h(e);o.call(this,e),s.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",l)))}function l(){this._writableState.ended||r.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(h.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(h.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(h.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(h.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},2725:function(e,t,n){e.exports=i;var r=n(4605);function i(e){if(!(this instanceof i))return new i(e);r.call(this,e)}n(5717)(i,r),i.prototype._transform=function(e,t,n){n(null,e)}},9481:function(e,t,n){var r,i=n(8768);e.exports=S,S.ReadableState=E,n(7187).EventEmitter;var o,s=function(e,t){return e.listeners(t).length},a=n(2503),u=n(8764).Buffer,c=globalThis.Uint8Array||function(){},h=n(4616);o=h&&h.debuglog?h.debuglog("stream"):function(){};var l,f,d,p=n(7327),v=n(1195),g=n(2457).getHighWaterMark,y=n(4281).q,m=y.ERR_INVALID_ARG_TYPE,_=y.ERR_STREAM_PUSH_AFTER_EOF,b=y.ERR_METHOD_NOT_IMPLEMENTED,w=y.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;n(5717)(S,a);var k=v.errorOrDestroy,x=["error","close","destroy","pause","resume"];function E(e,t,i){r=r||n(6753),e=e||{},"boolean"!=typeof i&&(i=t instanceof r),this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=g(this,e,"readableHighWaterMark",i),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(l||(l=n(2553).s),this.decoder=new l(e.encoding),this.encoding=e.encoding)}function S(e){if(r=r||n(6753),!(this instanceof S))return new S(e);var t=this instanceof r;this._readableState=new E(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),a.call(this)}function T(e,t,n,r,i){o("readableAddChunk",t);var s,a=e._readableState;if(null===t)a.reading=!1,function(e,t){if(o("onEofChunk"),!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?P(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,I(e)))}}(e,a);else if(i||(s=function(e,t){var n,r;return r=t,u.isBuffer(r)||r instanceof c||"string"==typeof t||void 0===t||e.objectMode||(n=new m("chunk",["string","Buffer","Uint8Array"],t)),n}(a,t)),s)k(e,s);else if(a.objectMode||t&&t.length>0)if("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===u.prototype||(t=function(e){return u.from(e)}(t)),r)a.endEmitted?k(e,new w):C(e,a,t,!0);else if(a.ended)k(e,new _);else{if(a.destroyed)return!1;a.reading=!1,a.decoder&&!n?(t=a.decoder.write(t),a.objectMode||0!==t.length?C(e,a,t,!1):L(e,a)):C(e,a,t,!1)}else r||(a.reading=!1,L(e,a));return!a.ended&&(a.length<a.highWaterMark||0===a.length)}function C(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&P(e)),L(e,t)}Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),S.prototype.destroy=v.destroy,S.prototype._undestroy=v.undestroy,S.prototype._destroy=function(e,t){t(e)},S.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=u.from(e,t),t=""),n=!0),T(this,e,t,!1,n)},S.prototype.unshift=function(e){return T(this,e,null,!0,!1)},S.prototype.isPaused=function(){return!1===this._readableState.flowing},S.prototype.setEncoding=function(e){l||(l=n(2553).s);var t=new l(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,i="";null!==r;)i+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var A=1073741824;function R(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=A?e=A:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function P(e){var t=e._readableState;o("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(o("emitReadable",t.flowing),t.emittedReadable=!0,i.nextTick(I,e))}function I(e){var t=e._readableState;o("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,N(e)}function L(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(O,e,t))}function O(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(o("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function Z(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function B(e){o("readable nexttick read 0"),e.read(0)}function M(e,t){o("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),N(e),t.flowing&&!t.reading&&e.read(0)}function N(e){var t=e._readableState;for(o("flow",t.flowing);t.flowing&&null!==e.read(););}function j(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function U(e){var t=e._readableState;o("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,i.nextTick(D,t,e))}function D(e,t){if(o("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function H(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}S.prototype.read=function(e){o("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return o("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?U(this):P(this),null;if(0===(e=R(e,t))&&t.ended)return 0===t.length&&U(this),null;var r,i=t.needReadable;return o("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&o("length less than watermark",i=!0),t.ended||t.reading?o("reading or ended",i=!1):i&&(o("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=R(n,t))),null===(r=e>0?j(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&U(this)),null!==r&&this.emit("data",r),r},S.prototype._read=function(e){k(this,new b("_read()"))},S.prototype.pipe=function(e,t){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=e;break;case 1:r.pipes=[r.pipes,e];break;default:r.pipes.push(e)}r.pipesCount+=1,o("pipe count=%d opts=%j",r.pipesCount,t);var a=t&&!1===t.end||e===i.stdout||e===i.stderr?v:u;function u(){o("onend"),e.end()}r.endEmitted?i.nextTick(a):n.once("end",a),e.on("unpipe",(function t(i,s){o("onunpipe"),i===n&&s&&!1===s.hasUnpiped&&(s.hasUnpiped=!0,o("cleanup"),e.removeListener("close",d),e.removeListener("finish",p),e.removeListener("drain",c),e.removeListener("error",f),e.removeListener("unpipe",t),n.removeListener("end",u),n.removeListener("end",v),n.removeListener("data",l),h=!0,!r.awaitDrain||e._writableState&&!e._writableState.needDrain||c())}));var c=function(e){return function(){var t=e._readableState;o("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,N(e))}}(n);e.on("drain",c);var h=!1;function l(t){o("ondata");var i=e.write(t);o("dest.write",i),!1===i&&((1===r.pipesCount&&r.pipes===e||r.pipesCount>1&&-1!==H(r.pipes,e))&&!h&&(o("false write response, pause",r.awaitDrain),r.awaitDrain++),n.pause())}function f(t){o("onerror",t),v(),e.removeListener("error",f),0===s(e,"error")&&k(e,t)}function d(){e.removeListener("finish",p),v()}function p(){o("onfinish"),e.removeListener("close",d),v()}function v(){o("unpipe"),n.unpipe(e)}return n.on("data",l),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",f),e.once("close",d),e.once("finish",p),e.emit("pipe",n),r.flowing||(o("pipe resume"),n.resume()),e},S.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=H(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},S.prototype.on=function(e,t){var n=a.prototype.on.call(this,e,t),r=this._readableState;return"data"===e?(r.readableListening=this.listenerCount("readable")>0,!1!==r.flowing&&this.resume()):"readable"===e&&(r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,o("on readable",r.length,r.reading),r.length?P(this):r.reading||i.nextTick(B,this))),n},S.prototype.addListener=S.prototype.on,S.prototype.removeListener=function(e,t){var n=a.prototype.removeListener.call(this,e,t);return"readable"===e&&i.nextTick(Z,this),n},S.prototype.removeAllListeners=function(e){var t=a.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||i.nextTick(Z,this),t},S.prototype.resume=function(){var e=this._readableState;return e.flowing||(o("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(M,e,t))}(this,e)),e.paused=!1,this},S.prototype.pause=function(){return o("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(o("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},S.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(o("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){o("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<x.length;s++)e.on(x[s],this.emit.bind(this,x[s]));return this._read=function(t){o("wrapped _read",t),r&&(r=!1,e.resume())},this},"function"==typeof Symbol&&(S.prototype[Symbol.asyncIterator]=function(){return void 0===f&&(f=n(5850)),f(this)}),Object.defineProperty(S.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(S.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(S.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),S._fromList=j,Object.defineProperty(S.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(S.from=function(e,t){return void 0===d&&(d=n(5167)),d(S,e,t)})},4605:function(e,t,n){e.exports=h;var r=n(4281).q,i=r.ERR_METHOD_NOT_IMPLEMENTED,o=r.ERR_MULTIPLE_CALLBACK,s=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=r.ERR_TRANSFORM_WITH_LENGTH_0,u=n(6753);function c(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(null===r)return this.emit("error",new o);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function h(e){if(!(this instanceof h))return new h(e);u.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",l)}function l(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?f(this,null,null):this._flush((function(t,n){f(e,t,n)}))}function f(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new a;if(e._transformState.transforming)throw new s;return e.push(null)}n(5717)(h,u),h.prototype.push=function(e,t){return this._transformState.needTransform=!1,u.prototype.push.call(this,e,t)},h.prototype._transform=function(e,t,n){n(new i("_transform()"))},h.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},h.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},h.prototype._destroy=function(e,t){u.prototype._destroy.call(this,e,(function(e){t(e)}))}},4229:function(e,t,n){var r,i=n(8768);function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(undefined),r=r.next}t.corkedRequestsFree.next=e}(t,e)}}e.exports=S,S.WritableState=E;var s,a={deprecate:n(4927)},u=n(2503),c=n(8764).Buffer,h=globalThis.Uint8Array||function(){},l=n(1195),f=n(2457).getHighWaterMark,d=n(4281).q,p=d.ERR_INVALID_ARG_TYPE,v=d.ERR_METHOD_NOT_IMPLEMENTED,g=d.ERR_MULTIPLE_CALLBACK,y=d.ERR_STREAM_CANNOT_PIPE,m=d.ERR_STREAM_DESTROYED,_=d.ERR_STREAM_NULL_VALUES,b=d.ERR_STREAM_WRITE_AFTER_END,w=d.ERR_UNKNOWN_ENCODING,k=l.errorOrDestroy;function x(){}function E(e,t,s){r=r||n(6753),e=e||{},"boolean"!=typeof s&&(s=t instanceof r),this.objectMode=!!e.objectMode,s&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=f(this,e,"writableHighWaterMark",s),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===e.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,o=n.writecb;if("function"!=typeof o)throw new g;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,o){--t.pendingcb,n?(i.nextTick(o,r),i.nextTick(I,e,t),e._writableState.errorEmitted=!0,k(e,r)):(o(r),e._writableState.errorEmitted=!0,k(e,r),I(e,t))}(e,n,r,t,o);else{var s=R(n)||e.destroyed;s||n.corked||n.bufferProcessing||!n.bufferedRequest||A(e,n),r?i.nextTick(C,e,n,s,o):C(e,n,s,o)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function S(e){var t=this instanceof(r=r||n(6753));if(!t&&!s.call(S,this))return new S(e);this._writableState=new E(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),u.call(this)}function T(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new m("write")):n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function C(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),I(e,t)}function A(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),s=t.corkedRequestsFree;s.entry=n;for(var a=0,u=!0;n;)i[a]=n,n.isBuf||(u=!1),n=n.next,a+=1;i.allBuffers=u,T(e,t,!0,t.length,i,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,h=n.encoding,l=n.callback;if(T(e,t,!1,t.objectMode?1:c.length,c,h,l),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function R(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function P(e,t){e._final((function(n){t.pendingcb--,n&&k(e,n),t.prefinished=!0,e.emit("prefinish"),I(e,t)}))}function I(e,t){var n=R(t);if(n&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,i.nextTick(P,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var r=e._readableState;(!r||r.autoDestroy&&r.endEmitted)&&e.destroy()}return n}n(5717)(S,u),E.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(E.prototype,"buffer",{get:a.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(s=Function.prototype[Symbol.hasInstance],Object.defineProperty(S,Symbol.hasInstance,{value:function(e){return!!s.call(this,e)||this===S&&e&&e._writableState instanceof E}})):s=function(e){return e instanceof this},S.prototype.pipe=function(){k(this,new y)},S.prototype.write=function(e,t,n){var r,o=this._writableState,s=!1,a=!o.objectMode&&(r=e,c.isBuffer(r)||r instanceof h);return a&&!c.isBuffer(e)&&(e=function(e){return c.from(e)}(e)),"function"==typeof t&&(n=t,t=null),a?t="buffer":t||(t=o.defaultEncoding),"function"!=typeof n&&(n=x),o.ending?function(e,t){var n=new b;k(e,n),i.nextTick(t,n)}(this,n):(a||function(e,t,n,r){var o;return null===n?o=new _:"string"==typeof n||t.objectMode||(o=new p("chunk",["string","Buffer"],n)),!o||(k(e,o),i.nextTick(r,o),!1)}(this,o,e,n))&&(o.pendingcb++,s=function(e,t,n,r,i,o){if(!n){var s=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=c.from(t,n)),t}(t,r,i);r!==s&&(n=!0,i="buffer",r=s)}var a=t.objectMode?1:r.length;t.length+=a;var u=t.length<t.highWaterMark;if(u||(t.needDrain=!0),t.writing||t.corked){var h=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},h?h.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else T(e,t,!1,a,r,i,o);return u}(this,o,a,e,t,n)),s},S.prototype.cork=function(){this._writableState.corked++},S.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||A(this,e))},S.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new w(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(S.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(S.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),S.prototype._write=function(e,t,n){n(new v("_write()"))},S.prototype._writev=null,S.prototype.end=function(e,t,n){var r=this._writableState;return"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||function(e,t,n){t.ending=!0,I(e,t),n&&(t.finished?i.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n),this},Object.defineProperty(S.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),S.prototype.destroy=l.destroy,S.prototype._undestroy=l.undestroy,S.prototype._destroy=function(e,t){t(e)}},5850:function(e,t,n){var r,i=n(8768);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=n(8610),a=Symbol("lastResolve"),u=Symbol("lastReject"),c=Symbol("error"),h=Symbol("ended"),l=Symbol("lastPromise"),f=Symbol("handlePromise"),d=Symbol("stream");function p(e,t){return{value:e,done:t}}function v(e){var t=e[a];if(null!==t){var n=e[d].read();null!==n&&(e[l]=null,e[a]=null,e[u]=null,t(p(n,!1)))}}function g(e){i.nextTick(v,e)}var y=Object.getPrototypeOf((function(){})),m=Object.setPrototypeOf((o(r={get stream(){return this[d]},next:function(){var e=this,t=this[c];if(null!==t)return Promise.reject(t);if(this[h])return Promise.resolve(p(void 0,!0));if(this[d].destroyed)return new Promise((function(t,n){i.nextTick((function(){e[c]?n(e[c]):t(p(void 0,!0))}))}));var n,r=this[l];if(r)n=new Promise(function(e,t){return function(n,r){e.then((function(){t[h]?n(p(void 0,!0)):t[f](n,r)}),r)}}(r,this));else{var o=this[d].read();if(null!==o)return Promise.resolve(p(o,!1));n=new Promise(this[f])}return this[l]=n,n}},Symbol.asyncIterator,(function(){return this})),o(r,"return",(function(){var e=this;return new Promise((function(t,n){e[d].destroy(null,(function(e){e?n(e):t(p(void 0,!0))}))}))})),r),y);e.exports=function(e){var t,n=Object.create(m,(o(t={},d,{value:e,writable:!0}),o(t,a,{value:null,writable:!0}),o(t,u,{value:null,writable:!0}),o(t,c,{value:null,writable:!0}),o(t,h,{value:e._readableState.endEmitted,writable:!0}),o(t,f,{value:function(e,t){var r=n[d].read();r?(n[l]=null,n[a]=null,n[u]=null,e(p(r,!1))):(n[a]=e,n[u]=t)},writable:!0}),t));return n[l]=null,s(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[u];return null!==t&&(n[l]=null,n[a]=null,n[u]=null,t(e)),void(n[c]=e)}var r=n[a];null!==r&&(n[l]=null,n[a]=null,n[u]=null,r(p(void 0,!0))),n[h]=!0})),e.on("readable",g.bind(null,n)),n}},7327:function(e,t,n){function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=n(8764).Buffer,a=n(2361).inspect,u=a&&a.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,n;return t=e,n=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return s.alloc(0);for(var t,n,r,i=s.allocUnsafe(e>>>0),o=this.head,a=0;o;)t=o.data,n=i,r=a,s.prototype.copy.call(t,n,r),a+=o.data.length,o=o.next;return i}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,r=t.data;for(e-=r.length;t=t.next;){var i=t.data,o=e>i.length?i.length:e;if(o===i.length?r+=i:r+=i.slice(0,e),0==(e-=o)){o===i.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(o));break}++n}return this.length-=n,r}},{key:"_getBuffer",value:function(e){var t=s.allocUnsafe(e),n=this.head,r=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var i=n.data,o=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,o),0==(e-=o)){o===i.length?(++r,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=i.slice(o));break}++r}return this.length-=r,t}},{key:u,value:function(e,t){return a(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}],n&&o(t.prototype,n),e}()},1195:function(e,t,n){var r=n(8768);function i(e,t){s(e,t),o(e)}function o(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function s(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,a=this._readableState&&this._readableState.destroyed,u=this._writableState&&this._writableState.destroyed;return a||u?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,r.nextTick(s,this,e)):r.nextTick(s,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?n._writableState?n._writableState.errorEmitted?r.nextTick(o,n):(n._writableState.errorEmitted=!0,r.nextTick(i,n,e)):r.nextTick(i,n,e):t?(r.nextTick(o,n),t(e)):r.nextTick(o,n)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,r=e._writableState;n&&n.autoDestroy||r&&r.autoDestroy?e.destroy(t):e.emit("error",t)}}},8610:function(e,t,n){var r=n(4281).q.ERR_STREAM_PREMATURE_CLOSE;function i(){}e.exports=function e(t,n,o){if("function"==typeof n)return e(t,null,n);n||(n={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.apply(this,r)}}}(o||i);var s=n.readable||!1!==n.readable&&t.readable,a=n.writable||!1!==n.writable&&t.writable,u=function(){t.writable||h()},c=t._writableState&&t._writableState.finished,h=function(){a=!1,c=!0,s||o.call(t)},l=t._readableState&&t._readableState.endEmitted,f=function(){s=!1,l=!0,a||o.call(t)},d=function(e){o.call(t,e)},p=function(){var e;return s&&!l?(t._readableState&&t._readableState.ended||(e=new r),o.call(t,e)):a&&!c?(t._writableState&&t._writableState.ended||(e=new r),o.call(t,e)):void 0},v=function(){t.req.on("finish",h)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",h),t.on("abort",p),t.req?v():t.on("request",v)):a&&!t._writableState&&(t.on("end",u),t.on("close",u)),t.on("end",f),t.on("finish",h),!1!==n.error&&t.on("error",d),t.on("close",p),function(){t.removeListener("complete",h),t.removeListener("abort",p),t.removeListener("request",v),t.req&&t.req.removeListener("finish",h),t.removeListener("end",u),t.removeListener("close",u),t.removeListener("finish",h),t.removeListener("end",f),t.removeListener("error",d),t.removeListener("close",p)}}},5167:function(e){e.exports=function(){throw new Error("Readable.from is not available in the browser")}},9946:function(e,t,n){var r,i=n(4281).q,o=i.ERR_MISSING_ARGS,s=i.ERR_STREAM_DESTROYED;function a(e){if(e)throw e}function u(e){e()}function c(e,t){return e.pipe(t)}e.exports=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var h,l=function(e){return e.length?"function"!=typeof e[e.length-1]?a:e.pop():a}(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new o("streams");var f=t.map((function(e,i){var o=i<t.length-1;return function(e,t,i,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var a=!1;e.on("close",(function(){a=!0})),void 0===r&&(r=n(8610)),r(e,{readable:t,writable:i},(function(e){if(e)return o(e);a=!0,o()}));var u=!1;return function(t){if(!a&&!u)return u=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void o(t||new s("pipe"))}}(e,o,i>0,(function(e){h||(h=e),e&&f.forEach(u),o||(f.forEach(u),l(h))}))}));return t.reduce(c)}},2457:function(e,t,n){var r=n(4281).q.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,n,i){var o=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,i,n);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new r(i?n:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},2503:function(e,t,n){e.exports=n(7187).EventEmitter},8473:function(e,t,n){(t=e.exports=n(9481)).Stream=t,t.Readable=t,t.Writable=n(4229),t.Duplex=n(6753),t.Transform=n(4605),t.PassThrough=n(2725),t.finished=n(8610),t.pipeline=n(9946)},9967:function(e,t,n){e.exports=function(e,t,n){if("number"!=typeof t)throw new Error("second argument must be a Number");var i,o,s,a,u,c,h=!0;function l(e){function t(){n&&n(e,i),n=null}h?r(t):t()}function f(t,n,r){if(i[t]=r,n&&(u=!0),0==--s||n)l(n);else if(!u&&c<o){var h;a?(h=a[c],c+=1,e[h]((function(e,t){f(h,e,t)}))):(h=c,c+=1,e[h]((function(e,t){f(h,e,t)})))}}Array.isArray(e)?(i=[],s=o=e.length):(a=Object.keys(e),i={},s=o=a.length),c=t,s?a?a.some((function(n,r){return e[n]((function(e,t){f(n,e,t)})),r===t-1})):e.some((function(e,n){return e((function(e,t){f(n,e,t)})),n===t-1})):l(null),h=!1};var r=n(4375)},4595:function(e,t,n){e.exports=function(e,t){var n,i,o,s=!0;function a(e){function i(){t&&t(e,n),t=null}s?r(i):i()}function u(e,t,r){n[e]=r,(0==--i||t)&&a(t)}Array.isArray(e)?(n=[],i=e.length):(o=Object.keys(e),n={},i=o.length),i?o?o.forEach((function(t){e[t]((function(e,n){u(t,e,n)}))})):e.forEach((function(e,t){e((function(e,n){u(t,e,n)}))})):a(null),s=!1};var r=n(4375)},9509:function(e,t,n){var r=n(8764),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(o(r,t),t.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},7485:function(e,t,n){var r=n(8764).Buffer;e.exports=function(e,t){var n=[];e.on("data",(function(e){n.push(e)})),e.once("end",(function(){t&&t(null,r.concat(n)),t=null})),e.once("error",(function(e){t&&t(e),t=null}))}},8853:function(e,t,n){var r=n(1227)("simple-peer"),i=n(5177),o=n(1798),s=n(8473),a=n(4375),u=n(2114),h=n(8764).Buffer,l=65536;function f(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}var v=function(e){(0,g.Z)(s,e);var n=(0,y.Z)(s);function s(e){var t;if((0,d.Z)(this,s),(t=n.call(this,e=Object.assign({allowHalfOpen:!1},e)))._id=o(4).toString("hex").slice(0,7),t._debug("new peer %o",e),t.channelName=e.initiator?e.channelName||o(20).toString("hex"):null,t.initiator=e.initiator||!1,t.channelConfig=e.channelConfig||s.channelConfig,t.channelNegotiated=t.channelConfig.negotiated,t.config=Object.assign({},s.config,e.config),t.offerOptions=e.offerOptions||{},t.answerOptions=e.answerOptions||{},t.sdpTransform=e.sdpTransform||function(e){return e},t.streams=e.streams||(e.stream?[e.stream]:[]),t.trickle=void 0===e.trickle||e.trickle,t.allowHalfTrickle=void 0!==e.allowHalfTrickle&&e.allowHalfTrickle,t.iceCompleteTimeout=e.iceCompleteTimeout||5e3,t.destroyed=!1,t.destroying=!1,t._connected=!1,t.remoteAddress=void 0,t.remoteFamily=void 0,t.remotePort=void 0,t.localAddress=void 0,t.localFamily=void 0,t.localPort=void 0,t._wrtc=e.wrtc&&"object"==typeof e.wrtc?e.wrtc:i(),!t._wrtc)throw"undefined"==typeof window?u(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):u(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");t._pcReady=!1,t._channelReady=!1,t._iceComplete=!1,t._iceCompleteTimer=null,t._channel=null,t._pendingCandidates=[],t._isNegotiating=!1,t._firstNegotiation=!0,t._batchedNegotiation=!1,t._queuedNegotiation=!1,t._sendersAwaitingStable=[],t._senderMap=new Map,t._closingInterval=null,t._remoteTracks=[],t._remoteStreams=[],t._chunk=null,t._cb=null,t._interval=null;try{t._pc=new t._wrtc.RTCPeerConnection(t.config)}catch(e){return(0,c.Z)(t,void t.destroy(u(e,"ERR_PC_CONSTRUCTOR")))}return t._isReactNativeWebrtc="number"==typeof t._pc._peerConnectionId,t._pc.oniceconnectionstatechange=function(){t._onIceStateChange()},t._pc.onicegatheringstatechange=function(){t._onIceStateChange()},t._pc.onconnectionstatechange=function(){t._onConnectionStateChange()},t._pc.onsignalingstatechange=function(){t._onSignalingStateChange()},t._pc.onicecandidate=function(e){t._onIceCandidate(e)},"object"==typeof t._pc.peerIdentity&&t._pc.peerIdentity.catch((function(e){t.destroy(u(e,"ERR_PC_PEER_IDENTITY"))})),t.initiator||t.channelNegotiated?t._setupData({channel:t._pc.createDataChannel(t.channelName,t.channelConfig)}):t._pc.ondatachannel=function(e){t._setupData(e)},t.streams&&t.streams.forEach((function(e){t.addStream(e)})),t._pc.ontrack=function(e){t._onTrack(e)},t._debug("initial negotiation"),t._needsNegotiation(),t._onFinishBound=function(){t._onFinish()},t.once("finish",t._onFinishBound),(0,c.Z)(t)}return(0,p.Z)(s,[{key:"bufferSize",get:function(){return this._channel&&this._channel.bufferedAmount||0}},{key:"connected",get:function(){return this._connected&&"open"===this._channel.readyState}},{key:"address",value:function(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}},{key:"signal",value:function(e){var n=this;if(!this.destroying){if(this.destroyed)throw u(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then((function(){n.destroyed||(n._pendingCandidates.forEach((function(e){n._addIceCandidate(e)})),n._pendingCandidates=[],"offer"===n._pc.remoteDescription.type&&n._createAnswer())})).catch((function(e){n.destroy(u(e,"ERR_SET_REMOTE_DESCRIPTION"))})),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.destroy(u(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}},{key:"_addIceCandidate",value:function(e){var t=this,n=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(n).catch((function(e){!n.address||n.address.endsWith(".local")?("Ignoring unsupported ICE candidate.",console.warn("Ignoring unsupported ICE candidate.")):t.destroy(u(e,"ERR_ADD_ICE_CANDIDATE"))}))}},{key:"send",value:function(e){if(!this.destroying){if(this.destroyed)throw u(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}},{key:"addTransceiver",value:function(e,t){if(!this.destroying){if(this.destroyed)throw u(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(e){this.destroy(u(e,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}},{key:"addStream",value:function(e){var t=this;if(!this.destroying){if(this.destroyed)throw u(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach((function(n){t.addTrack(n,e)}))}}},{key:"addTrack",value:function(e,t){if(!this.destroying){if(this.destroyed)throw u(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");var n=this._senderMap.get(e)||new Map,r=n.get(t);if(r)throw r.removed?u(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):u(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");r=this._pc.addTrack(e,t),n.set(t,r),this._senderMap.set(e,n),this._needsNegotiation()}}},{key:"replaceTrack",value:function(e,t,n){if(!this.destroying){if(this.destroyed)throw u(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");var r=this._senderMap.get(e),i=r?r.get(n):null;if(!i)throw u(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,r),null!=i.replaceTrack?i.replaceTrack(t):this.destroy(u(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}}},{key:"removeTrack",value:function(e,t){if(!this.destroying){if(this.destroyed)throw u(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");var n=this._senderMap.get(e),r=n?n.get(t):null;if(!r)throw u(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(r):this.destroy(u(e,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}}},{key:"removeStream",value:function(e){var t=this;if(!this.destroying){if(this.destroyed)throw u(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach((function(n){t.removeTrack(n,e)}))}}},{key:"_needsNegotiation",value:function(){var e=this;this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,a((function(){e._batchedNegotiation=!1,e.initiator||!e._firstNegotiation?(e._debug("starting batched negotiation"),e.negotiate()):e._debug("non-initiator initial negotiation request discarded"),e._firstNegotiation=!1})))}},{key:"negotiate",value:function(){var e=this;if(!this.destroying){if(this.destroyed)throw u(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout((function(){e._createOffer()}),0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}},{key:"destroy",value:function(e){this._destroy(e,(function(){}))}},{key:"_destroy",value:function(e,t){var n=this;this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),a((function(){if(n.destroyed=!0,n.destroying=!1,n._debug("destroy (error: %s)",e&&(e.message||e)),n.readable=n.writable=!1,n._readableState.ended||n.push(null),n._writableState.finished||n.end(),n._connected=!1,n._pcReady=!1,n._channelReady=!1,n._remoteTracks=null,n._remoteStreams=null,n._senderMap=null,clearInterval(n._closingInterval),n._closingInterval=null,clearInterval(n._interval),n._interval=null,n._chunk=null,n._cb=null,n._onFinishBound&&n.removeListener("finish",n._onFinishBound),n._onFinishBound=null,n._channel){try{n._channel.close()}catch(e){}n._channel.onmessage=null,n._channel.onopen=null,n._channel.onclose=null,n._channel.onerror=null}if(n._pc){try{n._pc.close()}catch(e){}n._pc.oniceconnectionstatechange=null,n._pc.onicegatheringstatechange=null,n._pc.onsignalingstatechange=null,n._pc.onicecandidate=null,n._pc.ontrack=null,n._pc.ondatachannel=null}n._pc=null,n._channel=null,e&&n.emit("error",e),n.emit("close"),t()})))}},{key:"_setupData",value:function(e){var t=this;if(!e.channel)return this.destroy(u(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=l),this.channelName=this._channel.label,this._channel.onmessage=function(e){t._onChannelMessage(e)},this._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},this._channel.onopen=function(){t._onChannelOpen()},this._channel.onclose=function(){t._onChannelClose()},this._channel.onerror=function(e){var n=e.error instanceof Error?e.error:new Error("Datachannel error: ".concat(e.message," ").concat(e.filename,":").concat(e.lineno,":").concat(e.colno));t.destroy(u(n,"ERR_DATA_CHANNEL"))};var n=!1;this._closingInterval=setInterval((function(){t._channel&&"closing"===t._channel.readyState?(n&&t._onChannelClose(),n=!0):n=!1}),5e3)}},{key:"_read",value:function(){}},{key:"_write",value:function(e,t,n){if(this.destroyed)return n(u(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(e){return this.destroy(u(e,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>l?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=n):n(null)}else this._debug("write before connect"),this._chunk=e,this._cb=n}},{key:"_onFinish",value:function(){var e=this;if(!this.destroyed){var t=function(){setTimeout((function(){return e.destroy()}),1e3)};this._connected?t():this.once("connect",t)}}},{key:"_startIceCompleteTimeout",value:function(){var e=this;this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout((function(){e._iceComplete||(e._iceComplete=!0,e._debug("iceComplete timeout completed"),e.emit("iceTimeout"),e.emit("_iceComplete"))}),this.iceCompleteTimeout))}},{key:"_createOffer",value:function(){var e=this;this.destroyed||this._pc.createOffer(this.offerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=f(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var n=function(){if(!e.destroyed){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp})}};e._pc.setLocalDescription(t).then((function(){e._debug("createOffer success"),e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))})).catch((function(t){e.destroy(u(t,"ERR_SET_LOCAL_DESCRIPTION"))}))}})).catch((function(t){e.destroy(u(t,"ERR_CREATE_OFFER"))}))}},{key:"_requestMissingTransceivers",value:function(){var e=this;this._pc.getTransceivers&&this._pc.getTransceivers().forEach((function(t){t.mid||!t.sender.track||t.requested||(t.requested=!0,e.addTransceiver(t.sender.track.kind))}))}},{key:"_createAnswer",value:function(){var e=this;this.destroyed||this._pc.createAnswer(this.answerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=f(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var n=function(){if(!e.destroyed){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp}),e.initiator||e._requestMissingTransceivers()}};e._pc.setLocalDescription(t).then((function(){e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))})).catch((function(t){e.destroy(u(t,"ERR_SET_LOCAL_DESCRIPTION"))}))}})).catch((function(t){e.destroy(u(t,"ERR_CREATE_ANSWER"))}))}},{key:"_onConnectionStateChange",value:function(){this.destroyed||"failed"===this._pc.connectionState&&this.destroy(u(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}},{key:"_onIceStateChange",value:function(){if(!this.destroyed){var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(u(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(u(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}}},{key:"getStats",value:function(e){var t=this,n=function(e){return"[object Array]"===Object.prototype.toString.call(e.values)&&e.values.forEach((function(t){Object.assign(e,t)})),e};0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then((function(t){var r=[];t.forEach((function(e){r.push(n(e))})),e(null,r)}),(function(t){return e(t)})):this._pc.getStats.length>0?this._pc.getStats((function(r){if(!t.destroyed){var i=[];r.result().forEach((function(e){var t={};e.names().forEach((function(n){t[n]=e.stat(n)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i.push(n(t))})),e(null,i)}}),(function(t){return e(t)})):e(null,[])}},{key:"_maybeReady",value:function(){var e=this;if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),!this._connected&&!this._connecting&&this._pcReady&&this._channelReady){this._connecting=!0;!function t(){e.destroyed||e.getStats((function(n,r){if(!e.destroyed){n&&(r=[]);var i={},o={},s={},a=!1;r.forEach((function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(i[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(o[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(s[e.id]=e)}));var c=function(t){a=!0;var n=o[t.localCandidateId];n&&(n.ip||n.address)?(e.localAddress=n.ip||n.address,e.localPort=Number(n.port)):n&&n.ipAddress?(e.localAddress=n.ipAddress,e.localPort=Number(n.portNumber)):"string"==typeof t.googLocalAddress&&(n=t.googLocalAddress.split(":"),e.localAddress=n[0],e.localPort=Number(n[1])),e.localAddress&&(e.localFamily=e.localAddress.includes(":")?"IPv6":"IPv4");var r=i[t.remoteCandidateId];r&&(r.ip||r.address)?(e.remoteAddress=r.ip||r.address,e.remotePort=Number(r.port)):r&&r.ipAddress?(e.remoteAddress=r.ipAddress,e.remotePort=Number(r.portNumber)):"string"==typeof t.googRemoteAddress&&(r=t.googRemoteAddress.split(":"),e.remoteAddress=r[0],e.remotePort=Number(r[1])),e.remoteAddress&&(e.remoteFamily=e.remoteAddress.includes(":")?"IPv6":"IPv4"),e._debug("connect local: %s:%s remote: %s:%s",e.localAddress,e.localPort,e.remoteAddress,e.remotePort)};if(r.forEach((function(e){"transport"===e.type&&e.selectedCandidatePairId&&c(s[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&c(e)})),a||Object.keys(s).length&&!Object.keys(o).length){if(e._connecting=!1,e._connected=!0,e._chunk){try{e.send(e._chunk)}catch(n){return e.destroy(u(n,"ERR_DATA_CHANNEL"))}e._chunk=null,e._debug('sent chunk from "write before connect"');var h=e._cb;e._cb=null,h(null)}"number"!=typeof e._channel.bufferedAmountLowThreshold&&(e._interval=setInterval((function(){return e._onInterval()}),150),e._interval.unref&&e._interval.unref()),e._debug("connect"),e.emit("connect")}else setTimeout(t,100)}}))}()}}},{key:"_onInterval",value:function(){!this._cb||!this._channel||this._channel.bufferedAmount>l||this._onChannelBufferedAmountLow()}},{key:"_onSignalingStateChange",value:function(){var e=this;this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach((function(t){e._pc.removeTrack(t),e._queuedNegotiation=!0})),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}},{key:"_onIceCandidate",value:function(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}},{key:"_onChannelMessage",value:function(e){if(!this.destroyed){var t=e.data;t instanceof ArrayBuffer&&(t=h.from(t)),this.push(t)}}},{key:"_onChannelBufferedAmountLow",value:function(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var e=this._cb;this._cb=null,e(null)}}},{key:"_onChannelOpen",value:function(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}},{key:"_onChannelClose",value:function(){this.destroyed||(this._debug("on channel close"),this.destroy())}},{key:"_onTrack",value:function(e){var t=this;this.destroyed||e.streams.forEach((function(n){t._debug("on track"),t.emit("track",e.track,n),t._remoteTracks.push({track:e.track,stream:n}),t._remoteStreams.some((function(e){return e.id===n.id}))||(t._remoteStreams.push(n),a((function(){t._debug("on stream"),t.emit("stream",n)})))}))}},{key:"_debug",value:function(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],r.apply(null,e)}}]),s}(s.Duplex);v.WEBRTC_SUPPORT=!!i(),v.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},v.channelConfig={},e.exports=v},522:function(e,t,n){var r=n(8764).Buffer,i=n(1227)("simple-websocket"),o=n(1798),s=n(8473),u=n(4375),h=n(3719),l="function"!=typeof h?WebSocket:h,f=function(t){(0,g.Z)(s,t);var n=(0,y.Z)(s);function s(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,d.Z)(this,s),"string"==typeof t&&(t={url:t}),e=n.call(this,t=Object.assign({allowHalfOpen:!1},t)),null==t.url&&null==t.socket)throw new Error("Missing required `url` or `socket` option");if(null!=t.url&&null!=t.socket)throw new Error("Must specify either `url` or `socket` option, not both");if(e._id=o(4).toString("hex").slice(0,7),e._debug("new websocket: %o",t),e.connected=!1,e.destroyed=!1,e._chunk=null,e._cb=null,e._interval=null,t.socket)e.url=t.socket.url,e._ws=t.socket,e.connected=t.socket.readyState===l.OPEN;else{e.url=t.url;try{e._ws="function"==typeof h?new l(t.url,null,(0,a.Z)((0,a.Z)({},t),{},{encoding:void 0})):new l(t.url)}catch(t){return(0,c.Z)(e,void u((function(){return e.destroy(t)})))}}return e._ws.binaryType="arraybuffer",t.socket&&e.connected?u((function(){return e._handleOpen()})):e._ws.onopen=function(){return e._handleOpen()},e._ws.onmessage=function(t){return e._handleMessage(t)},e._ws.onclose=function(){return e._handleClose()},e._ws.onerror=function(t){return e._handleError(t)},e._handleFinishBound=function(){return e._handleFinish()},e.once("finish",e._handleFinishBound),(0,c.Z)(e)}return(0,p.Z)(s,[{key:"send",value:function(e){this._ws.send(e)}},{key:"destroy",value:function(e){this._destroy(e,(function(){}))}},{key:"_destroy",value:function(e,t){if(!this.destroyed){if(this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this.connected=!1,this.destroyed=!0,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._handleFinishBound&&this.removeListener("finish",this._handleFinishBound),this._handleFinishBound=null,this._ws){var n=this._ws,r=function(){n.onclose=null};if(n.readyState===l.CLOSED)r();else try{n.onclose=r,n.close()}catch(e){r()}n.onopen=null,n.onmessage=null,n.onerror=function(){}}this._ws=null,e&&this.emit("error",e),this.emit("close"),t()}}},{key:"_read",value:function(){}},{key:"_write",value:function(e,t,n){if(this.destroyed)return n(new Error("cannot write after socket is destroyed"));if(this.connected){try{this.send(e)}catch(e){return this.destroy(e)}"function"!=typeof h&&this._ws.bufferedAmount>65536?(this._debug("start backpressure: bufferedAmount %d",this._ws.bufferedAmount),this._cb=n):n(null)}else this._debug("write before connect"),this._chunk=e,this._cb=n}},{key:"_handleOpen",value:function(){var t=this;if(!this.connected&&!this.destroyed){if(this.connected=!0,this._chunk){try{this.send(this._chunk)}catch(e){return this.destroy(e)}this._chunk=null,this._debug('sent chunk from "write before connect"');var n=this._cb;this._cb=null,n(null)}"function"!=typeof h&&(this._interval=setInterval((function(){return t._onInterval()}),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}}},{key:"_handleMessage",value:function(e){if(!this.destroyed){var t=e.data;t instanceof ArrayBuffer&&(t=r.from(t)),this.push(t)}}},{key:"_handleClose",value:function(){this.destroyed||(this._debug("on close"),this.destroy())}},{key:"_handleError",value:function(e){this.destroy(new Error("Error connecting to ".concat(this.url)))}},{key:"_handleFinish",value:function(){var e=this;if(!this.destroyed){var t=function(){setTimeout((function(){return e.destroy()}),1e3)};this.connected?t():this.once("connect",t)}}},{key:"_onInterval",value:function(){if(this._cb&&this._ws&&!(this._ws.bufferedAmount>65536)){this._debug("ending backpressure: bufferedAmount %d",this._ws.bufferedAmount);var e=this._cb;this._cb=null,e(null)}}},{key:"_debug",value:function(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],i.apply(null,e)}}]),s}(s.Duplex);f.WEBSOCKET_SUPPORT=!!l,e.exports=f},558:function(e,t,n){var r=n(7768),i=n(9929);e.exports={Throttle:r,ThrottleGroup:i}},9929:function(e,t,n){var r=n(5516).TokenBucket,i=n(7768);e.exports=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,d.Z)(this,e),"object"!=typeof t)throw new Error("Options must be an object");this.throttles=[],this.setEnabled(t.enabled),this.setRate(t.rate,t.chunksize)}return(0,p.Z)(e,[{key:"getEnabled",value:function(){return this._enabled}},{key:"getRate",value:function(){return this.bucket.tokensPerInterval}},{key:"getChunksize",value:function(){return this.chunksize}},{key:"setEnabled",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if("boolean"!=typeof e)throw new Error("Enabled must be a boolean");this._enabled=e;var t,n=(0,f.Z)(this.throttles);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.setEnabled(e)}}catch(i){n.e(i)}finally{n.f()}}},{key:"setRate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!Number.isInteger(e)||e<0)throw new Error("Rate must be an integer bigger than zero");if(e=parseInt(e),t&&("number"!=typeof t||t<=0))throw new Error("Chunksize must be bigger than zero");if(t=t||Math.max(parseInt(e/10),1),t=parseInt(t),e>0&&t>e)throw new Error("Chunk size must be smaller than rate");this.bucket||(this.bucket=new r(e,e,"second",null)),this.bucket.bucketSize=e,this.bucket.tokensPerInterval=e,this.chunksize=t}},{key:"setChunksize",value:function(e){if(!Number.isInteger(e)||e<=0)throw new Error("Chunk size must be an integer bigger than zero");var t=this.getRate();if(e=parseInt(e),t>0&&e>t)throw new Error("Chunk size must be smaller than rate");this.chunksize=e}},{key:"throttle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"!=typeof e)throw new Error("Options must be an object");return new i((0,a.Z)((0,a.Z)({},e),{},{group:this}))}},{key:"destroy",value:function(){var e,t=(0,f.Z)(this.throttles);try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(n){t.e(n)}finally{t.f()}this.throttles=[]}},{key:"_addThrottle",value:function(e){if(!(e instanceof i))throw new Error("Throttle must be an instance of Throttle");this.throttles.push(e)}},{key:"_removeThrottle",value:function(e){var t=this.throttles.indexOf(e);t>-1&&this.throttles.splice(t,1)}}]),e}()},7768:function(e,t,n){var r=n(7187).EventEmitter,i=n(1237).Transform,a=n(5324).wait;e.exports=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,d.Z)(this,n),e=t.call(this),"object"!=typeof i)throw new Error("Options must be an object");var o=Object.assign({},i);if(o.group&&!(o.group instanceof h))throw new Error("Group must be an instanece of ThrottleGroup");return o.group||(o.group=new h(o)),e._setEnabled(o.enabled||o.group.enabled),e._group=o.group,e._emitter=new r,e._destroyed=!1,e._group._addThrottle((0,v.Z)(e)),(0,c.Z)(e)}return(0,p.Z)(n,[{key:"getEnabled",value:function(){return this._enabled}},{key:"getGroup",value:function(){return this._group}},{key:"_setEnabled",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if("boolean"!=typeof e)throw new Error("Enabled must be a boolean");this._enabled=e}},{key:"setEnabled",value:function(e){this._setEnabled(e),this._enabled?this._emitter.emit("enabled"):this._emitter.emit("disabled")}},{key:"_transform",value:function(e,t){this._processChunk(e,t)}},{key:"_waitForTokens",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var n=this;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=!1,o=n;function s(t){if(o._emitter.removeListener("disabled",s),o._emitter.removeListener("destroyed",s),!i){if(i=!0,t)return r(t);e()}}n._emitter.once("disabled",s),n._emitter.once("destroyed",s),n._group.bucket.removeTokens(t,s)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_areBothEnabled",value:function(){return this._enabled&&this._group.getEnabled()}},{key:"_processChunk",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t,n){var r,i,o;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._areBothEnabled()){e.next=2;break}return e.abrupt("return",n(null,t));case 2:r=0,i=this._group.getChunksize(),o=t.slice(r,r+i);case 3:if(!(o.length>0)){e.next=28;break}if(!this._areBothEnabled()){e.next=25;break}e.prev=5;case 6:if(0!==this._group.getRate()||this._destroyed||!this._areBothEnabled()){e.next=13;break}return e.next=9,a(1e3);case 9:if(!this._destroyed){e.next=11;break}return e.abrupt("return");case 11:e.next=6;break;case 13:if(e.t0=this._areBothEnabled()&&!this._group.bucket.tryRemoveTokens(o.length),!e.t0){e.next=18;break}return e.next=17,this._waitForTokens(o.length);case 17:e.t0=this._destroyed;case 18:if(!e.t0){e.next=20;break}return e.abrupt("return");case 20:e.next=25;break;case 22:return e.prev=22,e.t1=e.catch(5),e.abrupt("return",n(e.t1));case 25:this.push(o),r+=i,i=this._areBothEnabled()?this._group.getChunksize():t.length-r,o=t.slice(r,r+i);case 26:e.next=3;break;case 28:return e.abrupt("return",n());case 29:case"end":return e.stop()}}),e,this,[[5,22]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this._group._removeThrottle(this),this._destroyed=!0,this._emitter.emit("destroyed"),(e=(0,o.Z)((0,s.Z)(n.prototype),"destroy",this)).call.apply(e,[this].concat(r))}}]),n}(i);var h=n(9929)},5324:function(e){e.exports={wait:function(e){return new Promise((function(t){return setTimeout(t,e)}))}}},1237:function(e,t,n){var r=n(7187).EventEmitter,i=new Error("Stream was destroyed"),u=new Error("Premature close"),c=n(3527),m=n(1607),_=67108863,b=1^_,w=128,k=1024,x=16384,E=768^_,S=1<<17,T=2<<17,C=4<<17,A=8<<17,R=16<<17,P=32<<17,I=64<<17,L=129<<17,O=256<<17,Z=66977791,B=_^T,M=131088,N=66977775,j=x|P,U=14,D=15,H=U|j,F=16941072,q=D|F&N,W=1179648,z=D|S|A,G=Symbol.asyncIterator||Symbol("asyncIterator"),V=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.highWaterMark,i=void 0===r?16384:r,o=n.map,s=void 0===o?null:o,a=n.mapWritable,u=n.byteLength,c=n.byteLengthWritable;(0,d.Z)(this,e),this.stream=t,this.queue=new m,this.highWaterMark=i,this.buffered=0,this.error=null,this.pipeline=null,this.byteLength=c||u||pe,this.map=a||s,this.afterWrite=ee.bind(this),this.afterUpdateNextTick=re.bind(this)}return(0,p.Z)(e,[{key:"ended",get:function(){return 0!=(this.stream._duplexState&P)}},{key:"push",value:function(e){return null!==this.map&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark?(this.stream._duplexState|=A,!0):(this.stream._duplexState|=3145728,!1)}},{key:"shift",value:function(){var e=this.queue.shift(),t=this.stream;return this.buffered-=this.byteLength(e),0===this.buffered&&(t._duplexState&=66060287),e}},{key:"end",value:function(e){"function"==typeof e?this.stream.once("finish",e):null!=e&&this.push(e),this.stream._duplexState=(this.stream._duplexState|O)&B}},{key:"autoBatch",value:function(e,t){var n=[],r=this.stream;for(n.push(e);(r._duplexState&z)===W;)n.push(r._writableState.shift());if(0!=(r._duplexState&D))return t(null);r._writev(n,t)}},{key:"update",value:function(){for(var e=this.stream;(e._duplexState&z)===A;){var t=this.shift();e._duplexState|=655360,e._write(t,this.afterWrite),e._duplexState&=66584575}0==(393216&e._duplexState)&&this.updateNonPrimary()}},{key:"updateNonPrimary",value:function(){var e=this.stream;if((38928399&e._duplexState)===O)return e._duplexState=33554431&(e._duplexState|S),void e._final(X.bind(this));4!==(e._duplexState&U)?1==(e._duplexState&q)&&(e._duplexState=(e._duplexState|M)&b,e._open(ie.bind(this))):0==(e._duplexState&F)&&(e._duplexState|=M,e._destroy(Q.bind(this)))}},{key:"updateNextTick",value:function(){0==(this.stream._duplexState&L)&&(this.stream._duplexState|=L,c(this.afterUpdateNextTick))}}]),e}(),K=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.highWaterMark,i=void 0===r?16384:r,o=n.map,s=void 0===o?null:o,a=n.mapReadable,u=n.byteLength,c=n.byteLengthReadable;(0,d.Z)(this,e),this.stream=t,this.queue=new m,this.highWaterMark=i,this.buffered=0,this.error=null,this.pipeline=null,this.byteLength=c||u||pe,this.map=a||s,this.pipeTo=null,this.afterRead=te.bind(this),this.afterUpdateNextTick=ne.bind(this)}return(0,p.Z)(e,[{key:"ended",get:function(){return 0!=(this.stream._duplexState&x)}},{key:"pipe",value:function(e,t){if(null!==this.pipeTo)throw new Error("Can only pipe to one destination");if("function"!=typeof t&&(t=null),this.stream._duplexState|=512,this.pipeTo=e,this.pipeline=new $(this.stream,e,t),t&&this.stream.on("error",ve),de(e))e._writableState.pipeline=this.pipeline,t&&e.on("error",ve),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{var n=this.pipeline.done.bind(this.pipeline,e),r=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",n),e.on("close",r),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",J.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}},{key:"push",value:function(e){var t=this.stream;return null===e?(this.highWaterMark=0,t._duplexState=67043295&(t._duplexState|k),!1):(null!==this.map&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),t._duplexState=67043327&(t._duplexState|w),this.buffered<this.highWaterMark)}},{key:"shift",value:function(){var e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=67100543),e}},{key:"unshift",value:function(e){for(var t,n=[];void 0!==(t=this.queue.shift());)n.push(t);this.push(e);for(var r=0;r<n.length;r++)this.queue.push(n[r])}},{key:"read",value:function(){var e=this.stream;if((16527&e._duplexState)===w){var t=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=E),0!=(2048&e._duplexState)&&e.emit("data",t),t}return null}},{key:"drain",value:function(){for(var e=this.stream;(16527&e._duplexState)===w&&0!=(768&e._duplexState);){var t=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=E),0!=(2048&e._duplexState)&&e.emit("data",t)}}},{key:"update",value:function(){var e=this.stream;for(this.drain();this.buffered<this.highWaterMark&&0==(82975&e._duplexState);)e._duplexState|=65616,e._read(this.afterRead),e._duplexState&=67108799,0==(16&e._duplexState)&&this.drain();4224==(12431&e._duplexState)&&(e._duplexState|=8192,e.emit("readable")),0==(48&e._duplexState)&&this.updateNonPrimary()}},{key:"updateNonPrimary",value:function(){var e=this.stream;(1167&e._duplexState)===k&&(e._duplexState=67107839&(e._duplexState|x),e.emit("end"),(e._duplexState&H)===j&&(e._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),4!==(e._duplexState&U)?1==(e._duplexState&q)&&(e._duplexState=(e._duplexState|M)&b,e._open(ie.bind(this))):0==(e._duplexState&F)&&(e._duplexState|=M,e._destroy(Q.bind(this)))}},{key:"updateNextTick",value:function(){0==(32784&this.stream._duplexState)&&(this.stream._duplexState|=32784,c(this.afterUpdateNextTick))}}]),e}(),Y=(0,p.Z)((function e(t){(0,d.Z)(this,e),this.data=null,this.afterTransform=oe.bind(t),this.afterFinal=null})),$=function(){function e(t,n,r){(0,d.Z)(this,e),this.from=t,this.to=n,this.afterPipe=r,this.error=null,this.pipeToFinished=!1}return(0,p.Z)(e,[{key:"finished",value:function(){this.pipeToFinished=!0}},{key:"done",value:function(e,t){t&&(this.error=t),e!==this.to||(this.to=null,null===this.from)?e!==this.from||(this.from=null,null===this.to)?(null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null):0==(e._duplexState&x)&&this.to.destroy(this.error||new Error("Readable stream closed before ending")):0!=(this.from._duplexState&x)&&this.pipeToFinished||this.from.destroy(this.error||new Error("Writable stream closed prematurely"))}}]),e}();function J(){this.stream._duplexState|=512,0==(80&this.stream._duplexState)?this.updateNextTick():this.drain()}function X(e){var t=this.stream;e&&t.destroy(e),0==(t._duplexState&U)&&(t._duplexState|=P,t.emit("finish")),(t._duplexState&H)===j&&(t._duplexState|=4),t._duplexState&=Z,this.update()}function Q(e){var t=this.stream;e||this.error===i||(e=this.error),e&&t.emit("error",e),t._duplexState|=8,t.emit("close");var n=t._readableState,r=t._writableState;null!==n&&null!==n.pipeline&&n.pipeline.done(t,e),null!==r&&null!==r.pipeline&&r.pipeline.done(t,e)}function ee(e){var t=this.stream;e&&t.destroy(e),t._duplexState&=Z,(3276815&t._duplexState)===R&&(t._duplexState&=65011711,(t._duplexState&I)===I&&t.emit("drain")),0==(t._duplexState&C)&&this.update()}function te(e){e&&this.stream.destroy(e),this.stream._duplexState&=67108847,0==(64&this.stream._duplexState)&&this.update()}function ne(){this.stream._duplexState&=67076079,this.update()}function re(){this.stream._duplexState&=50200575,this.update()}function ie(e){var t=this.stream;e&&t.destroy(e),0==(4&t._duplexState)&&(0==(17423&t._duplexState)&&(t._duplexState|=32),0==(37748751&t._duplexState)&&(t._duplexState|=T),t.emit("open")),t._duplexState&=N,null!==t._writableState&&t._writableState.update(),null!==t._readableState&&t._readableState.update()}function oe(e,t){null!=t&&this.push(t),this._writableState.afterWrite(e)}var se=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,d.Z)(this,n),(r=t.call(this))._duplexState=0,r._readableState=null,r._writableState=null,e&&(e.open&&(r._open=e.open),e.destroy&&(r._destroy=e.destroy),e.predestroy&&(r._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",ge.bind((0,v.Z)(r)))),r}return(0,p.Z)(n,[{key:"_open",value:function(e){e(null)}},{key:"_destroy",value:function(e){e(null)}},{key:"_predestroy",value:function(){}},{key:"readable",get:function(){return null!==this._readableState||void 0}},{key:"writable",get:function(){return null!==this._writableState||void 0}},{key:"destroyed",get:function(){return 0!=(8&this._duplexState)}},{key:"destroying",get:function(){return 0!=(this._duplexState&U)}},{key:"destroy",value:function(e){0==(this._duplexState&U)&&(e||(e=i),this._duplexState=66846687&(4|this._duplexState),null!==this._readableState&&(this._readableState.error=e),null!==this._writableState&&(this._writableState.error=e),this._duplexState|=2,this._predestroy(),this._duplexState&=67108861,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick())}},{key:"on",value:function(e,t){return null!==this._readableState&&("data"===e&&(this._duplexState|=2304,this._readableState.updateNextTick()),"readable"===e&&(this._duplexState|=4096,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===e&&(this._duplexState|=I,this._writableState.updateNextTick()),(0,o.Z)((0,s.Z)(n.prototype),"on",this).call(this,e,t)}}]),n}(r),ae=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,d.Z)(this,n),(r=t.call(this,e))._duplexState|=1|P,r._readableState=new K((0,v.Z)(r),e),e&&(e.read&&(r._read=e.read),e.eagerOpen&&r.resume().pause()),r}return(0,p.Z)(n,[{key:"_read",value:function(e){e(null)}},{key:"pipe",value:function(e,t){return this._readableState.pipe(e,t),this._readableState.updateNextTick(),e}},{key:"read",value:function(){return this._readableState.updateNextTick(),this._readableState.read()}},{key:"push",value:function(e){return this._readableState.updateNextTick(),this._readableState.push(e)}},{key:"unshift",value:function(e){return this._readableState.updateNextTick(),this._readableState.unshift(e)}},{key:"resume",value:function(){return this._duplexState|=256,this._readableState.updateNextTick(),this}},{key:"pause",value:function(){return this._duplexState&=67108607,this}},{key:G,value:function(){var e,t=this,n=null,r=null,o=null;return this.on("error",(function(e){n=e})),this.on("readable",(function(){null!==r&&s(t.read())})),this.on("close",(function(){null!==r&&s(null)})),e={},(0,h.Z)(e,G,(function(){return this})),(0,h.Z)(e,"next",(function(){return new Promise((function(e,n){r=e,o=n;var i=t.read();null!==i?s(i):0!=(8&t._duplexState)&&s(null)}))})),(0,h.Z)(e,"return",(function(){return a(null)})),(0,h.Z)(e,"throw",(function(e){return a(e)})),e;function s(e){null!==o&&(n?o(n):null===e&&0==(t._duplexState&x)?o(i):r({value:e,done:null===e}),o=r=null)}function a(e){return t.destroy(e),new Promise((function(n,r){if(8&t._duplexState)return n({value:void 0,done:!0});t.once("close",(function(){e?r(e):n({value:void 0,done:!0})}))}))}}}],[{key:"_fromAsyncIterator",value:function(e,t){var r,i=new n((0,a.Z)((0,a.Z)({},t),{},{read:function(t){e.next().then(o).then(t.bind(null,null)).catch(t)},predestroy:function(){r=e.return()},destroy:function(e){if(!r)return e(null);r.then(e.bind(null,null)).catch(e)}}));return i;function o(e){e.done?i.push(null):i.push(e.value)}}},{key:"from",value:function(e,t){if(de(r=e)&&r.readable)return e;var r;if(e[G])return this._fromAsyncIterator(e[G](),t);Array.isArray(e)||(e=void 0===e?[]:[e]);var i=0;return new n((0,a.Z)((0,a.Z)({},t),{},{read:function(t){this.push(i===e.length?null:e[i++]),t(null)}}))}},{key:"isBackpressured",value:function(e){return 0!=(17422&e._duplexState)||e._readableState.buffered>=e._readableState.highWaterMark}},{key:"isPaused",value:function(e){return 0==(256&e._duplexState)}}]),n}(se),ue=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,d.Z)(this,n),(r=t.call(this,e))._duplexState=1,r._writableState=new V((0,v.Z)(r),e),e&&(e.writev&&(r._writev=e.writev),e.write&&(r._write=e.write),e.final&&(r._final=e.final)),r}return(0,p.Z)(n,[{key:"_writev",value:function(e,t){t(null)}},{key:"_write",value:function(e,t){this._writableState.autoBatch(e,t)}},{key:"_final",value:function(e){e(null)}},{key:"write",value:function(e){return this._writableState.updateNextTick(),this._writableState.push(e)}},{key:"end",value:function(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}]),n}(ae),ce=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,d.Z)(this,n),(r=t.call(this,e))._transformState=new Y((0,v.Z)(r)),e&&(e.transform&&(r._transform=e.transform),e.flush&&(r._flush=e.flush)),r}return(0,p.Z)(n,[{key:"_write",value:function(e,t){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=e:this._transform(e,this._transformState.afterTransform)}},{key:"_read",value:function(e){if(null!==this._transformState.data){var t=this._transformState.data;this._transformState.data=null,e(null),this._transform(t,this._transformState.afterTransform)}else e(null)}},{key:"_transform",value:function(e,t){t(null,e)}},{key:"_flush",value:function(e){e(null)}},{key:"_final",value:function(e){this._transformState.afterFinal=e,this._flush(he.bind(this))}}]),n}(ue);function he(e,t){var n=this._transformState.afterFinal;if(e)return n(e);null!=t&&this.push(t),this.push(null),n(null)}function le(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=Array.isArray(e)?[].concat((0,l.Z)(e),n):[e].concat(n),o=i.length&&"function"==typeof i[i.length-1]?i.pop():null;if(i.length<2)throw new Error("Pipeline requires at least 2 streams");for(var s=i[0],a=null,c=null,h=1;h<i.length;h++)a=i[h],de(s)?s.pipe(a,v):(p(s,!0,h>1,v),s.pipe(a)),s=a;if(o){var d=!1;a.on("finish",(function(){d=!0})),a.on("error",(function(e){c=c||e})),a.on("close",(function(){return o(c||(d?null:u))}))}return a;function p(e,t,n,r){e.on("error",r),e.on("close",(function(){return t&&e._readableState&&!e._readableState.ended||n&&e._writableState&&!e._writableState.ended?r(u):void 0}))}function v(e){if(e&&!c){c=e;var t,n=(0,f.Z)(i);try{for(n.s();!(t=n.n()).done;){t.value.destroy(e)}}catch(r){n.e(r)}finally{n.f()}}}}function fe(e){return!!e._readableState||!!e._writableState}function de(e){return"number"==typeof e._duplexState&&fe(e)}function pe(e){return function(e){return"object"==typeof e&&null!==e&&"number"==typeof e.byteLength}(e)?e.byteLength:1024}function ve(){}function ge(){this.destroy(new Error("Stream aborted."))}e.exports={pipeline:le,pipelinePromise:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Promise((function(e,n){return le.apply(void 0,t.concat([function(t){if(t)return n(t);e()}]))}))},isStream:fe,isStreamx:de,getStreamError:function(e){return e._readableState&&e._readableState.error||e._writableState&&e._writableState.error},Stream:se,Writable:function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,d.Z)(this,n),(r=t.call(this,e))._duplexState|=1|x,r._writableState=new V((0,v.Z)(r),e),e&&(e.writev&&(r._writev=e.writev),e.write&&(r._write=e.write),e.final&&(r._final=e.final)),r}return(0,p.Z)(n,[{key:"_writev",value:function(e,t){t(null)}},{key:"_write",value:function(e,t){this._writableState.autoBatch(e,t)}},{key:"_final",value:function(e){e(null)}},{key:"write",value:function(e){return this._writableState.updateNextTick(),this._writableState.push(e)}},{key:"end",value:function(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}],[{key:"isBackpressured",value:function(e){return 0!=(39845902&e._duplexState)}}]),n}(se),Readable:ae,Duplex:ue,Transform:ce,PassThrough:function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(){return(0,d.Z)(this,n),t.apply(this,arguments)}return(0,p.Z)(n)}(ce)}},2553:function(e,t,n){var r=n(9509).Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=u,this.end=c,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=h,this.end=l,t=3;break;default:return this.write=f,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"\ufffd";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"\ufffd";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"\ufffd"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function u(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function h(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function l(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function f(e){return e.toString(this.encoding)}function d(e){return e&&e.length?this.write(e):""}t.s=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\ufffd":t},o.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=s(t[r]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(e.lastNeed=i-2),i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},5017:function(e,t,n){var r=n(883);t.encode=r.encode,t.decode=r.decode},883:function(e,t,n){var r=n(8764).Buffer,i=[255,255,26,27,28,29,30,31,255,255,255,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255];t.encode=function(e){r.isBuffer(e)||(e=new r(e));for(var t,n,i=0,o=0,s=0,a=0,u=new r(8*(t=e,n=Math.floor(t.length/5),t.length%5==0?n:n+1));i<e.length;){var c=e[i];s>3?(a=(a=c&255>>s)<<(s=(s+5)%8)|(i+1<e.length?e[i+1]:0)>>8-s,i++):(a=c>>8-(s+5)&31,0===(s=(s+5)%8)&&i++),u[o]="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".charCodeAt(a),o++}for(i=o;i<u.length;i++)u[i]=61;return u},t.decode=function(e){var t,n=0,o=0,s=0;r.isBuffer(e)||(e=new r(e));for(var a=new r(Math.ceil(5*e.length/8)),u=0;u<e.length&&61!==e[u];u++){var c=e[u]-48;if(!(c<i.length))throw new Error("Invalid input - it is not base32 encoded string");o=i[c],n<=3?0===(n=(n+5)%8)?(t|=o,a[s]=t,s++,t=0):t|=255&o<<8-n:(t|=255&o>>>(n=(n+5)%8),a[s]=t,s++,t=255&o<<8-n)}return a.slice(0,s)}},1463:function(e){function t(e){return(+Date.now()-e)/100&65535}e.exports=function(e){var n=+Date.now(),r=10*(e||5),i=[0],o=1,s=t(n)-1&65535;return function(e){var a=t(n),u=a-s&65535;for(u>r&&(u=r),s=a;u--;)o===r&&(o=0),i[o]=i[0===o?r-1:o-1],o++;e&&(i[o-1]+=e);var c=i[o-1],h=i.length<r?0:i[o===r?0:o];return i.length<10?c:10*(c-h)/i.length}}},8687:function(e,t,n){var r=n(8764).Buffer,i=16384,o=function(){function e(t){(0,d.Z)(this,e),this.length=t,this.missing=t,this.sources=null,this._chunks=Math.ceil(t/i),this._remainder=t%i||i,this._buffered=0,this._buffer=null,this._cancellations=null,this._reservations=0,this._flushed=!1}return(0,p.Z)(e,[{key:"chunkLength",value:function(e){return e===this._chunks-1?this._remainder:i}},{key:"chunkLengthRemaining",value:function(e){return this.length-e*i}},{key:"chunkOffset",value:function(e){return e*i}},{key:"reserve",value:function(){return this.init()?this._cancellations.length?this._cancellations.pop():this._reservations<this._chunks?this._reservations++:-1:-1}},{key:"reserveRemaining",value:function(){if(!this.init())return-1;if(this._cancellations.length||this._reservations<this._chunks){for(var e=this._reservations;this._cancellations.length;)e=Math.min(e,this._cancellations.pop());return this._reservations=this._chunks,e}return-1}},{key:"cancel",value:function(e){this.init()&&this._cancellations.push(e)}},{key:"cancelRemaining",value:function(e){this.init()&&(this._reservations=e)}},{key:"get",value:function(e){return this.init()?this._buffer[e]:null}},{key:"set",value:function(e,t,n){if(!this.init())return!1;for(var r=t.length,o=Math.ceil(r/i),s=0;s<o;s++)if(!this._buffer[e+s]){var a=s*i,u=t.slice(a,a+i);this._buffered++,this._buffer[e+s]=u,this.missing-=u.length,this.sources.includes(n)||this.sources.push(n)}return this._buffered===this._chunks}},{key:"flush",value:function(){if(!this._buffer||this._chunks!==this._buffered)return null;var e=r.concat(this._buffer,this.length);return this._buffer=null,this._cancellations=null,this.sources=null,this._flushed=!0,e}},{key:"init",value:function(){return!this._flushed&&(this._buffer||(this._buffer=new Array(this._chunks),this._cancellations=[],this.sources=[]),!0)}}]),e}();Object.defineProperty(o,"BLOCK_LENGTH",{value:i}),e.exports=o},6581:function(e){e.exports=function(e,t){if(!(t>=e.length||t<0)){var n=e.pop();if(t<e.length){var r=e[t];return e[t]=n,r}return n}}},4927:function(e){function t(e){try{if(!globalThis.localStorage)return!1}catch(e){return!1}var t=globalThis.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,n){if(t("noDeprecation"))return e;var r=!1;return function(){if(!r){if(t("throwDeprecation"))throw new Error(n);t("traceDeprecation")?console.trace(n):console.warn(n),r=!0}return e.apply(this,arguments)}}},2479:function(e){e.exports=function e(t,n){if(t&&n)return e(t)(n);if("function"!=typeof t)throw new TypeError("need wrapper function");return Object.keys(t).forEach((function(e){r[e]=t[e]})),r;function r(){for(var e=new Array(arguments.length),n=0;n<e.length;n++)e[n]=arguments[n];var r=t.apply(this,e),i=e[e.length-1];return"function"==typeof r&&r!==i&&Object.keys(i).forEach((function(e){r[e]=i[e]})),r}}},6475:function(){},2203:function(){},3423:function(){},1494:function(){},5381:function(){},8838:function(){},5517:function(){},9354:function(){},8411:function(){},1857:function(){},159:function(){},859:function(){},2911:function(){},970:function(){},1982:function(){},1156:function(){},2361:function(){},4616:function(){},3719:function(){},1018:function(){},2067:function(){},8302:function(){},3552:function(){},5843:function(){},3287:function(e,t,n){n.r(t),n.d(t,{default:function(){return b},enableSecure:function(){return _}});var r=n(7187),i=n(1237),o=n(6581),s=n(1227),a=n(814),u="tcpIncoming",c="tcpOutgoing",h="utpIncoming",l="utpOutgoing",f="webSeed",v=s("webtorrent:peer"),m=!1,_=function(){m=!0},b=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this)).id=e,i.type=r,v("new %s Peer %s",r,e),i.addr=null,i.conn=null,i.swarm=null,i.wire=null,i.source=null,i.connected=!1,i.destroyed=!1,i.timeout=null,i.retries=0,i.sentPe1=!1,i.sentPe2=!1,i.sentPe3=!1,i.sentPe4=!1,i.sentHandshake=!1,i}return(0,p.Z)(n,[{key:"onConnect",value:function(){var e=this;if(!this.destroyed){this.connected=!0,v("Peer %s connected",this.id),clearTimeout(this.connectTimeout);var t=this.conn;t.once("end",(function(){e.destroy()})),t.once("close",(function(){e.destroy()})),t.once("finish",(function(){e.destroy()})),t.once("error",(function(t){e.destroy(t)}));var n=this.wire=new a.Z(this.type,this.retries,m);n.once("end",(function(){e.destroy()})),n.once("close",(function(){e.destroy()})),n.once("finish",(function(){e.destroy()})),n.once("error",(function(t){e.destroy(t)})),n.once("pe1",(function(){e.onPe1()})),n.once("pe2",(function(){e.onPe2()})),n.once("pe3",(function(){e.onPe3()})),n.once("pe4",(function(){e.onPe4()})),n.once("handshake",(function(t,n){e.onHandshake(t,n)})),this.startHandshakeTimeout(),this.setThrottlePipes(),this.swarm&&("tcpOutgoing"===this.type?m&&0===this.retries&&!this.sentPe1?this.sendPe1():this.sentHandshake||this.handshake():"tcpIncoming"===this.type||this.sentHandshake||this.handshake())}}},{key:"sendPe1",value:function(){this.wire.sendPe1(),this.sentPe1=!0}},{key:"onPe1",value:function(){this.sendPe2()}},{key:"sendPe2",value:function(){this.wire.sendPe2(),this.sentPe2=!0}},{key:"onPe2",value:function(){this.sendPe3()}},{key:"sendPe3",value:function(){this.wire.sendPe3(this.swarm.infoHash),this.sentPe3=!0}},{key:"onPe3",value:function(e){this.swarm&&(this.swarm.infoHashHash!==e&&this.destroy(new Error("unexpected crypto handshake info hash for this swarm")),this.sendPe4())}},{key:"sendPe4",value:function(){this.wire.sendPe4(this.swarm.infoHash),this.sentPe4=!0}},{key:"onPe4",value:function(){this.sentHandshake||this.handshake()}},{key:"clearPipes",value:function(){this.conn.unpipe(),this.wire.unpipe()}},{key:"setThrottlePipes",value:function(){var e=this;(0,i.pipeline)(this.conn,this.throttleGroups.down.throttle(),new i.Transform({transform:function(t,n){e.emit("download",t.length),e.destroyed||n(null,t)}}),this.wire,this.throttleGroups.up.throttle(),new i.Transform({transform:function(t,n){e.emit("upload",t.length),e.destroyed||n(null,t)}}),this.conn)}},{key:"onHandshake",value:function(e,t){if(this.swarm&&!this.destroyed){if(this.swarm.destroyed)return this.destroy(new Error("swarm already destroyed"));if(e!==this.swarm.infoHash)return this.destroy(new Error("unexpected handshake info hash for this swarm"));if(t===this.swarm.peerId)return this.destroy(new Error("refusing to connect to ourselves"));v("Peer %s got handshake %s",this.id,e),clearTimeout(this.handshakeTimeout),this.retries=0;var n=this.addr;!n&&this.conn.remoteAddress&&this.conn.remotePort&&(n="".concat(this.conn.remoteAddress,":").concat(this.conn.remotePort)),this.swarm._onWire(this.wire,n),this.swarm&&!this.swarm.destroyed&&(this.sentHandshake||this.handshake())}}},{key:"handshake",value:function(){var e={dht:!this.swarm.private&&!!this.swarm.client.dht,fast:!0};this.wire.handshake(this.swarm.infoHash,this.swarm.client.peerId,e),this.sentHandshake=!0}},{key:"startConnectTimeout",value:function(){var e=this;clearTimeout(this.connectTimeout);this.connectTimeout=setTimeout((function(){e.destroy(new Error("connect timeout"))}),{webrtc:25e3,tcpOutgoing:5e3,utpOutgoing:5e3}[this.type]),this.connectTimeout.unref&&this.connectTimeout.unref()}},{key:"startHandshakeTimeout",value:function(){var e=this;clearTimeout(this.handshakeTimeout),this.handshakeTimeout=setTimeout((function(){e.destroy(new Error("handshake timeout"))}),25e3),this.handshakeTimeout.unref&&this.handshakeTimeout.unref()}},{key:"destroy",value:function(e){if(!this.destroyed){this.destroyed=!0,this.connected=!1,v("destroy %s %s (error: %s)",this.type,this.id,e&&(e.message||e)),clearTimeout(this.connectTimeout),clearTimeout(this.handshakeTimeout);var t=this.swarm,n=this.conn,r=this.wire;this.swarm=null,this.conn=null,this.wire=null,t&&r&&o(t.wires,t.wires.indexOf(r)),n&&(n.on("error",(function(){})),n.destroy()),r&&r.destroy(),t&&t.removePeer(this.id)}}}]),n}(r);b.TYPE_TCP_INCOMING=u,b.TYPE_TCP_OUTGOING=c,b.TYPE_UTP_INCOMING=h,b.TYPE_UTP_OUTGOING=l,b.TYPE_WEBRTC="webrtc",b.TYPE_WEBSEED=f,b.SOURCE_MANUAL="manual",b.SOURCE_TRACKER="tracker",b.SOURCE_DHT="dht",b.SOURCE_LSD="lsd",b.SOURCE_UT_PEX="ut_pex",b.createWebRTCPeer=function(e,t,n){var r=new b(e.id,"webrtc");if(r.conn=e,r.swarm=t,r.throttleGroups=n,r.conn.connected)r.onConnect();else{var i=function(){r.conn.removeListener("connect",o),r.conn.removeListener("error",s)},o=function(){i(),r.onConnect()},s=function(e){i(),r.destroy(e)};r.conn.once("connect",o),r.conn.once("error",s),r.startConnectTimeout()}return r},b.createTCPIncomingPeer=function(e,t){return b._createIncomingPeer(e,u,t)},b.createUTPIncomingPeer=function(e,t){return b._createIncomingPeer(e,h,t)},b.createTCPOutgoingPeer=function(e,t,n){return b._createOutgoingPeer(e,t,c,n)},b.createUTPOutgoingPeer=function(e,t,n){return b._createOutgoingPeer(e,t,l,n)},b._createIncomingPeer=function(e,t,n){var r="".concat(e.remoteAddress,":").concat(e.remotePort),i=new b(r,t);return i.conn=e,i.addr=r,i.throttleGroups=n,i.onConnect(),i},b._createOutgoingPeer=function(e,t,n,r){var i=new b(e,n);return i.addr=e,i.swarm=t,i.throttleGroups=r,i},b.createWebSeedPeer=function(e,t,n,r){var i=new b(t,f);return i.swarm=n,i.conn=e,i.throttleGroups=r,i.onConnect(),i}},502:function(e,t,n){n.d(t,{Z:function(){return g}});var r=n(5194);function o(e){var t=e<0?1:0;return e=Math.abs(Number(e||1)),Math.floor(Math.log10(e))+1+t}function s(e){return ArrayBuffer.isView(e)?"arraybufferview":Array.isArray(e)?"array":e instanceof Number?"number":e instanceof Boolean?"boolean":e instanceof Set?"set":e instanceof Map?"map":e instanceof String?"string":e instanceof ArrayBuffer?"arraybuffer":typeof e}function a(e,t,n){var i,o=[];return a._encode(o,e),i=(0,r.zo)(o),a.bytes=i.length,ArrayBuffer.isView(t)?(t.set(i,n),t):i}a.bytes=-1,a._floatConversionDetected=!1,a._encode=function(e,t){if(null!=t)switch(s(t)){case"object":a.dict(e,t);break;case"map":a.dictMap(e,t);break;case"array":a.list(e,t);break;case"set":a.listSet(e,t);break;case"string":a.string(e,t);break;case"number":case"boolean":a.number(e,t);break;case"arraybufferview":a.buffer(e,new Uint8Array(t.buffer,t.byteOffset,t.byteLength));break;case"arraybuffer":a.buffer(e,new Uint8Array(t))}};var u=new Uint8Array([101]),c=new Uint8Array([100]),h=new Uint8Array([108]);a.buffer=function(e,t){e.push((0,r.gR)(t.length+":"),t)},a.string=function(e,t){e.push((0,r.gR)((0,r.gR)(t).byteLength+":"+t))},a.number=function(e,t){var n=2147483648,i=(t/n<<0)*n+(t%n<<0);e.push((0,r.gR)("i"+i+"e")),i===t||a._floatConversionDetected||(a._floatConversionDetected=!0,console.warn('WARNING: Possible data corruption detected with value "'+t+'":','Bencoding only defines support for integers, value was converted to "'+i+'"'),console.trace())},a.dict=function(e,t){e.push(c);for(var n,r=0,i=Object.keys(t).sort(),o=i.length;r<o;r++)null!=t[n=i[r]]&&(a.string(e,n),a._encode(e,t[n]));e.push(u)},a.dictMap=function(e,t){e.push(c);var n,r=Array.from(t.keys()).sort(),i=(0,f.Z)(r);try{for(i.s();!(n=i.n()).done;){var o=n.value;null!=t.get(o)&&(ArrayBuffer.isView(o)?a._encode(e,o):a.string(e,String(o)),a._encode(e,t.get(o)))}}catch(s){i.e(s)}finally{i.f()}e.push(u)},a.list=function(e,t){var n=0,r=t.length;for(e.push(h);n<r;n++)null!=t[n]&&a._encode(e,t[n]);e.push(u)},a.listSet=function(e,t){e.push(h);var n,r=(0,f.Z)(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;null!=i&&a._encode(e,i)}}catch(o){r.e(o)}finally{r.f()}e.push(u)};var l=a;function d(e,t,n){for(var r=0,i=1,o=t;o<n;o++){var s=e[o];if(s<58&&s>=48)r=10*r+(s-48);else if(o!==t||43!==s){if(o!==t||45!==s){if(46===s)break;throw new Error("not a number: buffer["+o+"] = "+s)}i=-1}}return r*i}function p(e,t,n,i){return null==e||0===e.length?null:("number"!=typeof t&&null==i&&(i=t,t=void 0),"number"!=typeof n&&null==i&&(i=n,n=void 0),p.position=0,p.encoding=i||null,p.data=ArrayBuffer.isView(e)?new Uint8Array(e.slice(t,n)):(0,r.gR)(e),p.bytes=p.data.length,p.next())}function v(e){if(null==e)return 0;var t=s(e);switch(t){case"arraybufferview":return function(e){var t=e.byteLength-e.byteOffset;return o(t)+1+t}(e);case"string":return function(e){var t=(0,r.gR)(e).byteLength;return o(t)+1+t}(e);case"array":case"set":return function(e){var t,n=2,r=(0,f.Z)(e);try{for(r.s();!(t=r.n()).done;){n+=v(t.value)}}catch(i){r.e(i)}finally{r.f()}return n}(e);case"number":return 1+o(Math.floor(e))+1;case"bigint":return 1+e.toString().length+1;case"object":return function(e){for(var t=2,n=Object.keys(e),i=0;i<n.length;i++){var s=(0,r.gR)(n[i]).byteLength;t+=o(s)+1+s,t+=v(e[n[i]])}return t}(e);case"map":return function(e){var t,n=2,s=(0,f.Z)(e);try{for(s.s();!(t=s.n()).done;){var a=(0,i.Z)(t.value,2),u=a[0],c=a[1],h=(0,r.gR)(u).byteLength;n+=o(h)+1+h,n+=v(c)}}catch(l){s.e(l)}finally{s.f()}return n}(e);default:throw new TypeError('Unsupported value of type "'.concat(t,'"'))}}p.bytes=0,p.position=0,p.data=null,p.encoding=null,p.next=function(){switch(p.data[p.position]){case 100:return p.dictionary();case 108:return p.list();case 105:return p.integer();default:return p.buffer()}},p.find=function(e){for(var t=p.position,n=p.data.length,r=p.data;t<n;){if(r[t]===e)return t;t++}throw new Error('Invalid data: Missing delimiter "'+String.fromCharCode(e)+'" [0x'+e.toString(16)+"]")},p.dictionary=function(){p.position++;for(var e={};101!==p.data[p.position];)e[(0,r.vV)(p.buffer())]=p.next();return p.position++,e},p.list=function(){p.position++;for(var e=[];101!==p.data[p.position];)e.push(p.next());return p.position++,e},p.integer=function(){var e=p.find(101),t=d(p.data,p.position+1,e);return p.position+=e+1-p.position,t},p.buffer=function(){var e=p.find(58),t=d(p.data,p.position,e),n=++e+t;return p.position=n,p.encoding?(0,r.vV)(p.data.slice(e,n)):p.data.slice(e,n)};var g={encode:l,decode:p,byteLength:v,encodingLength:v}},8205:function(e,t,n){function r(e){var t=e>>3;return e%8!=0&&t++,t}n.d(t,{Z:function(){return i}});var i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0;(0,d.Z)(this,e);var i=null==n?void 0:n.grow;this.grow=i&&isFinite(i)&&r(i)||i||0,this.buffer="number"==typeof t?new Uint8Array(r(t)):t}return(0,p.Z)(e,[{key:"get",value:function(e){var t=e>>3;return t<this.buffer.length&&!!(this.buffer[t]&128>>e%8)}},{key:"set",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e>>3;if(t){if(this.buffer.length<n+1){var r=Math.max(n+1,Math.min(2*this.buffer.length,this.grow));if(r<=this.grow){var i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}this.buffer[n]|=128>>e%8}else n<this.buffer.length&&(this.buffer[n]&=~(128>>e%8))}},{key:"forEach",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8*this.buffer.length,r=t,i=r>>3,o=128>>r%8,s=this.buffer[i];r<n;r++)e(!!(s&o),r),o=1===o?(s=this.buffer[++i],128):o>>1}}]),e}()},814:function(e,t,n){n.d(t,{Z:function(){return D}});var r=n(502),i=n(8205),a=n(5517),c=n(1227),h=n(1798),l=n(7830),v=n(8473),_=n(5194),b=n(1463),w=n(6581),k=c("bittorrent-protocol"),x=(0,_.gR)("\x13BitTorrent protocol"),E=new Uint8Array([0,0,0,0]),S=new Uint8Array([0,0,0,1,0]),T=new Uint8Array([0,0,0,1,1]),C=new Uint8Array([0,0,0,1,2]),A=new Uint8Array([0,0,0,1,3]),R=[0,0,0,0,0,0,0,0],P=[0,0,0,3,9,0,0],I=new Uint8Array([0,0,0,1,14]),L=new Uint8Array([0,0,0,1,15]),O=new Uint8Array([0,0,0,0,0,0,0,0]),Z=new Uint8Array([0,0,1,2]),B=new Uint8Array([0,0,0,2]);function M(e,t){for(var n=e.length;n--;)e[n]^=t[n];return e}var N=(0,p.Z)((function e(t,n,r,i){(0,d.Z)(this,e),this.piece=t,this.offset=n,this.length=r,this.callback=i})),j=function(){function e(){(0,d.Z)(this,e),this.buffer=new Uint8Array}return(0,p.Z)(e,[{key:"get",value:function(e){return!0}},{key:"set",value:function(e){}}]),e}(),U=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,d.Z)(this,n),(e=t.call(this))._debugId=(0,_.oc)(h(4)),e._debug("new wire"),e.peerId=null,e.peerIdBuffer=null,e.type=r,e.amChoking=!0,e.amInterested=!1,e.peerChoking=!0,e.peerInterested=!1,e.peerPieces=new i.Z(0,{grow:4e5}),e.extensions={},e.peerExtensions={},e.requests=[],e.peerRequests=[],e.extendedMapping={},e.peerExtendedMapping={},e.extendedHandshake={},e.peerExtendedHandshake={},e.hasFast=!1,e.allowedFastSet=[],e.peerAllowedFastSet=[],e._ext={},e._nextExt=1,e.uploaded=0,e.downloaded=0,e.uploadSpeed=b(),e.downloadSpeed=b(),e._keepAliveInterval=null,e._timeout=null,e._timeoutMs=0,e._timeoutExpiresAt=null,e.destroyed=!1,e._finished=!1,e._parserSize=0,e._parser=null,e._buffer=[],e._bufferSize=0,e._peEnabled=s,s?(e._dh=a.createDiffieHellman("ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a36210000000000090563","hex",2),e._myPubKey=e._dh.generateKeys("hex")):e._myPubKey=null,e._peerPubKey=null,e._sharedSecret=null,e._peerCryptoProvide=[],e._cryptoHandshakeDone=!1,e._cryptoSyncPattern=null,e._waitMaxBytes=null,e._encryptionMethod=null,e._encryptGenerator=null,e._decryptGenerator=null,e._setGenerators=!1,e.once("finish",(function(){return e._onFinish()})),e.on("finish",e._onFinish),e._debug("type:",e.type),"tcpIncoming"===e.type&&e._peEnabled?e._determineHandshakeType():"tcpOutgoing"===e.type&&e._peEnabled&&0===o?e._parsePe2():e._parseHandshake(null),e}return(0,p.Z)(n,[{key:"setKeepAlive",value:function(e){var t=this;this._debug("setKeepAlive %s",e),clearInterval(this._keepAliveInterval),!1!==e&&(this._keepAliveInterval=setInterval((function(){t.keepAlive()}),55e3))}},{key:"setTimeout",value:function(e,t){this._debug("setTimeout ms=%d unref=%s",e,t),this._timeoutMs=e,this._timeoutUnref=!!t,this._resetTimeout(!0)}},{key:"destroy",value:function(){if(!this.destroyed)return this.destroyed=!0,this._debug("destroy"),this.emit("close"),this.end(),this}},{key:"end",value:function(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return this._debug("end"),this._onUninterested(),this._onChoke(),(e=(0,o.Z)((0,s.Z)(n.prototype),"end",this)).call.apply(e,[this].concat(r))}},{key:"use",value:function(e){var t=e.prototype.name;if(!t)throw new Error('Extension class requires a "name" property on the prototype');this._debug("use extension.name=%s",t);var n=this._nextExt,r=new e(this);function i(){}"function"!=typeof r.onHandshake&&(r.onHandshake=i),"function"!=typeof r.onExtendedHandshake&&(r.onExtendedHandshake=i),"function"!=typeof r.onMessage&&(r.onMessage=i),this.extendedMapping[n]=t,this._ext[t]=r,this[t]=r,this._nextExt+=1}},{key:"keepAlive",value:function(){this._debug("keep-alive"),this._push(E)}},{key:"sendPe1",value:function(){if(this._peEnabled){var e=Math.floor(513*Math.random()),t=h(e);this._push((0,_.zo)([(0,_._0)(this._myPubKey),t]))}}},{key:"sendPe2",value:function(){var e=Math.floor(513*Math.random()),t=h(e);this._push((0,_.zo)([(0,_._0)(this._myPubKey),t]))}},{key:"sendPe3",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var n,r,i,o,s,a;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setEncrypt(this._sharedSecret,t);case 2:return e.next=4,(0,_.vp)((0,_._0)(this._utfToHex("req1")+this._sharedSecret));case 4:return n=e.sent,e.t0=M,e.next=8,(0,_.vp)((0,_._0)(this._utfToHex("req2")+t));case 8:return e.t1=e.sent,e.next=11,(0,_.vp)((0,_._0)(this._utfToHex("req3")+this._sharedSecret));case 11:e.t2=e.sent,r=(0,e.t0)(e.t1,e.t2),i=new DataView(h(2).buffer).getUint16(0)%512,o=h(i),(s=new Uint8Array(14+i+2)).set(O),s.set(Z,8),(a=new DataView(s.buffer)).setInt16(12,i),o.copy(s,14),a.setInt16(14+i,0),s=this._encryptHandshake(s),this._push((0,_.zo)([n,r,s]));case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendPe4",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var n,r,i,o;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setEncrypt(this._sharedSecret,t);case 2:n=new DataView(h(2).buffer).getUint16(0)%512,r=h(n),i=new Uint8Array(14+n),o=new DataView(i.buffer),i.set(O),i.set(B,8),o.setInt16(12,n),i.set(r,14),i=this._encryptHandshake(i),this._push(i),this._cryptoHandshakeDone=!0,this._debug("completed crypto handshake");case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handshake",value:function(e,t,n){var r,i;if("string"==typeof e?(e=e.toLowerCase(),r=(0,_._0)(e)):(r=e,e=(0,_.oc)(r)),"string"==typeof t?i=(0,_._0)(t):(i=t,t=(0,_.oc)(i)),this._infoHash=r,20!==r.length||20!==i.length)throw new Error("infoHash and peerId MUST have length 20");this._debug("handshake i=%s p=%s exts=%o",e,t,n);var o=new Uint8Array(R);this.extensions={extended:!0,dht:!(!n||!n.dht),fast:!(!n||!n.fast)},o[5]|=16,this.extensions.dht&&(o[7]|=1),this.extensions.fast&&(o[7]|=4),this.extensions.fast&&this.peerExtensions.fast&&(this._debug("fast extension is enabled"),this.hasFast=!0),this._push((0,_.zo)([x,o,r,i])),this._handshakeSent=!0,this.peerExtensions.extended&&!this._extendedHandshakeSent&&this._sendExtendedHandshake()}},{key:"_sendExtendedHandshake",value:function(){var e=Object.assign({},this.extendedHandshake);for(var t in e.m={},this.extendedMapping){var n=this.extendedMapping[t];e.m[n]=Number(t)}this.extended(0,r.Z.encode(e)),this._extendedHandshakeSent=!0}},{key:"choke",value:function(){if(!this.amChoking)if(this.amChoking=!0,this._debug("choke"),this._push(S),this.hasFast)for(var e=0;this.peerRequests.length>e;){var t=this.peerRequests[e];this.allowedFastSet.includes(t.piece)?++e:this.reject(t.piece,t.offset,t.length)}else for(;this.peerRequests.length;)this.peerRequests.pop()}},{key:"unchoke",value:function(){this.amChoking&&(this.amChoking=!1,this._debug("unchoke"),this._push(T))}},{key:"interested",value:function(){this.amInterested||(this.amInterested=!0,this._debug("interested"),this._push(C))}},{key:"uninterested",value:function(){this.amInterested&&(this.amInterested=!1,this._debug("uninterested"),this._push(A))}},{key:"have",value:function(e){this._debug("have %d",e),this._message(4,[e],null)}},{key:"bitfield",value:function(e){this._debug("bitfield"),ArrayBuffer.isView(e)||(e=e.buffer),this._message(5,[],e)}},{key:"request",value:function(e,t,n,r){return r||(r=function(){}),this._finished?r(new Error("wire is closed")):!this.peerChoking||this.hasFast&&this.peerAllowedFastSet.includes(e)?(this._debug("request index=%d offset=%d length=%d",e,t,n),this.requests.push(new N(e,t,n,r)),this._timeout||this._resetTimeout(!0),void this._message(6,[e,t,n],null)):r(new Error("peer is choking"))}},{key:"piece",value:function(e,t,n){this._debug("piece index=%d offset=%d",e,t),this._message(7,[e,t],n),this.uploaded+=n.length,this.uploadSpeed(n.length),this.emit("upload",n.length)}},{key:"cancel",value:function(e,t,n){this._debug("cancel index=%d offset=%d length=%d",e,t,n),this._callback(this._pull(this.requests,e,t,n),new Error("request was cancelled"),null),this._message(8,[e,t,n],null)}},{key:"port",value:function(e){this._debug("port %d",e);var t=new Uint8Array(P);new DataView(t.buffer).setUint16(5,e),this._push(t)}},{key:"suggest",value:function(e){if(!this.hasFast)throw Error("fast extension is disabled");this._debug("suggest %d",e),this._message(13,[e],null)}},{key:"haveAll",value:function(){if(!this.hasFast)throw Error("fast extension is disabled");this._debug("have-all"),this._push(I)}},{key:"haveNone",value:function(){if(!this.hasFast)throw Error("fast extension is disabled");this._debug("have-none"),this._push(L)}},{key:"reject",value:function(e,t,n){if(!this.hasFast)throw Error("fast extension is disabled");this._debug("reject index=%d offset=%d length=%d",e,t,n),this._pull(this.peerRequests,e,t,n),this._message(16,[e,t,n],null)}},{key:"allowedFast",value:function(e){if(!this.hasFast)throw Error("fast extension is disabled");this._debug("allowed-fast %d",e),this.allowedFastSet.includes(e)||this.allowedFastSet.push(e),this._message(17,[e],null)}},{key:"extended",value:function(e,t){if(this._debug("extended ext=%s",e),"string"==typeof e&&this.peerExtendedMapping[e]&&(e=this.peerExtendedMapping[e]),"number"!=typeof e)throw new Error("Unrecognized extension: ".concat(e));var n=new Uint8Array([e]),i=ArrayBuffer.isView(t)?t:r.Z.encode(t);this._message(20,[],(0,_.zo)([n,i]))}},{key:"setEncrypt",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t,n){var r,i,o,s,a,u,c,h,d,p,v,g,y,b,w,k,x;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this.type,e.next="tcpIncoming"===e.t0?3:"tcpOutgoing"===e.t0?17:31;break;case 3:return e.next=5,(0,_.vp)((0,_._0)(this._utfToHex("keyB")+t+n));case 5:return r=e.sent,e.next=8,(0,_.vp)((0,_._0)(this._utfToHex("keyA")+t+n));case 8:o=e.sent,i=[],a=(0,f.Z)(r.values());try{for(a.s();!(u=a.n()).done;)c=u.value,i.push(c)}catch(m){a.e(m)}finally{a.f()}s=[],h=(0,f.Z)(o.values());try{for(h.s();!(d=h.n()).done;)p=d.value,s.push(p)}catch(m){h.e(m)}finally{h.f()}return this._encryptGenerator=new l(i),this._decryptGenerator=new l(s),e.abrupt("break",32);case 17:return e.next=19,(0,_.vp)((0,_._0)(this._utfToHex("keyA")+t+n));case 19:return r=e.sent,e.next=22,(0,_.vp)((0,_._0)(this._utfToHex("keyB")+t+n));case 22:o=e.sent,i=[],v=(0,f.Z)(r.values());try{for(v.s();!(g=v.n()).done;)y=g.value,i.push(y)}catch(m){v.e(m)}finally{v.f()}s=[],b=(0,f.Z)(o.values());try{for(b.s();!(w=b.n()).done;)k=w.value,s.push(k)}catch(m){b.e(m)}finally{b.f()}return this._encryptGenerator=new l(i),this._decryptGenerator=new l(s),e.abrupt("break",32);case 31:return e.abrupt("return",!1);case 32:for(x=0;x<1024;x++)this._encryptGenerator.randomByte(),this._decryptGenerator.randomByte();return e.abrupt("return",(this._setGenerators=!0,!0));case 34:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_read",value:function(){}},{key:"_message",value:function(e,t,n){var r=n?n.length:0,i=new Uint8Array(5+4*t.length),o=new DataView(i.buffer);o.setUint32(0,i.length+r-4),i[4]=e;for(var s=0;s<t.length;s++)o.setUint32(5+4*s,t[s]);this._push(i),n&&this._push(n)}},{key:"_push",value:function(e){if(!this._finished)return 2===this._encryptionMethod&&this._cryptoHandshakeDone&&(e=this._encrypt(e)),this.push(e)}},{key:"_onKeepAlive",value:function(){this._debug("got keep-alive"),this.emit("keep-alive")}},{key:"_onPe1",value:function(e){this._peerPubKey=(0,_.oc)(e),this._sharedSecret=this._dh.computeSecret(this._peerPubKey,"hex","hex"),this.emit("pe1")}},{key:"_onPe2",value:function(e){this._peerPubKey=(0,_.oc)(e),this._sharedSecret=this._dh.computeSecret(this._peerPubKey,"hex","hex"),this.emit("pe2")}},{key:"_onPe3",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var n,r;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_.oc)(this._utfToHex("req3")+this._sharedSecret);case 2:n=e.sent,r=(0,_.oc)(M(n,t)),this.emit("pe3",r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_onPe3Encrypted",value:function(e,t){if(!(0,_.Dg)(e,O))return this._debug("Error: verification constant did not match"),void this.destroy();var n,r=(0,f.Z)(t.values());try{for(r.s();!(n=r.n()).done;){var i=n.value;0!==i&&this._peerCryptoProvide.push(i)}}catch(o){r.e(o)}finally{r.f()}this._peerCryptoProvide.includes(2)?this._encryptionMethod=2:(this._debug("Error: RC4 encryption method not provided by peer"),this.destroy())}},{key:"_onPe4",value:function(e){this._encryptionMethod=e[3],Z.includes(this._encryptionMethod)||(this._debug("Error: peer selected invalid crypto method"),this.destroy()),this._cryptoHandshakeDone=!0,this._debug("crypto handshake done"),this.emit("pe4")}},{key:"_onHandshake",value:function(e,t,n){var r=(0,_.oc)(e),i=(0,_.oc)(t);for(var o in this._debug("got handshake i=%s p=%s exts=%o",r,i,n),this.peerId=i,this.peerIdBuffer=t,this.peerExtensions=n,this.extensions.fast&&this.peerExtensions.fast&&(this._debug("fast extension is enabled"),this.hasFast=!0),this.emit("handshake",r,i,n),this._ext)this._ext[o].onHandshake(r,i,n);n.extended&&this._handshakeSent&&!this._extendedHandshakeSent&&this._sendExtendedHandshake()}},{key:"_onChoke",value:function(){if(this.peerChoking=!0,this._debug("got choke"),this.emit("choke"),!this.hasFast)for(;this.requests.length;)this._callback(this.requests.pop(),new Error("peer is choking"),null)}},{key:"_onUnchoke",value:function(){this.peerChoking=!1,this._debug("got unchoke"),this.emit("unchoke")}},{key:"_onInterested",value:function(){this.peerInterested=!0,this._debug("got interested"),this.emit("interested")}},{key:"_onUninterested",value:function(){this.peerInterested=!1,this._debug("got uninterested"),this.emit("uninterested")}},{key:"_onHave",value:function(e){this.peerPieces.get(e)||(this._debug("got have %d",e),this.peerPieces.set(e,!0),this.emit("have",e))}},{key:"_onBitField",value:function(e){this.peerPieces=new i.Z(e),this._debug("got bitfield"),this.emit("bitfield",this.peerPieces)}},{key:"_onRequest",value:function(e,t,n){var r=this;if(!this.amChoking||this.hasFast&&this.allowedFastSet.includes(e)){this._debug("got request index=%d offset=%d length=%d",e,t,n);var i=function(i,s){if(o===r._pull(r.peerRequests,e,t,n))return i?(r._debug("error satisfying request index=%d offset=%d length=%d (%s)",e,t,n,i.message),void(r.hasFast&&r.reject(e,t,n))):void r.piece(e,t,s)},o=new N(e,t,n,i);this.peerRequests.push(o),this.emit("request",e,t,n,i)}else this.hasFast&&this.reject(e,t,n)}},{key:"_onPiece",value:function(e,t,n){this._debug("got piece index=%d offset=%d",e,t),this._callback(this._pull(this.requests,e,t,n.length),null,n),this.downloaded+=n.length,this.downloadSpeed(n.length),this.emit("download",n.length),this.emit("piece",e,t,n)}},{key:"_onCancel",value:function(e,t,n){this._debug("got cancel index=%d offset=%d length=%d",e,t,n),this._pull(this.peerRequests,e,t,n),this.emit("cancel",e,t,n)}},{key:"_onPort",value:function(e){this._debug("got port %d",e),this.emit("port",e)}},{key:"_onSuggest",value:function(e){if(!this.hasFast)return this._debug("Error: got suggest whereas fast extension is disabled"),void this.destroy();this._debug("got suggest %d",e),this.emit("suggest",e)}},{key:"_onHaveAll",value:function(){if(!this.hasFast)return this._debug("Error: got have-all whereas fast extension is disabled"),void this.destroy();this._debug("got have-all"),this.peerPieces=new j,this.emit("have-all")}},{key:"_onHaveNone",value:function(){if(!this.hasFast)return this._debug("Error: got have-none whereas fast extension is disabled"),void this.destroy();this._debug("got have-none"),this.emit("have-none")}},{key:"_onReject",value:function(e,t,n){if(!this.hasFast)return this._debug("Error: got reject whereas fast extension is disabled"),void this.destroy();this._debug("got reject index=%d offset=%d length=%d",e,t,n),this._callback(this._pull(this.requests,e,t,n),new Error("request was rejected"),null),this.emit("reject",e,t,n)}},{key:"_onAllowedFast",value:function(e){if(!this.hasFast)return this._debug("Error: got allowed-fast whereas fast extension is disabled"),void this.destroy();this._debug("got allowed-fast %d",e),this.peerAllowedFastSet.includes(e)||this.peerAllowedFastSet.push(e),this.peerAllowedFastSet.length>100&&this.peerAllowedFastSet.shift(),this.emit("allowed-fast",e)}},{key:"_onExtended",value:function(e,t){if(0===e){var n;try{n=r.Z.decode(t)}catch(e){this._debug("ignoring invalid extended handshake: %s",e.message||e)}if(!n)return;if(this.peerExtendedHandshake=n,"object"==typeof n.m)for(var i in n.m)this.peerExtendedMapping[i]=Number(n.m[i].toString());for(var o in this._ext)this.peerExtendedMapping[o]&&this._ext[o].onExtendedHandshake(this.peerExtendedHandshake);this._debug("got extended handshake"),this.emit("extended","handshake",this.peerExtendedHandshake)}else this.extendedMapping[e]&&(e=this.extendedMapping[e],this._ext[e]&&this._ext[e].onMessage(t)),this._debug("got extended message ext=%s",e),this.emit("extended",e,t)}},{key:"_onTimeout",value:function(){this._debug("request timed out"),this._callback(this.requests.shift(),new Error("request has timed out"),null),this.emit("timeout")}},{key:"_write",value:function(e,t,n){if(2===this._encryptionMethod&&this._cryptoHandshakeDone&&(e=this._decrypt(e)),this._bufferSize+=e.length,this._buffer.push(e),this._buffer.length>1&&(this._buffer=[(0,_.zo)(this._buffer,this._bufferSize)]),this._cryptoSyncPattern){var r=this._buffer[0].indexOf(this._cryptoSyncPattern);if(-1!==r)this._buffer[0]=this._buffer[0].slice(r+this._cryptoSyncPattern.length),this._bufferSize-=r+this._cryptoSyncPattern.length,this._cryptoSyncPattern=null;else if(this._bufferSize+e.length>this._waitMaxBytes+this._cryptoSyncPattern.length)return this._debug("Error: could not resynchronize"),void this.destroy()}for(;this._bufferSize>=this._parserSize&&!this._cryptoSyncPattern;)if(0===this._parserSize)this._parser(new Uint8Array);else{var i=this._buffer[0];this._bufferSize-=this._parserSize,this._buffer=this._bufferSize?[i.slice(this._parserSize)]:[],this._parser(i.slice(0,this._parserSize))}n(null)}},{key:"_callback",value:function(e,t,n){e&&(this._resetTimeout(!this.peerChoking&&!this._finished),e.callback(t,n))}},{key:"_resetTimeout",value:function(e){var t=this;if(!e||!this._timeoutMs||!this.requests.length)return clearTimeout(this._timeout),this._timeout=null,void(this._timeoutExpiresAt=null);var n=Date.now()+this._timeoutMs;if(this._timeout){if(n-this._timeoutExpiresAt<.05*this._timeoutMs)return;clearTimeout(this._timeout)}this._timeoutExpiresAt=n,this._timeout=setTimeout((function(){return t._onTimeout()}),this._timeoutMs),this._timeoutUnref&&this._timeout.unref&&this._timeout.unref()}},{key:"_parse",value:function(e,t){this._parserSize=e,this._parser=t}},{key:"_parseUntil",value:function(e,t){this._cryptoSyncPattern=e,this._waitMaxBytes=t}},{key:"_onMessageLength",value:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint32(0);t>0?this._parse(t,this._onMessage):(this._onKeepAlive(),this._parse(4,this._onMessageLength))}},{key:"_onMessage",value:function(e){this._parse(4,this._onMessageLength);var t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e[0]){case 0:return this._onChoke();case 1:return this._onUnchoke();case 2:return this._onInterested();case 3:return this._onUninterested();case 4:return this._onHave(t.getUint32(1));case 5:return this._onBitField(e.slice(1));case 6:return this._onRequest(t.getUint32(1),t.getUint32(5),t.getUint32(9));case 7:return this._onPiece(t.getUint32(1),t.getUint32(5),e.slice(9));case 8:return this._onCancel(t.getUint32(1),t.getUint32(5),t.getUint32(9));case 9:return this._onPort(t.getUint16(1));case 13:return this._onSuggest(t.getUint32(1));case 14:return this._onHaveAll();case 15:return this._onHaveNone();case 16:return this._onReject(t.getUint32(1),t.getUint32(5),t.getUint32(9));case 17:return this._onAllowedFast(t.getUint32(1));case 20:return this._onExtended(e[1],e.slice(2));default:return this._debug("got unknown message"),this.emit("unknownmessage",e)}}},{key:"_determineHandshakeType",value:function(){var e=this;this._parse(1,(function(t){var n=t[0];19===n?e._parse(n+48,e._onHandshakeBuffer):e._parsePe1(t)}))}},{key:"_parsePe1",value:function(e){var t=this;this._parse(95,(function(n){t._onPe1((0,_.zo)([e,n])),t._parsePe3()}))}},{key:"_parsePe2",value:function(){var e=this;this._parse(96,(function(t){for(e._onPe2(t);!e._setGenerators;);e._parsePe4()}))}},{key:"_parsePe3",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(){var t,n=this;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_.vp)((0,_._0)(this._utfToHex("req1")+this._sharedSecret));case 2:t=e.sent,this._parseUntil(t,512),this._parse(20,(function(e){for(n._onPe3(e);!n._setGenerators;);n._parsePe3Encrypted()}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_parsePe3Encrypted",value:function(){var e=this;this._parse(14,(function(t){var n=e._decryptHandshake(t.slice(0,8)),r=e._decryptHandshake(t.slice(8,12)),i=new DataView(e._decryptHandshake(t.slice(12,14)).buffer).getUint16(0);e._parse(i,(function(t){t=e._decryptHandshake(t),e._parse(2,(function(i){var o=new DataView(e._decryptHandshake(i).buffer).getUint16(0);e._parse(o,(function(i){i=e._decryptHandshake(i),e._onPe3Encrypted(n,r,t,i);var s=o?i[0]:null,a=o?i.slice(1,20):null;19===s&&"BitTorrent protocol"===(0,_.vV)(a)?e._onHandshakeBuffer(i.slice(1)):e._parseHandshake()}))}))}))}))}},{key:"_parsePe4",value:function(){var e=this,t=this._decryptHandshake(O);this._parseUntil(t,512),this._parse(6,(function(t){var n=e._decryptHandshake(t.slice(0,4)),r=new DataView(e._decryptHandshake(t.slice(4,6)).buffer).getUint16(0);e._parse(r,(function(t){e._decryptHandshake(t),e._onPe4(n),e._parseHandshake(null)}))}))}},{key:"_parseHandshake",value:function(){var e=this;this._parse(1,(function(t){var n=t[0];if(19!==n)return e._debug("Error: wire not speaking BitTorrent protocol (%s)",n.toString()),void e.end();e._parse(n+48,e._onHandshakeBuffer)}))}},{key:"_onHandshakeBuffer",value:function(e){var t=e.slice(0,19);if("BitTorrent protocol"!==(0,_.vV)(t))return this._debug("Error: wire not speaking BitTorrent protocol (%s)",(0,_.vV)(t)),void this.end();e=e.slice(19),this._onHandshake(e.slice(8,28),e.slice(28,48),{dht:!!(1&e[7]),fast:!!(4&e[7]),extended:!!(16&e[5])}),this._parse(4,this._onMessageLength)}},{key:"_onFinish",value:function(){for(this._finished=!0,this.push(null);this.read(););for(clearInterval(this._keepAliveInterval),this._parse(Number.MAX_VALUE,(function(){}));this.peerRequests.length;)this.peerRequests.pop();for(;this.requests.length;)this._callback(this.requests.pop(),new Error("wire was closed"),null)}},{key:"_debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t[0]="[".concat(this._debugId,"] ").concat(t[0]),k.apply(void 0,t)}},{key:"_pull",value:function(e,t,n,r){for(var i=0;i<e.length;i++){var o=e[i];if(o.piece===t&&o.offset===n&&o.length===r)return w(e,i),o}return null}},{key:"_encryptHandshake",value:function(e){var t=new Uint8Array(e);if(!this._encryptGenerator)return this._debug("Warning: Encrypting without any generator"),t;for(var n=0;n<e.length;n++){var r=this._encryptGenerator.randomByte();t[n]=t[n]^r}return t}},{key:"_encrypt",value:function(e){var t=new Uint8Array(e);if(!this._encryptGenerator||2!==this._encryptionMethod)return t;for(var n=0;n<e.length;n++){var r=this._encryptGenerator.randomByte();t[n]=t[n]^r}return t}},{key:"_decryptHandshake",value:function(e){var t=new Uint8Array(e);if(!this._decryptGenerator)return this._debug("Warning: Decrypting without any generator"),t;for(var n=0;n<e.length;n++){var r=this._decryptGenerator.randomByte();t[n]=t[n]^r}return t}},{key:"_decrypt",value:function(e){var t=new Uint8Array(e);if(!this._decryptGenerator||2!==this._encryptionMethod)return t;for(var n=0;n<e.length;n++){var r=this._decryptGenerator.randomByte();t[n]=t[n]^r}return t}},{key:"_utfToHex",value:function(e){return(0,_.oc)((0,_.gR)(e))}}]),n}(v.Duplex),D=U},5194:function(e,t,n){n.d(t,{te:function(){return w},oc:function(){return a},vV:function(){return y},Ff:function(){return k},zo:function(){return h},Dg:function(){return l},vp:function(){return C},_0:function(){return c},gR:function(){return b}});for(var r="0123456789abcdef",i=[],o=[],s=0;s<256;s++)i[s]=r[s>>4&15]+r[15&s],s<16&&(s<10?o[48+s]=s:o[87+s]=s);for(var a=function(e){for(var t=e.length,n="",r=0;r<t;)n+=i[e[r++]];return n},c=function(e){for(var t=e.length>>1,n=t<<1,r=new Uint8Array(t),i=0,s=0;s<n;)r[i++]=o[e.charCodeAt(s++)]<<4|o[e.charCodeAt(s++)];return r},h=function(e,t){if(!t){t=0;for(var n=e.length||e.byteLength||0;n--;)t+=e[n].length}var r,i=new Uint8Array(t),o=0,s=(0,f.Z)(e);try{for(s.s();!(r=s.n()).done;){var a=r.value;i.set(a,o),o+=a.byteLength||a.length}}catch(u){s.e(u)}finally{s.f()}return i},l=function(e,t){if(e.byteLength!==t.byteLength)return!1;for(var n=e.length;n>-1;n-=1)if(e[n]!==t[n])return!1;return!0},d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p="undefined"==typeof Uint8Array?[]:new Uint8Array(256),v=0;v<d.length;v++)p[d.charCodeAt(v)]=v;var g=new TextDecoder,y=function(e,t){return t?new TextDecoder(t).decode(e):g.decode(e)},_=new TextEncoder,b=function(e){return _.encode(e)},w=function(e){return function(e){var t,n=new Uint8Array(e),r=n.length,i="";for(t=0;t<r;t+=3)i+=d[n[t]>>2],i+=d[(3&n[t])<<4|n[t+1]>>4],i+=d[(15&n[t+1])<<2|n[t+2]>>6],i+=d[63&n[t+2]];return r%3==2?i=i.substring(0,i.length-1)+"=":r%3==1&&(i=i.substring(0,i.length-2)+"=="),i}(e)},k=function(e){for(var t,n="",i=0,o=e.length;i<o;)t=e.charCodeAt(i++),n+=r[t>>4],n+=r[15&t];return n},x="undefined"!=typeof window?window:self,E=x.crypto||x.msCrypto||{},S=E.subtle||E.webkitSubtle,T={hex:a,base64:w},C=function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t,n){var r,i,o=arguments;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>2&&void 0!==o[2]?o[2]:"sha-1",S){e.next=3;break}throw new Error("no web crypto support");case 3:return"string"==typeof t&&(t=b(t)),e.t0=Uint8Array,e.next=7,S.digest(r,t);case 7:return e.t1=e.sent,i=new e.t0(e.t1),e.abrupt("return",n?T[n](i):i);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},8768:function(e,t,n){n.r(t),n.d(t,{addListener:function(){return f},argv:function(){return a},binding:function(){return E},browser:function(){return o},chdir:function(){return S},cwd:function(){return k},emit:function(){return y},env:function(){return s},listeners:function(){return w},nextTick:function(){return b},off:function(){return p},on:function(){return l},once:function(){return d},prependListener:function(){return m},prependOnceListener:function(){return _},removeAllListeners:function(){return g},removeListener:function(){return v},title:function(){return i},umask:function(){return x},version:function(){return u},versions:function(){return c}});var r=n(4375),i="browser",o=!0,s={},a=[],u="",c={};function h(){}var l=h,f=h,d=h,p=h,v=h,g=h,y=h,m=h,_=h,b=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return r((function(){return e.apply(void 0,n)}))},w=function(e){return[]},k=function(){return"/"},x=function(){return 0},E=function(e){throw new Error("process.binding is not supported")},S=function(e){throw new Error("process.chdir is not supported")}}},R={};function P(e){var t=R[e];if(void 0!==t)return t.exports;var n=R[e]={exports:{}};return A[e](n,n.exports,P),n.exports}C=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},P.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var n=Object.create(null);P.r(n);var r={};T=T||[null,C({}),C([]),C(C)];for(var i=2&t&&e;"object"==typeof i&&!~T.indexOf(i);i=C(i))Object.getOwnPropertyNames(i).forEach((function(t){return r[t]=function(){return e[t]}}));return r.default=function(){return e},P.d(n,r),n},P.d=function(e,t){for(var n in t)P.o(t,n)&&!P.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},P.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},P.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var I={};!function(){var e,t,n,b;P.d(I,{Z:function(){return $t}});var k=P(7187),S=P(6470),T=P(7485),C=P(502),A=P(2090),R=P(3786),L=P(970),O=P(1351),Z=P(8225),B=P(4595),M=P(4375),N=P(5194),j=(P(3811),P(2911)),U=[["udp://tracker.leechers-paradise.org:6969"],["udp://tracker.coppersurfer.tk:6969"],["udp://tracker.opentrackr.org:1337"],["udp://explodie.org:6969"],["udp://tracker.empire-js.us:1337"],["wss://tracker.btorrent.xyz"],["wss://tracker.openwebtorrent.com"]],D=Symbol("itemPath");function H(e,t,n){if("undefined"!=typeof FileList&&e instanceof FileList&&(e=Array.from(e)),Array.isArray(e)||(e=[e]),0===e.length)throw new Error("invalid input type");e.forEach((function(e){if(null==e)throw new Error("invalid input type: ".concat(e))})),1!==(e=e.map((function(e){return q(e)&&"string"==typeof e.path&&"function"==typeof j?e.path:e}))).length||"string"==typeof e[0]||e[0].name||(e[0].name=t.name);var r=null;e.forEach((function(t,n){if("string"!=typeof t){var i=t.fullPath||t.name;i||(i="Unknown File ".concat(n+1),t.unknownName=!0),t[D]=i.split("/"),t[D][0]||t[D].shift(),t[D].length<2?r=null:0===n&&e.length>1?r=t[D][0]:t[D][0]!==r&&(r=null)}})),(void 0===t.filterJunkFiles||t.filterJunkFiles)&&(e=e.filter((function(e){return"string"==typeof e||!function(e){var t=e[e.length-1];return"."===t[0]&&O.is(t)}(e[D])}))),r&&e.forEach((function(e){var t=(ArrayBuffer.isView(e)||W(e))&&!e[D];"string"==typeof e||t||e[D].shift()})),!t.name&&r&&(t.name=r),t.name||e.some((function(e){return"string"==typeof e?(t.name=S.basename(e),!0):!e.unknownName&&(t.name=e[D][e[D].length-1],!0)})),t.name||(t.name="Unnamed Torrent ".concat(Date.now()));var i=e.reduce((function(e,t){return e+Number("string"==typeof t)}),0),o=1===e.length;if(1===e.length&&"string"==typeof e[0]){if("function"!=typeof j)throw new Error("filesystem paths do not work in the browser");L(e[0],(function(e,t){if(e)return n(e);o=t,s()}))}else M(s);function s(){B(e.map((function(e){return function(t){var n={};if(q(e))n.getStream=e.stream(),n.length=e.size;else if(ArrayBuffer.isView(e))n.getStream=[e],n.length=e.length;else{if(!W(e)){if("string"==typeof e){if("function"!=typeof j)throw new Error("filesystem paths do not work in the browser");return void j(e,i>1||o,t)}throw new Error("invalid input type")}n.getStream=function(){var e=x((0,m.Z)().mark((function e(t,n){var r,i,o,s,a,u;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!1,i=!1,e.prev=2,s=E(t);case 4:return e.next=6,w(s.next());case 6:if(!(r=!(a=e.sent).done)){e.next=14;break}return u=a.value,n.length+=u.length,e.next=11,u;case 11:r=!1,e.next=4;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(2),i=!0,o=e.t0;case 20:if(e.prev=20,e.prev=21,!r||null==s.return){e.next=25;break}return e.next=25,w(s.return());case 25:if(e.prev=25,!i){e.next=28;break}throw o;case 28:return e.finish(25);case 29:return e.finish(20);case 30:case"end":return e.stop()}}),e,null,[[2,16,20,30],[21,,25,29]])})));return function(t,n){return e.apply(this,arguments)}}()(e,n),n.length=0}n.path=e[D],t(null,n)}})),(function(e,t){if(e)return n(e);t=t.flat(),n(null,t,o)}))}}function F(e,t){return e+t.length}function q(e){return"undefined"!=typeof Blob&&e instanceof Blob}function W(e){return"object"==typeof e&&null!=e&&"function"==typeof e.pipe}var z=function(e,t,n){var r;"function"==typeof t&&(t=(r=[n,t])[0],n=r[1]),H(e,t=t?Object.assign({},t):{},(function(e,r,i){if(e)return n(e);t.singleFileTorrent=i,function(e,t,n){var r=t.announceList;r||("string"==typeof t.announce?r=[[t.announce]]:Array.isArray(t.announce)&&(r=t.announce.map((function(e){return[e]})))),r||(r=[]),globalThis.WEBTORRENT_ANNOUNCE&&("string"==typeof globalThis.WEBTORRENT_ANNOUNCE?r.push([[globalThis.WEBTORRENT_ANNOUNCE]]):Array.isArray(globalThis.WEBTORRENT_ANNOUNCE)&&(r=r.concat(globalThis.WEBTORRENT_ANNOUNCE.map((function(e){return[e]}))))),void 0===t.announce&&void 0===t.announceList&&(r=r.concat(U)),"string"==typeof t.urlList&&(t.urlList=[t.urlList]);var i={info:{name:t.name},"creation date":Math.ceil((Number(t.creationDate)||Date.now())/1e3),encoding:"UTF-8"};0!==r.length&&(i.announce=r[0][0],i["announce-list"]=r),void 0!==t.comment&&(i.comment=t.comment),void 0!==t.createdBy&&(i["created by"]=t.createdBy),void 0!==t.private&&(i.info.private=Number(t.private)),void 0!==t.info&&Object.assign(i.info,t.info),void 0!==t.sslCert&&(i.info["ssl-cert"]=t.sslCert),void 0!==t.urlList&&(i["url-list"]=t.urlList);var o=e.reduce(F,0),s=t.pieceLength||R(o);i.info["piece length"]=s,function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t,n,r,i,o){var s,a,u,c,h,l,f,d,p,v,g,y,_,b,w;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=[],a=0,u=0,c=t.map((function(e){return e.getStream})),h=i.onProgress,l=0,f=0,d=!1,p=A(Z(c),n,{zeroPadding:!1}),e.prev=5,v=!1,g=!1,e.prev=8,_=(0,m.Z)().mark((function e(){var t;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=w.value,e.next=3,new Promise((function(e){a+=t.length;var n=f;++f,++l<5&&e(),(0,N.vp)(t,"hex").then((function(i){s[n]=i,--l,u+=t.length,h&&h(u,r),e(),d&&0===l&&o(null,(0,N._0)(s.join("")),a)}))}));case 3:case"end":return e.stop()}}),e)})),b=E(p);case 11:return e.next=13,b.next();case 13:if(!(v=!(w=e.sent).done)){e.next=18;break}return e.delegateYield(_(),"t0",15);case 15:v=!1,e.next=11;break;case 18:e.next=24;break;case 20:e.prev=20,e.t1=e.catch(8),g=!0,y=e.t1;case 24:if(e.prev=24,e.prev=25,!v||null==b.return){e.next=29;break}return e.next=29,b.return();case 29:if(e.prev=29,!g){e.next=32;break}throw y;case 32:return e.finish(29);case 33:return e.finish(24);case 34:if(0!==l){e.next=36;break}return e.abrupt("return",o(null,(0,N._0)(s.join("")),a));case 36:d=!0,e.next=42;break;case 39:e.prev=39,e.t2=e.catch(5),o(e.t2);case 42:case"end":return e.stop()}}),e,null,[[5,39],[8,20,24,34],[25,,29,33]])})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()(e,s,o,t,(function(r,o,s){if(r)return n(r);i.info.pieces=o,e.forEach((function(e){delete e.getStream})),t.singleFileTorrent?i.info.length=s:i.info.files=e,n(null,C.Z.encode(i))}))}(r,t,n)}))},G=P(1227),V=P(3552),K=P(5843),Y=P(1982);self.Blob,self.File,self.FormData,self.Headers,self.Request,self.Response,self.AbortController,self.AbortSignal;var $=self.fetch||function(){throw new Error("global fetch is not available!")},J=P(5017);var X=function(e){var t,n={},r=e.split("magnet:?")[1];return(r&&r.length>=0?r.split("&"):[]).forEach((function(e){var t=e.split("=");if(2===t.length){var r=t[0],i=t[1];"dn"===r&&(i=decodeURIComponent(i).replace(/\+/g," ")),"tr"!==r&&"xs"!==r&&"as"!==r&&"ws"!==r||(i=decodeURIComponent(i)),"kt"===r&&(i=decodeURIComponent(i).split("+")),"ix"===r&&(i=Number(i)),"so"===r&&(i=function(e){return e.reduce((function(e,t,n,r){var i=t.split("-").map((function(e){return parseInt(e)}));return e.concat(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return Array.from({length:t-e+1},(function(t,n){return n+e}))}.apply(void 0,(0,l.Z)(i)))}),[])}(decodeURIComponent(i).split(","))),n[r]?(Array.isArray(n[r])||(n[r]=[n[r]]),n[r].push(i)):n[r]=i}})),n.xt&&(Array.isArray(n.xt)?n.xt:[n.xt]).forEach((function(e){if(t=e.match(/^urn:btih:(.{40})/))n.infoHash=t[1].toLowerCase();else if(t=e.match(/^urn:btih:(.{32})/)){var r=J.decode(t[1]);n.infoHash=(0,N.Ff)(r)}else(t=e.match(/^urn:btmh:1220(.{64})/))&&(n.infoHashV2=t[1].toLowerCase())})),n.xs&&(Array.isArray(n.xs)?n.xs:[n.xs]).forEach((function(e){(t=e.match(/^urn:btpk:(.{64})/))&&(n.publicKey=t[1].toLowerCase())})),n.infoHash&&(n.infoHashBuffer=(0,N._0)(n.infoHash)),n.infoHashV2&&(n.infoHashV2Buffer=(0,N._0)(n.infoHashV2)),n.publicKey&&(n.publicKeyBuffer=(0,N._0)(n.publicKey)),n.dn&&(n.name=n.dn),n.kt&&(n.keywords=n.kt),n.announce=[],("string"==typeof n.tr||Array.isArray(n.tr))&&(n.announce=n.announce.concat(n.tr)),n.urlList=[],("string"==typeof n.as||Array.isArray(n.as))&&(n.urlList=n.urlList.concat(n.as)),("string"==typeof n.ws||Array.isArray(n.ws))&&(n.urlList=n.urlList.concat(n.ws)),n.peerAddresses=[],("string"==typeof n["x.pe"]||Array.isArray(n["x.pe"]))&&(n.peerAddresses=n.peerAddresses.concat(n["x.pe"])),n.announce=Array.from(new Set(n.announce)),n.urlList=Array.from(new Set(n.urlList)),n.peerAddresses=Array.from(new Set(n.peerAddresses)),n};function Q(e){return ee.apply(this,arguments)}function ee(){return ee=(0,u.Z)((0,m.Z)().mark((function e(t){var n;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t||!/^(stream-)?magnet:/.test(t)){e.next=5;break}if((n=X(t)).infoHash){e.next=4;break}throw new Error("Invalid torrent identifier");case 4:return e.abrupt("return",n);case 5:if("string"!=typeof t||!/^[a-f0-9]{40}$/i.test(t)&&!/^[a-z2-7]{32}$/i.test(t)){e.next=7;break}return e.abrupt("return",X("magnet:?xt=urn:btih:".concat(t)));case 7:if(!ArrayBuffer.isView(t)||20!==t.length){e.next=9;break}return e.abrupt("return",X("magnet:?xt=urn:btih:".concat((0,N.oc)(t))));case 9:if(!ArrayBuffer.isView(t)){e.next=13;break}return e.next=12,function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var n,r,i;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ArrayBuffer.isView(t)&&(t=C.Z.decode(t)),ie(t.info,"info"),ie(t.info["name.utf-8"]||t.info.name,"info.name"),ie(t.info["piece length"],"info['piece length']"),ie(t.info.pieces,"info.pieces"),t.info.files?t.info.files.forEach((function(e){ie("number"==typeof e.length,"info.files[0].length"),ie(e["path.utf-8"]||e.path,"info.files[0].path")})):ie("number"==typeof t.info.length,"info.length"),n={info:t.info,infoBuffer:C.Z.encode(t.info),name:(0,N.vV)(t.info["name.utf-8"]||t.info.name),announce:[]},e.next=5,(0,N.vp)(n.infoBuffer);case 5:return n.infoHashBuffer=e.sent,n.infoHash=(0,N.oc)(n.infoHashBuffer),void 0!==t.info.private&&(n.private=!!t.info.private),t["creation date"]&&(n.created=new Date(1e3*t["creation date"])),t["created by"]&&(n.createdBy=(0,N.vV)(t["created by"])),ArrayBuffer.isView(t.comment)&&(n.comment=(0,N.vV)(t.comment)),Array.isArray(t["announce-list"])&&t["announce-list"].length>0?t["announce-list"].forEach((function(e){e.forEach((function(e){n.announce.push((0,N.vV)(e))}))})):t.announce&&n.announce.push((0,N.vV)(t.announce)),ArrayBuffer.isView(t["url-list"])&&(t["url-list"]=t["url-list"].length>0?[t["url-list"]]:[]),n.urlList=(t["url-list"]||[]).map((function(e){return(0,N.vV)(e)})),n.announce=Array.from(new Set(n.announce)),n.urlList=Array.from(new Set(n.urlList)),r=t.info.files||[t.info],n.files=r.map((function(e,t){var i=[].concat(n.name,e["path.utf-8"]||e.path||[]).map((function(e){return ArrayBuffer.isView(e)?(0,N.vV)(e):e}));return{path:S.join.apply(null,[S.sep].concat(i)).slice(1),name:i[i.length-1],length:e.length,offset:r.slice(0,t).reduce(re,0)}})),n.length=r.reduce(re,0),i=n.files[n.files.length-1],e.abrupt("return",(n.pieceLength=t.info["piece length"],n.lastPieceLength=(i.offset+i.length)%n.pieceLength||n.pieceLength,n.pieces=function(e){for(var t=[],n=0;n<e.length;n+=20)t.push((0,N.oc)(e.slice(n,n+20)));return t}(t.info.pieces),n));case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(t);case 12:return e.abrupt("return",e.sent);case 13:if(!t||!t.infoHash){e.next=15;break}return e.abrupt("return",(t.infoHash=t.infoHash.toLowerCase(),t.announce||(t.announce=[]),"string"==typeof t.announce&&(t.announce=[t.announce]),t.urlList||(t.urlList=[]),t));case 15:throw new Error("Invalid torrent identifier");case 16:case"end":return e.stop()}}),e)}))),ee.apply(this,arguments)}function te(e,t,n){return ne.apply(this,arguments)}function ne(){return ne=(0,u.Z)((0,m.Z)().mark((function e(t,n,r){var i,o,s,c,h;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h=function(){return h=(0,u.Z)((0,m.Z)().mark((function e(t){return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Q(t);case 3:i=e.sent,e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",r(e.t0));case 9:i&&i.infoHash?r(null,i):r(new Error("Invalid torrent identifier"));case 10:case"end":return e.stop()}}),e,null,[[0,6]])}))),h.apply(this,arguments)},c=function(e){return h.apply(this,arguments)},"function"!=typeof n){e.next=4;break}return e.abrupt("return",te(t,{},n));case 4:if("function"==typeof r){e.next=6;break}throw new Error("second argument must be a Function");case 6:return e.prev=6,e.next=9,Q(t);case 9:i=e.sent,e.next=14;break;case 12:e.prev=12,e.t0=e.catch(6);case 14:if(!i||!i.infoHash){e.next=18;break}M((function(){r(null,i)})),e.next=54;break;case 18:if(s=t,!("undefined"!=typeof Blob&&s instanceof Blob)){e.next=34;break}return e.prev=19,e.t1=c,e.t2=Uint8Array,e.next=24,t.arrayBuffer();case 24:e.t3=e.sent,e.t4=new e.t2(e.t3),(0,e.t1)(e.t4),e.next=32;break;case 29:return e.prev=29,e.t5=e.catch(19),e.abrupt("return",r(new Error("Error converting Blob: ".concat(e.t5.message))));case 32:e.next=54;break;case 34:if(!/^https?:/.test(t)){e.next=53;break}return e.prev=35,e.next=38,$(t,(0,a.Z)({headers:{"user-agent":"WebTorrent (https://webtorrent.io)"},signal:AbortSignal.timeout(3e4)},n));case 38:return o=e.sent,e.t6=c,e.t7=Uint8Array,e.next=43,o.arrayBuffer();case 43:e.t8=e.sent,e.t9=new e.t7(e.t8),(0,e.t6)(e.t9),e.next=51;break;case 48:return e.prev=48,e.t10=e.catch(35),e.abrupt("return",r(new Error("Error downloading torrent: ".concat(e.t10.message))));case 51:e.next=54;break;case 53:"function"==typeof Y.readFile&&"string"==typeof t?Y.readFile(t,(function(e,t){if(e)return r(new Error("Invalid torrent identifier"));c(t)})):M((function(){r(new Error("Invalid torrent identifier"))}));case 54:case"end":return e.stop()}}),e,null,[[6,12],[19,29],[35,48]])}))),ne.apply(this,arguments)}function re(e,t){return e+t.length}function ie(e,t){if(!e)throw new Error("Torrent is missing required field: ".concat(t))}P(8764).Buffer.alloc(0);var oe=Q,se=P(8853),ae=P(1798),ue=P(1463),ce=P(558),he=P(8302),le=P(2203),fe=P(1494),de=P(5381),pe=/^\[?([^\]]+)]?:(\d+)$/,ve=new Map;function ge(e){if(1e5===ve.size&&ve.clear(),!ve.has(e)){var t=pe.exec(e);if(!t)throw new Error("invalid addr: ".concat(e));ve.set(e,[t[1],Number(t[2])])}return ve.get(e)}var ye=P(8205),me=P(9421);function _e(e){return be.apply(this,arguments)}function be(){return be=x((0,m.Z)().mark((function e(t){var n,r,i,o,s,a,u,c,h,l=arguments;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:{},null===t||void 0===t||!t[Symbol.asyncIterator]){e.next=4;break}return e.delegateYield(_(E(t[Symbol.asyncIterator](n.offset)),w),"t0",3);case 3:return e.abrupt("return",void e.t0);case 4:if(null!==t&&void 0!==t&&t.get){e.next=6;break}throw new Error("First argument must be an abstract-chunk-store compliant store");case 6:if(r=n.chunkLength||t.chunkLength){e.next=9;break}throw new Error("missing required `chunkLength` property");case 9:if(i=n.length||t.length,Number.isFinite(i)){e.next=12;break}throw new Error("missing required `length` property");case 12:if(o=n.offset||0,s=function(e,n,r){return new Promise((function(i,o){t.get(e,{offset:r,length:n},(function(e,t){e&&o(e),i(t)}))}))},a=Math.floor(o/r),u=o%r,!o){e.next=20;break}return c=Math.min(i,r-u),i-=c,e.next=20,s(a++,c,u);case 20:h=i;case 21:if(!(h>0)){e.next=27;break}return e.next=24,s(a,Math.min(h,r));case 24:++a,h-=r,e.next=21;break;case 27:case"end":return e.stop()}}),e)}))),be.apply(this,arguments)}function we(e,t){return ke.apply(this,arguments)}function ke(){return ke=(0,u.Z)((0,m.Z)().mark((function e(t,n){var r,i,o,s,a,u,c,h,l,f,d,p,v,g=arguments;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=g.length>2&&void 0!==g[2]?g[2]:{},null!==t&&void 0!==t&&t.put){e.next=3;break}throw new Error("First argument must be an abstract-chunk-store compliant store");case 3:if(i=r.chunkLength||t.chunkLength){e.next=6;break}throw new Error("missing required `chunkLength` property");case 6:o=r.storeMaxOutstandingPuts||16,s=0,a=0,u=function(){},c=!1,h=!1,l=!1,e.prev=10,d=(0,m.Z)().mark((function e(){var n;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.value,e.next=3,new Promise((function(e){s++<=o&&e(),t.put(a++,n,(function(t){if(t)throw t;--s,e(),c&&0===s&&u()}))}));case 3:case"end":return e.stop()}}),e)})),p=E(A(n,i,{zeroPadding:r.zeroPadding||!1}));case 13:return e.next=15,p.next();case 15:if(!(h=!(v=e.sent).done)){e.next=20;break}return e.delegateYield(d(),"t0",17);case 17:h=!1,e.next=13;break;case 20:e.next=26;break;case 22:e.prev=22,e.t1=e.catch(10),l=!0,f=e.t1;case 26:if(e.prev=26,e.prev=27,!h||null==p.return){e.next=31;break}return e.next=31,p.return();case 31:if(e.prev=31,!l){e.next=34;break}throw f;case 34:return e.finish(31);case 35:return e.finish(26);case 36:if(e.t2=0!==s,!e.t2){e.next=41;break}return c=new Promise((function(e){u=e})),e.next=41,c;case 41:case"end":return e.stop()}}),e,null,[[10,22,26,36],[27,,31,35]])}))),ke.apply(this,arguments)}var xe=P(9648),Ee=P(1018),Se=P(778),Te=P(8411),Ce=P.t(Te,2),Ae=P(8764).Buffer,Re=(0,a.Z)({DEFAULT_ANNOUNCE_PEERS:50,MAX_ANNOUNCE_PEERS:82,binaryToHex:function(e){return"string"!=typeof e&&(e=String(e)),Ae.from(e,"binary").toString("hex")},hexToBinary:function(e){return"string"!=typeof e&&(e=String(e)),Ae.from(e,"hex").toString("binary")},parseUrl:function(e){var t=new URL(e.replace(/^udp:/,"http:"));return e.match(/^udp:/)&&Object.defineProperties(t,{href:{value:t.href.replace(/^http/,"udp")},protocol:{value:t.protocol.replace(/^http/,"udp")},origin:{value:t.origin.replace(/^http/,"udp")}}),t}},Ce),Pe=P(1857),Ie=P(159),Le=P(6313),Oe=P(522),Ze=P(9354),Be=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this)).client=e,i.announceUrl=r,i.interval=null,i.destroyed=!1,i}return(0,p.Z)(n,[{key:"setInterval",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=this;null==e&&(e=this.DEFAULT_ANNOUNCE_INTERVAL),clearInterval(this.interval),e&&(this.interval=setInterval((function(){t.announce(t.client._defaultAnnounceOpts())}),e),this.interval.unref&&this.interval.unref())}))}]),n}(k),Me=G("bittorrent-tracker:websocket-tracker"),Ne={},je=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),i=t.call(this,e,r),Me("new websocket tracker %s",r),i.peers={},i.socket=null,i.reconnecting=!1,i.retries=0,i.reconnectTimer=null,i.expectingResponse=!1,i._openSocket(),i}return(0,p.Z)(n,[{key:"announce",value:function(e){var t=this;if(!this.destroyed&&!this.reconnecting)if(this.socket.connected){var n=Object.assign({},e,{action:"announce",info_hash:this.client._infoHashBinary,peer_id:this.client._peerIdBinary});if(this._trackerId&&(n.trackerid=this._trackerId),"stopped"===e.event||"completed"===e.event)this._send(n);else{var r=Math.min(e.numwant,5);this._generateOffers(r,(function(e){n.numwant=r,n.offers=e,t._send(n)}))}}else this.socket.once("connect",(function(){t.announce(e)}))}},{key:"scrape",value:function(e){var t=this;if(!this.destroyed&&!this.reconnecting)if(this.socket.connected){var n={action:"scrape",info_hash:Array.isArray(e.infoHash)&&e.infoHash.length>0?e.infoHash.map((function(e){return e.toString("binary")})):e.infoHash&&e.infoHash.toString("binary")||this.client._infoHashBinary};this._send(n)}else this.socket.once("connect",(function(){t.scrape(e)}))}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ue;if(this.destroyed)return e(null);for(var t in this.destroyed=!0,clearInterval(this.interval),clearTimeout(this.reconnectTimer),this.peers){var n=this.peers[t];clearTimeout(n.trackerTimeout),n.destroy()}if(this.peers=null,this.socket&&(this.socket.removeListener("connect",this._onSocketConnectBound),this.socket.removeListener("data",this._onSocketDataBound),this.socket.removeListener("close",this._onSocketCloseBound),this.socket.removeListener("error",this._onSocketErrorBound),this.socket=null),this._onSocketConnectBound=null,this._onSocketErrorBound=null,this._onSocketDataBound=null,this._onSocketCloseBound=null,Ne[this.announceUrl]&&(Ne[this.announceUrl].consumers-=1),Ne[this.announceUrl].consumers>0)return e();var r,i=Ne[this.announceUrl];if(delete Ne[this.announceUrl],i.on("error",Ue),i.once("close",e),!this.expectingResponse)return o();function o(){r&&(clearTimeout(r),r=null),i.removeListener("data",o),i.destroy(),i=null}r=setTimeout(o,Re.DESTROY_TIMEOUT),i.once("data",o)}},{key:"_openSocket",value:function(){var e=this;if(this.destroyed=!1,this.peers||(this.peers={}),this._onSocketConnectBound=function(){e._onSocketConnect()},this._onSocketErrorBound=function(t){e._onSocketError(t)},this._onSocketDataBound=function(t){e._onSocketData(t)},this._onSocketCloseBound=function(){e._onSocketClose()},this.socket=Ne[this.announceUrl],this.socket)Ne[this.announceUrl].consumers+=1,this.socket.connected&&this._onSocketConnectBound();else{var t,n=new URL(this.announceUrl);this.client._proxyOpts&&(!(t="wss:"===n.protocol?this.client._proxyOpts.httpsAgent:this.client._proxyOpts.httpAgent)&&this.client._proxyOpts.socksProxy&&(t=new Ze.Agent(Le(this.client._proxyOpts.socksProxy),"wss:"===n.protocol))),this.socket=Ne[this.announceUrl]=new Oe({url:this.announceUrl,agent:t}),this.socket.consumers=1,this.socket.once("connect",this._onSocketConnectBound)}this.socket.on("data",this._onSocketDataBound),this.socket.once("close",this._onSocketCloseBound),this.socket.once("error",this._onSocketErrorBound)}},{key:"_onSocketConnect",value:function(){this.destroyed||this.reconnecting&&(this.reconnecting=!1,this.retries=0,this.announce(this.client._defaultAnnounceOpts()))}},{key:"_onSocketData",value:function(e){if(!this.destroyed){this.expectingResponse=!1;try{e=JSON.parse(e)}catch(e){return void this.client.emit("warning",new Error("Invalid tracker response"))}"announce"===e.action?this._onAnnounceResponse(e):"scrape"===e.action?this._onScrapeResponse(e):this._onSocketError(new Error("invalid action in WS response: ".concat(e.action)))}}},{key:"_onAnnounceResponse",value:function(e){var t=this;if(e.info_hash===this.client._infoHashBinary){if(!e.peer_id||e.peer_id!==this.client._peerIdBinary){Me("received %s from %s for %s",JSON.stringify(e),this.announceUrl,this.client.infoHash);var n=e["failure reason"];if(n)return this.client.emit("warning",new Error(n));var r=e["warning message"];r&&this.client.emit("warning",new Error(r));var i=e.interval||e["min interval"];i&&this.setInterval(1e3*i);var o,s=e["tracker id"];if(s&&(this._trackerId=s),null!=e.complete){var a=Object.assign({},e,{announce:this.announceUrl,infoHash:Re.binaryToHex(e.info_hash)});this.client.emit("update",a)}if(e.offer&&e.peer_id&&(Me("creating peer (from remote offer)"),(o=this._createPeer()).id=Re.binaryToHex(e.peer_id),o.once("signal",(function(n){var r={action:"announce",info_hash:t.client._infoHashBinary,peer_id:t.client._peerIdBinary,to_peer_id:e.peer_id,answer:n,offer_id:e.offer_id};t._trackerId&&(r.trackerid=t._trackerId),t._send(r)})),this.client.emit("peer",o),o.signal(e.offer)),e.answer&&e.peer_id){var u=Re.binaryToHex(e.offer_id);(o=this.peers[u])?(o.id=Re.binaryToHex(e.peer_id),this.client.emit("peer",o),o.signal(e.answer),clearTimeout(o.trackerTimeout),o.trackerTimeout=null,delete this.peers[u]):Me("got unexpected answer: ".concat(JSON.stringify(e.answer)))}}}else Me("ignoring websocket data from %s for %s (looking for %s: reused socket)",this.announceUrl,Re.binaryToHex(e.info_hash),this.client.infoHash)}},{key:"_onScrapeResponse",value:function(e){var t=this;e=e.files||{};var n=Object.keys(e);0!==n.length?n.forEach((function(n){var r=Object.assign(e[n],{announce:t.announceUrl,infoHash:Re.binaryToHex(n)});t.client.emit("scrape",r)})):this.client.emit("warning",new Error("invalid scrape response"))}},{key:"_onSocketClose",value:function(){this.destroyed||(this.destroy(),this._startReconnectTimer())}},{key:"_onSocketError",value:function(e){this.destroyed||(this.destroy(),this.client.emit("warning",e),this._startReconnectTimer())}},{key:"_startReconnectTimer",value:function(){var e=this,t=Math.floor(3e5*Math.random())+Math.min(1e4*Math.pow(2,this.retries),36e5);this.reconnecting=!0,clearTimeout(this.reconnectTimer),this.reconnectTimer=setTimeout((function(){e.retries++,e._openSocket()}),t),this.reconnectTimer.unref&&this.reconnectTimer.unref(),Me("reconnecting socket in %s ms",t)}},{key:"_send",value:function(e){if(!this.destroyed){this.expectingResponse=!0;var t=JSON.stringify(e);Me("send %s",t),this.socket.send(t)}}},{key:"_generateOffers",value:function(e,t){var n=this,r=[];Me("generating %s offers",e);for(var i=0;i<e;++i)o();function o(){var e=ae(20).toString("hex");Me("creating peer (from _generateOffers)");var t=n.peers[e]=n._createPeer({initiator:!0});t.once("signal",(function(t){r.push({offer:t,offer_id:Re.hexToBinary(e)}),s()})),t.trackerTimeout=setTimeout((function(){Me("tracker timeout: destroying peer"),t.trackerTimeout=null,delete n.peers[e],t.destroy()}),5e4),t.trackerTimeout.unref&&t.trackerTimeout.unref()}function s(){r.length===e&&(Me("generated %s offers",e),t(r))}s()}},{key:"_createPeer",value:function(e){var t=this;e=Object.assign({trickle:!1,config:t.client._rtcConfig,wrtc:t.client._wrtc},e);var n=new se(e);return n.once("error",r),n.once("connect",(function e(){n.removeListener("error",r),n.removeListener("connect",e)})),n;function r(e){t.client.emit("warning",new Error("Connection error: ".concat(e.message))),n.destroy()}}}]),n}(Be);function Ue(){}je.prototype.DEFAULT_ANNOUNCE_INTERVAL=3e4,je._socketPool=Ne;var De=je,He=P(8768),Fe=P(8764).Buffer,qe=G("bittorrent-tracker:client"),We=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,d.Z)(this,n),e=t.call(this),!r.peerId)throw new Error("Option `peerId` is required");if(!r.infoHash)throw new Error("Option `infoHash` is required");if(!r.announce)throw new Error("Option `announce` is required");if(!He.browser&&!r.port)throw new Error("Option `port` is required");e.peerId="string"==typeof r.peerId?r.peerId:r.peerId.toString("hex"),e._peerIdBuffer=Fe.from(e.peerId,"hex"),e._peerIdBinary=e._peerIdBuffer.toString("binary"),e.infoHash="string"==typeof r.infoHash?r.infoHash.toLowerCase():r.infoHash.toString("hex"),e._infoHashBuffer=Fe.from(e.infoHash,"hex"),e._infoHashBinary=e._infoHashBuffer.toString("binary"),qe("new client %s",e.infoHash),e.destroyed=!1,e._port=r.port,e._getAnnounceOpts=r.getAnnounceOpts,e._rtcConfig=r.rtcConfig,e._userAgent=r.userAgent,e._proxyOpts=r.proxyOpts,e._wrtc="function"==typeof r.wrtc?r.wrtc():r.wrtc;var i="string"==typeof r.announce?[r.announce]:null==r.announce?[]:r.announce;i=i.map((function(e){return"/"===(e=e.toString())[e.length-1]&&(e=e.substring(0,e.length-1)),e})),i=Array.from(new Set(i));var o=!1!==e._wrtc&&(!!e._wrtc||se.WEBRTC_SUPPORT),s=function(t){M((function(){e.emit("warning",t)}))};return e._trackers=i.map((function(t){var n;try{n=Re.parseUrl(t)}catch(n){return s(new Error("Invalid tracker URL: ".concat(t))),null}var r=n.port;if(r<0||r>65535)return s(new Error("Invalid tracker port: ".concat(t))),null;var i=n.protocol;return"http:"!==i&&"https:"!==i||"function"!=typeof Pe?"udp:"===i&&"function"==typeof Ie?new Ie((0,v.Z)(e),t):"ws:"!==i&&"wss:"!==i||!o||"ws:"===i&&"undefined"!=typeof window&&"https:"===window.location.protocol?(s(new Error("Unsupported tracker protocol: ".concat(t))),null):new De((0,v.Z)(e),t):new Pe((0,v.Z)(e),t)})).filter(Boolean),(0,c.Z)(e)}return(0,p.Z)(n,[{key:"start",value:function(e){(e=this._defaultAnnounceOpts(e)).event="started",qe("send `start` %o",e),this._announce(e),this._trackers.forEach((function(e){e.setInterval()}))}},{key:"stop",value:function(e){(e=this._defaultAnnounceOpts(e)).event="stopped",qe("send `stop` %o",e),this._announce(e)}},{key:"complete",value:function(e){e||(e={}),(e=this._defaultAnnounceOpts(e)).event="completed",qe("send `complete` %o",e),this._announce(e)}},{key:"update",value:function(e){(e=this._defaultAnnounceOpts(e)).event&&delete e.event,qe("send `update` %o",e),this._announce(e)}},{key:"_announce",value:function(e){this._trackers.forEach((function(t){t.announce(e)}))}},{key:"scrape",value:function(e){qe("send `scrape`"),e||(e={}),this._trackers.forEach((function(t){t.scrape(e)}))}},{key:"setInterval",value:function(e){qe("setInterval %d",e),this._trackers.forEach((function(t){t.setInterval(e)}))}},{key:"destroy",value:function(e){if(!this.destroyed){this.destroyed=!0,qe("destroy");var t=this._trackers.map((function(e){return function(t){e.destroy(t)}}));B(t,e),this._trackers=[],this._getAnnounceOpts=null}}},{key:"_defaultAnnounceOpts",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return null==e.numwant&&(e.numwant=Re.DEFAULT_ANNOUNCE_PEERS),null==e.uploaded&&(e.uploaded=0),null==e.downloaded&&(e.downloaded=0),this._getAnnounceOpts&&(e=Object.assign({},e,this._getAnnounceOpts())),e}}]),n}(k);We.scrape=function(e,t){if(t=Se(t),!e.infoHash)throw new Error("Option `infoHash` is required");if(!e.announce)throw new Error("Option `announce` is required");var n=Object.assign({},e,{infoHash:Array.isArray(e.infoHash)?e.infoHash[0]:e.infoHash,peerId:Fe.from("01234567890123456789"),port:6881}),r=new We(n);r.once("error",t),r.once("warning",t);var i=Array.isArray(e.infoHash)?e.infoHash.length:1,o={};return r.on("scrape",(function(e){if(i-=1,o[e.infoHash]=e,0===i){r.destroy();var n=Object.keys(o);1===n.length?t(null,o[n[0]]):t(null,o)}})),e.infoHash=Array.isArray(e.infoHash)?e.infoHash.map((function(e){return Fe.from(e,"hex")})):Fe.from(e.infoHash,"hex"),r.scrape({infoHash:e.infoHash}),r};var ze=We;P(859);var Ge=P(2067),Ve=P(8768),Ke=G("torrent-discovery"),Ye=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;if((0,d.Z)(this,n),r=t.call(this),!e.peerId)throw new Error("Option `peerId` is required");if(!e.infoHash)throw new Error("Option `infoHash` is required");if(!Ve.browser&&!e.port)throw new Error("Option `port` is required");r.peerId="string"==typeof e.peerId?e.peerId:e.peerId.toString("hex"),r.infoHash="string"==typeof e.infoHash?e.infoHash.toLowerCase():e.infoHash.toString("hex"),r._port=e.port,r._userAgent=e.userAgent,r.destroyed=!1,r._announce=e.announce||[],r._intervalMs=e.intervalMs||9e5,r._trackerOpts=null,r._dhtAnnouncing=!1,r._dhtTimeout=!1,r._internalDHT=!1,r._onWarning=function(e){r.emit("warning",e)},r._onError=function(e){r.emit("error",e)},r._onDHTPeer=function(e,t){t.toString("hex")===r.infoHash&&r.emit("peer","".concat(e.host,":").concat(e.port),"dht")},r._onTrackerPeer=function(e){r.emit("peer",e,"tracker")},r._onTrackerAnnounce=function(){r.emit("trackerAnnounce")},r._onLSDPeer=function(e,t){r.emit("peer",e,"lsd")};var i=function(e,t){var n=new Ee.Client(t);return n.on("warning",r._onWarning),n.on("error",r._onError),n.listen(e),r._internalDHT=!0,n};return!1===e.tracker?r.tracker=null:e.tracker&&"object"==typeof e.tracker?(r._trackerOpts=Object.assign({},e.tracker),r.tracker=r._createTracker()):r.tracker=r._createTracker(),!1===e.dht||"function"!=typeof Ee.Client?r.dht=null:e.dht&&"function"==typeof e.dht.addNode?r.dht=e.dht:e.dht&&"object"==typeof e.dht?r.dht=i(e.dhtPort,e.dht):r.dht=i(e.dhtPort),r.dht&&(r.dht.on("peer",r._onDHTPeer),r._dhtAnnounce()),!1===e.lsd||"function"!=typeof Ge?r.lsd=null:r.lsd=r._createLSD(),(0,c.Z)(r)}return(0,p.Z)(n,[{key:"updatePort",value:function(e){var t=this;e!==this._port&&(this._port=e,this.dht&&this._dhtAnnounce(),this.tracker&&(this.tracker.stop(),this.tracker.destroy((function(){t.tracker=t._createTracker()}))))}},{key:"complete",value:function(e){this.tracker&&this.tracker.complete(e)}},{key:"destroy",value:function(e){var t=this;if(!this.destroyed){this.destroyed=!0,clearTimeout(this._dhtTimeout);var n=[];this.tracker&&(this.tracker.stop(),this.tracker.removeListener("warning",this._onWarning),this.tracker.removeListener("error",this._onError),this.tracker.removeListener("peer",this._onTrackerPeer),this.tracker.removeListener("update",this._onTrackerAnnounce),n.push((function(e){t.tracker.destroy(e)}))),this.dht&&this.dht.removeListener("peer",this._onDHTPeer),this._internalDHT&&(this.dht.removeListener("warning",this._onWarning),this.dht.removeListener("error",this._onError),n.push((function(e){t.dht.destroy(e)}))),this.lsd&&(this.lsd.removeListener("warning",this._onWarning),this.lsd.removeListener("error",this._onError),this.lsd.removeListener("peer",this._onLSDPeer),n.push((function(e){t.lsd.destroy(e)}))),B(n,e),this.dht=null,this.tracker=null,this.lsd=null,this._announce=null}}},{key:"_createTracker",value:function(){var e=Object.assign({},this._trackerOpts,{infoHash:this.infoHash,announce:this._announce,peerId:this.peerId,port:this._port,userAgent:this._userAgent}),t=new ze(e);return t.on("warning",this._onWarning),t.on("error",this._onError),t.on("peer",this._onTrackerPeer),t.on("update",this._onTrackerAnnounce),t.setInterval(this._intervalMs),t.start(),t}},{key:"_dhtAnnounce",value:function(){var e=this;this._dhtAnnouncing||(Ke("dht announce"),this._dhtAnnouncing=!0,clearTimeout(this._dhtTimeout),this.dht.announce(this.infoHash,this._port,(function(t){e._dhtAnnouncing=!1,Ke("dht announce complete"),t&&e.emit("warning",t),e.emit("dhtAnnounce"),e.destroyed||(e._dhtTimeout=setTimeout((function(){e._dhtAnnounce()}),e._intervalMs+Math.floor(Math.random()*e._intervalMs/5)),e._dhtTimeout.unref&&e._dhtTimeout.unref())})))}},{key:"_createLSD",value:function(){var e=Object.assign({},{infoHash:this.infoHash,peerId:this.peerId,port:this._port}),t=new Ge(e);return t.on("warning",this._onWarning),t.on("error",this._onError),t.on("peer",this._onLSDPeer),t.start(),t}}]),n}(k.EventEmitter),$e=Ye;"undefined"!=typeof navigator&&(null===(e=navigator.storage)||void 0===e?void 0:e.getDirectory)&&navigator.storage.getDirectory().then((function(e){e.removeEntry("chunks",{recursive:!0})}));var Je,Xe=function(){},Qe=function(){function e(t){var n,r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,d.Z)(this,e),this.chunkLength=Number(t),!this.chunkLength)throw new Error("First argument must be a chunk length");if("undefined"==typeof navigator||null===(n=navigator.storage)||void 0===n||!n.getDirectory)throw new Error("FSA API is not supported");if(this.closed=!1,this.name=i.name||crypto.randomUUID(),this.chunks=[],this.rootDirPromise=i.rootDir||navigator.storage.getDirectory(),this.storageDirPromise=(0,u.Z)((0,m.Z)().mark((function e(){return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.rootDirPromise;case 2:return e.abrupt("return",e.sent.getDirectoryHandle(r.name,{create:!0}));case 3:case"end":return e.stop()}}),e)})))(),this.chunksDirPromise=this.storageDirPromise,i.files&&i.rootDir){if(this.chunkMap=[],this.directoryMap={},this.chunksDirPromise=this._getChunksDirHandle(),this.files=i.files.map((function(e,t,n){if(null==e.path)throw new Error("File is missing `path` property");if(null==e.length)throw new Error("File is missing `length` property");if(null==e.offset)if(0===t)e.offset=0;else{var i=n[t-1];e.offset=i.offset+i.length}null==e.handle&&(e.handle=r._createFileHandle({path:e.path})),e.blob=r._createBlobReference(e.handle);for(var o=e.offset,s=e.offset+e.length,a=Math.floor(o/r.chunkLength),u=Math.floor((s-1)/r.chunkLength),c=a;c<=u;++c){var h=c*r.chunkLength,l=o<h?0:o-h,f=s>h+r.chunkLength?r.chunkLength:s-h,d=o>h?0:h-o;r.chunkMap[c]||(r.chunkMap[c]=[]),r.chunkMap[c].push({from:l,to:f,offset:d,file:e})}return e})),window.addEventListener("pagehide",(function(){return r.cleanup()})),this.length=this.files.reduce((function(e,t){return e+t.length}),0),null!=i.length&&i.length!==this.length)throw new Error("total `files` length is not equal to explicit `length` option")}else this.length=Number(i.length)||1/0;this.length!==1/0&&(this.lastChunkLength=this.length%this.chunkLength||this.chunkLength,this.lastChunkIndex=Math.ceil(this.length/this.chunkLength)-1)}return(0,p.Z)(e,[{key:"_getChunkHandle",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var n,r;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.chunks[t]){e.next=8;break}return e.next=4,this.chunksDirPromise;case 4:return r=e.sent,e.next=7,r.getFileHandle(t,{create:!0});case 7:this.chunks[t]=n=e.sent;case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createFileHandle",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var n;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.path.slice(t.path.lastIndexOf("/")+1),e.next=3,this._getDirectoryHandle(t);case 3:return e.abrupt("return",e.sent.getFileHandle(n,{create:!0}));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createBlobReference",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return e.abrupt("return",e.sent.getFile());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getDirectoryHandle",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var n,r,i=this;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==(n=t.path.lastIndexOf("/"))&&0!==n){e.next=3;break}return e.abrupt("return",this.storageDirPromise);case 3:return r=t.path=t.path.slice(0,n),e.abrupt("return",(this.directoryMap[r]||(this.directoryMap[r]=(0,u.Z)((0,m.Z)().mark((function e(){return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i._getDirectoryHandle(t);case 2:return e.abrupt("return",e.sent.getDirectoryHandle(r.slice(r.lastIndexOf("/")+1),{create:!0}));case 3:case"end":return e.stop()}}),e)})))()),this.directoryMap[r]));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getChunksDirHandle",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(){var t;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.storage.getDirectory();case 2:return t=e.sent,e.next=5,t.getDirectoryHandle("chunks",{create:!0});case 5:return e.abrupt("return",e.sent.getDirectoryHandle(this.name,{create:!0}));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"put",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t,n){var r,i=arguments;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:Xe,e.prev=1,e.next=4,this._put(t,n);case 4:return r(null),e.abrupt("return",null);case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",(queueMicrotask((function(){return r(e.t0)})),e.t0));case 11:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_put",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t,n){var r,i,o,s,a=this;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.closed){e.next=2;break}throw new Error("Storage is closed");case 2:if(!(r=t===this.lastChunkIndex)||n.length===this.lastChunkLength){e.next=5;break}throw new Error("Last chunk length must be ".concat(this.lastChunkLength));case 5:if(r||n.length===this.chunkLength){e.next=7;break}throw new Error("Chunk length must be ".concat(this.chunkLength));case 7:if(i=(0,u.Z)((0,m.Z)().mark((function e(){var r,i;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a._getChunkHandle(t);case 2:return r=e.sent,e.next=5,r.createWritable({keepExistingData:!1});case 5:return i=e.sent,e.next=8,i.write(n);case 8:return e.next=10,i.close();case 10:case"end":return e.stop()}}),e)})))(),this.files){e.next=10;break}return e.abrupt("return",i);case 10:if(o=this.chunkMap[t]){e.next=13;break}throw new Error("No files matching the request range");case 13:return s=o.map(function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var r,i,o,s;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.file,i=t.offset,o=t.from,s=t.to,e.t0=r.stream,e.t0){e.next=8;break}return e.next=5,r.handle;case 5:return e.next=7,e.sent.createWritable({keepExistingData:!0});case 7:r.stream=e.sent;case 8:return e.next=10,r.stream.write({type:"write",position:i,data:n.slice(o,s)});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),s.push(i),e.next=17,Promise.all(s);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t,n){var r,i,o=arguments;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:Xe,null==n&&(n={}),e.prev=2,e.next=5,this._get(t,n);case 5:return i=e.sent,e.abrupt("return",(r(null,i),i));case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",(r(e.t0),e.t0));case 12:case"end":return e.stop()}}),e,this,[[2,9]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_get",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t,n){var r,i,o,s,a,c,h,l,f,d,p;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof n){e.next=2;break}return e.abrupt("return",this.get(t,void 0,n));case 2:if(!this.closed){e.next=4;break}throw new Error("Storage is closed");case 4:if(r=t===this.lastChunkIndex?this.lastChunkLength:this.chunkLength,i=n.offset||0,o=n.length?i+n.length:r,s=n.length||r-i,!(i<0||i<0||o>r)){e.next=7;break}throw new Error("Invalid offset and/or length");case 7:if(i!==o){e.next=9;break}return e.abrupt("return",new Uint8Array(0));case 9:if(this.files&&!this.chunks[t]){e.next=23;break}return e.next=12,this._getChunkHandle(t);case 12:return a=e.sent,e.next=15,a.getFile();case 15:return c=e.sent,0===i&&s===r||(c=c.slice(i,s+i)),e.next=19,c.arrayBuffer();case 19:if(0!==(h=e.sent).byteLength){e.next=22;break}throw new Error("Index ".concat(t," does not exist"));case 22:return e.abrupt("return",new Uint8Array(h));case 23:if(l=this.chunkMap[t]){e.next=26;break}throw new Error("No files matching the request range");case 26:if(!n||(l=l.filter((function(e){var t=e.from;return e.to>i&&t<o})),0!==l.length)){e.next=28;break}throw new Error("No files matching the request range");case 28:return f=l.map(function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var r,s,a,u;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.from,s=t.to,a=t.offset,u=t.file,n&&(s>o&&(s=o),r<i&&(a+=i-r,r=i)),e.next=4,u.blob;case 4:return e.abrupt("return",e.sent.slice(a,a+s-r));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=31,Promise.all(f);case 31:if(1!==(d=e.sent).length){e.next=38;break}return e.next=35,d[0].arrayBuffer();case 35:e.t0=e.sent,e.next=41;break;case 38:return e.next=40,new Blob(d).arrayBuffer();case 40:e.t0=e.sent;case 41:if(0!==(p=e.t0).byteLength){e.next=44;break}throw new Error("Index ".concat(t," does not exist"));case 44:return e.abrupt("return",new Uint8Array(p));case 45:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(){var t,n=arguments;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:Xe,!this.closed){e.next=3;break}return e.abrupt("return",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xe,t=arguments.length>1?arguments[1]:void 0;return queueMicrotask((function(){return e(new Error(t))}))}(t,"Storage is closed"));case 3:if(this.closed=!0,this.chunkMap=null,this.directoryMap=null,e.t0=this.files,!e.t0){e.next=10;break}return e.next=10,this.cleanup();case 10:queueMicrotask((function(){return t(null)}));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cleanup",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(){var t,n,r,i,o,s,a,c,h=this;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=(0,f.Z)(this.files);try{for(n.s();!(r=n.n()).done;)(i=r.value).stream&&(t.push(i.stream.close()),i.stream=null)}catch(l){n.e(l)}finally{n.f()}return o=(0,u.Z)((0,m.Z)().mark((function e(){var t,n,r,i,o,s,a;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.chunksDirPromise;case 2:t=e.sent,h.chunks=[],n=!1,r=!1,e.prev=6,o=E(t.keys());case 8:return e.next=10,o.next();case 10:if(!(n=!(s=e.sent).done)){e.next=17;break}return a=s.value,e.next=14,t.removeEntry(a,{recursive:!0});case 14:n=!1,e.next=8;break;case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(6),r=!0,i=e.t0;case 23:if(e.prev=23,e.prev=24,!n||null==o.return){e.next=28;break}return e.next=28,o.return();case 28:if(e.prev=28,!r){e.next=31;break}throw i;case 31:return e.finish(28);case 32:return e.finish(23);case 33:return e.next=35,h._getChunksDirHandle();case 35:h.chunksDirPromise=e.sent;case 36:case"end":return e.stop()}}),e,null,[[6,19,23,33],[24,,28,32]])})))(),e.next=6,Promise.all(t);case 6:s=(0,f.Z)(this.files);try{for(s.s();!(a=s.n()).done;)(c=a.value).blob=this._createBlobReference(c.handle)}catch(l){s.e(l)}finally{s.f()}return e.next=10,o;case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(){var t,n=this,r=arguments;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=r.length>0&&void 0!==r[0]?r[0]:Xe,this.close(function(){var e=(0,u.Z)((0,m.Z)().mark((function e(r){var i;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=4;break}t(r),e.next=16;break;case 4:return e.prev=4,e.next=7,n.rootDirPromise;case 7:return i=e.sent,e.next=10,i.removeEntry(n.name,{recursive:!0});case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(4),e.abrupt("return",void t(e.t0));case 15:t(null);case 16:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),et=P(4137),tt=P(1191),nt=("undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||"undefined"!=typeof window&&window||"undefined"!=typeof globalThis&&globalThis).chrome?1/0:2130706432,rt="undefined"!=typeof navigator&&(null===(t=navigator.storage)||void 0===t?void 0:t.getDirectory)&&(null===(n=FileSystemFileHandle)||void 0===n||null===(b=n.prototype)||void 0===b?void 0:b.createWritable),it=function(){},ot=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,d.Z)(this,e),this.chunkLength=Number(t),!this.chunkLength)throw new Error("First argument must be a chunk length");this.length=Number(n.length)||1/0,this.limit=n.limit||nt,this.fallbackStore=null,this.dataStore=null,this.chunkCount=0,this.stores=[],this._init(n),this.dataStore&&(n.max>0&&(this.dataStore=new me(this.dataStore,{max:n.max})),this.stores.push(this.dataStore)),this.stores.push(this.fallbackStore)}return(0,p.Z)(e,[{key:"_init",value:function(e){if(e.onlyMem||this.limit<this.chunkLength)this.fallbackStore=new tt(this.chunkLength,e);else{var t=rt?Qe:et;if(this.limit>=this.length)this.fallbackStore=new t(this.chunkLength,e);else{this.chunkCount=Math.floor(Math.min(this.length,this.limit)/this.chunkLength);var n=this.chunkCount*this.chunkLength,r=this.length-n;this.dataStore=new t(this.chunkLength,(0,a.Z)((0,a.Z)({},e),{},{length:n})),this.fallbackStore=new tt(this.chunkLength,(0,a.Z)((0,a.Z)({},e),{},{length:r}))}}}},{key:"get",value:function(e,t,n){e>=this.chunkCount?this.fallbackStore.get(e-this.chunkCount,t,n):this.dataStore.get(e,t,n)}},{key:"put",value:function(e,t,n){e>=this.chunkCount?this.fallbackStore.put(e-this.chunkCount,t,n):this.dataStore.put(e,t,n)}},{key:"close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it;Promise.all(this.stores.map((function(e){return new Promise((function(t){return e.close(t)}))}))).then((function(t){var n=t.find((function(e){return e}));e(n)}))}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it;Promise.all(this.stores.map((function(e){return new Promise((function(t){return e.destroy(t)}))}))).then((function(t){var n=t.find((function(e){return e}));e(n)}))}}]),e}(),st=P(3700),at=P(9417),ut=P(9967),ct=P(8687),ht=P(5960),lt=G("ut_metadata"),ft=16384,dt=function(e){var t=function(t){(0,g.Z)(r,t);var n=(0,y.Z)(r);function r(t){var i;return(0,d.Z)(this,r),(i=n.call(this))._wire=t,i._fetching=!1,i._metadataComplete=!1,i._metadataSize=null,i._remainingRejects=null,i._bitfield=new ye.Z(0,{grow:1e3}),ArrayBuffer.isView(e)&&i.setMetadata(e),i}return(0,p.Z)(r,[{key:"onHandshake",value:function(e,t,n){this._infoHash=e}},{key:"onExtendedHandshake",value:function(e){return e.m&&e.m.ut_metadata?e.metadata_size?"number"!=typeof e.metadata_size||1e7<e.metadata_size||e.metadata_size<=0?this.emit("warning",new Error("Peer gave invalid metadata size")):(this._metadataSize=e.metadata_size,this._numPieces=Math.ceil(this._metadataSize/ft),this._remainingRejects=2*this._numPieces,void this._requestPieces()):this.emit("warning",new Error("Peer does not have metadata")):this.emit("warning",new Error("Peer does not support ut_metadata"))}},{key:"onMessage",value:function(e){var t,n;try{var r=(0,N.vV)(e),i=r.indexOf("ee")+2;t=C.Z.decode(r.substring(0,i)),n=e.slice(i)}catch(e){return}switch(t.msg_type){case 0:this._onRequest(t.piece);break;case 1:this._onData(t.piece,n,t.total_size);break;case 2:this._onReject(t.piece)}}},{key:"fetch",value:function(){this._metadataComplete||(this._fetching=!0,this._metadataSize&&this._requestPieces())}},{key:"cancel",value:function(){this._fetching=!1}},{key:"setMetadata",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var n;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._metadataComplete){e.next=2;break}return e.abrupt("return",!0);case 2:lt("set metadata");try{(n=C.Z.decode(t).info)&&(t=C.Z.encode(n))}catch(t){}if(e.t1=!this._infoHash,e.t1){e.next=11;break}return e.t2=this._infoHash,e.next=9,(0,N.vp)(t,"hex");case 9:e.t3=e.sent,e.t1=e.t2===e.t3;case 11:if(e.t0=e.t1,!e.t0){e.next=14;break}e.t0=(this.cancel(),this.metadata=t,this._metadataComplete=!0,this._metadataSize=this.metadata.length,this._wire.extendedHandshake.metadata_size=this._metadataSize,this.emit("metadata",C.Z.encode({info:C.Z.decode(this.metadata)})),!0);case 14:return e.abrupt("return",e.t0);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_send",value:function(e,t){var n=C.Z.encode(e);ArrayBuffer.isView(t)&&(n=(0,N.zo)([n,t])),this._wire.extended("ut_metadata",n)}},{key:"_request",value:function(e){this._send({msg_type:0,piece:e})}},{key:"_data",value:function(e,t,n){var r={msg_type:1,piece:e};"number"==typeof n&&(r.total_size=n),this._send(r,t)}},{key:"_reject",value:function(e){this._send({msg_type:2,piece:e})}},{key:"_onRequest",value:function(e){if(this._metadataComplete){var t=e*ft,n=t+ft;n>this._metadataSize&&(n=this._metadataSize);var r=this.metadata.slice(t,n);this._data(e,r,this._metadataSize)}else this._reject(e)}},{key:"_onData",value:function(e,t,n){t.length>ft||!this._fetching||(this.metadata.set(t,e*ft),this._bitfield.set(e),this._checkDone())}},{key:"_onReject",value:function(e){this._remainingRejects>0&&this._fetching?(this._request(e),this._remainingRejects-=1):this.emit("warning",new Error('Peer sent "reject" too much'))}},{key:"_requestPieces",value:function(){if(this._fetching){this.metadata=new Uint8Array(this._metadataSize);for(var e=0;e<this._numPieces;e++)this._request(e)}}},{key:"_checkDone",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(){var t,n;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=0;case 2:if(!(n<this._numPieces)){e.next=9;break}if(this._bitfield.get(n)){e.next=6;break}return t=!1,e.abrupt("break",9);case 6:n++,e.next=2;break;case 9:if(t){e.next=11;break}return e.abrupt("return");case 11:return e.next=13,this.setMetadata(this.metadata);case 13:if(e.t0=e.sent,e.t0){e.next=16;break}this._failedMetadata();case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_failedMetadata",value:function(){this._bitfield=new ye.Z(0,{grow:1e3}),this._remainingRejects-=this._numPieces,this._remainingRejects>0?this._requestPieces():this.emit("warning",new Error("Peer sent invalid metadata"))}}]),r}(k.EventEmitter);return t.prototype.name="ut_metadata",t},pt=P(8838),vt=P(1237),gt=P(2109),yt=G("webtorrent:file-iterator"),mt=function(e,t){(0,g.Z)(r,e);var n=(0,y.Z)(r);function r(e,t){var i,o=t.start,s=t.end;return(0,d.Z)(this,r),(i=n.call(this))._torrent=e._torrent,i._pieceLength=e._torrent.pieceLength,i._startPiece=(o+e.offset)/i._pieceLength|0,i._endPiece=(s+e.offset)/i._pieceLength|0,i._piece=i._startPiece,i._offset=o+e.offset-i._startPiece*i._pieceLength,i._missing=s-o+1,i._criticalLength=Math.min(1048576/i._pieceLength|0,2),i._torrent.select(i._startPiece,i._endPiece,!0,(function(){i.emit("_notify")})),i.destroyed=!1,i}return(0,p.Z)(r,[{key:t,value:function(){return this}},{key:"next",value:function(){var e=this;return new Promise((function(t,n){if(0===e._missing||e.destroyed)return t({done:!0}),e.destroy();var r=Math.min(e._missing,e._pieceLength-e._offset);(function r(i,o){if(!e._torrent.bitfield.get(i)){e._torrent.critical(i,i+e._criticalLength);return e.on("_notify",(function t(){e._torrent.bitfield.get(i)&&(e.removeListener("_notify",t),r(i,o))}))}if(e._torrent.destroyed)return n(new Error("Torrent removed"));e._torrent.store.get(i,o,(function(r,o){return e.destroyed?t({done:!0}):(yt("read %s and yielding (length %s) (err %s)",i,null===o||void 0===o?void 0:o.length,null===r||void 0===r?void 0:r.message),r?n(r):void t({value:o,done:!1}))}))})(e._piece++,{length:r,offset:e._offset}),e._missing-=r,e._offset=0}))}},{key:"return",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(){var t,n;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.destroy(),e.next=3,this.next();case 3:return t=e.sent,n=t.value,e.abrupt("return",{done:!0,value:n});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"throw",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw t;case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments.length>1?arguments[1]:void 0;this.destroyed||(this.destroyed=!0,this._torrent.destroyed||this._torrent.deselect(this._startPiece,this._endPiece,!0),this.emit("return"),e(t))}}]),r}(k,Symbol.asyncIterator),_t=function(e,t){(0,g.Z)(r,e);var n=(0,y.Z)(r);function r(e,t){var i;(0,d.Z)(this,r),(i=n.call(this))._torrent=e,i._destroyed=!1,i._fileStreams=new Set,i._iterators=new Set,i.name=t.name,i.path=t.path,i.length=t.length,i.size=t.length,i.type=gt.getType(i.name)||"application/octet-stream",i.offset=t.offset,i.done=!1;var o=t.offset,s=o+t.length-1;return i._startPiece=o/i._torrent.pieceLength|0,i._endPiece=s/i._torrent.pieceLength|0,0===i.length&&(i.done=!0,i.emit("done")),i._client=e.client,i}return(0,p.Z)(r,[{key:"downloaded",get:function(){if(this._destroyed||!this._torrent.bitfield)return 0;for(var e=this._torrent,t=e.pieces,n=e.bitfield,r=e.pieceLength,i=e.lastPieceLength,o=this._startPiece,s=this._endPiece,a=function(e){var o=e===t.length-1?i:r;return n.get(e)?o:o-t[e].missing},u=0,c=o;c<=s;c+=1){var h=a(c);if(u+=h,c===o){var l=this.offset%r;u-=Math.min(l,h)}if(c===s){var f=(s===t.length-1?i:r)-(this.offset+this.length)%r;u-=Math.min(f,h)}}return u}},{key:"progress",get:function(){return this.length?this.downloaded/this.length:0}},{key:"select",value:function(e){0!==this.length&&this._torrent.select(this._startPiece,this._endPiece,e)}},{key:"deselect",value:function(){0!==this.length&&this._torrent.deselect(this._startPiece,this._endPiece,!1)}},{key:t,value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(0===this.length)return x((0,m.Z)().mark((function e(){return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))();var n=null!==t&&void 0!==t?t:{},r=n.start,i=void 0===r?0:r,o=null!==t&&void 0!==t&&t.end&&t.end<this.length?t.end:this.length-1;if(this.done)return _e(this._torrent.store,{offset:i+this.offset,length:o-i+1});var s=new mt(this,{start:i,end:o});return this._iterators.add(s),s.once("return",(function(){e._iterators.delete(s)})),s}},{key:"createReadStream",value:function(e){var t=this,n=this[Symbol.asyncIterator](e),r=vt.Readable.from(n);return this._fileStreams.add(r),r.once("close",(function(){t._fileStreams.delete(r)})),r}},{key:"arrayBuffer",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var n,r,i,o,s,a,u,c;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new Uint8Array(this.length),r=0,i=!1,o=!1,e.prev=4,a=E(this[Symbol.asyncIterator](t));case 6:return e.next=8,a.next();case 8:if(!(i=!(u=e.sent).done)){e.next=14;break}c=u.value,n.set(c,r),r+=c.length;case 11:i=!1,e.next=6;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(4),o=!0,s=e.t0;case 20:if(e.prev=20,e.prev=21,!i||null==a.return){e.next=25;break}return e.next=25,a.return();case 25:if(e.prev=25,!o){e.next=28;break}throw s;case 28:return e.finish(25);case 29:return e.finish(20);case 30:return e.abrupt("return",n.buffer);case 31:case"end":return e.stop()}}),e,this,[[4,16,20,30],[21,,25,29]])})));return function(t){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Blob,e.next=3,this.arrayBuffer(t);case 3:return e.t1=e.sent,e.t2=[e.t1],e.t3={mimeType:this.type},e.abrupt("return",new e.t0(e.t2,e.t3));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stream",value:function(e){var t;return new ReadableStream({start:function(){t=this[Symbol.asyncIterator](e)},pull:function(e){return(0,u.Z)((0,m.Z)().mark((function n(){var r,i,o,s;return(0,m.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.close,i=e.enqueue,n.next=3,t.next();case 3:o=n.sent,s=o.value,o.done?r():i(s);case 7:case"end":return n.stop()}}),n)})))()},cancel:function(){t.return()}})}},{key:"streamURL",get:function(){if(!this._client._server)throw new Error("No server created");return"".concat(this._client._server.pathname,"/").concat(this._torrent.infoHash,"/").concat(encodeURI(this.path))}},{key:"streamTo",value:function(e){return e.src=this.streamURL,e}},{key:"includes",value:function(e){return this._startPiece<=e&&this._endPiece>=e}},{key:"_destroy",value:function(){this._destroyed=!0,this._torrent=null;var e,t=(0,f.Z)(this._fileStreams);try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(i){t.e(i)}finally{t.f()}this._fileStreams.clear();var n,r=(0,f.Z)(this._iterators);try{for(r.s();!(n=r.n()).done;){n.value.destroy()}}catch(i){r.e(i)}finally{r.f()}this._iterators.clear()}}]),r}(k,Symbol.asyncIterator),bt=P(3287),wt=function(){function e(t){var n=this;(0,d.Z)(this,e),this._torrent=t,this._numPieces=t.pieces.length,this._pieces=new Array(this._numPieces),this._onWire=function(e){n.recalculate(),n._initWire(e)},this._onWireHave=function(e){n._pieces[e]+=1},this._onWireBitfield=function(){n.recalculate()},this._torrent.wires.forEach((function(e){n._initWire(e)})),this._torrent.on("wire",this._onWire),this.recalculate()}return(0,p.Z)(e,[{key:"getRarestPiece",value:function(e){for(var t=[],n=1/0,r=0;r<this._numPieces;++r)if(!e||e(r)){var i=this._pieces[r];i===n?t.push(r):i<n&&(t=[r],n=i)}return t.length?t[Math.random()*t.length|0]:-1}},{key:"destroy",value:function(){var e=this;this._torrent.removeListener("wire",this._onWire),this._torrent.wires.forEach((function(t){e._cleanupWireEvents(t)})),this._torrent=null,this._pieces=null,this._onWire=null,this._onWireHave=null,this._onWireBitfield=null}},{key:"_initWire",value:function(e){var t=this;e._onClose=function(){t._cleanupWireEvents(e);for(var n=0;n<t._numPieces;++n)t._pieces[n]-=e.peerPieces.get(n)},e.on("have",this._onWireHave),e.on("bitfield",this._onWireBitfield),e.once("close",e._onClose)}},{key:"recalculate",value:function(){this._pieces.fill(0);var e,t=(0,f.Z)(this._torrent.wires);try{for(t.s();!(e=t.n()).done;)for(var n=e.value,r=0;r<this._numPieces;++r)this._pieces[r]+=n.peerPieces.get(r)}catch(i){t.e(i)}finally{t.f()}}},{key:"_cleanupWireEvents",value:function(e){e.removeListener("have",this._onWireHave),e.removeListener("bitfield",this._onWireBitfield),e._onClose&&e.removeListener("close",e._onClose),e._onClose=null}}]),e}(),kt=P(6475),xt=P(814),Et="2.0.14",St=G("webtorrent:webconn"),Tt=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this)).url=e,i.connId=e,i._torrent=r,i._init(e),i}return(0,p.Z)(n,[{key:"_init",value:function(e){var t=this;this.setKeepAlive(!0),this.use(at()),this.once("handshake",function(){var n=(0,u.Z)((0,m.Z)().mark((function n(r,i){var o,s,a,u;return(0,m.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,N.vp)(e,"hex");case 2:if(o=n.sent,!t.destroyed){n.next=5;break}return n.abrupt("return");case 5:for(t.handshake(r,o),s=t._torrent.pieces.length,a=new ye.Z(s),u=0;u<=s;u++)a.set(u,!0);t.bitfield(a);case 9:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()),this.once("interested",(function(){St("interested"),t.unchoke()})),this.on("uninterested",(function(){St("uninterested")})),this.on("choke",(function(){St("choke")})),this.on("unchoke",(function(){St("unchoke")})),this.on("bitfield",(function(){St("bitfield")})),this.lt_donthave.on("donthave",(function(){St("donthave")})),this.on("request",(function(e,n,r,i){St("request pieceIndex=%d offset=%d length=%d",e,n,r),t.httpRequest(e,n,r,(function(n,r){if(n){t.lt_donthave.donthave(e);var o=setTimeout((function(){t.destroyed||t.have(e)}),1e4);o.unref&&o.unref()}i(n,r)}))}))}},{key:"httpRequest",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t,n,r,i){var o,s,a,c,h,l,f=this;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Se(i),o=t*this._torrent.pieceLength+n,s=o+r-1,!((a=this._torrent.files).length<=1)){e.next=6;break}c=[{url:this.url,start:o,end:s}],e.next=10;break;case 6:if(h=a.filter((function(e){return e.offset<=s&&e.offset+e.length>o})),!(h.length<1)){e.next=9;break}return e.abrupt("return",i(new Error("Could not find file corresponding to web seed range request")));case 9:c=h.map((function(e){var t=e.offset+e.length-1;return{url:f.url+("/"===f.url[f.url.length-1]?"":"/")+e.path.replace(f._torrent.path,""),fileOffsetInRange:Math.max(e.offset-o,0),start:Math.max(o-e.offset,0),end:Math.min(t,s-e.offset)}}));case 10:return e.next=12,Promise.all(c.map(function(){var e=(0,u.Z)((0,m.Z)().mark((function e(o){var s,a,u,c,h;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=o.start,a=o.end,u=o.url,St("Requesting url=%s pieceIndex=%d offset=%d length=%d start=%d end=%d",u,t,n,r,s,a),e.prev=2,e.next=5,$(u,{cache:"no-store",method:"GET",headers:{"Cache-Control":"no-store","user-agent":"WebTorrent/".concat("2.0.14"," (https://webtorrent.io)"),range:"bytes=".concat(s,"-").concat(a)},signal:AbortSignal.timeout(6e4)});case 5:c=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",i(e.t0));case 11:if(c.ok){e.next=13;break}return e.abrupt("return",i(new Error("Unexpected HTTP status code ".concat(c.status))));case 13:return e.prev=13,e.t1=Uint8Array,e.next=17,c.arrayBuffer();case 17:e.t2=e.sent,h=new e.t1(e.t2),e.next=24;break;case 21:return e.prev=21,e.t3=e.catch(13),e.abrupt("return",i(e.t3));case 24:return e.abrupt("return",(St("Got data of length %d",h.length),h));case 25:case"end":return e.stop()}}),e,null,[[2,8],[13,21]])})));return function(t){return e.apply(this,arguments)}}()));case 12:l=e.sent,i(null,(0,N.zo)(l));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){(0,o.Z)((0,s.Z)(n.prototype),"destroy",this).call(this),this._torrent=null}}]),n}(xt.Z),Ct=P(8768),At=G("webtorrent:torrent"),Rt=5e3,Pt=3*ct.BLOCK_LENGTH,It=Ct.browser?xe().length:2,Lt=[1e3,5e3,15e3],Ot="WebTorrent/".concat(Et," (https://webtorrent.io)");try{Je=S.join(le.statSync("/tmp")&&"/tmp","webtorrent")}catch(k){Je=S.join("function"==typeof de.tmpdir?de.tmpdir():"/","webtorrent")}var Zt=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(e,r,i){var o;return(0,d.Z)(this,n),(o=t.call(this))._debugId="unknown infohash",o.client=r,o.announce=i.announce,o.urlList=i.urlList,o.path=i.path||Je,o.addUID=i.addUID||!1,o.rootDir=i.rootDir||null,o.skipVerify=!!i.skipVerify,o._store=i.store||ot,o._preloadedStore=i.preloadedStore||null,o._storeCacheSlots=void 0!==i.storeCacheSlots?i.storeCacheSlots:20,o._destroyStoreOnDestroy=i.destroyStoreOnDestroy||!1,o.store=null,o.storeOpts=i.storeOpts,o._getAnnounceOpts=i.getAnnounceOpts,"boolean"==typeof i.private&&(o.private=i.private),o.strategy=i.strategy||"sequential",o.maxWebConns=i.maxWebConns||4,o._rechokeNumSlots=!1===i.uploads||0===i.uploads?0:+i.uploads||10,o._rechokeOptimisticWire=null,o._rechokeOptimisticTime=0,o._rechokeIntervalId=null,o._noPeersIntervalId=null,o._noPeersIntervalTime=i.noPeersIntervalTime?1e3*i.noPeersIntervalTime:3e4,o.ready=!1,o.destroyed=!1,o.paused=i.paused||!1,o.done=!1,o.metadata=null,o.files=[],o.pieces=[],o._amInterested=!1,o._selections=[],o._critical=[],o.wires=[],o._queue=[],o._peers={},o._peersLength=0,o.received=0,o.uploaded=0,o._downloadSpeed=ue(),o._uploadSpeed=ue(),o._servers=[],o._xsRequests=[],o._fileModtimes=i.fileModtimes,null!==e&&o._onTorrentId(e),o._debug("new torrent"),o}return(0,p.Z)(n,[{key:"timeRemaining",get:function(){return this.done?0:0===this.downloadSpeed?1/0:(this.length-this.downloaded)/this.downloadSpeed*1e3}},{key:"downloaded",get:function(){if(!this.bitfield)return 0;for(var e=0,t=0,n=this.pieces.length;t<n;++t)if(this.bitfield.get(t))e+=t===n-1?this.lastPieceLength:this.pieceLength;else{var r=this.pieces[t];e+=r.length-r.missing}return e}},{key:"downloadSpeed",get:function(){return this._downloadSpeed()}},{key:"uploadSpeed",get:function(){return this._uploadSpeed()}},{key:"progress",get:function(){return this.length?this.downloaded/this.length:0}},{key:"ratio",get:function(){return this.uploaded/(this.received||this.length)}},{key:"numPeers",get:function(){return this.wires.length}},{key:"torrentFileBlob",get:function(){return this.torrentFile?new Blob([this.torrentFile],{type:"application/x-bittorrent"}):null}},{key:"_numQueued",get:function(){return this._queue.length+(this._peersLength-this._numConns)}},{key:"_numConns",get:function(){var e=0;for(var t in this._peers)this._peers[t].connected&&(e+=1);return e}},{key:"_onTorrentId",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var n,r=this;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.destroyed){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,oe(t);case 5:n=e.sent,e.next=10;break;case 8:e.prev=8,e.t0=e.catch(2);case 10:n?(this.infoHash=n.infoHash,this._debugId=(0,N.oc)(n.infoHash).substring(0,7),M((function(){r.destroyed||r._onParsedTorrent(n)}))):te(t,(function(e,t){if(!r.destroyed)return e?r._destroy(e):void r._onParsedTorrent(t)}));case 11:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_onParsedTorrent",value:function(e){var t=this;if(!this.destroyed){if(this._processParsedTorrent(e),!this.infoHash)return this._destroy(new Error("Malformed torrent data: No info hash"));this._rechokeIntervalId=setInterval((function(){t._rechoke()}),1e4),this._rechokeIntervalId.unref&&this._rechokeIntervalId.unref(),this.emit("_infoHash",this.infoHash),this.destroyed||(this.emit("infoHash",this.infoHash),this.destroyed||(this.client.listening?this._onListening():this.client.once("listening",(function(){t._onListening()}))))}}},{key:"_processParsedTorrent",value:function(e){this._debugId=(0,N.oc)(e.infoHash).substring(0,7),void 0!==this.private&&(e.private=this.private),this.announce&&(e.announce=e.announce.concat(this.announce)),this.client.tracker&&globalThis.WEBTORRENT_ANNOUNCE&&!e.private&&(e.announce=e.announce.concat(globalThis.WEBTORRENT_ANNOUNCE)),this.urlList&&(e.urlList=e.urlList.concat(this.urlList)),e.announce=Array.from(new Set(e.announce)),e.urlList=Array.from(new Set(e.urlList)),Object.assign(this,e),this.magnetURI=function(e){e=Object.assign({},e);var t=new Set;e.xt&&"string"==typeof e.xt&&t.add(e.xt),e.xt&&Array.isArray(e.xt)&&(t=new Set(e.xt)),e.infoHashBuffer&&t.add("urn:btih:".concat((0,N.oc)(e.infoHashBuffer))),e.infoHash&&t.add("urn:btih:".concat(e.infoHash)),e.infoHashV2Buffer&&t.add(e.xt="urn:btmh:1220".concat((0,N.oc)(e.infoHashV2Buffer))),e.infoHashV2&&t.add("urn:btmh:1220".concat(e.infoHashV2));var n=Array.from(t);1===n.length&&(e.xt=n[0]),n.length>1&&(e.xt=n),e.publicKeyBuffer&&(e.xs="urn:btpk:".concat((0,N.oc)(e.publicKeyBuffer))),e.publicKey&&(e.xs="urn:btpk:".concat(e.publicKey)),e.name&&(e.dn=e.name),e.keywords&&(e.kt=e.keywords),e.announce&&(e.tr=e.announce),e.urlList&&(e.ws=e.urlList,delete e.as),e.peerAddresses&&(e["x.pe"]=e.peerAddresses);var r="magnet:?";return Object.keys(e).filter((function(e){return 2===e.length||"x.pe"===e})).forEach((function(t,n){var i=Array.isArray(e[t])?e[t]:[e[t]];i.forEach((function(e,i){(n>0||i>0)&&("kt"!==t&&"so"!==t||0===i)&&(r+="&"),"dn"===t&&(e=encodeURIComponent(e).replace(/%20/g,"+")),"tr"!==t&&"as"!==t&&"ws"!==t||(e=encodeURIComponent(e)),"xs"!==t||e.startsWith("urn:btpk:")||(e=encodeURIComponent(e)),"kt"===t&&(e=encodeURIComponent(e)),"so"!==t&&(r+="kt"===t&&i>0?"+".concat(e):"".concat(t,"=").concat(e))})),"so"===t&&(r+="".concat(t,"=").concat(i.reduce((function(e,t,n,r){return 0!==n&&t===r[n-1]+1||e.push([]),e[e.length-1].push(t),e}),[]).map((function(e){return e.length>1?"".concat(e[0],"-").concat(e[e.length-1]):"".concat(e[0])}))))})),r}(e),this.torrentFile=function(e){var t={info:e.info};return t["announce-list"]=(e.announce||[]).map((function(e){return t.announce||(t.announce=e),[e=(0,N.gR)(e)]})),t["url-list"]=e.urlList||[],void 0!==e.private&&(t.private=Number(e.private)),e.created&&(t["creation date"]=e.created.getTime()/1e3|0),e.createdBy&&(t["created by"]=e.createdBy),e.comment&&(t.comment=e.comment),C.Z.encode(t)}(e)}},{key:"_onListening",value:function(){this.destroyed||(this.info?this._onMetadata(this):(this.xs&&this._getMetadataFromServer(),this._startDiscovery()))}},{key:"_startDiscovery",value:function(){var e=this;if(!this.discovery&&!this.destroyed){var t=this.client.tracker;t&&(t=Object.assign({},this.client.tracker,{getAnnounceOpts:function(){if(!e.destroyed){var t={uploaded:e.uploaded,downloaded:e.downloaded,left:Math.max(e.length-e.downloaded,0)};return e.client.tracker.getAnnounceOpts&&Object.assign(t,e.client.tracker.getAnnounceOpts()),e._getAnnounceOpts&&Object.assign(t,e._getAnnounceOpts()),t}}})),this.peerAddresses&&this.peerAddresses.forEach((function(t){return e.addPeer(t,bt.default.SOURCE_MANUAL)})),this.discovery=new $e({infoHash:this.infoHash,announce:this.announce,peerId:this.client.peerId,dht:!this.private&&this.client.dht,tracker:t,port:this.client.torrentPort,userAgent:Ot,lsd:this.client.lsd}),this.discovery.on("error",(function(t){e._destroy(t)})),this.discovery.on("peer",(function(t,n){e._debug("peer %s discovered via %s",t,n),"string"==typeof t&&e.done||e.addPeer(t,n)})),this.discovery.on("trackerAnnounce",(function(){e.emit("trackerAnnounce")})),this.discovery.on("dhtAnnounce",(function(){e.emit("dhtAnnounce")})),this.discovery.on("warning",(function(t){e.emit("warning",t)})),this._noPeersIntervalId=setInterval((function(){var t;if(!e.destroyed){for(var n=(t={},(0,h.Z)(t,bt.default.SOURCE_TRACKER,{enabled:!!e.client.tracker,numPeers:0}),(0,h.Z)(t,bt.default.SOURCE_DHT,{enabled:!!e.client.dht,numPeers:0}),(0,h.Z)(t,bt.default.SOURCE_LSD,{enabled:!!e.client.lsd,numPeers:0}),(0,h.Z)(t,bt.default.SOURCE_UT_PEX,{enabled:e.client.utPex&&"function"==typeof pt,numPeers:0}),t),r=0,i=Object.values(e._peers);r<i.length;r++){var o=n[i[r].source];void 0!==o&&o.numPeers++}for(var s=0,a=Object.keys(n);s<a.length;s++){var u=a[s],c=n[u];c.enabled&&0===c.numPeers&&e.emit("noPeers",u)}}}),this._noPeersIntervalTime),this._noPeersIntervalId.unref&&this._noPeersIntervalId.unref()}}},{key:"_getMetadataFromServer",value:function(){var e=this,t=Array.isArray(this.xs)?this.xs:[this.xs];e._xsRequestsController=new AbortController;var n=e._xsRequestsController.signal,r=t.map((function(t){return function(r){!function(){var t=(0,u.Z)((0,m.Z)().mark((function t(r,i){var o,s,a,u;return(0,m.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0===r.indexOf("http://")||0===r.indexOf("https://")){t.next=2;break}return t.abrupt("return",(e.emit("warning",new Error("skipping non-http xs param: ".concat(r))),i(null)));case 2:return o={method:"GET",headers:{"user-agent":Ot},signal:n},t.prev=3,t.next=6,$(r,o);case 6:s=t.sent,t.next=12;break;case 9:return t.prev=9,t.t0=t.catch(3),t.abrupt("return",(e.emit("warning",new Error("http error from xs param: ".concat(r))),i(null)));case 12:if(!e.destroyed){t.next=14;break}return t.abrupt("return",i(null));case 14:if(!e.metadata){t.next=16;break}return t.abrupt("return",i(null));case 16:if(200===s.status){t.next=18;break}return t.abrupt("return",(e.emit("warning",new Error("non-200 status code ".concat(s.status," from xs param: ").concat(r))),i(null)));case 18:return t.prev=18,t.t1=Uint8Array,t.next=22,s.arrayBuffer();case 22:t.t2=t.sent,a=new t.t1(t.t2),t.next=29;break;case 26:return t.prev=26,t.t3=t.catch(18),t.abrupt("return",(e.emit("warning",t.t3),i(null)));case 29:return t.prev=29,t.next=32,oe(a);case 32:u=t.sent,t.next=37;break;case 35:t.prev=35,t.t4=t.catch(29);case 37:if(u){t.next=39;break}return t.abrupt("return",(e.emit("warning",new Error("got invalid torrent file from xs param: ".concat(r))),i(null)));case 39:if(u.infoHash===e.infoHash){t.next=41;break}return t.abrupt("return",(e.emit("warning",new Error("got torrent file with incorrect info hash from xs param: ".concat(r))),i(null)));case 41:e._onMetadata(u),i(null);case 42:case"end":return t.stop()}}),t,null,[[3,9],[18,26],[29,35]])})));return function(e,n){return t.apply(this,arguments)}}()(t,r)}}));B(r)}},{key:"_onMetadata",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var n,r,i,o,s=this;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.metadata&&!this.destroyed){e.next=2;break}return e.abrupt("return");case 2:if(this._debug("got metadata"),null!==(n=this._xsRequestsController)&&void 0!==n&&n.abort(),this._xsRequestsController=null,!t||!t.infoHash){e.next=6;break}r=t,e.next=15;break;case 6:return e.prev=6,e.next=9,oe(t);case 9:r=e.sent,e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(6),e.abrupt("return",this._destroy(e.t0));case 15:this._processParsedTorrent(r),this.metadata=this.torrentFile,this.client.enableWebSeeds&&this.urlList.forEach((function(e){s.addWebSeed(e)})),this._rarityMap=new wt(this),this.files=this.files.map((function(e){return new _t(s,e)})),(i=this._preloadedStore)||(i=new this._store(this.pieceLength,(0,a.Z)((0,a.Z)({},this.storeOpts),{},{torrent:this,path:this.path,files:this.files,length:this.length,name:this.name+" - "+this.infoHash.slice(0,8),addUID:this.addUID,rootDir:this.rootDir,max:this._storeCacheSlots}))),this._storeCacheSlots>0&&!(i instanceof tt||i instanceof ot)&&(i=new me(i,{max:this._storeCacheSlots})),this.store=new st(i),this.so?this.files.forEach((function(e,t){s.so.includes(t)?s.files[t].select():s.files[t].deselect()})):0!==this.pieces.length&&this.select(0,this.pieces.length-1,!1),this._hashes=this.pieces,this.pieces=this.pieces.map((function(e,t){var n=t===s.pieces.length-1?s.lastPieceLength:s.pieceLength;return new ct(n)})),this._reservations=this.pieces.map((function(){return[]})),this.bitfield=new ye.Z(this.pieces.length),this.emit("metadata"),this.destroyed||(this.skipVerify?(this._markAllVerified(),this._onStore()):(o=function(e){if(e)return s._destroy(e);s._debug("done verifying"),s._onStore()},this._debug("verifying existing torrent data"),this._fileModtimes&&this._store===ot?this.getFileModtimes((function(e,t){if(e)return s._destroy(e);s.files.map((function(e,n){return t[n]===s._fileModtimes[n]})).every((function(e){return e}))?(s._markAllVerified(),s._onStore()):s._verifyPieces(o)})):this._verifyPieces(o)));case 18:case"end":return e.stop()}}),e,this,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getFileModtimes",value:function(e){var t=this,n=[];ut(this.files.map((function(e,r){return function(i){var o=t.addUID?S.join(t.name+" - "+t.infoHash.slice(0,8)):S.join(t.path,e.path);le.stat(o,(function(e,t){if(e&&"ENOENT"!==e.code)return i(e);n[r]=t&&t.mtime.getTime(),i(null)}))}})),It,(function(r){t._debug("done getting file modtimes"),e(r,n)}))}},{key:"_verifyPieces",value:function(e){var t=this;ut(this.pieces.map((function(e,n){return function(e){if(t.destroyed)return e(new Error("torrent is destroyed"));var r={};n===t.pieces.length-1&&(r.length=t.lastPieceLength),t.store.get(n,r,function(){var r=(0,u.Z)((0,m.Z)().mark((function r(i,o){var s;return(0,m.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.destroyed){r.next=2;break}return r.abrupt("return",e(new Error("torrent is destroyed")));case 2:if(!i){r.next=4;break}return r.abrupt("return",M((function(){return e(null)})));case 4:return r.next=6,(0,N.vp)(o,"hex");case 6:if(s=r.sent,!t.destroyed){r.next=9;break}return r.abrupt("return",e(new Error("torrent is destroyed")));case 9:s===t._hashes[n]?(t._debug("piece verified %s",n),t._markVerified(n)):(t._markUnverified(n),t._debug("piece invalid %s",n)),e(null);case 10:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}})),It,e)}},{key:"rescanFiles",value:function(e){var t=this;if(this.destroyed)throw new Error("torrent is destroyed");e||(e=Mt),this._verifyPieces((function(n){if(n)return t._destroy(n),e(n);t._checkDone(),e(null)}))}},{key:"_markAllVerified",value:function(){for(var e=0;e<this.pieces.length;e++)this._markVerified(e)}},{key:"_markVerified",value:function(e){this.pieces[e]=null,this._reservations[e]=null,this.bitfield.set(e,!0)}},{key:"_markUnverified",value:function(e){var t=e===this.pieces.length-1?this.lastPieceLength:this.pieceLength;this.pieces[e]=new ct(t),this.bitfield.set(e,!1),this.select(e,e,1),this.files.forEach((function(t){t.done&&t.includes(e)&&(t.done=!1)}))}},{key:"_hasAllPieces",value:function(){for(var e=0;e<this.pieces.length;e++)if(!this.bitfield.get(e))return!1;return!0}},{key:"_hasNoPieces",value:function(){return!this._hasMorePieces(0)}},{key:"_hasMorePieces",value:function(e){for(var t=0,n=0;n<this.pieces.length;n++)if(this.bitfield.get(n)&&(t+=1)>e)return!0;return!1}},{key:"_onStore",value:function(){var e=this;this.destroyed||(this._debug("on store"),this._startDiscovery(),this.ready=!0,this.emit("ready"),this._checkDone(),this._updateSelections(),this.wires.forEach((function(t){t.ut_metadata&&t.ut_metadata.setMetadata(e.metadata),e._onWireWithMetadata(t)})))}},{key:"destroy",value:function(e,t){if("function"==typeof e)return this.destroy(null,e);this._destroy(null,e,t)}},{key:"_destroy",value:function(e,t,n){var r,i=this;if("function"==typeof t)return this._destroy(e,null,t);if(!this.destroyed){for(var o in this.destroyed=!0,this._debug("destroy"),this.client._remove(this),clearInterval(this._rechokeIntervalId),clearInterval(this._noPeersIntervalId),null!==(r=this._xsRequestsController)&&void 0!==r&&r.abort(),this._rarityMap&&this._rarityMap.destroy(),this._peers)this.removePeer(o);this.files.forEach((function(e){e instanceof _t&&e._destroy()}));var s=this._servers.map((function(e){return function(t){e.destroy(t)}}));if(this.discovery&&s.push((function(e){i.discovery.destroy(e)})),this.store){var a=this._destroyStoreOnDestroy;t&&void 0!==t.destroyStore&&(a=t.destroyStore),s.push((function(e){a?i.store.destroy(e):i.store.close(e)}))}B(s,n),e&&(0===this.listenerCount("error")?this.client.emit("error",e):this.emit("error",e)),this.emit("close"),this.client=null,this.files=[],this.discovery=null,this.store=null,this._rarityMap=null,this._peers=null,this._servers=null,this._xsRequests=null}}},{key:"addPeer",value:function(e,t){if(this.destroyed)throw new Error("torrent is destroyed");if(!this.infoHash)throw new Error("addPeer() must not be called before the `infoHash` event");var n;if(this.client.blocked){if("string"==typeof e){var r;try{r=ge(e)}catch(t){return this._debug("ignoring peer: invalid %s",e),this.emit("invalidPeer",e),!1}n=r[0]}else"string"==typeof e.remoteAddress&&(n=e.remoteAddress);if(n&&this.client.blocked.contains(n))return this._debug("ignoring peer: blocked %s",e),"string"!=typeof e&&e.destroy(),this.emit("blockedPeer",e),!1}var i=this.client.utp&&this._isIPv4(n)?"utp":"tcp",o=!!this._addPeer(e,i,t);return o?this.emit("peer",e):this.emit("invalidPeer",e),o}},{key:"_addPeer",value:function(e,t,n){if(this.destroyed)return"string"!=typeof e&&e.destroy(),null;if("string"==typeof e&&!this._validAddr(e))return this._debug("ignoring peer: invalid %s",e),null;var r,i=e&&e.id||e;return this._peers[i]?(this._debug("ignoring peer: duplicate (%s)",i),"string"!=typeof e&&e.destroy(),null):this.paused?(this._debug("ignoring peer: torrent is paused"),"string"!=typeof e&&e.destroy(),null):(this._debug("add peer %s",i),r="string"==typeof e?"utp"===t?bt.default.createUTPOutgoingPeer(e,this,this.client.throttleGroups):bt.default.createTCPOutgoingPeer(e,this,this.client.throttleGroups):bt.default.createWebRTCPeer(e,this,this.client.throttleGroups),this._registerPeer(r),"string"==typeof e&&(this._queue.push(r),this._drain()),r)}},{key:"addWebSeed",value:function(e){if(this.destroyed)throw new Error("torrent is destroyed");var t,n;if("string"==typeof e){if(!/^https?:\/\/.+/.test(t=e))return this.emit("warning",new Error("ignoring invalid web seed: ".concat(t))),void this.emit("invalidPeer",t);if(this._peers[t])return this.emit("warning",new Error("ignoring duplicate web seed: ".concat(t))),void this.emit("invalidPeer",t);n=new Tt(t,this)}else{if(!e||"string"!=typeof e.connId)return void this.emit("warning",new Error("addWebSeed must be passed a string or connection object with id property"));if(t=(n=e).connId,this._peers[t])return this.emit("warning",new Error("ignoring duplicate web seed: ".concat(t))),void this.emit("invalidPeer",t)}this._debug("add web seed %s",t);var r=bt.default.createWebSeedPeer(n,t,this,this.client.throttleGroups);this._registerPeer(r),this.emit("peer",t)}},{key:"_addIncomingPeer",value:function(e){return this.destroyed?e.destroy(new Error("torrent is destroyed")):this.paused?e.destroy(new Error("torrent is paused")):(this._debug("add incoming peer %s",e.id),void this._registerPeer(e))}},{key:"_registerPeer",value:function(e){var t=this;e.on("download",(function(e){t.destroyed||(t.received+=e,t._downloadSpeed(e),t.client._downloadSpeed(e),t.emit("download",e),t.destroyed||t.client.emit("download",e))})),e.on("upload",(function(e){t.destroyed||(t.uploaded+=e,t._uploadSpeed(e),t.client._uploadSpeed(e),t.emit("upload",e),t.destroyed||t.client.emit("upload",e))})),this._peers[e.id]=e,this._peersLength+=1}},{key:"removePeer",value:function(e){var t,n,r=(null===(t=e)||void 0===t?void 0:t.id)||e;e&&!e.id&&(e=null===(n=this._peers)||void 0===n?void 0:n[r]),e&&(e.destroy(),this.destroyed||(this._debug("removePeer %s",r),delete this._peers[r],this._peersLength-=1,this._drain()))}},{key:"select",value:function(e,t,n,r){if(this.destroyed)throw new Error("torrent is destroyed");if(e<0||t<e||this.pieces.length<=t)throw new Error("invalid selection ".concat(e," : ").concat(t));n=Number(n)||0,this._debug("select %s-%s (priority %s)",e,t,n),this._selections.push({from:e,to:t,offset:0,priority:n,notify:r||Mt}),this._selections.sort((function(e,t){return t.priority-e.priority})),this._updateSelections()}},{key:"deselect",value:function(e,t,n){if(this.destroyed)throw new Error("torrent is destroyed");n=Number(n)||0,this._debug("deselect %s-%s (priority %s)",e,t,n);for(var r=0;r<this._selections.length;++r){var i=this._selections[r];if(i.from===e&&i.to===t&&i.priority===n){this._selections.splice(r,1);break}}this._updateSelections()}},{key:"critical",value:function(e,t){if(this.destroyed)throw new Error("torrent is destroyed");this._debug("critical %s-%s",e,t);for(var n=e;n<=t;++n)this._critical[n]=!0;this._updateSelections()}},{key:"_onWire",value:function(e,t){var n=this;if(this._debug("got wire %s (%s)",e._debugId,t||"Unknown"),this.wires.push(e),t){var r=ge(t);e.remoteAddress=r[0],e.remotePort=r[1]}this.client.dht&&this.client.dht.listening&&e.on("port",(function(r){if(!n.destroyed&&!n.client.dht.destroyed){if(!e.remoteAddress)return n._debug("ignoring PORT from peer with no address");if(0===r||r>65536)return n._debug("ignoring invalid PORT from peer");n._debug("port: %s (from %s)",r,t),n.client.dht.addNode({host:e.remoteAddress,port:r})}})),e.on("timeout",(function(){n._debug("wire timeout (%s)",t),e.destroy()})),"webSeed"!==e.type&&e.setTimeout(3e4,!0),e.setKeepAlive(!0),e.use(dt(this.metadata)),e.ut_metadata.on("warning",(function(e){n._debug("ut_metadata warning: %s",e.message)})),this.metadata||(e.ut_metadata.on("metadata",(function(e){n._debug("got metadata via ut_metadata"),n._onMetadata(e)})),e.ut_metadata.fetch()),this.client.utPex&&"function"==typeof pt&&!this.private&&(e.use(pt()),e.ut_pex.on("peer",(function(e){n.done||(n._debug("ut_pex: got peer: %s (from %s)",e,t),n.addPeer(e,bt.default.SOURCE_UT_PEX))})),e.ut_pex.on("dropped",(function(e){var r=n._peers[e];r&&!r.connected&&(n._debug("ut_pex: dropped peer: %s (from %s)",e,t),n.removePeer(e))})),e.once("close",(function(){e.ut_pex.reset()}))),e.use(at()),this.emit("wire",e,t),this.ready&&M((function(){n._onWireWithMetadata(e)}))}},{key:"_onWireWithMetadata",value:function(e){var t,n=this,r=null,i=function t(){n.destroyed||e.destroyed||(n._numQueued>2*(n._numConns-n.numPeers)&&e.amInterested?e.destroy():(r=setTimeout(t,Rt)).unref&&r.unref())},o=function(){if(e.peerPieces.buffer.length===n.bitfield.buffer.length){for(t=0;t<n.pieces.length;++t)if(!e.peerPieces.get(t))return;e.isSeeder=!0,e.choke()}};e.on("bitfield",(function(){o(),n._update(),n._updateWireInterest(e)})),e.on("have",(function(){o(),n._update(),n._updateWireInterest(e)})),e.lt_donthave.on("donthave",(function(){o(),n._update(),n._updateWireInterest(e)})),e.on("have-all",(function(){e.isSeeder=!0,e.choke(),n._update(),n._updateWireInterest(e)})),e.on("have-none",(function(){e.isSeeder=!1,n._update(),n._updateWireInterest(e)})),e.on("allowed-fast",(function(e){n._update()})),e.once("interested",(function(){e.unchoke()})),e.once("close",(function(){clearTimeout(r)})),e.on("choke",(function(){clearTimeout(r),(r=setTimeout(i,Rt)).unref&&r.unref()})),e.on("unchoke",(function(){clearTimeout(r),n._update()})),e.on("request",(function(t,r,i,o){if(i>131072)return e.destroy();n.pieces[t]||n.store.get(t,{offset:r,length:i},o)})),e.hasFast&&this._hasAllPieces()?e.haveAll():e.hasFast&&this._hasNoPieces()?e.haveNone():e.bitfield(this.bitfield),this._updateWireInterest(e),e.peerExtensions.dht&&this.client.dht&&this.client.dht.listening&&e.port(this.client.dht.address().port),"webSeed"!==e.type&&((r=setTimeout(i,Rt)).unref&&r.unref()),e.isSeeder=!1,o()}},{key:"_updateSelections",value:function(){var e=this;this.ready&&!this.destroyed&&(M((function(){e._gcSelections()})),this._updateInterest(),this._update())}},{key:"_gcSelections",value:function(){for(var e=0;e<this._selections.length;++e){for(var t=this._selections[e],n=t.offset;this.bitfield.get(t.from+t.offset)&&t.from+t.offset<t.to;)t.offset+=1;n!==t.offset&&t.notify(),t.to===t.from+t.offset&&this.bitfield.get(t.from+t.offset)&&(this._selections.splice(e,1),e-=1,t.notify(),this._updateInterest())}this._selections.length||this.emit("idle")}},{key:"_updateInterest",value:function(){var e=this,t=this._amInterested;this._amInterested=!!this._selections.length,this.wires.forEach((function(t){return e._updateWireInterest(t)})),t!==this._amInterested&&(this._amInterested?this.emit("interested"):this.emit("uninterested"))}},{key:"_updateWireInterest",value:function(e){for(var t=!1,n=0;n<this.pieces.length;++n)if(this.pieces[n]&&e.peerPieces.get(n)){t=!0;break}t?e.interested():e.uninterested()}},{key:"_update",value:function(){if(!this.destroyed)for(var e,t=ht(this.wires);e=t();)this._updateWireWrapper(e)}},{key:"_updateWireWrapper",value:function(e){var t=this;"undefined"!=typeof window&&"function"==typeof window.requestIdleCallback?window.requestIdleCallback((function(){t._updateWire(e)}),{timeout:250}):t._updateWire(e)}},{key:"_updateWire",value:function(e){if(e.destroyed)return!1;var t=this,n=Bt(e,.5);if(!(e.requests.length>=n)){var r=Bt(e,1);if(e.peerChoking)e.hasFast&&e.peerAllowedFastSet.length>0&&!this._hasMorePieces(e.peerAllowedFastSet.length-1)&&function(){if(e.requests.length>=r)return!1;var n,i=(0,f.Z)(e.peerAllowedFastSet);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(e.peerPieces.get(o)&&!t.bitfield.get(o))for(;t._request(e,o,!1)&&e.requests.length<r;);if(!(e.requests.length<r))return!0}}catch(s){i.e(s)}finally{i.f()}}();else{if(!e.downloaded)return function(){if(!e.requests.length)for(var n=t._selections.length;n--;){var r=t._selections[n],o=void 0;if("rarest"===t.strategy)for(var s=r.from+r.offset,a=r.to,u=a-s+1,c={},h=0,l=i(s,a,c);h<u&&!((o=t._rarityMap.getRarestPiece(l))<0);){if(t._request(e,o,!1))return;c[o]=!0,h+=1}else for(o=r.to;o>=r.from+r.offset;--o)if(e.peerPieces.get(o)&&t._request(e,o,!1))return}}();s(!1)||s(!0)}}function i(t,n,r,i){return function(o){return o>=t&&o<=n&&!(o in r)&&e.peerPieces.get(o)&&(!i||i(o))}}function o(e){for(var n=e,r=e;r<t._selections.length&&t._selections[r].priority;r++)n=r;var i=t._selections[e];t._selections[e]=t._selections[n],t._selections[n]=i}function s(n){if(e.requests.length>=r)return!0;for(var s=function(){var n=e.downloadSpeed()||1;if(n>Pt)return function(){return!0};var r=Math.max(1,e.requests.length)*ct.BLOCK_LENGTH/n,i=10,o=0;return function(e){if(!i||t.bitfield.get(e))return!0;for(var s=t.pieces[e].missing;o<t.wires.length;o++){var a=t.wires[o],u=a.downloadSpeed();if(!(u<Pt)&&!(u<=n)&&a.peerPieces.get(e)&&!((s-=u*r)>0))return i--,!1}return!0}}(),a=0;a<t._selections.length;a++){var u=t._selections[a],c=void 0;if("rarest"===t.strategy)for(var h=u.from+u.offset,l=u.to,f=l-h+1,d={},p=0,v=i(h,l,d,s);p<f&&!((c=t._rarityMap.getRarestPiece(v))<0);){for(;t._request(e,c,t._critical[c]||n)&&e.requests.length<r;);if(!(e.requests.length<r))return u.priority&&o(a),!0;d[c]=!0,p++}else for(c=u.from+u.offset;c<=u.to;c++)if(e.peerPieces.get(c)&&s(c)){for(;t._request(e,c,t._critical[c]||n)&&e.requests.length<r;);if(!(e.requests.length<r))return u.priority&&o(a),!0}}return!1}}},{key:"_rechoke",value:function(){var e=this;if(this.ready){var t=this.wires.map((function(e){return{wire:e,random:Math.random()}})).sort((function(e,t){var n=e.wire,r=t.wire;return n.downloadSpeed()!==r.downloadSpeed()?n.downloadSpeed()-r.downloadSpeed():n.uploadSpeed()!==r.uploadSpeed()?n.uploadSpeed()-r.uploadSpeed():n.amChoking!==r.amChoking?n.amChoking?-1:1:e.random-t.random})).map((function(e){return e.wire}));this._rechokeOptimisticTime<=0?this._rechokeOptimisticWire=null:this._rechokeOptimisticTime-=1;for(var n,r=0;t.length>0&&r<this._rechokeNumSlots-1;){var i=t.pop();i.isSeeder||i===this._rechokeOptimisticWire||(i.unchoke(),i.peerInterested&&r++)}if(null===this._rechokeOptimisticWire&&this._rechokeNumSlots>0){var o=t.filter((function(e){return e.peerInterested}));if(o.length>0){var s=o[(n=o.length,Math.random()*n|0)];s.unchoke(),this._rechokeOptimisticWire=s,this._rechokeOptimisticTime=2}}t.filter((function(t){return t!==e._rechokeOptimisticWire})).forEach((function(e){return e.choke()}))}}},{key:"_hotswap",value:function(e,t){var n=e.downloadSpeed();if(n<ct.BLOCK_LENGTH)return!1;if(!this._reservations[t])return!1;var r=this._reservations[t];if(!r)return!1;var i,o,s=1/0;for(o=0;o<r.length;o++){var a=r[o];if(a&&a!==e){var u=a.downloadSpeed();u>=Pt||2*u>n||u>s||(i=a,s=u)}}if(!i)return!1;for(o=0;o<r.length;o++)r[o]===i&&(r[o]=null);for(o=0;o<i.requests.length;o++){var c=i.requests[o];c.piece===t&&this.pieces[t].cancel(c.offset/ct.BLOCK_LENGTH|0)}return this.emit("hotswap",i,e,t),!0}},{key:"_request",value:function(e,t,n){var r=this,i=e.requests.length,o="webSeed"===e.type;if(r.bitfield.get(t))return!1;var s=o?Math.min(function(e,t,n){return 1+Math.ceil(1*e.downloadSpeed()/n)}(e,0,r.pieceLength),r.maxWebConns):Bt(e,1);if(i>=s)return!1;var a=r.pieces[t],c=o?a.reserveRemaining():a.reserve();if(-1===c&&n&&r._hotswap(e,t)&&(c=o?a.reserveRemaining():a.reserve()),-1===c)return!1;var h=r._reservations[t];h||(h=r._reservations[t]=[]);var l=h.indexOf(null);-1===l&&(l=h.length),h[l]=e;var f=a.chunkOffset(c),d=o?a.chunkLengthRemaining(c):a.chunkLength(c);function p(){M((function(){r._update()}))}return e.request(t,f,d,function(){var n=(0,u.Z)((0,m.Z)().mark((function n(s,u){var v,g;return(0,m.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!r.destroyed){n.next=2;break}return n.abrupt("return");case 2:if(r.ready){n.next=4;break}return n.abrupt("return",r.once("ready",(function(){i(s,u)})));case 4:if(h[l]===e&&(h[l]=null),a===r.pieces[t]){n.next=6;break}return n.abrupt("return",p());case 6:if(!s){n.next=8;break}return n.abrupt("return",(r._debug("error getting piece %s (offset: %s length: %s) from %s: %s",t,f,d,"".concat(e.remoteAddress,":").concat(e.remotePort),s.message),o?a.cancelRemaining(c):a.cancel(c),void p()));case 8:if(r._debug("got piece %s (offset: %s length: %s) from %s",t,f,d,"".concat(e.remoteAddress,":").concat(e.remotePort)),a.set(c,u,e)){n.next=10;break}return n.abrupt("return",p());case 10:return v=a.flush(),n.next=13,(0,N.vp)(v,"hex");case 13:g=n.sent,r.destroyed||(g===r._hashes[t]?(r._debug("piece verified %s",t),r.store.put(t,v,(function(e){e?r._destroy(e):(r.pieces[t]=null,r._markVerified(t),r.wires.forEach((function(e){e.have(t)})),r._checkDone()&&!r.destroyed&&r.discovery.complete(),p())}))):(r.pieces[t]=new ct(a.length),r.emit("warning",new Error("Piece ".concat(t," failed verification"))),p()));case 15:case"end":return n.stop()}}),n)})));function i(e,t){return n.apply(this,arguments)}return i}()),!0}},{key:"_checkDone",value:function(){var e=this;if(!this.destroyed){this.files.forEach((function(t){if(!t.done){for(var n=t._startPiece;n<=t._endPiece;++n)if(!e.bitfield.get(n))return;t.done=!0,t.emit("done"),e._debug("file done: ".concat(t.name))}}));var t,n=!0,r=(0,f.Z)(this._selections);try{for(r.s();!(t=r.n()).done;){for(var i=t.value,o=i.from;o<=i.to;o++)if(!this.bitfield.get(o)){n=!1;break}if(!n)break}}catch(s){r.e(s)}finally{r.f()}return!this.done&&n?(this.done=!0,this._debug("torrent done: ".concat(this.infoHash)),this.emit("done")):this.done=!1,this._gcSelections(),n}}},{key:"load",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t,n){var r=this;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.destroyed){e.next=2;break}throw new Error("torrent is destroyed");case 2:if(this.ready){e.next=4;break}return e.abrupt("return",this.once("ready",(function(){r.load(t,n)})));case 4:return Array.isArray(t)||(t=[t]),n||(n=Mt),e.prev=5,e.next=8,we(this.store,Z(t),{chunkLength:this.pieceLength});case 8:this._markAllVerified(),this._checkDone(),n(null),e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(5),e.abrupt("return",(n(e.t0),e.t0));case 16:case"end":return e.stop()}}),e,this,[[5,13]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"pause",value:function(){this.destroyed||(this._debug("pause"),this.paused=!0)}},{key:"resume",value:function(){this.destroyed||(this._debug("resume"),this.paused=!1,this._drain())}},{key:"_debug",value:function(){var e=[].slice.call(arguments);e[0]="[".concat(this.client?this.client._debugId:"No Client","] [").concat(this._debugId,"] ").concat(e[0]),At.apply(void 0,(0,l.Z)(e))}},{key:"_drain",value:function(){var e=this;if(this._debug("_drain numConns %s maxConns %s",this._numConns,this.client.maxConns),!("function"!=typeof fe.connect||this.destroyed||this.paused||this._numConns>=this.client.maxConns)){this._debug("drain (%s queued, %s/%s peers)",this._numQueued,this.numPeers,this.client.maxConns);var t=this._queue.shift();if(t){this._debug("%s connect attempt to %s",t.type,t.addr);var n=ge(t.addr),r={host:n[0],port:n[1]};this.client.utp&&t.type===bt.default.TYPE_UTP_OUTGOING?t.conn=kt.connect(r.port,r.host):t.conn=fe.connect(r);var i=t.conn;i.once("connect",(function(){e.destroyed||t.onConnect()})),i.once("error",(function(e){t.destroy(e)})),t.startConnectTimeout(),i.on("close",(function(){if(!e.destroyed)if(t.retries>=Lt.length)if(e.client.utp){var n=e._addPeer(t.addr,"tcp",t.source);n&&(n.retries=0)}else e._debug("conn %s closed: will not re-add (max %s attempts)",t.addr,Lt.length);else{var r=Lt[t.retries];e._debug("conn %s closed: will re-add to queue in %sms (attempt %s)",t.addr,r,t.retries+1);var i=setTimeout((function(){if(!e.destroyed){var n=ge(t.addr)[0],r=e.client.utp&&e._isIPv4(n)?"utp":"tcp",i=e._addPeer(t.addr,r,t.source);i&&(i.retries=t.retries+1)}}),r);i.unref&&i.unref()}}))}}}},{key:"_validAddr",value:function(e){var t;try{t=ge(e)}catch(e){return!1}var n=t[0],r=t[1];return r>0&&r<65535&&!("127.0.0.1"===n&&r===this.client.torrentPort)}},{key:"_isIPv4",value:function(e){return/^((?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])[.]){3}(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])$/.test(e)}}]),n}(k);function Bt(e,t){var n=2+Math.ceil(t*e.downloadSpeed()/ct.BLOCK_LENGTH);if(e.peerExtendedHandshake){var r=e.peerExtendedHandshake.reqq;"number"==typeof r&&r>0&&(n=Math.min(n,r))}return n}function Mt(){}var Nt=P(3423),jt=P(5573),Ut=P(4286),Dt=P(4622),Ht=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,d.Z)(this,e),this.client=t,n.origin||(n.origin="*"),this.opts=n,this.pendingReady=new Set}return(0,p.Z)(e,[{key:"isOriginAllowed",value:function(e){return!1!==this.opts.origin&&("*"===this.opts.origin||e.headers.origin===this.opts.origin)}},{key:"onRequest",value:function(){var t=(0,u.Z)((0,m.Z)().mark((function t(n,i){var o,s,a,c,h,l=this;return(0,m.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=(o=new URL(n.url,"http://example.com").pathname).slice(o.indexOf(this.pathname)+this.pathname.length+1),s={headers:{"X-Content-Type-Options":"nosniff","Content-Security-Policy":"base-uri 'none'; frame-ancestors 'none'; form-action 'none';"}},this.isOriginAllowed(n)&&(s.headers["Access-Control-Allow-Origin"]="*"===this.opts.origin?"*":n.headers.origin),"favicon.ico"!==o){t.next=5;break}return t.abrupt("return",i(e.serve404Page(s)));case 5:if("OPTIONS"!==n.method){t.next=7;break}return t.abrupt("return",this.isOriginAllowed(n)?i(e.serveOptionsRequest(n,s)):i(e.serveMethodNotAllowed(s)));case 7:if(a=function(){var e=(0,u.Z)((0,m.Z)().mark((function e(){var t;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l.pendingReady.delete(a),e.next=3,c();case 3:t=e.sent,i(t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c=function(){var t=(0,u.Z)((0,m.Z)().mark((function t(){var i,a,u,c,h,f;return(0,m.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(""!==o){t.next=2;break}return t.abrupt("return",e.serveIndexPage(s,l.client.torrents,l.pathname));case 2:return i=o.split("/"),a=(0,r.Z)(i),u=a[0],c=a.slice(1),c=decodeURI(c.join("/")),t.next=6,l.client.get(u);case 6:if(h=t.sent,u&&h){t.next=9;break}return t.abrupt("return",e.serve404Page(s));case 9:if(c){t.next=11;break}return t.abrupt("return",e.serveTorrentPage(h,s,l.pathname));case 11:return f=h.files.find((function(e){return e.path.replace(/\\/g,"/")===c})),t.abrupt("return",f?e.serveFile(f,n,s):e.serve404Page(s));case 13:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),"GET"!==n.method&&"HEAD"!==n.method){t.next=15;break}if(!this.client.ready){t.next=14;break}return t.next=12,c();case 12:return h=t.sent,t.abrupt("return",i(h));case 14:return t.abrupt("return",(this.pendingReady.add(a),void this.client.once("ready",a)));case 15:return t.abrupt("return",e.serveMethodNotAllowed(s));case 16:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"close",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.closed=!0,this.pendingReady.forEach((function(t){e.client.removeListener("ready",t)})),this.pendingReady.clear(),M(t)}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.closed?M(e):this.close(e),this.client=null}}],[{key:"serveIndexPage",value:function(e,t,n){var r=t.map((function(e){return'<li>\n        <a href="'.concat(jt(n),"/").concat(e.infoHash,'">\n          ').concat(jt(e.name),"\n        </a>\n        (").concat(jt(e.length)," bytes)\n      </li>")})).join("<br>");return e.status=200,e.headers["Content-Type"]="text/html",e.body=Wt("WebTorrent","<h1>WebTorrent</h1>\n         <ol>".concat(r,"</ol>")),e}},{key:"serveMethodNotAllowed",value:function(e){return e.status=405,e.headers["Content-Type"]="text/html",e.body=Wt("405 - Method Not Allowed","<h1>405 - Method Not Allowed</h1>"),e}},{key:"serve404Page",value:function(e){return e.status=404,e.headers["Content-Type"]="text/html",e.body=Wt("404 - Not Found","<h1>404 - Not Found</h1>"),e}},{key:"serveTorrentPage",value:function(e,t,n){var r=e.files.map((function(t){return'<li>\n      <a href="'.concat(jt(n),"/").concat(e.infoHash,"/").concat(jt(t.path),'">\n        ').concat(jt(t.path),"\n      </a>\n      (").concat(jt(t.length)," bytes)\n    </li>")})).join("<br>");return t.status=200,t.headers["Content-Type"]="text/html",t.body=Wt("".concat(jt(e.name)," - WebTorrent"),"<h1>".concat(jt(e.name),"</h1>\n        <ol>").concat(r,"</ol>")),t}},{key:"serveOptionsRequest",value:function(e,t){return t.status=204,t.headers["Access-Control-Max-Age"]="600",t.headers["Access-Control-Allow-Methods"]="GET,HEAD",e.headers["access-control-request-headers"]&&(t.headers["Access-Control-Allow-Headers"]=e.headers["access-control-request-headers"]),t}},{key:"serveFile",value:function(e,t,n){n.status=200,n.headers.Expires="0",n.headers["Cache-Control"]="no-cache, no-store, must-revalidate, max-age=0",n.headers["Accept-Ranges"]="bytes",n.headers["Content-Type"]=e.type,n.headers["transferMode.dlna.org"]="Streaming",n.headers["contentFeatures.dlna.org"]="DLNA.ORG_OP=01;DLNA.ORG_CI=0;DLNA.ORG_FLAGS=01700000000000000000000000000000","document"===t.destination?(n.headers["Content-Type"]="application/octet-stream",n.headers["Content-Disposition"]="attachment; filename*=UTF-8''".concat(zt(e.name)),n.body="DOWNLOAD"):n.headers["Content-Disposition"]="inline; filename*=UTF-8''".concat(zt(e.name));var r=Dt(e.length,t.headers.range||"");if(Array.isArray(r)?(n.status=206,r=r[0],n.headers["Content-Range"]="bytes ".concat(r.start,"-").concat(r.end,"/").concat(e.length),n.headers["Content-Length"]=r.end-r.start+1):(n.statusCode=200,r=null,n.headers["Content-Length"]=e.length),"GET"===t.method){var i=e[Symbol.asyncIterator](r),o=null;e.emit("iterator",{iterator:i,req:t,file:e},(function(e){o=e}));var s=vt.Readable.from(o||i),a=null;e.emit("stream",{stream:s,req:t,file:e},(function(e){a=Ut(s,e)})),n.body=a||s}else n.body=!1;return n}}]),e}(),Ft=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this,e,r)).server=Nt.createServer(),i._listen=i.server.listen,i.server.listen=i.listen.bind((0,v.Z)(i)),i._close=i.server.close,i.server.close=i.close.bind((0,v.Z)(i)),i.sockets=new Set,i.closed=!1,i.pathname=(null===r||void 0===r?void 0:r.pathname)||"/webtorrent",i}return(0,p.Z)(n,[{key:"wrapRequest",value:function(e,t){return this.opts.hostname&&e.headers.host!=="".concat(this.opts.hostname,":").concat(this.server.address().port)?e.destroy():new URL(e.url,"http://example.com").pathname.startsWith(this.pathname)?void this.onRequest(e,(function(e){var n=e.status,r=e.headers,i=e.body;t.writeHead(n,r),i instanceof vt.Readable?Ut(i,t):t.end(i)})):e.destroy()}},{key:"onConnection",value:function(e){var t=this;e.setTimeout(36e6),this.sockets.add(e),e.once("close",(function(){t.sockets.delete(e)}))}},{key:"address",value:function(){return this.server.address()}},{key:"listen",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.closed=!1,this.server.on("connection",this.onConnection.bind(this)),this.server.on("request",this.wrapRequest.bind(this)),this._listen.apply(this.server,t)}},{key:"close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.server.removeAllListeners("connection"),this.server.removeAllListeners("request"),(0,o.Z)((0,s.Z)(n.prototype),"close",this).call(this),this._close.call(this.server,e)}},{key:"destroy",value:function(e){this.sockets.forEach((function(e){e.destroy()})),(0,o.Z)((0,s.Z)(n.prototype),"destroy",this).call(this,e)}}]),n}(Ht),qt=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;(0,d.Z)(this,n),(i=t.call(this,e,r)).registration=r.controller,i.workerKeepAliveInterval=null,i.workerPortCount=0;var o=new URL(r.controller.scope);return i.pathname=o.pathname+"webtorrent",i._address={port:o.port,family:"IPv4",address:o.hostname},i.boundHandler=i.wrapRequest.bind((0,v.Z)(i)),navigator.serviceWorker.addEventListener("message",i.boundHandler),fetch("".concat(i.pathname,"/cancel/")).then((function(e){e.body.cancel()})),i}return(0,p.Z)(n,[{key:"wrapRequest",value:function(e){var t=this,n=e.data;if("webtorrent"===!(null!==n&&void 0!==n&&n.type)||!n.url)return null;var r=(0,i.Z)(e.ports,1)[0];this.onRequest(n,(function(e){var n=e.status,i=e.headers,o=e.body,s=o instanceof vt.Readable&&o[Symbol.asyncIterator](),a=function(){r.onmessage=null,null!==o&&void 0!==o&&o.destroy&&o.destroy(),t.workerPortCount--,t.workerPortCount||(clearInterval(t.workerKeepAliveInterval),t.workerKeepAliveInterval=null)};r.onmessage=function(){var e=(0,u.Z)((0,m.Z)().mark((function e(n){var i;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.data){e.next=12;break}return e.prev=1,e.next=4,s.next();case 4:i=e.sent.value,e.next=9;break;case 7:e.prev=7,e.t0=e.catch(1);case 9:r.postMessage(i),i||a(),t.workerKeepAliveInterval||(t.workerKeepAliveInterval=setInterval((function(){return fetch("".concat(t.pathname,"/keepalive/"))}),2e4)),e.next=13;break;case 12:a();case 13:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}(),t.workerPortCount++,r.postMessage({status:n,headers:i,body:s?"STREAM":o})}))}},{key:"listen",value:function(e,t){t()}},{key:"address",value:function(){return this._address}},{key:"close",value:function(e){navigator.serviceWorker.removeEventListener("message",this.boundHandler),(0,o.Z)((0,s.Z)(n.prototype),"close",this).call(this,e)}},{key:"destroy",value:function(e){(0,o.Z)((0,s.Z)(n.prototype),"destroy",this).call(this,e)}}]),n}(Ht);function Wt(e,t){return'\n    <!DOCTYPE html>\n    <html lang="en">\n      <head>\n        <meta charset="utf-8">\n        <title>'.concat(e,"</title>\n      </head>\n      <body>\n        ").concat(t,"\n      </body>\n    </html>\n  ")}function zt(e){return encodeURIComponent(e).replace(/['()]/g,escape).replace(/\*/g,"%2A").replace(/%(?:7C|60|5E)/g,unescape)}var Gt=Et,Vt=G("webtorrent"),Kt=Gt.replace(/\d*./g,(function(e){return("0"+e%100).slice(-2)})).slice(0,4),Yt="-WW".concat(Kt,"-"),$t=function(e){(0,g.Z)(n,e);var t=(0,y.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,d.Z)(this,n),e=t.call(this),"string"==typeof r.peerId?e.peerId=r.peerId:ArrayBuffer.isView(r.peerId)?e.peerId=(0,N.oc)(r.peerId):e.peerId=(0,N.oc)((0,N.gR)(Yt+(0,N.te)(ae(9)))),e.peerIdBuffer=(0,N._0)(e.peerId),"string"==typeof r.nodeId?e.nodeId=r.nodeId:ArrayBuffer.isView(r.nodeId)?e.nodeId=(0,N.oc)(r.nodeId):e.nodeId=(0,N.oc)(ae(20)),e.nodeIdBuffer=(0,N._0)(e.nodeId),e._debugId=(0,N.oc)(e.peerId).substring(0,7),e.destroyed=!1,e.listening=!1,e.torrentPort=r.torrentPort||0,e.dhtPort=r.dhtPort||0,e.tracker=void 0!==r.tracker?r.tracker:{},e.lsd=!1!==r.lsd,e.utPex=!1!==r.utPex,e.torrents=[],e.maxConns=Number(r.maxConns)||55,e.utp=n.UTP_SUPPORT&&!1!==r.utp,e._downloadLimit=Math.max("number"==typeof r.downloadLimit?r.downloadLimit:-1,-1),e._uploadLimit=Math.max("number"==typeof r.uploadLimit?r.uploadLimit:-1,-1),!0===r.secure&&Promise.resolve().then(P.bind(P,3287)).then((function(e){return(0,e.enableSecure)()})),e._debug("new webtorrent (peerId %s, nodeId %s, port %s)",e.peerId,e.nodeId,e.torrentPort),e.throttleGroups={down:new ce.ThrottleGroup({rate:Math.max(e._downloadLimit,0),enabled:e._downloadLimit>=0}),up:new ce.ThrottleGroup({rate:Math.max(e._uploadLimit,0),enabled:e._uploadLimit>=0})},e.tracker&&("object"!=typeof e.tracker&&(e.tracker={}),globalThis.WRTC&&!e.tracker.wrtc&&(e.tracker.wrtc=globalThis.WRTC)),"function"==typeof he?e._connPool=new he((0,v.Z)(e)):M((function(){e._onListening()})),e._downloadSpeed=ue(),e._uploadSpeed=ue(),!1!==r.dht&&"function"==typeof V.Client?(e.dht=new V.Client(Object.assign({},{nodeId:e.nodeId},r.dht)),e.dht.once("error",(function(t){e._destroy(t)})),e.dht.once("listening",(function(){var t=e.dht.address();t&&(e.dhtPort=t.port)})),e.dht.setMaxListeners(0),e.dht.listen(e.dhtPort)):e.dht=!1,e.enableWebSeeds=!1!==r.webSeeds;var i=function(){e.destroyed||(e.ready=!0,e.emit("ready"))};return"function"==typeof K&&null!=r.blocklist?K(r.blocklist,{headers:{"user-agent":"WebTorrent/".concat(Gt," (https://webtorrent.io)")}},(function(t,n){if(t)return console.error("Failed to load blocklist: ".concat(t.message));e.blocked=n,i()})):M(i),e}return(0,p.Z)(n,[{key:"createServer",value:function(e,t){if(this.destroyed)throw new Error("torrent is destroyed");if(this._server)throw new Error("server already created");if("undefined"!=typeof window&&"node"!==t||"browser"===t){if(!((null===e||void 0===e?void 0:e.controller)instanceof ServiceWorkerRegistration))throw new Error("Invalid worker registration");if("activated"!==e.controller.active.state)throw new Error("Worker isn't activated");return this._server=new qt(this,e),this._server}return this._server=new Ft(this,e),this._server}},{key:"downloadSpeed",get:function(){return this._downloadSpeed()}},{key:"uploadSpeed",get:function(){return this._uploadSpeed()}},{key:"progress",get:function(){var e=this.torrents.filter((function(e){return 1!==e.progress}));return e.reduce((function(e,t){return e+t.downloaded}),0)/(e.reduce((function(e,t){return e+(t.length||0)}),0)||1)}},{key:"ratio",get:function(){return this.torrents.reduce((function(e,t){return e+t.uploaded}),0)/(this.torrents.reduce((function(e,t){return e+t.received}),0)||1)}},{key:"get",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var n,r,i,o,s;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof Zt)){e.next=5;break}if(!this.torrents.includes(t)){e.next=3;break}return e.abrupt("return",t);case 3:e.next=35;break;case 5:return n=this.torrents,e.prev=6,e.next=9,oe(t);case 9:r=e.sent,e.next=14;break;case 12:e.prev=12,e.t0=e.catch(6);case 14:if(r){e.next=16;break}return e.abrupt("return",null);case 16:if(r.infoHash){e.next=18;break}throw new Error("Invalid torrent identifier");case 18:i=(0,f.Z)(n),e.prev=19,i.s();case 21:if((o=i.n()).done){e.next=27;break}if((s=o.value).infoHash!==r.infoHash){e.next=25;break}return e.abrupt("return",s);case 25:e.next=21;break;case 27:e.next=32;break;case 29:e.prev=29,e.t1=e.catch(19),i.e(e.t1);case 32:return e.prev=32,i.f(),e.finish(32);case 35:return e.abrupt("return",null);case 36:case"end":return e.stop()}}),e,this,[[6,12],[19,29,32,35]])})));return function(t){return e.apply(this,arguments)}}()},{key:"add",value:function(e){var t,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(this.destroyed)throw new Error("client is destroyed");"function"==typeof r&&(r=(t=[{},r])[0],i=t[1]);var o=function(){if(!n.destroyed){var e,t=(0,f.Z)(n.torrents);try{for(t.s();!(e=t.n()).done;){var r=e.value;if(r.infoHash===a.infoHash&&r!==a)return a._destroy(new Error("Cannot add duplicate torrent ".concat(a.infoHash))),void i(r)}}catch(o){t.e(o)}finally{t.f()}}},s=function(){n.destroyed||(i(a),n.emit("torrent",a))};this._debug("add"),r=r?Object.assign({},r):{};var a=new Zt(e,this,r);return this.torrents.push(a),a.once("_infoHash",o),a.once("ready",s),a.once("close",(function e(){a.removeListener("_infoHash",o),a.removeListener("ready",s),a.removeListener("close",e)})),a}},{key:"seed",value:function(e,t,n){var r,i=this;if(this.destroyed)throw new Error("client is destroyed");"function"==typeof t&&(t=(r=[{},t])[0],n=r[1]),this._debug("seed"),(t=t?Object.assign({},t):{}).skipVerify=!0;var o="string"==typeof e;o&&(t.path=S.dirname(e)),t.createdBy||(t.createdBy="WebTorrent/".concat(Kt));var s,a=this.add(null,t,(function(e){var r=[function(n){if(o||t.preloadedStore)return n();e.load(s,n)}];i.dht&&r.push((function(t){e.once("dhtAnnounce",t)})),B(r,(function(t){if(!i.destroyed)return t?e._destroy(t):void function(e){i._debug("on seed"),"function"==typeof n&&n(e),e.emit("seed"),i.emit("seed",e)}(e)}))}));return"undefined"!=typeof FileList&&e instanceof FileList?e=Array.from(e):Array.isArray(e)||(e=[e]),B(e.map((function(e){return function(n){!t.preloadedStore&&function(e){return"object"==typeof e&&null!=e&&"function"==typeof e.pipe}(e)?T(e,(function(t,r){if(t)return n(t);r.name=e.name,n(null,r)})):n(null,e)}})),(function(e,r){if(!i.destroyed)return e?a._destroy(e):void function(e,t,n){var r;"function"==typeof t&&(t=(r=[n,t])[0],n=r[1]),H(e,t=t?Object.assign({},t):{},n)}(r,t,(function(e,o){if(!i.destroyed){if(e)return a._destroy(e);s=o.map((function(e){return e.getStream})),z(r,t,function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t,r){var o;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i.destroyed){e.next=2;break}return e.abrupt("return");case 2:if(!t){e.next=4;break}return e.abrupt("return",a._destroy(t));case 4:return e.next=6,i.get(r);case 6:(o=e.sent)?(console.warn("A torrent with the same id is already being seeded"),a._destroy(),"function"==typeof n&&n(o)):a._onTorrentId(r);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}}))})),a}},{key:"remove",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t,n,r){var i;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof n){e.next=2;break}return e.abrupt("return",this.remove(t,null,n));case 2:return this._debug("remove"),e.next=5,this.get(t);case 5:if(i=e.sent){e.next=8;break}throw new Error("No torrent with id ".concat(t));case 8:this._remove(i,n,r);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_remove",value:function(e,t,n){if(e){if("function"==typeof t)return this._remove(e,null,t);this.torrents.splice(this.torrents.indexOf(e),1),e.destroy(t,n),this.dht&&this.dht._tables.remove(e.infoHash)}}},{key:"address",value:function(){return this.listening?this._connPool?this._connPool.tcpServer.address():{address:"0.0.0.0",family:"IPv4",port:0}:null}},{key:"throttleDownload",value:function(e){return e=Number(e),!(isNaN(e)||!isFinite(e)||e<-1)&&(this._downloadLimit=e,this._downloadLimit<0?this.throttleGroups.down.setEnabled(!1):(this.throttleGroups.down.setEnabled(!0),void this.throttleGroups.down.setRate(this._downloadLimit)))}},{key:"throttleUpload",value:function(e){return e=Number(e),!(isNaN(e)||!isFinite(e)||e<-1)&&(this._uploadLimit=e,this._uploadLimit<0?this.throttleGroups.up.setEnabled(!1):(this.throttleGroups.up.setEnabled(!0),void this.throttleGroups.up.setRate(this._uploadLimit)))}},{key:"destroy",value:function(e){if(this.destroyed)throw new Error("client already destroyed");this._destroy(null,e)}},{key:"_destroy",value:function(e,t){var n=this;this._debug("client destroy"),this.destroyed=!0;var r=this.torrents.map((function(e){return function(t){e.destroy(t)}}));this._connPool&&r.push((function(e){n._connPool.destroy(e)})),this.dht&&r.push((function(e){n.dht.destroy(e)})),this._server&&r.push((function(e){n._server.destroy(e)})),B(r,t),e&&this.emit("error",e),this.torrents=[],this._connPool=null,this.dht=null,this.throttleGroups.down.destroy(),this.throttleGroups.up.destroy()}},{key:"_onListening",value:function(){if(this._debug("listening"),this.listening=!0,this._connPool){var e=this._connPool.tcpServer.address();e&&(this.torrentPort=e.port)}this.emit("listening")}},{key:"_debug",value:function(){var e=[].slice.call(arguments);e[0]="[".concat(this._debugId,"] ").concat(e[0]),Vt.apply(void 0,(0,l.Z)(e))}},{key:"_getByHash",value:function(){var e=(0,u.Z)((0,m.Z)().mark((function e(t){var n,r,i;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,f.Z)(this.torrents),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=14;break}if(i=r.value,e.t0=i.infoHashHash,e.t0){e.next=10;break}return e.next=9,(0,N.vp)((0,N._0)("72657132"+i.infoHash),"hex");case 9:i.infoHashHash=e.sent;case 10:if(t!==i.infoHashHash){e.next=12;break}return e.abrupt("return",i);case 12:e.next=3;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(1),n.e(e.t1);case 19:return e.prev=19,n.f(),e.finish(19);case 22:return e.abrupt("return",null);case 23:case"end":return e.stop()}}),e,this,[[1,16,19,22]])})));return function(t){return e.apply(this,arguments)}}()}]),n}(k);$t.WEBRTC_SUPPORT=se.WEBRTC_SUPPORT,$t.UTP_SUPPORT=he.UTP_SUPPORT,$t.VERSION=Gt}();var L=I.Z}}]);
//# sourceMappingURL=762.d7c6f697.chunk.js.map